<?xml version="1.0" encoding="utf-8"?>
<mx:TitleWindow xmlns:mx="http://www.adobe.com/2006/mxml" 
				width="558" height="490" 
				xmlns:util="views.util.*" 
				showCloseButton="true" close="exitRequest()"
				initialize="update(event)"
				title="Assign index profile to selected samples">
	
	<mx:Script>
		<![CDATA[
			import hci.flex.controls.DropdownLabel;
			import hci.flex.dictionary.DictionaryEditor;
			import hci.flex.dictionary.DictionaryEvent;
			
			import mx.collections.XMLListCollection;
			import mx.controls.Alert;
			import mx.controls.listClasses.ListBase;
			import mx.core.DragSource;
			import mx.core.UIComponent;
			import mx.events.CloseEvent;
			import mx.events.CollectionEvent;
			import mx.events.CollectionEventKind;
			import mx.events.DragEvent;
			import mx.events.FlexEvent;
			import mx.events.ListEvent;
			import mx.events.PropertyChangeEvent;
			import mx.managers.DragManager;
			import mx.managers.PopUpManager;
			import mx.rpc.events.ResultEvent;
			
			import views.util.PromptXMLListCollection;
			
			public var hasChanged:Boolean = false;
			
			[Bindable]
			public var currentSample:String;
			
			[Bindable]
			public var workListFilt:XMLListCollection;
			
			[Bindable]
			public var sampleIndices:Array;
			
			public var parentView:DisplayObject;
			
			public function filterWorkList(item:Object):Boolean {
				var keep:Boolean = false;
				var idx:int = workListFilt.getItemIndex(item);
				
				for(var incl:String in sampleIndices){
					if(idx == sampleIndices[incl]){
						keep = true;
					}
				}

				return keep;
			} 
			
			private function save():void{
				
			}
			
			private function onPromptToCancel(event:CloseEvent):void {
				if (event.detail == Alert.YES) {
					cancel();
				}
			}
			
			protected function exitRequest():void {
				if (hasChanged==true) {
					Alert.show("Are you sure you want to exit without saving?",
						"Confirm",
						(Alert.YES | Alert.NO), this, 
						onPromptToCancel,						
						parentApplication.iconWarning);
				} else {
					cancel();
				}
			}
			
			protected function cancelRequest():void {
				if (hasChanged==true) {
					Alert.show("Are you sure you want to cancel without saving?",
						"Confirm",
						(Alert.YES | Alert.NO), this, 
						onPromptToCancel,						
						parentApplication.iconWarning);
				} else  {
					cancel();
				}
			}
			
			protected function cancel():void {
				PopUpManager.removePopUp(this);
			}
			
			protected function previousIndex():void {
				
			}
			
			protected function nextIndex():void {
				
			}
			
			public function getIndexTreeLabel(item:Object):String { 
				return item.@sampleNumber;
			}
			
			protected function update(event:FlexEvent):void
			{
				indexTree.selectedIndex = 0;
				currentSample = indexTree.selectedItem.@sampleNumber;
			}
			
			protected function indexTree_changeSelection(event:ListEvent):void
			{
				currentSample = indexTree.selectedItem.@sampleNumber;
			}
			
		]]> 
	</mx:Script>
	
	<mx:VBox width="100%" height="100%" verticalGap="0">
		<mx:HDividedBox height="100%" width="100%" >
			<mx:VBox height="100%" width="200" styleName="panelBox">
				<mx:Canvas label="Samples" width="100%" height="100%">
					<mx:HDividedBox width="100%" height="100%" 
									paddingBottom="4" 
									paddingLeft="4" 
									paddingRight="4" 
									paddingTop="4">
						<mx:VBox width="200" height="100%">
							
							<mx:Text  width="100%" 
									  text="Samples to assign index to:" fontSize="11" styleName="formLabel">						
							</mx:Text>
							<mx:Tree width="195" height="100%" 
									 id="indexTree"
									 selectedIndex="0"
									 showRoot="false" 
									 dropEnabled="false"
									 dragMoveEnabled="false"
									 change="indexTree_changeSelection(event)"
									 iconFunction="parentApplication.getTreeIcon"
									 labelFunction="getIndexTreeLabel"
									 dataProvider="{workListFilt}"
							>						
							</mx:Tree>
						</mx:VBox>
						<mx:VBox width="301" height="100%" styleName="form">
							<mx:VBox verticalGap="0" 
									 width="100%" height="100%" 
									 id="vbox1">
							     <mx:HBox width="100%">
									 <mx:Text  width="100%" text="Select index profile:" fontSize="11" styleName="formLabel" />
							          <mx:HBox width="83" horizontalAlign="right" horizontalGap="0">
							               
										  <mx:LinkButton label="Clear all" 
														  toolTip="Clear all samples" 
														  id="sampleClearButton"
							               				  icon="@Embed(source='../../assets/folder_delete.png')" 
														  disabledIcon="@Embed(source='../../assets/folder_delete_disable.png') " 
														  textDecoration="underline"/>
							          </mx:HBox>
							     </mx:HBox>
							</mx:VBox>
						</mx:VBox>	
					</mx:HDividedBox>
				</mx:Canvas>
			</mx:VBox>	
		</mx:HDividedBox>
	</mx:VBox>
	
	<mx:ControlBar horizontalAlign="right" width="100%">
	    <mx:HBox width="100%" 
				 horizontalAlign="right" 
				 verticalAlign="middle">
			<mx:Button label="Cancel" 
					   click="cancelRequest()" 
					   id="cancelButton"/>
			<mx:Spacer width="100%" />
<!--			<mx:Button label="Previous Index"
					   click="previousIndex()"
					   enabled="{indexTree.selectedIndex != 0}"
					   id="previousButton"
					   />
			<mx:Button label="Next Index"
					   click="nextIndex()"
					   enabled="{indexTree.selectedIndex != workListFilt.length-1}"
					   id="nextButton"
					   />
			
			-->
	    	<mx:Button label="Apply Index Profile" 
				   id="saveButton" 
				   click="save()" 
				   enabled="{hasChanged==true}" />

	    </mx:HBox>
	</mx:ControlBar>
	
</mx:TitleWindow>
