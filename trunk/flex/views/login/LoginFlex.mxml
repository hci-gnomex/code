<?xml version="1.0" encoding="utf-8"?>
<mx:Canvas xmlns:mx="http://www.adobe.com/2006/mxml" width="100%" height="100%" xmlns="*" 
	show="clearPwd()"
	paddingBottom="3" paddingLeft="3" paddingRight="3" paddingTop="3" defaultButton="{loginButton}" 
	>

    <mx:HTTPService 
	    id="loginService"	    	    
	    url="loginsucceeded.jsp"
	    resultFormat="text"
	    result="onLogin(event)"
	    fault="onFailLogin()"
	    showBusyCursor="true"
	    method="POST" 	     
	    useProxy="false" >
	  <mx:request>
	   <j_username>{txtUserName.text}</j_username>
	   <j_password>{txtPassword.text}</j_password>
	  </mx:request>	    
    </mx:HTTPService>  
       
        
   	<mx:Script>           
        <![CDATA[
	    	import mx.utils.ArrayUtil;
	    	import mx.events.CloseEvent;
	    	import mx.collections.Sort;
	    	import mx.collections.XMLListCollection;
	    	import mx.collections.XMLListCollection;
	        import mx.controls.Alert;
	        import mx.rpc.events.ResultEvent;        
	        import mx.managers.CursorManager;
	        import mx.managers.PopUpManager;
	        import mx.events.CloseEvent;
	        import mx.rpc.events.FaultEvent;
	        import mx.utils.ArrayUtil;		        	        	        	        	
		 	  
			private function clearPwd():void {
				txtPassword.text = "";
			}
			
			//private function register():void {
			//	parentApplication.showRegistration();
			//}		
			
			private function changePassword():void {
				parentApplication.showChangePasswordBeforeLogin();
			}	

			
			private function sendLogin(event:CloseEvent):void {
				if (event.detail == Alert.OK) {
					loginFailedMessage.visible = false;
					loginService.send();
				}
			}					

			private function onLogin(event:ResultEvent):void {
				if (event.result != "<SUCCESS/>") {
					onFailLogin();
				}
				else {
					//Login succeeded
					loginFailedMessage.visible = false;
					parentApplication.loggedIn(event);
				}				
			}
			
			private function onFailLogin():void {
				this.txtUserName.setFocus();
				loginFailedMessage.visible = true;
			}			
   		]]>
   	</mx:Script>
	
	<mx:HBox horizontalGap="100" horizontalAlign="center" verticalAlign="middle" width="100%" height="100%">
		<mx:VBox verticalAlign="middle" horizontalAlign="center" width="400" height="100%">
			<mx:TitleWindow id="loginWindow" width="360" height="154"
							layout="vertical" horizontalAlign="right" verticalGap="10"
							title="Login" styleName="loginWindow"
							defaultButton="{loginButton}" titleStyleName="loginTitleStyle" >	
				<mx:VBox verticalAlign="top" styleName="form" horizontalAlign="left" paddingLeft="4" paddingRight="4" paddingTop="10" paddingBottom="1" verticalGap="0" height="100%" width="100%">
					<mx:HBox width="100%" verticalAlign="middle" horizontalAlign="left" horizontalGap="0">
						<mx:Label text="User name" width="70" textAlign="left"/>
						<mx:TextInput id="txtUserName" visible="true" width="100%"/> 
					</mx:HBox> 
					<mx:HBox width="100%" verticalAlign="middle" paddingTop="10" horizontalAlign="left" horizontalGap="0">
						<mx:Label text="Password" width="70" textAlign="left"/>
						<mx:TextInput id="txtPassword" displayAsPassword="true" width="100%" />
					</mx:HBox> 
					<mx:Spacer height="100%"/>
					<mx:Text textAlign="left" htmlText="Login failed.  Please re-enter the user name and password." color="#A82009" fontWeight="bold" fontStyle="normal" visible="false" id="loginFailedMessage"/>
				</mx:VBox>
				<mx:ControlBar textAlign="left" horizontalAlign="right" verticalAlign="bottom">
					<mx:LinkButton click="changePassword()"  label="Change or reset your password" textAlign="left" color="#FFFFFF" textDecoration="underline" paddingLeft="0" paddingBottom="0"/>
					<mx:Spacer width="100%"/>
					<mx:Button label="Login" click="loginService.send()"  id="loginButton"/>					
				</mx:ControlBar>
				
			</mx:TitleWindow>
		</mx:VBox>
	</mx:HBox>
		
</mx:Canvas>
