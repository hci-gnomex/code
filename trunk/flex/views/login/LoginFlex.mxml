<?xml version="1.0" encoding="utf-8"?>
<mx:Canvas xmlns:mx="http://www.adobe.com/2006/mxml" width="100%" height="100%" xmlns="*" 
	show="clearPwd()"
	paddingBottom="3" paddingLeft="3" paddingRight="3" paddingTop="3" defaultButton="{loginButton}" 
	>

    <mx:HTTPService 
	    id="loginService"	    	    
	    url="loginsucceeded.jsp"
	    resultFormat="text"
	    result="onLogin(event)"
	    fault="onFailLogin()"
	    showBusyCursor="true"
	    method="POST" 	     
	    useProxy="false" >
	  <mx:request>
	   <j_username>{txtUserName.text}</j_username>
	   <j_password>{txtPassword.text}</j_password>
	  </mx:request>	    
    </mx:HTTPService>  
       
        
   	<mx:Script>           
        <![CDATA[
	    	import mx.collections.Sort;
	    	import mx.collections.XMLListCollection;
	    	import mx.controls.Alert;
	    	import mx.events.CloseEvent;
	    	import mx.managers.CursorManager;
	    	import mx.managers.PopUpManager;
	    	import mx.rpc.events.FaultEvent;
	    	import mx.rpc.events.ResultEvent;
	    	import mx.utils.ArrayUtil;
		        	        	        	        	
		 	  
			private function clearPwd():void {
				txtPassword.text = "";
			}
			
			//private function register():void {
			//	parentApplication.showRegistration();
			//}		
			
			private function changePassword():void {
				parentApplication.showChangePasswordBeforeLogin();
			}	

			
			private function sendLogin(event:CloseEvent):void {
				if (event.detail == Alert.OK) {
					loginFailedMessage.visible = false;
					loginService.send();
				}
			}					

			private function onLogin(event:ResultEvent):void {
				if (event.result != "<SUCCESS/>") {
					onFailLogin();
				}
				else {
					//Login succeeded
					loginFailedMessage.visible = false;
					parentApplication.loggedIn(event);
				}				
			}
			
			private function onFailLogin():void {
				this.txtUserName.setFocus();
				loginFailedMessage.visible = true;
			}	
			
			private function loginAsGuest():void {
				var params:Object = new Object();
				params.j_username = "guest";
				params.j_password = "guest";
				loginService.send(params);
			}
   		]]>
   	</mx:Script>
	
	<mx:HBox horizontalGap="100" horizontalAlign="center" verticalAlign="middle" width="100%" height="100%">
		<mx:VBox verticalAlign="middle" horizontalAlign="center" width="400" height="100%">
			<mx:TitleWindow id="loginWindow" width="296" height="174"
							layout="vertical" verticalAlign="middle" horizontalAlign="right" verticalGap="10"
							title="Login" styleName="loginWindow"
							defaultButton="{loginButton}" titleStyleName="loginTitleStyle" >	
				<mx:VBox verticalAlign="middle" styleName="form" horizontalAlign="left" paddingLeft="4" paddingRight="4" paddingTop="10" verticalGap="10" height="100%" width="100%" paddingBottom="4">
					<mx:HBox width="100%"  horizontalAlign="left" horizontalGap="0" verticalAlign="middle">
						<mx:Label text="User name" width="70" textAlign="left"/>
						<mx:TextInput id="txtUserName" visible="true" width="100%"/> 
					</mx:HBox> 
					<mx:HBox width="100%" verticalAlign="middle"  horizontalAlign="left"  horizontalGap="0">
						<mx:Label text="Password" width="70" textAlign="left"/>
						<mx:TextInput id="txtPassword" displayAsPassword="true" width="100%" />
					</mx:HBox> 
					<mx:Spacer height="100%"/>
					<mx:HBox>
						<mx:LinkButton click="changePassword()"  label="Change or reset password" textAlign="left"  textDecoration="underline" paddingLeft="0" paddingBottom="0" styleName="formLinkButton"/>
						<mx:LinkButton click="loginAsGuest()"  label="Login as guest" textAlign="left" textDecoration="underline" paddingLeft="0" paddingBottom="0" styleName="formLinkButton" icon="@Embed(source='../../assets/bullet_go.png')" paddingRight="0" textIndent="0" horizontalGap="0"/>						
					</mx:HBox>
				</mx:VBox>
				<mx:ControlBar textAlign="left" horizontalGap="8" horizontalAlign="left" verticalAlign="middle">
					<mx:Text  id="loginFailedMessage" textAlign="left" htmlText="Login failed.  Please try again." color="#931E26" fontWeight="bold" fontStyle="normal" visible="false" />
					<mx:Spacer width="100%"/>
					<mx:Button label="Login" click="loginService.send()"  id="loginButton"/>					
				</mx:ControlBar>
				
			</mx:TitleWindow>
		</mx:VBox>
	</mx:HBox>
		
</mx:Canvas>
