<?xml version="1.0" encoding="utf-8"?>
<mx:Canvas xmlns:mx="http://www.adobe.com/2006/mxml" width="100%" height="100%" xmlns="*" 
	show="init()"
	paddingBottom="3" paddingLeft="3" paddingRight="3" paddingTop="3"
	> 

    <mx:HTTPService 
	    id="changePasswordService"	    
	    url="ChangePassword.gx"
	    resultFormat="e4x"
	    result="succeeded(event)"
	    fault="parentApplication.onFailHttpRequest('Password Change Failed', event)"
	    showBusyCursor="true"
		destination="changePasswordService"
	    useProxy="false">
	  <mx:request>
	   <userName>{userName.text}</userName>
	   <oldPassword>{oldPassword.text}</oldPassword>
	   <newPassword>{newPassword.text}</newPassword>
	   <newPasswordConfirm>{passwordConfirm.text}</newPasswordConfirm>
	  </mx:request>	    
    </mx:HTTPService> 	

    <mx:Script>            
        <![CDATA[
	    	import mx.utils.ArrayUtil;
	    	import mx.collections.Sort;
	    	import mx.collections.XMLListCollection;
	    	import mx.collections.XMLListCollection;
	        import mx.controls.Alert;
	        import mx.rpc.events.ResultEvent;        
	        import mx.managers.CursorManager;
	        import mx.managers.PopUpManager;
	        import mx.events.CloseEvent;
	        import mx.rpc.events.FaultEvent;
	        import mx.utils.ArrayUtil;	
	        import mx.events.ValidationResultEvent;	        	        	        	        	
		 	  
			private function init():void {
				pwdStack.selectedChild = reg1;
				clearFields();
			}	
			
			private function changePwd():void {
				if (userNameValidator.validate().type == ValidationResultEvent.INVALID
						|| oldPasswordValidator.validate().type == ValidationResultEvent.INVALID
						|| newPasswordValidator.validate().type == ValidationResultEvent.INVALID
						|| newPasswordConfirmValidator.validate().type == ValidationResultEvent.INVALID) {
						
					Alert.show("Please fix errors (red) before continuing");
					return;
				}	
				else {
					changePasswordService.send();
				}			
			}	
			
			private function clearFields():void {
				oldPassword.text = "";
				newPassword.text = "";
				passwordConfirm.text = "";
			}										
			
			private function succeeded(event:ResultEvent):void {
				//Registration succeeded	
				if (changePassword.selected) {
					Alert.show("Your password has been successfully changed.");	
				}
				else {
					Alert.show("Your password has been reset. Your new temporary password will be emailed to you. Once you received your new password, please take a moment to change it to one of your own choosing.");
				}
				parentApplication.showLogin();		
			}
			
			public function next():void {	
				if (isExternal.selected) {
					pwdStack.selectedIndex += 2;
				}			
				else {
					pwdStack.selectedIndex += 1;
				}
			}	
			
			private function openHelp():void {
				var url:String = "Help/Registering_as_a_UPDBL_User.htm";
				var request:URLRequest = new URLRequest(url);
				navigateToURL(request,"help")   				
			}
			
			private function showLogin():void {
				parentApplication.showLogin();
			}
		]]>
    </mx:Script>   
    
    <mx:StringValidator
        id="userNameValidator"
        source="{userName}" property="text" required="true"
    /> 
    <mx:StringValidator
        id="oldPasswordValidator"
        source="{oldPassword}" property="text" required="{changePassword.selected}"
    />  
    <mx:StringValidator
        id="newPasswordValidator"
        source="{newPassword}" property="text" required="{changePassword.selected}"
    />  
    <mx:StringValidator
        id="newPasswordConfirmValidator"
        source="{passwordConfirm}" property="text" required="{changePassword.selected}"
    />                 

	    <mx:VBox id="mainArea" width="100%" height="100%"
	    	paddingTop="0" paddingBottom="1" paddingLeft="0" 
	    	paddingRight="0" horizontalCenter="0" verticalGap="0" verticalAlign="middle" horizontalAlign="center">
	    	

	    			<mx:HBox paddingTop="0" paddingLeft="0" verticalGap="0" borderThickness="3" borderStyle="inset" borderColor="#000000" height="432">
	    				<mx:Canvas paddingTop="0" paddingLeft="0" backgroundColor="#FFFFFF" borderColor="#FFFFFF" fontSize="14" height="420">
							  <mx:Text x="10" y="62" htmlText="&lt;b&gt;Changing Your Password:&lt;/b&gt;&lt;br/&gt;Have you forgotten your password, or would you just like to change it? The instructions to the right will help you change or reset your password." width="159" fontSize="14">
							  </mx:Text>
							  <mx:Label x="10" y="334" fontSize="12" fontWeight="bold" color="#1F49C3" textDecoration="underline" click="showLogin()" htmlText="&lt;a href='#'&gt;Return to login window&lt;/a&gt;"/>

							  <mx:HBox x="0" y="0" width="795" height="15" backgroundColor="#191962">
							  </mx:HBox>
							  <mx:Label x="10" y="23" text="Passwords" color="#102A8B" fontWeight="bold" fontSize="20"/>
							  	<mx:ViewStack id="pwdStack" width="100%" x="173" y="23" height="100%">
						  			<mx:Canvas id="reg1" verticalScrollPolicy="off" horizontalScrollPolicy="off">
										<mx:VBox width="100%" height="100%">
											<mx:VBox width="602" height="354"  borderColor="#000000" borderThickness="5" borderStyle="inset">
												<mx:Form id="form1">
												<mx:Label text="What institution are you affiliated with?" color="#102A8B" x="306" y="77" fontWeight="bold"/>
												<mx:Spacer/>
											  	<mx:RadioButtonGroup id="institution" />
											  	<mx:FormItem label="Member of:" horizontalAlign="right" paddingLeft="20">
											  		<mx:HBox width="370">
											  			<mx:RadioButton selected="true" label="University of Utah" groupName="institution"/>
											  			<mx:RadioButton id="isExternal" label="Other Institution" groupName="institution"/>
											  		</mx:HBox>
											  	</mx:FormItem>
												</mx:Form>										  													
											</mx:VBox>
											<mx:VBox width="100%" verticalAlign="bottom" horizontalAlign="right" paddingBottom="10" paddingRight="10" click="next()">
												<mx:Button label="Next" icon="@Embed(source='../../assets/arrow_right.png')" labelPlacement="left"/>
											</mx:VBox>											  											  
										</mx:VBox>						  			
						  			</mx:Canvas>
						  			<mx:Canvas id="reg2" width="100%" verticalScrollPolicy="off" horizontalScrollPolicy="off">
						  				<mx:VBox width="100%" height="100%">
							  				<mx:VBox height="100%" paddingRight="10" verticalScrollPolicy="off" width="602" borderColor="#000000" borderThickness="5" borderStyle="inset">
											  	<mx:RadioButtonGroup id="acceptGroup" />											  	
											  	<mx:Form id="form0" width="100%" height="110" verticalScrollPolicy="off">
											  	<mx:Label text="University of Utah Users:" color="#102A8B" fontWeight="bold"/>
											  	<mx:Text width="100%" height="61">
											  		<mx:htmlText><![CDATA[If you have registered using your uNID (u00000000), your password is tied to the University Campus Information System. Please use the <u><font color="#2658FB"><a href='https://gate.acs.utah.edu/' target='_blank'>Campus Information System</a></font></u> to change or reset your password.]]></mx:htmlText>
											  	</mx:Text>
											  	 	<mx:RadioButtonGroup id="institution0" />
											  	</mx:Form>
											  	<mx:Form id="form2" width="100%" height="199" verticalScrollPolicy="off">
											  	<mx:Label text="Users with a Huntsman Cancer Institute Account" color="#102A8B" fontWeight="bold"/>											  
											  	<mx:Text text="If you have registered using your HCI username and password, your password is linked to your HCI account." width="100%" height="42"/>
											  	 	<mx:RadioButtonGroup id="institution1" />
											  	 	<mx:Text width="100%" height="42">
											  	 		<mx:htmlText><![CDATA[For passowrd changes, please refer to the following document: <u><font color="#2658FB"><a href='http://www.hci.utah.edu/internal/CSG/PublicDocs/SourceDocs/NetworkProcedures/NetworkViaNT/N003.pdf' target='_blank'>Password Changes</a></font></u>]]></mx:htmlText>
											  	 	</mx:Text>
											  	 	<mx:Text width="100%" height="59">
											  	 		<mx:htmlText><![CDATA[If you have forgotten your password and need it reset, please contact the HCI Help Desk. Please email <u><font color="#2658FB"><a href='mailto:help.desk@hci.utah.edu'>help.desk@hci.utah.edu</a></font></u> or call 5-0330 for help.]]></mx:htmlText>
											  	 	</mx:Text>
											  	</mx:Form>
							  				</mx:VBox>		
											<mx:HBox width="100%" verticalAlign="bottom" horizontalAlign="right" paddingBottom="10" paddingRight="1" paddingLeft="10">
												<mx:Button label="Previous" icon="@Embed(source='../../assets/arrow_left.png')" labelPlacement="right" click="pwdStack.selectedIndex = 0"/>
												<mx:HBox horizontalAlign="right" width="100%" paddingRight="10">
												</mx:HBox>
											</mx:HBox>																		  					
						  				</mx:VBox>						  								  				
						  			</mx:Canvas>
						  			<mx:Canvas id="reg3" width="100%" verticalScrollPolicy="off" horizontalScrollPolicy="off">
						  				<mx:VBox width="100%" height="100%">
							  				<mx:VBox height="353" width="602" borderColor="#000000" borderThickness="5" borderStyle="inset">
							  					<mx:Form id="form3" width="100%" verticalScrollPolicy="off">
											  		<mx:Label text="Users Outside the University of Utah:" color="#102A8B" fontWeight="bold"/>
											  		<mx:Label text="1. Would you like to:" color="#102A8B" paddingLeft="5"/>
											  		<mx:RadioButtonGroup id="changeType" />
										  			<mx:HBox paddingLeft="20">
										  				<mx:RadioButton selected="true" label="Change Your Password" groupName="changeType" id="changePassword"/>
										  				<mx:RadioButton label="Have Your Password Reset*" groupName="changeType" click="clearFields()"/>
										  			</mx:HBox>
										  			<mx:Spacer/>
										  			<mx:Label text="2. Please enter the following information:" color="#102A8B" paddingLeft="5"/>
												  	<mx:FormItem label="User ID" horizontalAlign="left" paddingLeft="20">
												  		<mx:TextInput id="userName"/>
												  	</mx:FormItem>
												  	<mx:FormItem label="Old Password" horizontalAlign="left" visible="{changePassword.selected}" paddingLeft="20">
												  		<mx:TextInput id="oldPassword" displayAsPassword="true"/>
												  	</mx:FormItem>
												  	<mx:FormItem label="New Password" horizontalAlign="left" visible="{changePassword.selected}" paddingLeft="20">
												  		<mx:TextInput id="newPassword" displayAsPassword="true"/>
												  	</mx:FormItem>							  		
												  	<mx:FormItem label="Confirm New Password" horizontalAlign="left" visible="{changePassword.selected}" paddingLeft="20">
												  		<mx:TextInput id="passwordConfirm" displayAsPassword="true"/>
												  	</mx:FormItem>	
													<mx:Text text="* Your new password will be emailed to the email address that you used to register " width="100%" paddingLeft="20" visible="{!(changePassword.selected)}" paddingRight="20"/>

											  	</mx:Form>
											  	<!--mx:Spacer height="20"/-->
							  				</mx:VBox>		
											<mx:HBox width="100%" verticalAlign="bottom" horizontalAlign="right" paddingBottom="10" paddingRight="1" paddingLeft="10">
												<mx:Button label="Previous" icon="@Embed(source='../../assets/arrow_left.png')" labelPlacement="right" click="pwdStack.selectedIndex = 0"/>
												<mx:HBox horizontalAlign="right" width="100%" paddingRight="10">
													<mx:Button id="submitBtn" label="Finish" fontWeight="bold" click="changePwd()"/>										
												</mx:HBox>
											</mx:HBox>																		  					
						  				</mx:VBox>							  				
						  			</mx:Canvas>
						  				
						  		</mx:ViewStack>							  	
							 							  					  
	    				</mx:Canvas>
	    			</mx:HBox>
	    	          
     </mx:VBox>
		
</mx:Canvas>
