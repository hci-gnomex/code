<?xml version="1.0" encoding="utf-8"?>
<mx:TitleWindow
	xmlns:mx="http://www.adobe.com/2006/mxml"
	xmlns:hci = "hci.components.*"
	layout="vertical" left="0" right="0" top="0" bottom="0" 
	backgroundAlpha="1.0" cornerRadius="4"
	showCloseButton="true"
	close="PopUpManager.removePopUp(this)" borderColor="#9F9F9F" backgroundColor="#747474"
	creationComplete="init()">
		
		<mx:HTTPService
		id="createProtocol"
		url="SaveProtocol.gx"
		showBusyCursor="true"
		method="POST"
		resultFormat="e4x"
		useProxy="false"
		result="resultHandler(event)"
    	fault="parentApplication.onFailHttpRequest('Failed to save protocol', event)">
 		<mx:request>
			<protocolName>
				{protocolName.text}
			</protocolName>
			<codeRequestCategory>
				{codeRequestCategory.selectedItem.@value}
			</codeRequestCategory>
			<isActive>
				{isActive.data}
			</isActive>
			<protocolClassName>
				{protocolClassName}
			</protocolClassName>
		</mx:request>
	</mx:HTTPService>
	
	<mx:Script>
		<![CDATA[
			import mx.managers.PopUpManager;
			import mx.rpc.events.ResultEvent;
			
			[Bindable]
			public var protocolClassName:String;
			public var windowTitle:String;
			
			public function init():void {
				protocolClassName = parentApplication.protocolsView.browseProtocols.selectedItem.@protocolClassName;
				this.title = "Create New "+parentApplication.protocolsView.protocolList.(@protocolClassName==protocolClassName).@label;
			}
			
			public function callSaveProtocol():void {
				var call:Object = createProtocol.send();
				call.marker = "doneSaveProtocol";
			}
			
			public function resultHandler(event:ResultEvent):void {
				var call:Object = event.token;
				if (call.marker == "doneSaveProtocol") {
					parentApplication.protocolsView.callGetProtocolList();
					PopUpManager.removePopUp(this);
					var params:Object = new Object();
					params.id = createProtocol.lastResult.@idProtocolSaved;
					params.protocolClassName = createProtocol.lastResult.@savedProtocolClassName;
					parentApplication.protocolsView.callGetProtocol(params);
				}
			}
		]]>
	</mx:Script>
			<mx:VBox width="100%">
				<mx:Label text="Protocol Name" color="#FFFFFF"/>
				<mx:TextInput id="protocolName" width="100%"/>
			</mx:VBox>
			<mx:HBox width="100%" verticalAlign="bottom">
				<mx:VBox top="54" left="0" right="85" bottom="124" width="100%" verticalAlign="bottom">
					<mx:Label text="Kind of Request:" color="#FFFFFF"/>
					<hci:DictionaryComboBox
						id="codeRequestCategory"
						dataProvider="{parentApplication.manageDictionaries.lastResult.Dictionary.(@className == 'hci.gnomex.model.RequestCategory').DictionaryEntry}"
						dictValue="@value"
						dictDisplay="@display"
						dictName="hci.gnomex.model.RequestCategory"
						labelField="@display"
						dictProvider="{new XMLList(parentApplication.manageDictionaries.lastResult.Dictionary)}"
						width="100%">
						</hci:DictionaryComboBox>
				</mx:VBox>
				<hci:CheckBoxYN  id="isActive"  label="Active" color="#FFFFFF" selected="true"/>
			</mx:HBox>
			<mx:ControlBar horizontalAlign="right" paddingBottom="4" paddingLeft="4" paddingRight="4" paddingTop="4">
				<mx:Button id="saveProtocolButton" label="Create Protocol" click="callSaveProtocol()" icon="@Embed('../assets/action_save.gif')" toolTip="Save protocol" top="118" bottom="36" right="10" left="241"/>
				<mx:Button id="cancer" label="Cancel" click="PopUpManager.removePopUp(this)" icon="@Embed('../assets/delete.png')" toolTip="Cancel" top="124" bottom="-22" right="282" left="17"/>
			</mx:ControlBar>
</mx:TitleWindow>