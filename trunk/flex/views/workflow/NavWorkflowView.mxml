<?xml version="1.0" encoding="utf-8"?>
<mx:Canvas xmlns:mx="http://www.adobe.com/2006/mxml"     
	xmlns:views="views.*" 
	xmlns:workflow="views.workflow.*"  
	xmlns:util="views.util.*"  
	xmlns:WorkflowView="WorkflowView.*" 
	showEffect="{parentApplication.fadeIn}" hideEffect="{parentApplication.fadeOut}" 	
    creationPolicy="all"
	show="init()"
	label="Workflow" width="100%" height="100%"  >

    <mx:Script>
        <![CDATA[ 
			import mx.collections.XMLListCollection;
			import mx.controls.Alert;
			import mx.controls.dataGridClasses.DataGridListData;
			
			import views.util.DataGridAlternatingGroup;
			import views.util.FillButtonClickEvent;
			
			public var hiSeqFlowCellChannels:int = 0;
			public var miSeqFlowCellChannels:int = 0;
			public var solexaFlowCellChannels:int = 0;
				
		private function init():void {
			var requestCategory:Object = parentApplication.dictionaryManager.getEntry('hci.gnomex.model.RequestCategory', 'SOLEXA');
			solexaFlowCellChannels = requestCategory.@numberOfChannels;
			
			var rcList:XMLList;
			
			var rcGAII:Object = null;
			if (requestCategory != null) {
				if (requestCategory is XMLList) {
					rcList = XMLList(requestCategory);
					if (rcList.length() > 0) {
						rcGAII = rcList[0];
					}
				} else {
					rcGAII = requestCategory;
				} 
			} 
			if (rcGAII == null || rcGAII.@isActive == 'N') {
				if (navBar.contains(solexaTab)) {
					navBar.removeChild(solexaTab);
				}
			}
			
			requestCategory = parentApplication.dictionaryManager.getEntry('hci.gnomex.model.RequestCategory', 'MISEQ');
			miSeqFlowCellChannels = requestCategory.@numberOfChannels;
			
			var miSeq:Object = null;
			if (requestCategory != null) {
				if (requestCategory is XMLList) {
					rcList = XMLList(requestCategory);
					if (rcList.length() > 0) {
						miSeq = rcList[0];
					}
				} else {
					miSeq = requestCategory;
				} 
			} 
			if (miSeq == null || miSeq.@isActive == 'N') {
				if (navBar.contains(miSeqTab)) {
					navBar.removeChild(miSeqTab);
				}
			}
			
			requestCategory = parentApplication.dictionaryManager.getEntry('hci.gnomex.model.RequestCategory', 'HISEQ');
			hiSeqFlowCellChannels = requestCategory.@numberOfChannels;
						
		}
		
		public function checkDirty():void {
		}
		        
        private function onMicroarrayWorklistChange():void {
        	if (microarrayViews.selectedChild == workflowQCView) {
        		workflowQCView.getWorkListQC.send();
        	} else if (microarrayViews.selectedChild == workflowLabelingView) {
        		workflowLabelingView.getWorkList.send();
        	} else if (microarrayViews.selectedChild  == workflowHybView) {
        		workflowHybView.getWorkList.send();
        	} else if (microarrayViews.selectedChild == workflowExtractionView) {
        		workflowExtractionView.getWorkList.send();
        	}
			detailViews.selectedIndex = 0;
			detailViews.visible = true;

        }
			
        private function onSolexaWorklistChange():void {
        	if (solexaViews.selectedChild == workflowSolexaQCView) {
        		workflowSolexaQCView.codeStepNext = "SEQQC";
				workflowSolexaQCView.initTitle();
        		workflowSolexaQCView.getWorkList.send();
        	} else if (solexaViews.selectedChild == workflowSolexaPrepView) {
        		workflowSolexaPrepView.codeStepNext = "SEQPREP";
				workflowSolexaPrepView.titleInit();
        		workflowSolexaPrepView.getWorkList.send();
        	} else if (solexaViews.selectedChild == workflowSolexaAssembleView) {
        		workflowSolexaAssembleView.codeStepNext = "SEQASSEM";
        		workflowSolexaAssembleView.initializeData(solexaFlowCellChannels);
        		workflowSolexaAssembleView.getWorkList.send();
        		workflowSolexaAssembleView.getNextWorkList.send();
        	} else if (solexaViews.selectedChild == workflowSolexaPipelineView) {
        		workflowSolexaPipelineView.codeStepNext = "SEQPIPE";
				workflowSolexaPipelineView.initTitle();
        		workflowSolexaPipelineView.getWorkList.send();
        	} 
			detailViews.selectedIndex = 1;  
			detailViews.visible = true;
        }
			
        private function onHiSeqWorklistChange():void {
        	if (hiSeqViews.selectedChild == workflowHiSeqQCView) {
        		workflowHiSeqQCView.codeStepNext = "HSEQQC";
				workflowHiSeqQCView.initTitle();
        		workflowHiSeqQCView.getWorkList.send();
        	} else if (hiSeqViews.selectedChild == workflowHiSeqPrepView) {
        		workflowHiSeqPrepView.codeStepNext = "HSEQPREP";
				workflowHiSeqPrepView.titleInit();
        		workflowHiSeqPrepView.getWorkList.send();
        	} else if (hiSeqViews.selectedChild == workflowHiSeqAssembleView) {
        		workflowHiSeqAssembleView.codeStepNext = "HSEQASSEM";
        		workflowHiSeqAssembleView.initializeData(hiSeqFlowCellChannels);
        		workflowHiSeqAssembleView.getWorkList.send();
        		workflowHiSeqAssembleView.getNextWorkList.send();
        	} else if (hiSeqViews.selectedChild == workflowHiSeqPipelineView) {
        		workflowHiSeqPipelineView.codeStepNext = "HSEQPIPE";
				workflowHiSeqPipelineView.initTitle();
        		workflowHiSeqPipelineView.getWorkList.send();
        	} 
			detailViews.selectedIndex = 2;  
			detailViews.visible = true;
			

        }

		private function onMiSeqWorklistChange():void {
			if (miSeqViews.selectedChild == workflowMiSeqQCView) {
				workflowMiSeqQCView.codeStepNext = "MISEQQC";
				workflowMiSeqQCView.initTitle();
				workflowMiSeqQCView.getWorkList.send();
			} else if (miSeqViews.selectedChild == workflowMiSeqPrepView) {
				workflowMiSeqPrepView.codeStepNext = "MISEQPREP";
				workflowMiSeqPrepView.titleInit();
				workflowMiSeqPrepView.getWorkList.send();
			} else if (miSeqViews.selectedChild == workflowMiSeqAssembleView) {
				workflowMiSeqAssembleView.codeStepNext = "MISEQASSEM";		
				workflowMiSeqAssembleView.initializeData(miSeqFlowCellChannels);
				workflowMiSeqAssembleView.getWorkList.send();
				workflowMiSeqAssembleView.getNextWorkList.send();
			} else if (miSeqViews.selectedChild == workflowMiSeqPipelineView) {
				workflowMiSeqPipelineView.codeStepNext = "MISEQPIPE";
				workflowMiSeqPipelineView.initTitle();
				workflowMiSeqPipelineView.getWorkList.send();
			} 
			detailViews.selectedIndex = 3;  
			detailViews.visible = true;
		}   
			
        private function onTabChange():void {
        	if (this.navBar.selectedChild == this.solexaTab) {
        		this.flowCellView.codeSequencingPlatform = "GAIIX";
				this.flowCellView.titleLabel.text = 'Illumina GAIIx Flow Cells';
        		this.flowCellView.lookupField.text = '';
        		this.flowCellView.lastThreeMonthsCheckbox.selected = true;
        		this.flowCellView.toggleDateCheckboxes(3);
        		microarrayViews.selectedChild=blankMicroarray;
				hiSeqViews.selectedChild=this.blankHiSeq;
				miSeqViews.selectedChild=this.blankMiSeq;
        		this.detailViews.selectedChild = this.solexaViews;
			} else if (this.navBar.selectedChild == this.hiSeqTab) {
				this.flowCellView.codeSequencingPlatform = "HISEQ";
				this.flowCellView.titleLabel.text = 'Illumina HiSeq 2000 Flow Cells';
				this.flowCellView.lookupField.text = '';
				this.flowCellView.lastThreeMonthsCheckbox.selected = true;
				this.flowCellView.toggleDateCheckboxes(3);
				solexaViews.selectedChild=blankSolexa;
				microarrayViews.selectedChild=blankMicroarray;
				miSeqViews.selectedChild=this.blankMiSeq;
				this.detailViews.selectedChild = this.hiSeqViews;
			} else if (this.navBar.selectedChild == this.miSeqTab) {
				this.flowCellView.codeSequencingPlatform = "MISEQ";
				this.flowCellView.titleLabel.text = 'Illumina MiSeq Flow Cells';
				this.flowCellView.lookupField.text = '';
				this.flowCellView.lastThreeMonthsCheckbox.selected = true;
				this.flowCellView.toggleDateCheckboxes(3);
				solexaViews.selectedChild=blankSolexa;
				microarrayViews.selectedChild=blankMicroarray;
				hiSeqViews.selectedChild=this.blankHiSeq;
				this.detailViews.selectedChild = this.miSeqViews;
        	} else {
	        	solexaViews.selectedChild=blankSolexa;
				hiSeqViews.selectedChild=this.blankHiSeq;
				miSeqViews.selectedChild=this.blankMiSeq;
    	    	this.detailViews.selectedChild = this.microarrayViews;
        	}
        }
        ]]>
    </mx:Script>


	<mx:HDividedBox width="100%" height="100%">

		<mx:TabNavigator id="navBar" styleName="navTabNavigator" width="140"  height="100%" change="onTabChange()">
			<mx:Canvas id="hiSeqTab" width="100%" height="100%" icon="{parentApplication.iconHiSeq}" toolTip="HiSeq workflow">
				<mx:VBox  styleName="panelTabBody" horizontalAlign="center" width="100%" height="100%" paddingTop="4">
					
					<mx:LinkBar dataProvider="hiSeqViews"  styleName="navLinkBar" textDecoration="underline"  direction="vertical"   itemClick="onHiSeqWorklistChange()"  height="202"  width="116" paddingTop="4">
					</mx:LinkBar> 
					
					<mx:Spacer height="20"/>			  		
					<mx:HRule>
					</mx:HRule>
					<mx:Spacer height="10"/>			  		
					<mx:LinkButton label="Flow Cells"  styleName="navLinkBar"  click="{hiSeqViews.selectedChild=this.blankHiSeq;detailViews.selectedChild = flowCellView;flowCellView.getFlowCellList.send();}"/>
				</mx:VBox>
			</mx:Canvas>
			<mx:Canvas id="miSeqTab" width="100%" height="100%" icon="{parentApplication.iconMiSeq}" toolTip="MiSeq workflow">
				<mx:VBox  styleName="panelTabBody" horizontalAlign="center" width="100%" height="100%" paddingTop="4">
					
					<mx:LinkBar dataProvider="miSeqViews"  styleName="navLinkBar" textDecoration="underline"  direction="vertical"   itemClick="onMiSeqWorklistChange()"  height="202"  width="116" paddingTop="4">
					</mx:LinkBar> 
					
					<mx:Spacer height="20"/>			  		
					<mx:HRule>
					</mx:HRule>
					<mx:Spacer height="10"/>			  		
					<mx:LinkButton label="Flow Cells"  styleName="navLinkBar"  click="{miSeqViews.selectedChild=this.blankMiSeq;detailViews.selectedChild = flowCellView;flowCellView.getFlowCellList.send();}"/>
				</mx:VBox>
			</mx:Canvas>			
			<mx:Canvas id="microarrayTab" width="100%" height="100%"  icon="{parentApplication.iconMicroarray}" toolTip="Microarray workflow"> 
				<mx:VBox styleName="panelTabBody" horizontalAlign="center" width="100%" height="100%" paddingTop="2" paddingRight="2" paddingLeft="2" paddingBottom="4">
			  		<mx:Text text="Microarray and Sample Quality Work Lists" width="100%" fontWeight="normal" color="#000000" paddingTop="4"/>
			  		
			  		<mx:LinkBar dataProvider="microarrayViews"   styleName="navLinkBar" direction="vertical"   selectedIndex="4"  itemClick="onMicroarrayWorklistChange()"  height="131" >
			  		</mx:LinkBar>
				
				</mx:VBox>
			</mx:Canvas >
			<mx:Canvas id="solexaTab" width="100%" height="100%" icon="{parentApplication.iconSolexa}" toolTip="GAIIx workflow" visible="true">
				<mx:VBox  styleName="panelTabBody" horizontalAlign="center" width="100%" height="100%" paddingTop="4">
					
					<mx:LinkBar dataProvider="solexaViews"  styleName="navLinkBar" textDecoration="underline"  direction="vertical"   itemClick="onSolexaWorklistChange()"  height="202"  width="116" paddingTop="4">
					</mx:LinkBar> 
					
					<mx:Spacer height="20"/>			  		
					<mx:HRule>
					</mx:HRule>
					<mx:Spacer height="10"/>			  		
					<mx:LinkButton label="Flow Cells"  styleName="navLinkBar"  click="{solexaViews.selectedChild=this.blankSolexa;detailViews.selectedChild = flowCellView;flowCellView.getFlowCellList.send();}"/>
				</mx:VBox>
			</mx:Canvas>
			
		</mx:TabNavigator>
		    
			
	
		<mx:ViewStack id="detailViews" width="100%" height="100%">
			<mx:ViewStack id="microarrayViews"  visible="true" height="100%" width="100%"  >


	           <workflow:WorkflowQCView label="Sample Quality" id="workflowQCView" icon="@Embed('../../assets/chart_curve.png')"/> 
	           
	           <workflow:WorkflowLabelingView label="Labeling" id="workflowLabelingView" icon="@Embed('../../assets/asterisk_yellow.png')"/>
	    
	           <workflow:WorkflowHybView label="Hybridization" id="workflowHybView" icon="@Embed('../../assets/basket_put.png')"/>
	
	           <workflow:WorkflowExtractionView label="Scan / FE" id="workflowExtractionView" icon="{parentApplication.iconExperiment}"/>
               
               <mx:Canvas id="blankMicroarray" label=""> 
               </mx:Canvas>
                
            </mx:ViewStack>
			<mx:ViewStack id="solexaViews"  visible="true" height="100%" width="100%" selectedIndex="6"  >
			
			   <workflow:WorkflowSolexaQCView label="Sample Quality" id="workflowSolexaQCView" icon="@Embed('../../assets/chart_curve.png')"/> 	           
			   
			   <workflow:WorkflowSolexaPrepView label="Lib Prep" id="workflowSolexaPrepView" icon="@Embed('../../assets/chart_line.png')"/>

			   <workflow:WorkflowSolexaAssembleView label="Seq Run Setup" id="workflowSolexaAssembleView" icon="{parentApplication.iconSolexa}"/> 	           

			   <workflow:WorkflowSolexaPipelineView label="Data Pipeline" id="workflowSolexaPipelineView" icon="@Embed('../../assets/server_go.png')"/> 	           
			    
			   <mx:Canvas id="blankSolexa" label=""/>
			   
			</mx:ViewStack>
		   <mx:ViewStack id="hiSeqViews"  visible="true" height="100%" width="100%" selectedIndex="6"  >
			
			   <workflow:WorkflowSolexaQCView label="Sample Quality" id="workflowHiSeqQCView" icon="@Embed('../../assets/chart_curve.png')"/> 	           
			   
			   <workflow:WorkflowSolexaPrepView label="Lib Prep" id="workflowHiSeqPrepView" icon="@Embed('../../assets/chart_line.png')"/>

			   <workflow:WorkflowSolexaAssembleView label="Seq Run Setup" id="workflowHiSeqAssembleView" icon="{parentApplication.iconHiSeq}"/> 	           

			   <workflow:WorkflowSolexaPipelineView label="Data Pipeline" id="workflowHiSeqPipelineView" icon="@Embed('../../assets/server_go.png')"/> 	           
			    
			   <mx:Canvas id="blankHiSeq" label=""/>
			   
			</mx:ViewStack>
			<mx:ViewStack id="miSeqViews"  visible="true" height="100%" width="100%" selectedIndex="6"  >
				
				<workflow:WorkflowSolexaQCView label="Sample Quality" id="workflowMiSeqQCView" icon="@Embed('../../assets/chart_curve.png')"/> 	           
				
				<workflow:WorkflowSolexaPrepView label="Lib Prep" id="workflowMiSeqPrepView" icon="@Embed('../../assets/chart_line.png')"/>
				
				<workflow:WorkflowSolexaAssembleView label="Seq Run Setup" id="workflowMiSeqAssembleView" icon="{parentApplication.iconMiSeq}"/> 	           
				
				<workflow:WorkflowSolexaPipelineView label="Data Pipeline" id="workflowMiSeqPipelineView" icon="@Embed('../../assets/server_go.png')"/> 	           
				
				<mx:Canvas id="blankMiSeq" label=""/>
				
			</mx:ViewStack>			
			<workflow:FlowCellView id="flowCellView"/>
			
			
		</mx:ViewStack>
		
	
	</mx:HDividedBox>
	
	
  		
	
    
</mx:Canvas>
