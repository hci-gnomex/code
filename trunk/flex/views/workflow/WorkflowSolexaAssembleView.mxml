<?xml version="1.0" encoding="utf-8"?>
<mx:Panel xmlns:mx="http://www.adobe.com/2006/mxml" 
	layout="vertical" 
	width="100%" height="100%" 
	title="Illumina Cluster Gen"
	xmlns:util="views.util.*">
	
	
	<mx:HTTPService 
    id="getWorkList" 
    url="GetWorkItemList.gx"
    resultFormat="e4x"
    destination="getWorkList"
    showBusyCursor="true"
    result="onGetWorkList(event)"
    fault="parentApplication.onFailHttpRequest('Unable to get work list', event)"
    useProxy="false">
    <mx:request>
        <codeStepNext>SEQASSEM</codeStepNext>
    </mx:request>
    </mx:HTTPService >
    
    	
	<mx:HTTPService 
    id="getNextWorkList" 
    url="GetWorkItemList.gx"
    resultFormat="e4x"
    showBusyCursor="true"
    result="onGetNextWorkList(event)"
    fault="parentApplication.onFailHttpRequest('Unable to get next work list', event)"
    useProxy="false">
    <mx:request>
        <codeStepNext>SEQRUN</codeStepNext>
    </mx:request>
    </mx:HTTPService >
    
    <mx:HTTPService 
    id="saveWorkItem" 
    url="SaveWorkItemSolexaAssemble.gx"
    resultFormat="e4x"
    showBusyCursor="true"
    result="onSaveWorkItem(event)"
    fault="parentApplication.onFailHttpRequest('Unable to save work list', event)"
    method="POST"
    useProxy="false">
    </mx:HTTPService >    
    
    <mx:HTTPService 
    id="deleteWorkItem"   
    url="DeleteWorkItem.gx" 
    resultFormat="e4x"
    showBusyCursor="true"
    result="onDeleteWorkItem(event)"
    fault="parentApplication.onFailHttpRequest('Unable to delete work item', event)"
    method="POST"
    useProxy="false">
    </mx:HTTPService >    

    <mx:XMLListCollection id="workList" source="{getWorkList.lastResult.WorkItem}"/>
    <mx:XMLListCollection id="dirtyWorkList" />
    <mx:XMLListCollection id="nextWorkList" source="{getNextWorkList.lastResult.WorkItem}"/>
    
<mx:Script>
	<![CDATA[
		import mx.events.CollectionEvent;
		import mx.events.CollectionEventKind;
		import mx.rpc.events.ResultEvent;
		import mx.controls.Alert;
		import mx.events.DragEvent;
		import mx.managers.DragManager;
		import mx.events.CloseEvent;
		import hci.flex.renderers.ComboBoxDictionary;
		import hci.flex.renderers.LabelDictionary;
		import views.renderers.FlowCellSampleConcentrationLabel;
		import views.renderers.FlowCellSampleConcentrationTextInput;
		
		private var isValid:Boolean = true;
		
		private var warningMessage:String = "";
		
		public function initializeData():void {
			controlsGrid.dataProvider = parentApplication.dictionaryManager.getEntriesExcludeBlank('hci.gnomex.model.SequencingControl'); 
        }
		
		private function onGetWorkList(event:ResultEvent):void {
			if (event.result.name() == "WorkItemList") {
    	    	workList.addEventListener(CollectionEvent.COLLECTION_CHANGE, this.underlyingWorkItemDataChange);
        	} else {
        		Alert.show(event.result..ERROR.@message.toString(), "Error getting work list");
        	}
        }
		private function onGetNextWorkList(event:ResultEvent):void {
        	if (event.result.name() != "WorkItemList") {
        		Alert.show(event.result..ERROR.@message.toString(), "Error getting next work list");
        	}
        }
		private function underlyingWorkItemDataChange(event:CollectionEvent):void {
			if (event.kind == CollectionEventKind.RESET || event.kind == CollectionEventKind.REFRESH) {
				// ignore refresh and resets to work list
			} else {
				dirty.setDirty();
				this.workList.filterFunction = null;
			}
		}
		private function refreshWorkList():void {
			dirtyWorkList.removeAll();
        	dirty.resetDirty();
        	getWorkList.send();
        	getNextWorkList.send();
        }

    	private function getAssembleLaneRowNumber(item:Object,col:int):String
    	{
       		var x:int = dirtyWorkList.getItemIndex(item) + 1;
       		return String(x);
    	} 
    	private function getPendingLaneRowNumber(item:Object,col:int):String
    	{
       		var x:int = workList.getItemIndex(item) + 1;
       		return String(x);
    	} 	
    	
    	private function save():void {
    		// Prevent save if flow cell barcode is not entered
    		if (this.flowCellBarcode.text == "") {
    			this.flowCellBarcode.setFocus();
    			Alert.show("Please enter the flow cell barcode");
    			return;
    		}
    		// Prevent save if flow cell date is not entered
    		if (this.flowCellDate.text == "") {
    			this.flowCellDate.setFocus();
    			Alert.show("Please enter the cluster gen date");
    			return;
    		}
    		
    		// Prevent save if sample concentration not entered on all
    		// flow cell channels (other than sequencing control).
	       	for each (var item:Object in dirtyWorkList) {
	       		if (item.name() == "WorkItem") {
	       			if (item.@sampleConcentrationpM == '') {
	       				Alert.show("Please enter sample concentration for hilighted flow cell channels");
	       				return;
	       			}
	       		}
	       	}
	       	
    		
    		warningMessage = "";
    		isValid = true;
    		validateNumberOfLanes();
    		validateSequencingControl();
    		validateSeqRunType();
    		validateOrganism();
	    	validateNumberSequencingCycles();
    		if (isValid) {
    			saveWorkItems();
    		} else {
    			promptForWarning();
    		}
    	}
    	
    	private function saveWorkItems():void {
    		var params:Object = new Object();
    		params.flowCellBarcode = this.flowCellBarcode.text;
    		params.flowCellDate = this.flowCellDate.text;
    		params.workItemXMLString = dirtyWorkList.toXMLString();
        	saveWorkItem.send(params);
    	}	

    	private function promptForWarning():void {
    		if (warningMessage != "") {
    			warningMessage += "Continue saving?";
				Alert.show(warningMessage, "Warning", (Alert.YES | Alert.NO), null, onPromptForWarning);
	       	}
    	}
    	
    	private function onPromptForWarning(event:CloseEvent):void {
    		if (event.detail == Alert.YES) {
    			saveWorkItems();
    		}
    	}

        private function onSaveWorkItem(event:ResultEvent):void {
        	if (saveWorkItem.lastResult.name() == "WorkItemList" || saveWorkItem.lastResult.name() == "SUCCESS" ) {
        		dirty.resetDirty();
        		this.getWorkList.send();
        		this.getNextWorkList.send();
        		dirtyWorkList.removeAll();
        		this.flowCellBarcode.text = "";

        	} else {
        		Alert.show(saveWorkItem.lastResult..ACTMESSAGE.@TEXT);
        	}        	
        }    
        private function onDeleteWorkItem(event:ResultEvent):void {
        	if (deleteWorkItem.lastResult.name() == "SUCCESS") {
        		this.getWorkList.send();
        	} else {
        		Alert.show(deleteWorkItem.lastResult..ACTMESSAGE.@TEXT);
        	}        	
        }     
    	private function validateNumberOfLanes():void {
    		if (dirtyWorkList.length < 8) {
    			warningMessage = "Not all 8 channels are populated.\n\n";
    			isValid = false;
    		}
    	}
    	
    	private function validateSequencingControl():void {
    		var theItem:Object;
    		var item:Object;
    		var controlCount:int = 0;
	       // Make sure at least one sequencing control specified
	       for each (theItem in dirtyWorkList) {
	       		if (theItem.hasOwnProperty("@idSequencingControl")) {
	       			controlCount++;
	       		}
	       }
   			if (controlCount == 0) {
   				warningMessage += "No sequencing control specified for any of the channels.\n\n";
   			}
    	}
    	
    	private function validateSeqRunType():void {
    		var theItem:Object;
    		var item:Object;
    		var invalidCount:int = 0;
	       //Warn if different flow cell type 
	       for each (theItem in dirtyWorkList) {
	       		if (theItem.hasOwnProperty("@idSequencingControl")) {
	       			continue;
	       		}
	       		for each (item in dirtyWorkList) {
	       			if (item.hasOwnProperty("@idSequencingControl")) {
	       				continue;
	       			}
	       			if (theItem.@idSeqRunType != item.@idSeqRunType) {
	       				warningMessage += "The flow cell channels have samples destined for different sequence run types.\n\n";
	       				isValid = false;
	       				invalidCount++;
	       				break;
	       			}
	       		}
	       		if (invalidCount > 0) {
	       			break;
	       		}
	       }

    	}    	
    	        	
    	private function validateOrganism():void {
    		var theItem:Object;
    		var item:Object;
    		var invalidCount:int = 0;
	       //Warn if different organism or number of seq cycles
	       for each (theItem in dirtyWorkList) {
	       		if (theItem.hasOwnProperty("@idSequencingControl")) {
	       			continue;
	       		}
	       		for each (item in dirtyWorkList) {
	       			if (item.hasOwnProperty("@idSequencingControl")) {
	       				continue;
	       			}
	       			if (theItem.@idOrganism != item.@idOrganism) {
	       				warningMessage += "Flow cell channels contain samples from different organisms.\n\n";
	       				isValid = false;
	       				invalidCount++;
	       				break;
	       			}
	       		}
	       		if (invalidCount > 0) {
	       			break;
	       		}
	       }

    	}
    	
    	
    	private function validateNumberSequencingCycles():void {
    		var theItem:Object;
    		var item:Object;
    		var invalidCount:int = 0;
	       for each (theItem in dirtyWorkList) {
	       		if (theItem.hasOwnProperty("@idSequencingControl")) {
	       			continue;
	       		}
	       		for each (item in dirtyWorkList) {
	       			if (item.hasOwnProperty("@idSequencingControl")) {
	       			continue;
	       			}
	       			if (theItem.@idNumberSequencingCycles != item.@idNumberSequencingCycles) {
	       				isValid = false;
	       				warningMessage += "Flow cell channels have different number of sequencing cycles requested.\n\n";
	       				invalidCount++;
	       				break;
	       			}
	       		}
	       		if (invalidCount > 0) {
	       			break;
	       		}
	       }    		

    	}
 	
    	
    	private function moveAssembleLaneUp():void {
    		var pos:int = this.assembleLanesGrid.selectedIndex;
    		if (pos == 0) {
    			return;
    		}

    		var item:Object = this.assembleLanesGrid.selectedItem;
    		var prevItem:Object  = dirtyWorkList.getItemAt(pos - 1);
    		
    		dirtyWorkList.removeItemAt(dirtyWorkList.getItemIndex(item));
    		dirtyWorkList.removeItemAt(dirtyWorkList.getItemIndex(prevItem));
    		
    		pos--;
    		dirtyWorkList.addItemAt(item, pos);
    		dirtyWorkList.addItemAt(prevItem, pos + 1);
    		
    		assembleLanesGrid.selectedItem = item;
    		
    	}
    	private function moveAssembleLaneDown():void {
    		var pos:int = this.assembleLanesGrid.selectedIndex;
    		if (pos == (dirtyWorkList.length - 1)) {
    			return;
    		}

    		var item:Object = this.assembleLanesGrid.selectedItem;
    		var nextItem:Object  = dirtyWorkList.getItemAt(pos + 1);
    		
    		dirtyWorkList.removeItemAt(dirtyWorkList.getItemIndex(item));
    		dirtyWorkList.removeItemAt(dirtyWorkList.getItemIndex(nextItem));
    		
    		dirtyWorkList.addItemAt(nextItem, pos);
    		dirtyWorkList.addItemAt(item, pos + 1);
    		
    		assembleLanesGrid.selectedItem = item; 
    	}   	
	  	private function onDragDropLane(event:DragEvent) : void
		{
	       // retrieve the data associated with the "items" format. This will be the data that
	       // the dragInitiator has copied into the DragSource.
	       var items:Array = event.dragSource.dataForFormat("items") as Array;
	
	       // determine where in the grid the drop occurs and select that node by the index; followed by 
	       // retrieving the node itself. 
	       var row:int = assembleLanesGrid.calculateDropIndex(event);
	       assembleLanesGrid.selectedIndex = row;
	       var node:XML = assembleLanesGrid.selectedItem as XML;	       
	        
	       // Disallow operation if already 8 lanes loaded
	       if (dirtyWorkList.length == 8) {
	       	  	Alert.show("Max 8 lanes loaded.  Please save assembled flow cell.");
		       	event.preventDefault();
		       	event.target.hideDropFeedback(event);
		       	DragManager.showFeedback(DragManager.NONE);
				return;	       	  	
	       }
	       
	       // Disallow operation if seq run is of different type
	       for each (var dragItem:Object in items) {
	       		if (dragItem.name() == "DictionaryEntry") {
	       			continue;
    	   		}
	       		for each (var item:Object in dirtyWorkList) {
	       			if (item.name() == "WorkItem") {	       				
		       			if (dragItem.@idSeqRunType != item.@idSeqRunType) {
		       				Alert.show("Warning - Incompatible sequence run type.");
				       		event.preventDefault();
				       		event.target.hideDropFeedback(event);
				       		DragManager.showFeedback(DragManager.NONE);
							return;	       	  	
		       			}
		       		}
	       		}
	       }
	       

	       
	
	       // taking all of the items in the DragSouce, move to work items
	       // to the dirtyWorkItems list
	       for(var i:Number=0; i < items.length; i++) {
	       	if (items[i].name() == "WorkItem") {
	       		items[i].@sampleConcentrationpM = '';
		    	dirtyWorkList.addItemAt(items[i], row);
		    	workList.removeItemAt(workList.getItemIndex(items[i]));	       			
	       	} else if (items[i].name() == "DictionaryEntry") {
	       		items[i].@sampleConcentrationpM = '';
	       		var newItem:Object = new XML(XML(items[i]).toXMLString());
		    	dirtyWorkList.addItemAt(newItem, row); 
	       	} 
	       }
	       
	       
	       // Don't allow flex to do any default moves to the data.  
	       // We handle it in the code above.
	       event.preventDefault();
	       
		}
		
		public function removeAssembleLane():void {
			var item:Object = this.assembleLanesGrid.selectedItem;
		   	workList.addItem(item);
		    dirtyWorkList.removeItemAt(dirtyWorkList.getItemIndex(item));	       			
	 	}
		public function removePendingLane():void {
			var item:Object = this.pendingLanesGrid.selectedItem;
			var params:Object = new Object();
			params.idWorkItem = item.@idWorkItem;
			
			deleteWorkItem.send(params);
	 	}
	 	
    	private function promptForRemove():void {
    		var warningMessage:String = "Are you sure you want to remove " + pendingLanesGrid.selectedItem.@laneNumber + " from the work list?";
			Alert.show(warningMessage, "Warning", (Alert.YES | Alert.NO), null, onPromptForRemove);
    	}
    	
    	private function onPromptForRemove(event:CloseEvent):void {
    		if (event.detail == Alert.YES) {
    			removePendingLane();
    		}
    	}
	 	
		
		//
		// Need to use these label functions instead of LabelDictionary item renderer because drag image is blank otherwise.
		//
        private function lookupOrganism(item:Object, col:DataGridColumn):String {
        	var d:Object = parentApplication.dictionaryManager.getEntry('hci.gnomex.model.Organism', item.@idOrganism);
        	if (d != null) {
        		return d.@display;
        	} else {
        		return ""; 
        	}
        }		
        private function lookupSeqRunType(item:Object, col:DataGridColumn):String {
        	var d:Object = parentApplication.dictionaryManager.getEntry('hci.gnomex.model.SeqRunType', item.@idSeqRunType);
        	if (d != null) {
        		return d.@display;
        	} else {
        		return "";
        	}
        }		
        private function lookupNumberSequencingCycles(item:Object, col:DataGridColumn):String {
        	var d:Object = parentApplication.dictionaryManager.getEntry('hci.gnomex.model.NumberSequencingCycles', item.@idNumberSequencingCycles);
        	if (d != null) {
        		return d.@display; 
        	} else {
        		return "";
        	}
        }		
        
        
	]]>
</mx:Script>    	
	<mx:HDividedBox width="100%" height="100%" styleName="form" paddingBottom="4" paddingLeft="4" paddingRight="4" paddingTop="4">
	    <mx:VDividedBox width="40%" height="100%"  >
			<mx:VBox width="100%" height="104"   verticalGap="0">	
			
				<mx:HBox paddingTop="8" width="100%" verticalAlign="bottom" paddingBottom="1">
					<mx:Label text="Controls" fontWeight="bold"/>
			    </mx:HBox>
				<mx:DataGrid id="controlsGrid" width="100%" height="100%" dragEnabled="true" showHeaders="false">
					<mx:columns>
						<mx:DataGridColumn  dataField="@display"             headerText="Control Name" width="40"/>
					</mx:columns>				
				</mx:DataGrid>			 
			</mx:VBox>
			<mx:VBox width="100%" height="100%"   verticalGap="0">	
			    <mx:HBox paddingTop="8" width="100%" verticalAlign="bottom" paddingBottom="1">
					<mx:Label text="{'Pending Sequence Requests (' + workList.length + ')' }" fontWeight="bold"/>
					<mx:HBox width="100%" horizontalAlign="right">
						<mx:Button id="removePendingLaneButton" icon="@Embed(source='../../assets/delete.png')" width="24" disabledIcon="@Embed(source='../../assets/delete_disable.png')" click="promptForRemove()">
							<mx:enabled>{pendingLanesGrid.selectedItem != null ? true : false}</mx:enabled>
						</mx:Button>						
					</mx:HBox>
			    </mx:HBox>
				<util:DataGridAlternatingGroup id="pendingLanesGrid" width="100%" height="100%" dataProvider="{workList}" dragEnabled="true">
					<util:columns>
						<mx:DataGridColumn  dataField="@laneNumber"             headerText="Flow Cell Sample #" width="50">
							<mx:headerRenderer > 
							<mx:Component>
								<mx:VBox verticalGap="0"   horizontalAlign="center" verticalAlign="middle"> 
								    <mx:Label text="Flow Cell"/>
								    <mx:Label text="Sample #"/>
								</mx:VBox> 
							</mx:Component>
							</mx:headerRenderer>
	  					</mx:DataGridColumn>					
						<mx:DataGridColumn  dataField="@idSeqRunType"           headerText="Seq Type"   width="50" labelFunction="lookupSeqRunType"/>
	                    <mx:DataGridColumn  dataField="@idOrganism"               headerText="Organism"         width="35"  labelFunction="lookupOrganism"/>
						<mx:DataGridColumn  dataField="@idNumberSequencingCycles" headerText="# Cycles"          width="35"  labelFunction="lookupNumberSequencingCycles"/>
					</util:columns>				
				</util:DataGridAlternatingGroup>		
			</mx:VBox> 
			
	    	
	    </mx:VDividedBox>
	    <mx:VBox height="100%">
	    	<mx:Spacer height="45"/>
	        <mx:Image source="assets/arrow_right.png"/>
	    	<mx:Spacer height="100"/>
	        <mx:Image source="assets/arrow_right.png"/>
	    	 
	    </mx:VBox>
		<mx:VBox width="60%" height="100%" verticalGap="1" borderColor="#4E7C9C">			
			    <mx:VBox width="100%" paddingTop="3" paddingBottom="4" borderStyle="outset" cornerRadius="10" borderColor="#466D88" paddingLeft="4" paddingRight="4">
					<mx:Label text="Flow Cell to Assemble" fontWeight="bold" color="#153A64"/>
					<mx:HBox width="100%" horizontalGap="2">
						<mx:Label text="Barcode:"/>
						<mx:TextInput id="flowCellBarcode" width="100%"/>
						<mx:Label text="Cluster Gen Date:"/>
						<mx:DateField id="flowCellDate" showToday="true"/>
						<mx:HBox width="100%" horizontalAlign="right" paddingTop="0" paddingBottom="0" horizontalGap="4">
							<mx:Button click="moveAssembleLaneUp()" icon="@Embed(source='../../assets/arrow_up.png')" width="24" toolTip="Move sample up a lane"/>
							<mx:Button click="moveAssembleLaneDown()" width="24" icon="@Embed(source='../../assets/arrow_down.png')" toolTip="Move sample down a lane"/>
							<mx:VRule height="20"/>
							<mx:Button id="removeFlowCellButton" icon="@Embed(source='../../assets/delete.png')" width="24" disabledIcon="@Embed(source='../../assets/delete_disable.png')" click="removeAssembleLane()">
								<mx:enabled>{assembleLanesGrid.selectedItem != null ? true : false}</mx:enabled>
							</mx:Button>
						</mx:HBox>
						 
					</mx:HBox> 
			<mx:DataGrid  id="assembleLanesGrid"  editable="true" dataProvider="{dirtyWorkList}" width="100%" height="220" 
				maxHeight="178" dropEnabled="true" dragDrop="onDragDropLane(event)"	>	
				<mx:columns>
				   <mx:DataGridColumn editable="false" headerText="Channel"  labelFunction="getAssembleLaneRowNumber" width="21" showDataTips="true" />
					<mx:DataGridColumn  editable="false" dataField="@laneNumber" width="45" headerText="Flow Cell Sample #" showDataTips="true" >
						<mx:headerRenderer > 
						<mx:Component>
							<mx:VBox verticalGap="0"   horizontalScrollPolicy="off" horizontalAlign="center" verticalAlign="middle"  >
							    <mx:Label text="Flow Cell"/>
							    <mx:Label text="Sample #"/>
							</mx:VBox>
						</mx:Component>
						</mx:headerRenderer>
					</mx:DataGridColumn>					
					<mx:DataGridColumn  editable="false"  dataField="@idSeqRunType" headerText="Seq Run Type" width="65" 
					 showDataTips="true" 
                     itemRenderer="{LabelDictionary.create(parentApplication.dictionaryManager, 'hci.gnomex.model.SeqRunType', '@idSeqRunType')}"/>                 											
					<mx:DataGridColumn  editable="false"  dataField="@idOrganism" headerText="Organism" width="40"  
					 showDataTips="true" 
                     itemRenderer="{LabelDictionary.create(parentApplication.dictionaryManager, 'hci.gnomex.model.Organism', '@idOrganism')}"/>                 											
					<mx:DataGridColumn  editable="false"  dataField="@idNumberSequencingCycles" headerText="# Cycles"  width="32" 
					 showDataTips="true" 
                     itemRenderer="{LabelDictionary.create(parentApplication.dictionaryManager, 'hci.gnomex.model.NumberSequencingCycles', '@idNumberSequencingCycles')}">
						<mx:headerRenderer > 
						<mx:Component>
							<mx:VBox verticalGap="0"   horizontalScrollPolicy="off"  horizontalAlign="center" verticalAlign="middle">
							    <mx:Label text="#"/>
							    <mx:Label text="Cycles"/>
							</mx:VBox>
						</mx:Component>
						</mx:headerRenderer>
					</mx:DataGridColumn>					

                     <mx:DataGridColumn dataField="@sampleConcentrationpM" editable="true" 
                     	showDataTips="true"
                     	headerText="Sample conc. (pM)" width="45"
                     	rendererIsEditor="false" 
                     	itemRenderer="{FlowCellSampleConcentrationLabel.create('@sampleConcentrationpM')}"
                     	itemEditor="{FlowCellSampleConcentrationTextInput.create('@sampleConcentrationpM')}">
						<mx:headerRenderer > 
						<mx:Component>
							<mx:VBox verticalGap="0"   horizontalScrollPolicy="off" horizontalAlign="center" verticalAlign="middle">
							    <mx:Label text="Sample"/>
							    <mx:Label text="conc. (pM)"/>
							</mx:VBox>
						</mx:Component>
						</mx:headerRenderer>
                    </mx:DataGridColumn>                 											
				</mx:columns>			
			</mx:DataGrid>		 
			    </mx:VBox> 
			<mx:Spacer height="10"/>
			<mx:VBox width="100%" height="100%" verticalGap="1">			
				<mx:Label text="Flow Cells ready for Sequencing" fontWeight="bold" color="#666D6E" fontStyle="italic"/>
				<util:DataGridAlternatingGroup width="100%" height="100%" dataProvider="{nextWorkList}">
					<util:columns>
						<mx:DataGridColumn  dataField="@flowCellNumber" headerText="Flow Cell #" width="18"/>
						<mx:DataGridColumn  dataField="@channelNumber" headerText="Channel" width="15"/>
						<mx:DataGridColumn  dataField="@flowCellBarcode" headerText="Barcode" width="18"/>
						<mx:DataGridColumn  dataField="@number" headerText="Flow Cell Sample #" width="40"/>
						<mx:DataGridColumn  dataField="@idNumberSequencingCycles" headerText="# Cycles"   width="30" labelFunction="lookupNumberSequencingCycles"/>
					</util:columns>				
				</util:DataGridAlternatingGroup>		
			</mx:VBox>
		</mx:VBox>
	</mx:HDividedBox>
	<mx:ControlBar horizontalAlign="right">
	    <mx:HBox width="100%" horizontalAlign="left">
			<mx:LinkButton textDecoration="underline" label="Refresh"  icon="@Embed('../../assets/action_refresh.gif')" 
				click="refreshWorkList();" toolTip="Refresh worklist"/>
	    </mx:HBox>
		<util:DirtyNote id="dirty"/>
		<mx:Button label="Save" id="saveButton" icon="@Embed(source='../../assets/save.png')" disabledIcon="@Embed(source='../../assets/save_disable.png')" click="save()"/>
	</mx:ControlBar>	
</mx:Panel>
