<?xml version="1.0" encoding="utf-8"?> 
<mx:Canvas styleName="panelWelcomeBox"  xmlns:mx="http://www.adobe.com/2006/mxml"   
		   xmlns:views="views.*"    
		   xmlns:util="views.util.*"  
		   creationPolicy="all" width="100%" height="100%"  		
		   show="init()"
		   showEffect="{parentApplication.fadeIn}" hideEffect="{parentApplication.fadeOut}" >
	<mx:states> 
		<mx:State name="GuestState">
			<mx:RemoveChild target="{submitExternalExperimentButton}"/>
			<mx:RemoveChild target="{amendButton}"/>
			<mx:RemoveChild target="{button1}"/>
			<mx:RemoveChild target="{sampleCharacteristicButton0}"/>
			<mx:RemoveChild target="{organismButton0}"/>
			<mx:RemoveChild target="{label4}"/>
			<mx:RemoveChild target="{button12}"/>
			<mx:RemoveChild target="{button8}"/>
			<mx:RemoveChild target="{button13}"/>
			<mx:RemoveChild target="{usageButton}"/>
		</mx:State>
		<mx:State name="AdminState">
			<mx:AddChild relativeTo="{hbox8}" position="lastChild">
				<mx:VBox height="100%" verticalGap="2">
					<mx:HBox id="hbox1" horizontalGap="2" verticalAlign="middle" verticalGap="2">
						<mx:Label text="Administration" styleName="welcomeLabel"/>
					</mx:HBox> 
					<mx:LinkButton id="dictionaryButton"  label="Manage Dictionaries" styleName="dashboardButton" 
								   click="showDictionaries()" visible="true" enabled="true" icon="@Embed(source='../../assets/book.png')"/>
					<mx:LinkButton id="sampleCharacteristicButton"  label="Configure Sample Annotations" styleName="dashboardButton" 
								   click="showSampleCharacteristicWindow()" visible="true" enabled="true" icon="@Embed(source='../../assets/page_white_wrench.png')"/>
					<mx:LinkButton id="platformConfigButton"  label="Configure Experiment Platforms" styleName="dashboardButton" 
								   click="showExperimentPlatformWindow()" visible="true" enabled="true" icon="@Embed(source='../../assets/page_white_wrench.png')"/>
					<mx:LinkButton id="organismButton"  label="Configure Organisms" styleName="dashboardButton" 
								   click="showOrganismWindow()" visible="true" enabled="true" icon="@Embed(source='../../assets/page_white_wrench.png')"/>
					<mx:LinkButton label="Manage microarray catalog" click="showSlides()" styleName="dashboardButton"  id="button0" icon="@Embed(source='../../assets/images.png')"/>
					<mx:LinkButton label="Setup a user or a lab group" click="showUsersAndGroups()" styleName="dashboardButton"  id="button10"  toolTip="Notify all GNomEx users via a broadcast email" icon="@Embed(source='../../assets/group.png')"/>
					<mx:LinkButton label="Send email to all GNomEx users" click="showBroadcastEmailWindow()" styleName="dashboardButton"  id="button9"  toolTip="Notify all GNomEx users via a broadcast email" icon="@Embed(source='../../assets/email_go.png')"/>
				</mx:VBox>
			</mx:AddChild>
			<mx:RemoveChild target="{sampleCharacteristicButton0}"/>
			<mx:RemoveChild target="{organismButton0}"/>
			<mx:RemoveChild target="{label4}"/>
			<mx:AddChild relativeTo="{vbox9}" position="lastChild" target="{label4}"/>
			<mx:RemoveChild target="{button12}"/>
			<mx:AddChild relativeTo="{vbox9}" position="lastChild" target="{button12}"/>
			<mx:RemoveChild target="{button8}"/>
			<mx:AddChild relativeTo="{vbox9}" position="lastChild" target="{button8}"/>
			<mx:SetStyle target="{label4}" name="paddingTop" value="2"/>
			<mx:RemoveChild target="{label3}"/>
			<mx:AddChild relativeTo="{hbox5}" position="before" target="{label3}"/>
			<mx:RemoveChild target="{button4}"/>
			<mx:AddChild relativeTo="{hbox5}" position="before" target="{button4}"/>
			<mx:RemoveChild target="{button5}"/>
			<mx:AddChild relativeTo="{hbox5}" position="before" target="{button5}"/>
			<mx:RemoveChild target="{vbox1}"/>
			<mx:SetStyle target="{label6}" name="paddingTop" value="30"/>
		</mx:State>
		<mx:State name="UserNonSubmitterState">
			<mx:RemoveChild target="{button1}"/>
			<mx:RemoveChild target="{amendButton}"/>
			<mx:RemoveChild target="{submitExternalExperimentButton}"/>
			<mx:RemoveChild target="{sampleCharacteristicButton0}"/>
			<mx:RemoveChild target="{organismButton0}"/>
		</mx:State>
		<mx:State name="UniversityOnlyUserState" basedOn="UserNonSubmitterState" >
		</mx:State>
		<mx:State name="ExternalUserState">
		</mx:State>
		<mx:State name="ExternalUserNonSubmitterState" basedOn="UserNonSubmitterState">
			<mx:SetStyle target="{label4}" name="paddingTop" value="6"/>
		</mx:State>
	</mx:states>
	<mx:Script>
		<![CDATA[
			import hci.flex.dictionary.DictionaryEditor;
			
			import mx.managers.PopUpManager;
			
			public function checkDirty():void {
			}
			
			public function init():void {
				checkSecurity();
			}
			
			public function checkSecurity():void {
				if (parentApplication.currentState == "GuestState") {
					if (parentApplication.isUniversityOnlyUser) {
						this.currentState = "UniversityOnlyUserState"
					} else {
						this.currentState = "GuestState";
					}
				} else if (parentApplication.currentState == "AdminState") {
					this.currentState = "AdminState";
				} else if (parentApplication.currentState == "UserNonSubmitterState")  {
					if (parentApplication.isExternalUser)  {
						currentState = "ExternalUserNonSubmitterState";												
					} else {
						currentState = "UserNonSubmitterState";						
					}
				} else if (parentApplication.isExternalUser)  {
					currentState = "ExternalUserState";
				} else {
					currentState = "";
				}
			}
			
			private function submitRequest():void {
				this.parentApplication.isInternalExperimentSubmission = true;
				this.parentApplication.theViews.selectedChild = this.parentApplication.submitRequestView;
				// If new experiment then initialize ShowCCNumber checkbox
				this.parentApplication.submitRequestView.showCCNumberColumn = "N";
			}
			
			private function submitExternalExperiment():void {
				this.parentApplication.isInternalExperimentSubmission = false;
				this.parentApplication.theViews.selectedChild = this.parentApplication.submitRequestView;
				// If new experiment then initialize ShowCCNumber checkbox
				this.parentApplication.submitRequestView.showCCNumberColumn = "N";
			}
			
			private function amendRequest():void {
				this.parentApplication.theViews.selectedChild = this.parentApplication.amendRequestView;
			}
			private function showExperiments():void {
				this.parentApplication.navExperimentView.shortcutToExperimentListTab = true;
				this.parentApplication.theViews.selectedChild = this.parentApplication.navExperimentView;
			}
			private function showExperimentDownloads():void {
				this.parentApplication.navExperimentView.shortcutToDownloadTab = true;
				this.parentApplication.theViews.selectedChild = this.parentApplication.navExperimentView;
			}
			private function showAnalysis():void {
				this.parentApplication.navAnalysisView.shortcutToAnalysisListTab = true;
				this.parentApplication.theViews.selectedChild = this.parentApplication.navAnalysisView;
			}
			private function showAnalysisDownloads():void {
				this.parentApplication.navAnalysisView.shortcutToDownloadTab = true;
				this.parentApplication.theViews.selectedChild = this.parentApplication.navAnalysisView;
			} 
			private function showProtocols():void {
				this.parentApplication.theViews.selectedChild = this.parentApplication.protocolsView;
			}	
			
			private function showPricing():void {
				navigateToURL(new URLRequest(parentApplication.getProperty(parentApplication.PROPERTY_PRICING_URL)), '_blank');
			}
			
			private function changePassword():void {
				parentApplication.showChangePasswordAfterLogin();
			}
			
			private function showAdvancedSearch():void {				
				parentApplication.showSearch();
			}		
			private function showSlides():void {
				this.parentApplication.theViews.selectedChild = this.parentApplication.slideManagementView;
			}
			private function showBilling():void {
				this.parentApplication.theViews.selectedChild = this.parentApplication.navBillingView;
			}
			private function showUsersAndGroups():void {
				this.parentApplication.theViews.selectedChild = this.parentApplication.navUsersView;
			}
			private function showWorkAuthForm():void {
				var workAuthWindow:WorkAuthorizationWindow = WorkAuthorizationWindow(PopUpManager.createPopUp(this, WorkAuthorizationWindow, true));
				PopUpManager.centerPopUp(workAuthWindow);
				
				workAuthWindow.emailAddress.text = parentApplication.getUserEmail();
				if (workAuthWindow.labCombo.dataProvider.length == 2) {
					workAuthWindow.labCombo.selectedIndex = 1;
				}
			}			       
			private function showDictionaries():void {
				parentApplication.showDictionaries();				
			}
			private function showBroadcastEmailWindow():void {
				var broadcastEmailWindow:BroadcastEmailWindow = BroadcastEmailWindow(PopUpManager.createPopUp(this, BroadcastEmailWindow, true));
				PopUpManager.centerPopUp(broadcastEmailWindow);
			}			
			
			private function showSampleCharacteristicWindow():void {
				var configWindow:SampleCharacteristicWindow = SampleCharacteristicWindow(PopUpManager.createPopUp(parentApplication.theBody, SampleCharacteristicWindow, true));
				PopUpManager.centerPopUp(configWindow);
				
			}
			
			private function showOrganismWindow():void {
				var configWindow:OrganismsWindow = OrganismsWindow(PopUpManager.createPopUp(parentApplication.theBody, OrganismsWindow, true));
				PopUpManager.centerPopUp(configWindow);
				
			}
			
			
			private function showExperimentPlatformWindow():void {
				var platformWindow:ExperimentPlatformWindow = ExperimentPlatformWindow(PopUpManager.createPopUp(parentApplication.theBody, ExperimentPlatformWindow, true));
				PopUpManager.centerPopUp(platformWindow);
				
			}
			
			private function showUsageWindow():void {
				this.parentApplication.theViews.selectedChild = this.parentApplication.navUsageView;
			}
			
		]]> 
	</mx:Script>
	
	<mx:Text text="{'Welcome ' + parentApplication.userName}" styleName="welcomeUserLabel" left="12" top="12"/>
	<mx:Text  bottom="2" right="2" text="{'Session started ' + parentApplication.loginDateTime}" styleName="welcomeSessionLabel"/>
	<mx:VBox   top="12" right ="2"  visible="{parentApplication.bulletin != ''}" backgroundColor="#FFFFFF" backgroundAlpha="1" id="vbox11">
		<mx:Text text="{parentApplication.bulletin}" fontSize="11"  width="300" fontStyle="italic" />  			
	</mx:VBox>
	<mx:VBox    
		width="100%" height="100%"  
		verticalAlign="middle" horizontalAlign="center"  
		paddingRight="6" paddingLeft="6" paddingBottom="6" verticalGap="40" paddingTop="6" id="vbox10">
		
		<mx:HBox width="100%" verticalAlign="top" horizontalAlign="center" horizontalGap="40" id="hbox8">
			<mx:VBox height="100%" width="268" verticalGap="2" id="vbox9">
				<mx:HBox id="hbox3" horizontalGap="2" verticalAlign="middle">
					<mx:Label text="Experiments" id="label2" styleName="welcomeLabel"/>
				</mx:HBox>
				<mx:LinkButton label="Submit Experiment Request"  click="submitRequest()"  
							   styleName="dashboardButton" id="button1"  toolTip="Submit new work requests for Microarray, Next generation sequencing or quality controlservices" icon="@Embed(source='../../assets/flask_add.png')"/>
				<mx:LinkButton label="Add services to Experiment Request"  click="amendRequest()" 
							   styleName="dashboardButton" id="amendButton"  toolTip="Add microarray or next gen sequencing services to an existing experiment request" icon="@Embed(source='../../assets/flask_edit.png')"/>
				<mx:LinkButton label="Register External Experiment"  click="submitExternalExperiment()"  
							   styleName="dashboardButton" id="submitExternalExperimentButton"  toolTip="Submit an experiment to the GNomEx repository and upload associated raw data files" icon="@Embed(source='../../assets/experiment_register.png')"/>
				<mx:LinkButton label="Browse Experiments and Projects" click="showExperiments()" styleName="dashboardButton" id="button2"  toolTip="View experiment progress, review project description and design parameters, review experiment and sample annotations" icon="@Embed(source='../../assets/flask.png')"/>
				<mx:LinkButton label="Download Experiment Results" click="showExperimentDownloads()" styleName="dashboardButton"  id="button3"  toolTip="Download experiment raw data files" icon="@Embed(source='../../assets/download.png')"/>
				<mx:LinkButton id="sampleCharacteristicButton0"  label="Configure Sample Annotations" styleName="dashboardButton" 
							   click="showSampleCharacteristicWindow()" visible="true" enabled="true" icon="@Embed(source='../../assets/page_white_wrench.png')"/>
				<mx:LinkButton id="organismButton0"  label="Configure Organisms" styleName="dashboardButton" 
							   click="showOrganismWindow()" visible="true" enabled="true" icon="@Embed(source='../../assets/page_white_wrench.png')"/>				
			</mx:VBox> 
			<mx:VBox height="100%" verticalAlign="top" horizontalAlign="left" id="vbox1" verticalGap="2" width="268" label="View experiment protocol descriptions">
				<mx:HBox id="hbox7" horizontalGap="2" verticalAlign="middle">
					<mx:Label text="Analysis" id="label3" styleName="welcomeLabel"/>
				</mx:HBox> 
				<mx:LinkButton label="Browse Analyses" click="showAnalysis()" styleName="dashboardButton"  id="button4"  verticalGap="4" toolTip="Browse analysis entries, view analysis annotations" icon="@Embed(source='../../assets/map.png')"/>
				<mx:LinkButton label="Download Analyzed data files" click="showAnalysisDownloads()" styleName="dashboardButton"  id="button5"  toolTip="Download analysis data files" icon="@Embed(source='../../assets/download.png')"/>
				<mx:Label text="Billing" id="label4" styleName="welcomeLabel" paddingTop="20"/>
				<mx:LinkButton label="Pricing" click="showPricing()" styleName="dashboardButton"  id="button12"  toolTip="Show core facility pricing for experiment services and products" icon="@Embed(source='../../assets/money_dollar.png')" visible="{parentApplication.pricingURL != ''}"/>
				<mx:LinkButton label="Submit Work Authorization" click="showWorkAuthForm()" styleName="dashboardButton" id="button8"  toolTip="Submit a work authorization form indicating the billing account to be charged for work" icon="@Embed(source='../../assets/work_auth_form.png')"/>
			</mx:VBox>
			<mx:VBox height="100%" width="268" verticalGap="2" id="vbox12">
				<mx:HBox id="hbox5" horizontalGap="2">
					<mx:Label text="General" id="label6" styleName="welcomeLabel"/>
				</mx:HBox>
				<mx:LinkButton label="Perform advanced search" click="showAdvancedSearch()" styleName="dashboardButton"  id="button7"  toolTip="Perform advanced search on experiments, analysis, and protocols" icon="@Embed(source='../../assets/magnifier.png')"/>
				<mx:LinkButton label="Change password" click="changePassword()" styleName="dashboardButton"  id="button13"  icon="@Embed(source='../../assets/user.png')"/>
				<mx:LinkButton label="View experiment protocol descriptions" click="showProtocols()" styleName="dashboardButton"  id="button6"  icon="@Embed(source='../../assets/bricks.png')"/>
				<mx:LinkButton id="usageButton"  label="Track Usage" styleName="dashboardButton" 
							   click="showUsageWindow()" enabled="{parentApplication.showUsage}" icon="@Embed(source='../../assets/chart_bar.png')" disabledIcon="@Embed(source='../../assets/chart_bar_disabled.png')"/>
			</mx:VBox>
		</mx:HBox>
		
	</mx:VBox>
</mx:Canvas>