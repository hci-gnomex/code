<?xml version="1.0" encoding="utf-8"?>
<mx:TitleWindow xmlns:mx="http://www.adobe.com/2006/mxml" layout="vertical" title="Filter By Experiment Platform"
				width="400"  showCloseButton="false" creationComplete="centerMe();" show="init();"
				paddingLeft="2" paddingRight="2" paddingTop="2" paddingBottom="2" height="294" verticalGap="4" titleIcon="@Embed(source='../../assets/group.png')" headerHeight="19">
	
	
	<mx:Script>
		
		<![CDATA[
			import hci.flex.controls.CheckBox;
			
			import mx.collections.XMLListCollection;
			import mx.controls.Alert;
			import mx.events.CloseEvent;
			import mx.events.ListEvent;
			import mx.managers.FocusManager;
			import mx.managers.PopUpManager;
			
			import views.renderers.CheckBoxRenderer;
			
			public var selectedRequestCategories:XMLListCollection = new XMLListCollection();
			public var parentWindow:Object;
			
			
			public function init():void {
//				for each(var rc:XML in requestCategories){
//					rc.@isSelected = false;
//				}
			}
			
			private function centerMe():void{
				PopUpManager.centerPopUp(this);
			}
			
			private function close():void{
				parentWindow.requestCategories = new XMLListCollection(this.requestCategories.copy());
				dispatchEvent(new CloseEvent(CloseEvent.CLOSE));
				PopUpManager.removePopUp(this);
			}
			
			private function toggleCustomColumnCheck(event:ListEvent):void{
				if (requestCategoryGrid.selectedItems.length > 1 ) {
					for each ( var obj1:Object in requestCategoryGrid.selectedItems ) {
						obj1.@isSelected = true;
					}
				} else if ( event.columnIndex != 0 ){
					
					// We don't want the typing in the the text field for "Other" to be treated
					// as a toggle off
					if ( requestCategoryGrid.selectedItem == null ) {
						return;
					}
					
					if (requestCategoryGrid.selectedItem.@isSelected == "true") {
						requestCategoryGrid.selectedItem.@isSelected = "false";
					} else {
						requestCategoryGrid.selectedItem.@isSelected = "true";
					} 
				}
				
			}
			
			private function filterByCoreFacility(item:Object):Boolean{
				return parentApplication.isCoreFacilityIManage(item.@idCoreFacility);
			}
			
		]]>
		
	</mx:Script>
	
	<mx:XMLListCollection id="requestCategories" filterFunction="filterByCoreFacility" source="{parentApplication.dictionaryManager.xml.Dictionary.(@className == 'hci.gnomex.model.RequestCategory').DictionaryEntry.(@isActive == 'Y' &amp;&amp; @value != '')}"/>
	
	
	<mx:VBox width="100%" height="100%">
		<mx:DataGrid id="requestCategoryGrid" width="100%" height="100%" itemClick="toggleCustomColumnCheck(event)" 
					 showHeaders="true" headerHeight="20" variableRowHeight="true"
					 allowMultipleSelection="true" focusOut="{requestCategoryGrid.selectedIndex=-1}" rowHeight="20" >
			<mx:dataProvider>{requestCategories}</mx:dataProvider>
			<mx:columns>
				<mx:DataGridColumn id="checkBoxColumn1"
								   textAlign="center"
								   width="30" minWidth="30"
								   resizable="false"
								   sortable="false"
								   editable="true"
								   rendererIsEditor="true"
								   dataField="@isSelected"
								   editorDataField="selected"
								   itemRenderer="views.renderers.CheckBoxIsSelectedToggle"
								   headerRenderer="views.renderers.CheckBoxHeader"
								   draggable="false"/>
				<mx:DataGridColumn headerText="Experiment Platform" dataField="@display" />
			</mx:columns>
		</mx:DataGrid>
	</mx:VBox>
	
	<mx:HBox  horizontalAlign="right" width="100%" id="searchButtonView" verticalAlign="middle">
		<mx:Button label="Close" click="close()"/>
	</mx:HBox>
	
</mx:TitleWindow>