<?xml version="1.0" encoding="utf-8"?>
<mx:Canvas xmlns:mx="http://www.adobe.com/2006/mxml" 
	label="Confirm" width="100%" 
	height="100%" 
	enabled="false"
	show="init()">
	<mx:states>
		<mx:State name="BillingState">
			<mx:AddChild relativeTo="{confirmContainer}" position="lastChild">
				<mx:VBox width="100%" height="100%" verticalGap="0" id="billingContainer" paddingTop="6">
				    <mx:HBox width="100%" id="chargesHeaderBox">
	 					<mx:Label text="{'Estimated Charges ' + parentDocument.createBillingItems.lastResult.Request.@totalPrice}" id="label2" textDecoration="underline"/>								    	
				    </mx:HBox>
					<mx:VBox paddingLeft="20" width="100%" height="100%" id="vbox1">
						<mx:DataGrid height="100%" id="billingConfirmGrid"  
							editable="false" dataProvider="{parentDocument.createBillingItems.lastResult..BillingItem}"  
							backgroundAlpha="0" borderStyle="none"  showHeaders="false" 
							sortableColumns="false" horizontalGridLines="false" verticalGridLines="false" rowHeight="19" fontSize="9">
							<mx:columns>
							   				<mx:DataGridColumn  headerText="Price Category" dataField="@category" editable="false" width="200">
							   				     <mx:itemRenderer>
							   				         <mx:Component>
							   				         <mx:Text text="{data.@category}" styleName="{data.@other == 'Y' ?'other':'normal'}" />
							   				         </mx:Component>
							   				     </mx:itemRenderer>
							   				</mx:DataGridColumn>
							   				<mx:DataGridColumn headerText="Description" dataField="@description" editable="false" width="200">
							   				     <mx:itemRenderer>
							   				         <mx:Component>
							   				         <mx:Text text="{data.@description}" styleName="{data.@other == 'Y' ?'other':'normal'}" />
							   				         </mx:Component>
							   				     </mx:itemRenderer>
							   				</mx:DataGridColumn>
							   				<mx:DataGridColumn headerText="Qty" dataField="@qty" editable="false" textAlign="right" width="50" >
							   				  <mx:itemRenderer>
							   				         <mx:Component>
							   				         <mx:Text  textAlign="right" text="{data.@qty}" styleName="{data.@other == 'Y' ?'other':'normal'}" />
							   				         </mx:Component>
							   				     </mx:itemRenderer>
							   				</mx:DataGridColumn>
							   				<mx:DataGridColumn headerText=""   textAlign="center" editable="false" width="10" > 
							   				  <mx:itemRenderer>
							   				         <mx:Component>
							   				         <mx:Text  textAlign="center" text="X" styleName="{data.@other == 'Y' ?'other':'normal'}" />
							   				         </mx:Component>
							   				     </mx:itemRenderer>
							   				</mx:DataGridColumn>
							   				<mx:DataGridColumn headerText="Unit price" dataField="@unitPrice"  textAlign="right" editable="false" width="65" > 
							   				  <mx:itemRenderer>
							   				         <mx:Component>
							   				         <mx:Text  textAlign="right" text="{data.@unitPrice}" styleName="{data.@other == 'Y' ?'other':'normal'}" />
							   				         </mx:Component>
							   				     </mx:itemRenderer>
							   				</mx:DataGridColumn>
							   				<mx:DataGridColumn headerText=""   textAlign="left" editable="false" width="10" > 
							   				  <mx:itemRenderer>
							   				         <mx:Component>
							   				         <mx:Text  textAlign="left" text="=" styleName="{data.@other == 'Y' ?'other':'normal'}" />
							   				         </mx:Component>
							   				     </mx:itemRenderer>
							   				</mx:DataGridColumn>
							   				<mx:DataGridColumn headerText="Total price" dataField="@totalPrice" textAlign="right" width="105" editable="false" >
							   				  <mx:itemRenderer>
							   				         <mx:Component>
							   				         <mx:Text text="{data.@totalPrice}"  textAlign="right" styleName="{data.@other == 'Y' ?'other':'normal'}" />
							   				         </mx:Component>
							   				     </mx:itemRenderer> 
							   				</mx:DataGridColumn>
							   			</mx:columns>
						</mx:DataGrid>
					</mx:VBox>
					
				</mx:VBox>
			</mx:AddChild>
			<mx:SetStyle target="{label1}" name="textDecoration" value="underline"/>
			<mx:SetStyle target="{label3}" name="textDecoration" value="underline"/>
		</mx:State>
		<mx:State name="BillingExceedState" basedOn="BillingState">
			<mx:AddChild relativeTo="{chargesHeaderBox}" position="lastChild">
			    <mx:HBox borderStyle="solid" borderColor="#000000" borderThickness="1" id="hbox1">
					<mx:Text text="{'Total charges exceed balance remaining on billing account by ' + parentDocument.createBillingItems.lastResult.Request.@exceededDollarAmount + '. Experiment request cannot be submitted.'}" styleName="warningLabelSevere"/>			    	
			    </mx:HBox>
			</mx:AddChild>
			<mx:SetStyle target="{chargesHeaderBox}" name="verticalAlign" value="middle"/>
			<mx:AddChild relativeTo="{hbox1}" position="before">
				<mx:Spacer width="10"/>
			</mx:AddChild>
		</mx:State>
		<mx:State name="ExternalExperimentState">
			<mx:RemoveChild target="{vbox2}"/>
			<mx:SetProperty target="{text1}" name="width" value="300"/>
			<mx:SetProperty target="{text2}" name="width" value="200"/>
			<mx:SetProperty target="{requestKindLabel}" name="width" value="160"/>
			<mx:SetProperty target="{appLabel}" name="width" value="160"/>
			<mx:SetProperty target="{textarea1}" name="htmlText">
				<mx:value><![CDATA[1.  Please confirm that all information has been<br>     correctly entered. Modifications can be made by<br>     clicking the “Back” button or by clicking on a tab.<br>2.  Submit the experiment information by<br>      clicking the “Submit” button.]]></mx:value>
			</mx:SetProperty>
		</mx:State>
	</mx:states>
	
	
<mx:Script>	
	<![CDATA[
		import views.util.AnnotationDataGridColumn;
		import hci.flex.controls.ComboBox;
		import hci.flex.controls.DropdownLabel;
		
		private function init():void {
			parentDocument.getEstimatedBilling();
		} 

        public function showHideColumns():void {
        	if (parentDocument.isSolexaState()) {
				concentrationUnitConfirmColumn.visible = true;
				sampleOrganismConfirmColumn.visible = true;
				chipTypeConfirmColumn.visible = false; 
				
				preppedByCoreCol.visible = true;
				samplePrepMethodConfirmCol.visible = true;
				
				corePrepInstructionsConfirmColumn.visible = true;
				
				if (!parentDocument.isEditState() &&
				    parentDocument.sampleSetupView.currentState == "SolexaSetupState") {
					seqLibProtocolConfirmCol.visible = false;
				} else {
					seqLibProtocolConfirmCol.visible = true;
				}
			} else if (parentDocument.currentState == 'QCState') {
				concentrationUnitConfirmColumn.visible = true;
				sampleOrganismConfirmColumn.visible = false;
				chipTypeConfirmColumn.visible = true; 
				samplePrepMethodConfirmCol.visible = true;
				preppedByCoreCol.visible = false;
				seqLibProtocolConfirmCol.visible = false;
				corePrepInstructionsConfirmColumn.visible = false;
			} else {
				concentrationUnitConfirmColumn.visible = true;
				sampleOrganismConfirmColumn.visible = true;
				chipTypeConfirmColumn.visible = false; 
				samplePrepMethodConfirmCol.visible = true;
				preppedByCoreCol.visible = false;
				seqLibProtocolConfirmCol.visible = false;
				corePrepInstructionsConfirmColumn.visible = false;
			}
			// If this is a QC request, hide the annotation columns 
			if (parentDocument.currentState == 'QCState') {
				// Make all annotation columns invisible
				for each(var col:DataGridColumn in this.samplesGridConfirm.columns) {
					if (col is views.util.AnnotationDataGridColumn) {
						col.visible = false;
					}
				} 
			}
  						 
        }
		
	]]>
</mx:Script>
	<mx:VBox id="confirmHeaderContainer"  width="100%" height="100%" backgroundAlpha="0.0" verticalGap="0">
		<mx:VBox   width="100%" height="100%" backgroundAlpha="0.0" verticalGap="0" paddingBottom="5" paddingLeft="5" paddingRight="5" paddingTop="0" id="confirmContainer">
			<mx:HBox width="100%" horizontalGap="4">
				<mx:VBox height="100%" verticalGap="0">
					<mx:Label text="Experiment" textDecoration="underline" height="16"/>
					<mx:Text text="{parentDocument.requestCategoryName}" id="requestKindLabel" width="140"/>
					<mx:Text text="{parentDocument.applicationName}" id="appLabel" width="140"/>
				</mx:VBox>
				<mx:VBox height="100%" verticalGap="0">
					<mx:Label text="Lab" textDecoration="underline" height="16"/>
					<mx:Text text="{parentDocument.isAmendState() ? parentDocument.labCombo.selectedItem.@name : parentDocument.setupView.labCombo.selectedItem.@name}" width="140" id="text2"/>
				</mx:VBox>
				<mx:VBox height="100%" verticalGap="0">
					<mx:Label text="Project" textDecoration="underline" height="16"/>
					<mx:Text text="{parentDocument.isAmendState() ? parentDocument.request.@projectName : parentDocument.setupView.projectCombo.selectedItem.@name}" width="200" height="100%" id="text1"/>
				</mx:VBox>
				<mx:VBox height="100%" verticalGap="0" id="vbox2">
					<mx:Label text="Billing Account" textDecoration="underline" height="16"/>
					<mx:Text text="{parentDocument.isAmendState() ? parentDocument.request.@billingAccountName : parentDocument.setupView.billingAccountCombo.selectedItem.@accountName}" width="250"/>
					<mx:Text text="{parentDocument.isAmendState() ? parentDocument.request.@billingAccountNumber : parentDocument.setupView.billingAccountCombo.selectedItem.@accountNumber}" width="250"/>
				</mx:VBox>
				<mx:Spacer width="100%"/>
				<mx:TextArea styleName="instructionBox" right="0" top="0" width="268" wordWrap="true" id="textarea1" height="78">
					  <mx:htmlText><![CDATA[1.  Please confirm that all information has been<br>     correctly entered. Modifications can be made by<br>    clicking the “Back” button or by clicking on a tab.<br>2.  Approve the work request by clicking the<br>     “Submit” button.]]></mx:htmlText>
				</mx:TextArea>
			</mx:HBox>
			
			<mx:VBox verticalGap="0" width="100%" id="samplesConfirmContainer" paddingTop="2" height="100%">
				<mx:Label text="{parentDocument.samples.length + ' Samples'}" id="label1"/>
				<mx:DataGrid width="100%" id="samplesGridConfirm"  editable="false" dataProvider="{parentDocument.samples}" 
					backgroundAlpha="0" borderStyle="solid"  horizontalScrollPolicy="auto" height="100%"
					sortableColumns="false" alpha=".7" fontSize="9" rowHeight="19">
					<mx:columns>
						<mx:DataGridColumn headerText="Sample Name" width="100" dataField="@name">				    
						</mx:DataGridColumn>
						<mx:DataGridColumn headerText="Conc." width="65" dataField="@concentration"/>
		                <mx:DataGridColumn id="concentrationUnitConfirmColumn" headerText="Unit"  width="60" 
	                  	  itemRenderer="{DropdownLabel.getFactory(parentApplication.dictionaryManager.xml.Dictionary.(@className=='hci.gnomex.model.ConcentrationUnit').DictionaryEntry, '@display', '@value', '@codeConcentrationUnit')}"/>
	                    <mx:DataGridColumn id="barcodeColumn"  headerText="Barcode" width="60" dataField="@idOlogiBarcode" 
	                      editorDataField="value" sortable="false" editable="false" rendererIsEditor="true" 
	                      visible="false"
 	                      itemRenderer="{DropdownLabel.getFactory(parentApplication.dictionaryManager.xml.Dictionary.(@className=='hci.gnomex.model.OligoBarcode').DictionaryEntry, '@barcodeSequence', '@value', '@idOligoBarcode')}" />

						<mx:DataGridColumn id="AGE0" headerText="Age" dataField="@AGE" editable="false" visible="{parentDocument.request.@AGE == 'Y' ? true : false}"/>
						<mx:DataGridColumn id="CELLLINE0" headerText="Cell line" dataField="@CELLLINE" editable="false" visible="{parentDocument.request.@CELLLINE == 'Y' ? true : false}"/>
						<mx:DataGridColumn id="CELLTYPE0" headerText="Cell Type" dataField="@CELLTYPE" editable="false" visible="{parentDocument.request.@CELLTYPE == 'Y' ? true : false}"/>
						<mx:DataGridColumn id="CLININFO0" headerText="Clinical Info" dataField="@CLININFO" editable="false" visible="{parentDocument.request.@CLININFO == 'Y' ? true : false}"/>
						<mx:DataGridColumn id="COMPOUND0" headerText="Compound" dataField="@COMPOUND" editable="false" visible="{parentDocument.request.@COMPOUND == 'Y' ? true : false}"/>
						<mx:DataGridColumn id="DISSTATE0" headerText="Disease State" dataField="@DISSTATE" editable="false" visible="{parentDocument.request.@DISSTATE == 'Y' ? true : false}"/>
						<mx:DataGridColumn id="DOSE0" headerText="Dose" dataField="@DOSE" editable="true" visible="{parentDocument.request.@DOSE == 'Y' ? true : false}"/>
						<mx:DataGridColumn id="GENMOD0" headerText="Genetic Modification" dataField="@GENMOD" editable="false" visible="{parentDocument.request.@GENMOD == 'Y' ? true : false}"/>
						<mx:DataGridColumn id="GENOTYPE0" headerText="Genotype" dataField="@GENOTYPE" editable="false" visible="{parentDocument.request.@GENOTYPE == 'Y' ? true : false}"/>
						<mx:DataGridColumn id="GROWTHCOND0" headerText="Growth Conditions" dataField="@GROWTHCOND" editable="false" visible="{parentDocument.request.@GROWTHCOND == 'Y' ? true : false}"/>
						<mx:DataGridColumn id="INDIV0" headerText="Individual" dataField="@INDIV" editable="false" visible="{parentDocument.request.@INDIV == 'Y' ? true : false}"/>
						<mx:DataGridColumn id="ORGPART0" headerText="Organ / Tissue" dataField="@ORGPART" editable="false" visible="{parentDocument.request.@ORGPART == 'Y' ? true : false}"/>
						<mx:DataGridColumn id="SEX0" headerText="Sex" dataField="@SEX" editable="false" visible="{parentDocument.request.@SEX == 'Y' ? true : false}"/>
						<mx:DataGridColumn id="TEMP0" headerText="Temperature" dataField="@TEMP" editable="false" visible="{parentDocument.request.@TEMP == 'Y' ? true : false}"/>
						<mx:DataGridColumn id="TIME0" headerText="Time Course" dataField="@TIME" editable="false" visible="{parentDocument.request.@TIME == 'Y' ? true : false}"/>
						<mx:DataGridColumn id="otherDataColumnConfirm" headerText="Other" dataField="@OTHER" editable="false" visible="{parentDocument.request.@OTHER == 'Y' ? true : false}"/>
						<mx:DataGridColumn id="treatmentConfirmColumn" headerText="Treatment" visible="{parentDocument.request.@treatment == 'Y' ? true : false}" width="100" dataField="@treatment"/>
						<mx:DataGridColumn headerText="Description" width="200" dataField="@description"/>

						<mx:DataGridColumn id="corePrepInstructionsConfirmColumn" headerText="Instructions" width="140" dataField="@prepInstructions"/>


  					    <mx:DataGridColumn id="preppedByCoreCol" headerText="Core to prep lib?"   visible="{true}" width="104"  dataField="@seqPrepByCore" editable="false"/>
			            <mx:DataGridColumn headerText="Seq Lib Protocol" id="seqLibProtocolConfirmCol" width="160" 
	                  	  itemRenderer="{DropdownLabel.getFactory(parentApplication.dictionaryManager.xml.Dictionary.(@className=='hci.gnomex.model.SeqLibProtocol').DictionaryEntry, '@display', '@value', '@idSeqLibProtocol')}"/>
			            <mx:DataGridColumn headerText="Nucl. acid extraction method" id="samplePrepMethodConfirmCol" width="160" 
	                  	  itemRenderer="{DropdownLabel.getFactory(parentApplication.dictionaryManager.xml.Dictionary.(@className=='hci.gnomex.model.SamplePrepMethod').DictionaryEntry, '@display', '@value', '@idSamplePrepMethod')}"/>
						<mx:DataGridColumn headerText="Other nucl. acid extraction method" width="200" dataField="@otherSamplePrepMethod"/>
			            <mx:DataGridColumn headerText="Sample Type"  width="130" 
	                  	  itemRenderer="{DropdownLabel.getFactory(parentApplication.dictionaryManager.xml.Dictionary.(@className=='hci.gnomex.model.SampleType').DictionaryEntry, '@display', '@value', '@idSampleType')}"/>
			            <mx:DataGridColumn headerText="Organism" id="sampleOrganismConfirmColumn" width="100" 
	                  	  itemRenderer="{DropdownLabel.getFactory(parentApplication.dictionaryManager.xml.Dictionary.(@className=='hci.gnomex.model.Organism').DictionaryEntry, '@display', '@value', '@idOrganism')}"/>
		                <mx:DataGridColumn id="chipTypeConfirmColumn" headerText="Chip Type"  width="130" 
	                  	  itemRenderer="{DropdownLabel.getFactory(parentApplication.dictionaryManager.xml.Dictionary.(@className=='hci.gnomex.model.BioanalyzerChipType').DictionaryEntry, '@display', '@value', '@codeBioanalyzerChipType')}"/>
					</mx:columns>
				</mx:DataGrid>				
			</mx:VBox>
			
			<mx:VBox width="100%" verticalGap="0" id="hybsConfirmContainer" paddingTop="4" height="100%">
				<mx:Label text="{parentDocument.hybs.length + ' Hybridizations'}" id="label3"/>
				<mx:DataGrid width="100%" height="100%" id="hybsGridConfirm" 
					editable="false" dataProvider="{parentDocument.hybs}"  
					backgroundAlpha="0" borderStyle="solid" 
					sortableColumns="false" alpha=".7" fontSize="9" rowHeight="19">
					<mx:columns>
					    <mx:DataGridColumn editable="false" headerText="Cy3 Sample (green)"  width="122" labelFunction="parentDocument.getSampleChannel1Name"/>
					    <mx:DataGridColumn id="channel2SampleConfirmColumn" editable="false" headerText="Cy5 Sample (red)"  width="122" labelFunction="parentDocument.getSampleChannel2Name"/>
					     <mx:DataGridColumn headerText="Slide"  width="182" 
	                  	  itemRenderer="{DropdownLabel.getFactory(parentApplication.dictionaryManager.xml.Dictionary.(@className=='hci.gnomex.model.SlideDesign').DictionaryEntry, '@display', '@value', '@idSlideDesign')}"/>
					     <mx:DataGridColumn headerText="Slide Source"  width="52" 
	                  	  itemRenderer="{DropdownLabel.getFactory(parentApplication.dictionaryManager.xml.Dictionary.(@className=='hci.gnomex.model.SlideSource').DictionaryEntry, '@display', '@value', '@codeSlideSource')}"/>
					</mx:columns>
				</mx:DataGrid>
				
			</mx:VBox>

		</mx:VBox>
	</mx:VBox>
</mx:Canvas>
