<?xml version="1.0" encoding="utf-8"?>
<mx:Canvas label="Description" 
		   width="100%" height="100%"
		   xmlns:views="*.views" xmlns:mx="http://www.adobe.com/2006/mxml" xmlns:util="views.util.*">

	<mx:states>
		<mx:State name="EditState">
			<mx:SetProperty target="{text1}" name="htmlText" value="Experiment name"/>
			<mx:SetProperty target="{label1}" name="text" value="Experiment description"/>
			<mx:SetProperty target="{label2}" name="text" value="Notes for Core Facility"/>
			<mx:SetProperty target="{label3}" name="text" value="Notes for the Bioinformatics Group regarding analysis"/>
		</mx:State>
	</mx:states>

<mx:Script>
	<![CDATA[
		
	import mx.controls.Alert;
	import views.util.StringUtil;
		
		
	private function propagateDescript(e:FocusEvent):void{
		parentDocument.request.@description = "";  // Description will be saved differently to avoid problems sending with XML encoding.
		parentDocument.saveDescription = StringUtil.cleanRichTextHTML(overallDescript.htmlText);
		parentDocument.confirmView.expDescriptArea.text = overallDescript.text;
	}
	
	private function propagateAnalysisInstructions():void {
 		for each (var sample:Object in parentDocument.samples) {
			sample.@analysisInstructions = noteToBio.text;
		}
		for each (var lane:Object in parentDocument.lanes) {
			lane.@analysisInstructions = noteToBio.text;
		} 
		parentDocument.request.@analysisInstructions = noteToBio.text;
		parentDocument.confirmView.bioNotes.text = noteToBio.text;
		parentDocument.request.@analysisInstructions = noteToBio.text;

	}
	
	private function propagatePrepInstructions():void {
 		for each (var sample:Object in parentDocument.samples) {
			sample.@prepInstructions = noteToSeq.text;
		}
		parentDocument.confirmView.seqNotes.text = noteToSeq.text;
		parentDocument.request.@corePrepInstructions = noteToSeq.text;
	}
	private function propagateName():void {
		parentDocument.confirmView.experimentName.text = experimentName.text;
		parentDocument.request.@name = experimentName.text;
	}
	

	public function setAnalysisVisibility():void {
		var includeBioNote:Boolean = (parentDocument.requestType != parentApplication.TYPE_QC
			&& parentDocument.requestType != parentApplication.TYPE_CAP_SEQ
			&& parentDocument.requestType != parentApplication.TYPE_FRAG_ANAL
			&& parentDocument.requestType != parentApplication.TYPE_MIT_SEQ
			&& parentDocument.requestType != parentApplication.TYPE_CHERRY_PICK)
		label3.visible = includeBioNote;
		label3.includeInLayout = includeBioNote;
		noteToBio.visible = includeBioNote;
		noteToBio.includeInLayout = includeBioNote;
	}
		
	private function removeRichTextButtons():void {
		this.overallDescript.toolbar.removeChild(overallDescript.colorPicker);
		this.overallDescript.toolbar.removeChild(overallDescript.fontFamilyCombo);
		this.overallDescript.toolbar.removeChild(overallDescript.fontSizeCombo);
	}
		
	]]>
</mx:Script>
	<mx:VBox width="100%" height="100%" paddingLeft="4" paddingRight="4" paddingTop="4" paddingBottom="4" verticalGap="0">
		<mx:HBox>
			<mx:Text id="text1">
				<mx:htmlText>(1) Name your experiment. (optional)</mx:htmlText>
			</mx:Text>
			<mx:TextInput id="experimentName" focusOut="propagateName()" text="{parentDocument.request.@name}"  width="301" maxChars="200"/>
			<mx:Spacer width="10"/>
		</mx:HBox>	
		<mx:Spacer height="10" />
		<mx:Label text="(2) Provide an experiment description. (optional)" id="label1"/>
		<mx:RichTextEditor  borderStyle="none"  headerHeight="0"  
							id="overallDescript" width="100%" 
							htmlText="{parentDocument.request.@description}" 
							showControlBar="true"
							change="parentDocument.dirty.setDirty();"
							creationComplete="removeRichTextButtons(); this.addEventListener(FocusEvent.FOCUS_OUT,propagateDescript); "
							paddingLeft="0" paddingRight="0" paddingTop="0" 
							roundedBottomCorners="false" paddingBottom="0" 
							borderThicknessRight="0" borderThicknessLeft="0" 
							borderThicknessBottom="0" borderThickness="0" 
							borderThicknessTop="0" height="100%" minHeight="50"/>		
        <mx:Spacer height="10" />
		<mx:Label text="(3) Enter a note for the Core Facility. (optional)"  id="label2"/>
		<util:TextAreaWorkaround id="noteToSeq" text="{parentDocument.request.@corePrepInstructions}" focusOut="propagatePrepInstructions()" 
				width ="100%" height="50%"/>
		<mx:Spacer height="10"  />
		<mx:Label text="(4) Enter a note for the Bioinformatics Group regarding analysis. (optional)" id="label3"/>
		<util:TextAreaWorkaround id="noteToBio" text="{parentDocument.request.@analysisInstructions}" 
				focusOut="propagateAnalysisInstructions()" width ="100%" height="50%"/>
		
	</mx:VBox>

	
</mx:Canvas>