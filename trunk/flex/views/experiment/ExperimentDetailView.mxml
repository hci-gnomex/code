<?xml version="1.0" encoding="utf-8"?>
<mx:VBox  
    xmlns:mx="http://www.adobe.com/2006/mxml" 
	width="100%" height="100%" initialize="overallDescript.textArea.editable=false;"
	xmlns:views="views.*"   creationPolicy="all"
	xmlns:util="views.util.*" xmlns:experiment="views.experiment.*" 
	xmlns:data="views.data.*">
   
	<mx:HTTPService  
    id="getProtocol" 
    url="GetProtocol.gx"
    resultFormat="e4x"
    showBusyCursor="true"
    result="onGetProtocol(event)"
    fault="parentApplication.onFailHttpRequest('Failed to get protocol', event)"
	method="POST"
    useProxy="false">
  </mx:HTTPService>
	
	
	<mx:HTTPService  
		id="cacheFDTFileDownloadList" 
		url="CacheFileDownloadList.gx"
		destination="cacheFileDownloadList"
		resultFormat="e4x"
		showBusyCursor="true"
		result="onCacheFDTFileDownloadList(event)"
		fault="parentApplication.onFailHttpRequest('Failed to get cache file download list', event)"
		method="POST"
		useProxy="false">
		<mx:request>
			<fileDescriptorXMLString>{selectedFileList.toXMLString()}</fileDescriptorXMLString>
		</mx:request>
	</mx:HTTPService>
  	 
<mx:Script>
	<![CDATA[
		import hci.flex.controls.DropdownLabel;
		
		import mx.collections.Grouping;
		import mx.collections.GroupingCollection;
		import mx.collections.GroupingField;
		import mx.collections.XMLListCollection;
		import mx.controls.Alert;
		import mx.events.CloseEvent;
		import mx.events.IndexChangedEvent;
		import mx.managers.PopUpManager;
		import mx.rpc.events.ResultEvent;
		import mx.utils.ObjectUtil;
		
		import views.experiment.ConvertIlluminaRequestWindow;
		import views.experiment.ExperimentEditView;
		import views.renderers.MultiselectRenderer;
		import views.renderers.URLRenderer;
		import views.util.RunAlignmentWindow;
		
		public var sampleGroupingCollection:GroupingCollection = null;		
		
	
		[Bindable]
		private var requestCategoryName:String;
		[Bindable]
		private var experimentCategoryName:String;
		[Bindable]
		private var seqLibTreatments:String;
		[Bindable]
		private var visibilityName:String;
		
		
		[Bindable]
		public var selectedExperiment:Object;
		
		public function isCapSeqState():Boolean {
			if (currentState == 'CapSeqState') {
				return true;
			} else {
				return false;
			}
		}
		
		public function isMitSeqState():Boolean {
			if (currentState == 'MitSeqState') {
				return true;
			} else {
				return false;
			}
		}
		
		public function isFragAnalState():Boolean {
			if (currentState == 'FragAnalState') {
				return true;
			} else {
				return false;
			}
		}
		
		public function isCherryPickState():Boolean {
			if (currentState == 'CherryPickState') {
				return true;
			} else {
				return false;
			}
		}
		
		public function checkSecurity():void {
			
			if (parentApplication.isGuestMode()) {
				this.showCy3LabelingFieldsCheckBox.visible = false;
				this.showCy5LabelingFieldsCheckBox.visible = false;
				this.showExtFieldsCheckBox.visible = false;
				this.showHybFieldsCheckBox.visible = false;
				
				
				if (parentDocument != null && parentDocument is ExperimentDetailPanel) {
					parentDocument.requestFormButton.visible = false;				
				}
			}
		}
	
		public function setupForm(selectedExperiment:Object):void {
			this.selectedExperiment = selectedExperiment;
			
			if(selectedExperiment.@captureLibDesignId != ""){
				libDesignAndInsertBox.visible = true;
				designAndInsertLabel.text = "Cap Lib Design";
				designAndInsertText.text = selectedExperiment.@captureLibDesignId;
			}
			else if(selectedExperiment.@avgInsertSizeFrom != ""){
				libDesignAndInsertBox.visible = true;
				designAndInsertLabel.text = "Avg Insert Size";
				designAndInsertText.text = selectedExperiment.@avgInsertSizeFrom + " to " + selectedExperiment.@avgInsertSizeTo + " bp";

			}
			else{
				libDesignAndInsertBox.visible = false;

			}
				
			if (selectedExperiment.@canUpdate == 'Y' && this.billingItems.length > 0) {
				if (!theTab.contains(this.billingTab)) {
					theTab.addChild(billingTab);
				}
			} else {
				if (theTab.contains(this.billingTab)) {
					theTab.removeChild(billingTab);
				}
			}
			if (this.protocolsBox.visible) {
				if (!this.headerBox.contains(this.protocolsBox)) {
					this.headerBox.addChild(this.protocolsBox);
				} 
			} else {
				if (this.headerBox.contains(this.protocolsBox)) {
					this.headerBox.removeChild(this.protocolsBox);
				} 
			}
			var requestCategory:Object = parentApplication.dictionaryManager.getEntry('hci.gnomex.model.RequestCategory',this.selectedExperiment.@codeRequestCategory);
			this.currentState = '';	
			if (this.selectedExperiment.@codeRequestCategory == "QC") {
				if(this.selectedExperiment.@isExternal != 'Y'){
					currentState = 'QCState';
				}
				else{
					currentState = 'ExternalQCState';
				}
				
			} else if (this.selectedExperiment.@isExternal != 'Y' &&
				       (this.selectedExperiment.@codeRequestCategory == 'SOLEXA' ||
			           this.selectedExperiment.@codeRequestCategory == 'HISEQ')) {
				currentState = 'SolexaState';
			} else if (requestCategory.@type == 'MICROARRAY') {
				if (this.selectedExperiment.@isExternal != 'Y') {
					currentState = 'MicroarrayState';
					
					
					showCy3LabelingFieldsCheckBox.selected = false;
					showCy5LabelingFieldsCheckBox.selected = false;
					showHybFieldsCheckBox.selected = false;
					showExtFieldsCheckBox.selected = false;
					
				} else {
					currentState = 'ExternalMicroarrayState';
				}

			} else if (requestCategory.@type == 'ILLUMINA' && this.selectedExperiment.@isExternal == 'Y') {
				currentState = 'ExternalSeqState';
				if(headerBox != null) {
					headerBox.visible = false;
				}
				
			} else if (requestCategory.@type == 'CAPSEQ') {
				currentState = 'CapSeqState';
				this.chromoTab.idRequest = this.selectedExperiment.@idRequest;
				this.chromoTab.getList();
				for each(var doff:Object in parentApplication.dictionaryManager.xml.Dictionary.(@className == 'hci.gnomex.model.SampleDropOffLocation').DictionaryEntry) {
					if (doff.@value == this.selectedExperiment.@idSampleDropOffLocation) {
						this.sampleDropOffLocationText.text = doff.@display;
					}
				}
			} else if (requestCategory.@type == 'MITSEQ') {
				currentState = 'MitSeqState';
			} else if (requestCategory.@type == 'FRAGANAL') {
				currentState = 'FragAnalState';
			} else if (requestCategory.@type == 'CHERRYPICK') {
				currentState = 'CherryPickState';
			}
			
			if (parentDocument != null && parentDocument is ExperimentDetailPanel) {
				if (this.selectedExperiment.analysisExperimentItems.hasOwnProperty("AnalysisExperimentItem")) {
					parentDocument.analysisButton.enabled = true;
				} else {
					parentDocument.analysisButton.enabled = false;
				} 
			}
			
			if(this.selectedExperiment.@isExternal == 'Y') {
				if(lanesConfirmContainer != null && theTab.contains(lanesConfirmContainer)) {
					//theTab.setChildIndex(lanesConfirmContainer, 2);
					//lanesConfirmContainer.enabled = false;
					/*
					var index:int = theTab.getChildIndex(lanesConfirmContainer);
					if (index > 0) {
						var tabButton:Button = theTab.getTabAt(index);
						if(tabButton != null) {
							lanesConfirmContainer.tabIndex = theTab.numChildren+1;
							//tabButton.visible = false;
						}						
					}
					*/

				}
			}

			getRequestCategoryName();
			getExperimentCategoryName();
			getSeqLibTreatments();
			getVisibilityName();
			callLater(showHideColumns);
			this.addNonStandardSampleColumns();
			
			if (theTab.selectedChild == this.filesView) {
				downloadExpandedFilesButtonView.visible = true;
				downloadExpandedFilesButtonView.includeInLayout = true;
			} else {
				downloadExpandedFilesButtonView.visible = false;
				downloadExpandedFilesButtonView.includeInLayout = false;
			}
			this.theTab.selectedIndex = 0;
		}
		
		public function initializeBarcoding():void {
			var showSampleMultiplexGroup:Boolean = false;
			var showSampleBarcode:Boolean = false;
			var showSampleCustomBarcode:Boolean = false;
			var showPlates:Boolean = false;
			for each (var s:Object in samples) {
				if (s.@multiplexGroupNumber != '') {
					showSampleMultiplexGroup = true;
				}
				if (isCapSeqState() && s.hasOwnProperty("@plateName") && s.@plateName != '') {
					showPlates = true;
				}
				if (s.@idOligoBarcode != '' ) {
					showSampleBarcode = true;
				}else if (s.@barcodeSequence != '' ) {
					showSampleCustomBarcode = true;
				}
			}
			
			if (showPlates) {
				
				this.samplesGridConfirm.dataProvider = null;
				sampleGroupingCollection = new GroupingCollection();
				sampleGroupingCollection.source = this.samples;
				var groupCapSeq:Grouping = new Grouping();
				var gfCapSeq:GroupingField = new GroupingField();
				gfCapSeq.name = "@plateName";
				groupCapSeq.fields = [gfCapSeq];
				gfCapSeq.compareFunction = sampleCompareFunction;
				sampleGroupingCollection.grouping  = groupCapSeq;
				sampleGroupingCollection.refresh(); 
				this.samplesGridConfirm.dataProvider = sampleGroupingCollection;
				
				this.samplesGridConfirm.dragMoveEnabled = false;
				this.samplesGridConfirm.dropEnabled = false;
				this.samplesGridConfirm.dragEnabled = false;
				
				
				this.switchFirstSampleGridColumns(this.plateNameCol, this.multiplexGroupNumberColumn);
				this.plateNameCol.visible = true;
				this.multiplexGroupNumberColumn.visible = false;

			} else if (showSampleMultiplexGroup) {

        		this.samplesGridConfirm.dataProvider = null;
        		sampleGroupingCollection = new GroupingCollection();
        		sampleGroupingCollection.source = this.samples;
        		var group:Grouping = new Grouping();
        		var gf:GroupingField = new GroupingField();
        		gf.name = "@multiplexGroupNumber";
				gf.compareFunction = sampleCompareFunction;
        		group.fields = [gf];
        		sampleGroupingCollection.grouping  = group;
        		sampleGroupingCollection.refresh();
        		this.samplesGridConfirm.dataProvider = sampleGroupingCollection;
       
				this.multiplexGroupNumberColumn.visible = true;
				switchFirstSampleGridColumns(this.multiplexGroupNumberColumn, this.plateNameCol);
				this.plateNameCol.visible = false;

        	} else {
        		sampleGroupingCollection = null;
        		this.samplesGridConfirm.dataProvider = this.samples;
        		
        		this.multiplexGroupNumberColumn.visible = false;

        	}
        		
        	this.barcodeCol.visible = showSampleBarcode;
        	this.customBarcodeCol.visible = showSampleCustomBarcode;
        	
        	if (currentState == "SolexaState") {
	        	this.laneBarcodeCol.visible = showSampleBarcode;
    	    	this.laneCustomBarcodeCol.visible = showSampleCustomBarcode;
        	}
        	
			this.samplesGridConfirm.validateNow();
		}
		
		private function switchFirstSampleGridColumns (col1:AdvancedDataGridColumn, col2:AdvancedDataGridColumn):void {
			var columns:Array = [];
			columns[0] = col1;
			columns[1] = col2;
			for(var i:int = 2;i < this.samplesGridConfirm.columns.length;i++) {
				columns[i] = this.samplesGridConfirm.columns[i];
			}
			this.samplesGridConfirm.columns = columns;
		}

		private function sampleCompareFunction(a:XML, b:XML):int
		{
			var aPersistFlag:Number = 0;
			var aPosition:Number = 0;
			if (a.@idSample.toString().indexOf("Sample") > -1) {
				aPosition = a.@idSample.toString().substr(6);
				aPersistFlag = 1;
			} else {
				aPosition = a.@idSample;
			}
			
			var bPersistFlag:Number = 0;
			var bPosition:Number = 0;
			if (b.@idSample.toString().indexOf("Sample") > -1) {
				bPosition = b.@idSample.toString().substr(6);
				bPersistFlag = 1; // non-persistent samples sort after the persistent ones
			} else {
				bPosition = b.@idSample;
			}
			
			if (aPersistFlag == bPersistFlag) {
				return ObjectUtil.numericCompare(aPosition, bPosition);				
			} else {
				return ObjectUtil.numericCompare(aPersistFlag, bPersistFlag);
			}
		}		

		
		private function showCy3LabelCols(isVisible:Boolean):void {
			labelCol1.visible = isVisible;
			labelCol2.visible = isVisible;
			labelCol3.visible = isVisible;
			labelCol4.visible = isVisible;
			labelCol5.visible = isVisible;
		}
			
		private function showCy5LabelCols(isVisible:Boolean):void {
			labelCol6.visible = isVisible;
			labelCol7.visible = isVisible;
			labelCol8.visible = isVisible;
			labelCol9.visible = isVisible;
			labelCol10.visible = isVisible;
		}

	    private function getChannel1SampleName(item:Object, col:int):String {
			var de:XMLList = item.labeledSampleChannel1.LabeledSample.sample.Sample;
	    	if (de.length() == 1) {
		    	return de[0].@name;
	    	} else {
	    		return "";
	    	}
		}
		private function getChannel2SampleName(item:Object, col:int):String {
			var de:XMLList = item.labeledSampleChannel2.LabeledSample.sample.Sample;
	    	if (de.length() == 1) {
		    	return de[0].@name;
	    	} else {
	    		return "";
	    	}
		}
		private function getChannel1SampleNumber(item:Object, col:int):String {
			var de:XMLList = item.labeledSampleChannel1.LabeledSample.sample.Sample;
	    	if (de.length() == 1) {
		    	return de[0].@number;
	    	} else {
	    		return "";
	    	}
		}
		private function getChannel2SampleNumber(item:Object, col:int):String {
			var de:XMLList = item.labeledSampleChannel2.LabeledSample.sample.Sample;
	    	if (de.length() == 1) {
		    	return de[0].@number;
	    	} else {
	    		return "";
	    	}
		}

   	 	private function getSamplesGridRowNumber(item:Object,col:int):String
	    {
    	   var x:int = samplesGridConfirm.dataProvider.getItemIndex(item) + 1;
	       return String(x);
	    } 
   	 	private function getHybsGridRowNumber(item:Object,col:int):String
	    {
    	   var x:int = hybsGridConfirm.dataProvider.getItemIndex(item) + 1;
	       return String(x);
	    } 

		private function getRequestCategoryName():void {
			var requestCategory:Object = parentApplication.dictionaryManager.getEntry('hci.gnomex.model.RequestCategory', this.selectedExperiment.@codeRequestCategory);
			if (requestCategory is XMLList) {
				requestCategoryName = requestCategory[0].@display.toString();				
			} else {
				requestCategoryName = requestCategory.@display.toString();		
			}
		}
		private function getExperimentCategoryName():void {
			var experimentCategory:Object = parentApplication.dictionaryManager.getEntry('hci.gnomex.model.Application', this.selectedExperiment.@codeApplication);
			if (experimentCategory is XMLList) {
				experimentCategoryName  = experimentCategory[0].@display.toString();
			} else {
				experimentCategoryName = experimentCategory.@display.toString();
			}
		}

		private function getSeqLibTreatments():void {
			seqLibTreatments = "";
			for each(var item:Object in this.selectedExperiment.seqLibTreatments.SeqLibTreatment) {
				if (seqLibTreatments.length > 0) {
					seqLibTreatments += ", ";
				}
				seqLibTreatments += item.@display;
			}
		}
		private function getVisibilityName():void {
			var visibility:Object = parentApplication.dictionaryManager.getEntry('hci.gnomex.model.Visibility', this.selectedExperiment.@codeVisibility);
			if (visibility is XMLList) {
				visibilityName = visibility[0].@display.toString();			
			} else {
				visibilityName = visibility.@display.toString();
			}
		}
		
		public function showDownloads():void {
			this.theTab.selectedChild = this.filesView;
			downloadExpandedFilesButtonView.visible = true;
			downloadExpandedFilesButtonView.includeInLayout = true;
		}

	  	public function promptToDeleteExperiment():void {
	  		var billingItems:XMLList = this.selectedExperiment.billingItems.BillingItem;
	  		if ( billingItems.length() > 0) {
				Alert.show("Delete experiment " + this.selectedExperiment.@number + 
				            "?\n\nWARNING:  This will also delete "  +
				            billingItems.length() + " billing item(s) associated with this experiment.\n\n", 
							"Confirm", 
							(Alert.YES | Alert.NO), this, 
							onPromptToDeleteExperiment);
	  			
	  		} else {
				Alert.show("Delete experiment " + this.selectedExperiment.@number + "?", 
							"Confirm", 
							(Alert.YES | Alert.NO), this, 
							onPromptToDeleteExperiment);
	  		}
			
	  	}
		
	  	private function onPromptToDeleteExperiment(event:CloseEvent):void {
            if (event.detail==Alert.YES) {
            	deleteExperiment();
            }
      	}
		private function deleteExperiment():void {
			parentDocument.parentDocument.deleteExperiment();
		}
		
		public function promptToSubmitExperiment():void {
			Alert.show("Submit experiment " + this.selectedExperiment.@number + "?  After submission only facility personnel will be able to make changes.", 
				"Confirm", 
				(Alert.YES | Alert.NO), this, 
				onPromptToSubmitExperiment);
		}
		
		private function onPromptToSubmitExperiment(event:CloseEvent):void {
			if (event.detail==Alert.YES) {
				submitExperiment();
			}
		}
		private function submitExperiment():void {
			parentDocument.parentDocument.submitExperiment();
		}
		
		public function showPrintableRequestForm():void {
			var url:URLRequest = new URLRequest('ShowRequestForm.gx?idRequest=' + this.selectedExperiment.@idRequest);
			navigateToURL(url, '_blank');			
		}
		
		public function showEditExperimentWindow():void {
			 // add this get request code b/c the edit window was freezing the second time 
			 // the edit window was pressed.  by putting this extra call in, it seems to clear
			 // out some weird state.
			 //var parms:Object = new Object();
			 //parms.idRequest = this.selectedExperiment.@idRequest;
			 //parentDocument.getRequest.send(parms);
           	 
           	 parentDocument.parentDocument.editView.request = this.selectedExperiment;
           	 parentDocument.parentDocument.editView.samplesView.showCCNumberCheckbox.selected = this.selectedExperiment.@hasCCNumber == 'Y' ? true : false;
			 
           	 
           	 parentDocument.parentDocument.theViews.selectedChild = parentDocument.parentDocument.editView;
			 if (parentDocument.parentDocument.editView.theTab.contains(parentDocument.parentDocument.editView.annotationView)) {
				 parentDocument.parentDocument.editView.annotationView.onPropertyRefreshed(null);
				 parentDocument.parentDocument.editView.annotationView.checkSecurity();
			 } 
			 
			 if (parentDocument.parentDocument.editView.samplesView.hasPlates()) {
				 parentDocument.parentDocument.editView.samplesView.fillPlates();
			 }
			 //parentDocument.editView.removeDataListeners();
           	 //parentDocument.editView.initializeData();
           	 //callLater(parentDocument.editView.setupDataListeners);
		}
		
		public function refreshSavedExperiment(idRequest:Object):void {
			 parentDocument.parentDocument.selectedIdRequest = idRequest;
			 var parms:Object = new Object();
			 parms.idRequest = parentDocument.parentDocument.selectedIdRequest;
			 parentDocument.parentDocument.getRequest.send(parms);
			
		}

		public function getLanesGridRowNumber(item:Object,col:int):String
        {
           var x:int = this.lanesConfirmGrid.dataProvider.getItemIndex(item) + 1;
           return String(x);     		
        }
	
        private function showHideColumns():void {
			descriptionCol.visible = (this.selectedExperiment[0].@hasSampleDescription=="Y");
			this.cherryDestinationWellCol.visible = false;
			this.cherrySourcePlateCol.visible = false;
			this.cherrySourceWellCol.visible = false;
			
			if (currentState == 'ExternalSeqState') {
				sampleTypeCol.visible = true;
				organismCol.visible = true;

				this.otherOrganismCol.visible = false;
				this.otherSamplePrepMethodCol.visible = false;
				concentrationCol.visible = false; 
				preppedByLabCol.visible = false;
				chipTypeCol.visible = false;
				concentrationUnitCol.visible = false;
				barcodeCol.visible = false;
				plateNameCol.visible = false;
				wellNameCol.visible = false;
				isControlCol.visible = false;
				this.qc260Col.visible = false;
				this.qcConcCol.visible = false;
				this.qcRINCol.visible = false;
				this.qcStatusCol.visible = true;
				
			} else if (currentState == 'ExternalMicroarrayState') {
				sampleTypeCol.visible = true;
				organismCol.visible = true;

				this.otherOrganismCol.visible = false;
				this.otherSamplePrepMethodCol.visible = false;
				concentrationCol.visible = false; 
				preppedByLabCol.visible = false;
				chipTypeCol.visible = false;
				concentrationUnitCol.visible = false;        		
				barcodeCol.visible = false;
				plateNameCol.visible = false;
				wellNameCol.visible = false;
				isControlCol.visible = false;
				this.qc260Col.visible = false;
				this.qcConcCol.visible = false;
				this.qcRINCol.visible = false;
				this.qcStatusCol.visible = true;

			} else {
  
				descriptionCol.visible = true;   

	        	if (currentState == 'SolexaState') {
					concentrationCol.visible = true; 
					sampleTypeCol.visible = true;
					organismCol.visible = true;
					preppedByLabCol.visible = true;
					otherSamplePrepMethodCol.visible = true;
					chipTypeCol.visible = false;
					concentrationUnitCol.visible = false;
					plateNameCol.visible = false;
					wellNameCol.visible = false;
					isControlCol.visible = false;
					this.qc260Col.visible = true;
					this.qcConcCol.visible = true;
					this.qcRINCol.visible = true;
					this.qcStatusCol.visible = true;
	        		
	        	} else if (currentState == 'QCState') {
					concentrationCol.visible = false; 
					sampleTypeCol.visible = false;
					organismCol.visible = false;
					preppedByLabCol.visible = false;
					otherSamplePrepMethodCol.visible = true;
					chipTypeCol.visible = (this.selectedExperiment.@codeApplication == 'BIOAN' ? true : false);
					concentrationUnitCol.visible = true;
					plateNameCol.visible = false;
					wellNameCol.visible = false;
					isControlCol.visible = false;
					this.qc260Col.visible = true;
					this.qcConcCol.visible = true;
					this.qcRINCol.visible = true;
					this.qcStatusCol.visible = true;
				} else if (isCapSeqState()) {
					concentrationCol.visible = false; 
					sampleTypeCol.visible = true;
					organismCol.visible = false;
					preppedByLabCol.visible = false;
					otherSamplePrepMethodCol.visible = false;
					chipTypeCol.visible = false
					concentrationUnitCol.visible = false;
					plateNameCol.visible = (this.selectedExperiment.@containerType == "PLATE" ? true : false);
					wellNameCol.visible = (this.selectedExperiment.@containerType == "PLATE" ? true : false);
					isControlCol.visible = (this.selectedExperiment.@containerType == "PLATE" ? true : false);
					this.qc260Col.visible = false;
					this.qcConcCol.visible = false;
					this.qcRINCol.visible = false;
					this.qcStatusCol.visible = false;
				} else if (isMitSeqState()) {
					concentrationCol.visible = false; 
					sampleTypeCol.visible = false;
					organismCol.visible = false;
					preppedByLabCol.visible = false;
					otherSamplePrepMethodCol.visible = false;
					chipTypeCol.visible = false
					concentrationUnitCol.visible = false;
					plateNameCol.visible = false;
					wellNameCol.visible = true;
					isControlCol.visible = false;
					this.qc260Col.visible = false;
					this.qcConcCol.visible = false;
					this.qcRINCol.visible = false;
					this.qcStatusCol.visible = false;
				} else if (isFragAnalState()) {
					concentrationCol.visible = false; 
					sampleTypeCol.visible = false;
					organismCol.visible = false;
					preppedByLabCol.visible = false;
					otherSamplePrepMethodCol.visible = false;
					chipTypeCol.visible = false
					concentrationUnitCol.visible = false;
					plateNameCol.visible = false;
					wellNameCol.visible = true;
					isControlCol.visible = false;
					this.qc260Col.visible = false;
					this.qcConcCol.visible = false;
					this.qcRINCol.visible = false;
					this.qcStatusCol.visible = false;
				} else if (isCherryPickState()) {
					concentrationCol.visible = false; 
					sampleTypeCol.visible = false;
					organismCol.visible = false;
					preppedByLabCol.visible = false;
					otherSamplePrepMethodCol.visible = false;
					chipTypeCol.visible = false
					concentrationUnitCol.visible = false;
					plateNameCol.visible = false;
					wellNameCol.visible = false;
					isControlCol.visible = false;
					this.qc260Col.visible = false;
					this.qcConcCol.visible = false;
					this.qcRINCol.visible = false;
					this.qcStatusCol.visible = false;
					this.cherryDestinationWellCol.visible = true;
					this.cherrySourcePlateCol.visible = true;
					this.cherrySourceWellCol.visible = true;
	        	} else {
					concentrationCol.visible = true; 
					sampleTypeCol.visible = true;
					organismCol.visible = true;
					preppedByLabCol.visible = false;
					otherSamplePrepMethodCol.visible = true;
					chipTypeCol.visible = false;
					concentrationUnitCol.visible = false;        		
					plateNameCol.visible = false;
					wellNameCol.visible = false;
					isControlCol.visible = false;
					this.qc260Col.visible = true;
					this.qcConcCol.visible = true;
					this.qcRINCol.visible = true;
					this.qcStatusCol.visible = true;
        		}
        	} 
        	this.initializeBarcoding();
			otherOrganismCol.visible = organismCol.visible;
        }
        
        public function showRelatedAnalysis():void {
        	parentApplication.showAnalysisForExperiment(this.selectedExperiment);
        }

		// Get all options (include inactive)
		public function getPropertyOptions(idProperty:String):XMLList {
			return parentApplication.getPropertyOptions(idProperty, true);
		}
        
		private function addAssayColumns():void {
			var columns:Array = samplesGridConfirm.columns;
			var newColumns:Array = new Array();
			
			// remove any existing assay columns
			var colRemoved:Boolean = false;
			for each(var remCol:AdvancedDataGridColumn in columns) {
				if (remCol.dataField == null || remCol.dataField.substr(0, 9) != "@hasAssay") {
					newColumns.push(remCol);
				} else {
					colRemoved = true;
				}
			}
			if (colRemoved) {
				samplesGridConfirm.columns = newColumns;
				samplesGridConfirm.validateNow();
			}
			
			if (isFragAnalState()) {
				columns = samplesGridConfirm.columns;
				newColumns = new Array();
				for each(var addCol:AdvancedDataGridColumn in columns) {
					if (addCol.dataField == "@description") {
						for each (var assay:Object in assays) {
							var newCol:AdvancedDataGridColumn = new AdvancedDataGridColumn();
							newCol.dataField  = "@hasAssay" + assay.@name;
							newCol.headerText = assay.@name;
							newCol.visible    = true;
							newCol.width	  = 40;
							newColumns.push(newCol);
						}
					}
					newColumns.push(addCol);
				}
				samplesGridConfirm.columns = newColumns;
				samplesGridConfirm.validateNow();
			}
		}
		
        public function addNonStandardSampleColumns():void {
       		var annotation:Object;
       		var col:AdvancedDataGridColumn;
       		var exists:Boolean = false;

			addAssayColumns();
			
			// Make all annotation columns not visible
			for each(col in samplesGridConfirm.columns) {
				if (col.dataField != null && col.dataField.substr(0, 6) == "@ANNOT") {
					col.visible    = false;       				
				}    				
			}

			if (!isCapSeqState() && !isMitSeqState() && !isFragAnalState() && !isCherryPickState()) {
	       		for each(annotation in this.selectedExperiment.PropertyEntries.PropertyEntry) {
					if(annotation.@idProperty == "-1") {
						continue;
					}
					
					var property:XML = parentApplication.getSampleProperty(annotation.@idProperty);
					var headerName:String = "";
					if (property.@name == "Other" && annotation.@otherLabel != "" ) {
						headerName = annotation.@otherLabel;
						annotation.@isSelected = "true";
					} else {
						headerName = annotation.@name;
					}
	
					exists = false;
					
	       			for each(col in samplesGridConfirm.columns) {
						if (col.dataField == ("@ANNOT" + annotation.@idProperty)) {
							exists = true;
							col.visible    = annotation.@isSelected == "true" ? true : false;       				
							col.headerText = headerName;
							break;
						}    				
	       			}
					
					// We already have this column.  Just set the header and visible and move on.
					if (exists) {
						continue;
					}
	   				var newCol:AdvancedDataGridColumn = new AdvancedDataGridColumn();
	   				newCol.dataField  = "@ANNOT" + annotation.@idProperty;
	   				newCol.headerText = headerName;
	   				newCol.visible    = (annotation.@isSelected == "true" ? true : false);
					
					if (property.@codePropertyType == 'MOPTION') {
						newCol.itemRenderer =  MultiselectRenderer.create(false);
					} else if (property.@codePropertyType == 'URL') {
						newCol.itemRenderer = URLRenderer.create(false);
					} else if (property.@codePropertyType == 'CHECK') {
						// checkbox is just normal label renderer
					} else if (property.@codePropertyType == 'OPTION') {
						             
						newCol.itemRenderer = views.renderers.DropdownLabel.create(
							parentApplication.getPropertyOptions(annotation.@idProperty), 
							'@option', 
							'@idPropertyOption', 
							"@ANNOT" + annotation.@idProperty,
							false);                
					} 
					
	
					// Place the new column right after the description column
					var columns:Array = samplesGridConfirm.columns;
					var newColumns:Array = new Array();
					for each(var column:AdvancedDataGridColumn in columns) {
						if (column.dataField == "@description") {
							newColumns.push(newCol);
						}
						newColumns.push(column);
					}
					samplesGridConfirm.columns = newColumns;
	
					samplesGridConfirm.validateNow();
	   			} 
			}   		
        }

        private function showProtocol(idProtocol:Object, protocolClassName:String):void {
        	var params:Object = new Object();
        	params.id = idProtocol;
        	params.protocolClassName = protocolClassName;
        	getProtocol.send(params);
        }
        
    	private function onGetProtocol(event:ResultEvent): void { 
			if (getProtocol.lastResult.name() != "Protocol") {
        		mx.controls.Alert.show(getProtocol.lastResult..ACTMESSAGE.@TEXT);
      	  		return;
   			}
   			var protocolWindow:ProtocolWindow = ProtocolWindow(PopUpManager.createPopUp(DisplayObject(this.parentDocument), ProtocolWindow, false));
   			PopUpManager.centerPopUp(protocolWindow);
   			protocolWindow.title = getProtocol.lastResult.name;
   			protocolWindow.protocolDescription.text = getProtocol.lastResult.description;
    	}
    	
    	public function showConvertIlluminaRequest():void {
   			var convertWindow:ConvertIlluminaRequestWindow = ConvertIlluminaRequestWindow(PopUpManager.createPopUp(DisplayObject(this), ConvertIlluminaRequestWindow, false));
   			PopUpManager.centerPopUp(convertWindow);
   			convertWindow.init(this.selectedExperiment);
    	}  
    	
		public function getSampleTreeIcon(item:Object):Class {
			if (item == null) {
				return parentApplication.iconGroup;
			} else {
				return null; 
			}  
		}   
		public function getLaneTreeIcon(item:Object):Class {
			return null; 
		} 
		
		public function refreshDownloadList():void {
			if (theTab.selectedChild == filesView) {
				var params:Object = new Object();
				params.idRequest = this.selectedExperiment.@idRequest;
				filesView.getRequestDownloadList.send(params);
				theTab.selectedChild = filesView;
			}
		}
		
		public function filterList():void{		}

		protected function tabChangeHandler(event:IndexChangedEvent):void
		{
			refreshDownloadList();
		}
		
		[Bindable]
		private var selectedFileList:XMLListCollection;
		
		public function downloadFilesUsingFDT():void {
			var selectedFiles:XMLList = filesView.getRequestDownloadList.lastResult..FileDescriptor.(@isSelected == "true");
			selectedFileList = new XMLListCollection(selectedFiles);					
			
			if (selectedFileList.length == 0) {
				mx.controls.Alert.show("Please select the files to download.");
			} else {
				cacheFDTFileDownloadList.send();
			}
		}
		
		public function alignSelectedFiles():void {
			var selectedFiles:XMLList = filesView.getRequestDownloadList.lastResult..FileDescriptor.(@isSelected == "true");
			selectedFileList = new XMLListCollection(selectedFiles);
			
			var folderPath:String = "";
			var filesStr:String = "";
			
			for each(var file:XML in selectedFileList) {
				var fileName:String = file.@fileName;
				var number:String = file.@number;
				
				if(number == null || number.length == 0) {
					Alert.show("Error: Number parameter undefined in selectedFileList entry.");					
					return;						
				}
				
				var splitIndx:int = fileName.indexOf(number) + number.length;					
				if(splitIndx < 0) {
					Alert.show("Cannot proceed because file '" + file.@displayName + "' is not physically present.");					
					return;
				}
				var currentFolderPath:String = fileName.substr(0, splitIndx);
				fileName = fileName.substr(splitIndx, 0x7fffffff);
				if(folderPath.length == 0) {
					folderPath = currentFolderPath;
					filesStr = fileName;
				} else {
					filesStr = filesStr + "," + fileName;
				}			
			}

			
			if (selectedFileList.length == 0) {
				mx.controls.Alert.show("Please select the file(s).");
			} else {
				var alignFilesWindow:RunAlignmentWindow = RunAlignmentWindow(PopUpManager.createPopUp(this, RunAlignmentWindow, true));
				if(selectedExperiment != null && selectedExperiment.samples != null) {
					alignFilesWindow.setOrganismDropdown(selectedExperiment.samples.Sample[0].@idOrganism);
				}
				alignFilesWindow.setFolderPathAndFilesStr(folderPath, filesStr);
				PopUpManager.centerPopUp(alignFilesWindow);
			}
		}
		
		private function onCacheFDTFileDownloadList(event:ResultEvent):void {
			// We have cached the selected analysis files
			// Now call the URL to start the FDT app using webstart
			showFastDataTransferDownloadPage();
		}
		
		public function showFastDataTransferDownloadPage():void {
			var paramStr:String =  selectedFileList.toXMLString();			
			var url:URLRequest = new URLRequest('FastDataTransferDownloadExpServlet.gx');	
			url.contentType = "text/xml";
			url.method = URLRequestMethod.GET;
			navigateToURL(url, '_self');						
		}
		
		public function showAlternateDownloadPage():void {
			if (parentDocument.parentDocument.selectedIdRequest != null) {
				var url:URLRequest = new URLRequest('ShowRequestDownloadForm' + 
					(parentDocument.parentApplication.isGuestMode() ? 'ForGuest' : '') +   
					'.gx?idRequest=' + 
					parentDocument.parentDocument.selectedIdRequest);
				navigateToURL(url, '_blank');					 
			} else if (theTab.selectedChild == filesView ) {
				var requestNumbers:String = "";
				for each(var dl:Object in filesView.downloadList) {
					if (requestNumbers.length > 0) {
						requestNumbers += ":"
					}
					requestNumbers += dl.@requestNumber;
				}
				if (requestNumbers.length > 0) {
					var url1:URLRequest = new URLRequest('ShowRequestDownloadForm' + 
						(parentDocument.parentApplication.isGuestMode() ? 'ForGuest' : '') +   
						'.gx?requestNumbers=' + 
						requestNumbers);
					navigateToURL(url1, '_blank');	
				}
			}
		}
		
		public function isControlLabelFunction(item:Object, column:AdvancedDataGridColumn):String
		{
			if (item is XML) {
				if (item.@isControl == "N") {
					return "";
				} else {
					return item.@isControl;
				}
			} else {
				return "";
			}
		}
		
		public function plateNameLabelFunction(item:Object, column:AdvancedDataGridColumn):String
		{
			if (item is XML) {
				return "";
			} else {
				return item.groupLabel;
			}
		}

	]]>
</mx:Script>

<mx:XMLListCollection id="billingItems" source="{selectedExperiment.billingItems.BillingLab}"/>
<mx:XMLListCollection id="samples" source="{selectedExperiment.samples.Sample}"/>
<mx:XMLListCollection id="assays" source="{selectedExperiment.assays.assay}"/>
<mx:XMLListCollection id="primers" source="{selectedExperiment.primers.Primer}"/>
<mx:XMLListCollection id="multiplexLanes" source="{this.selectedExperiment.multiplexSequenceLanes.MultiplexLane}"/>

        
			<mx:TabNavigator width="100%" height="100%" verticalGap="5" id="theTab" paddingBottom="4" paddingRight="4" paddingLeft="4" paddingTop="2" change="tabChangeHandler(event)">
					<mx:VBox verticalGap="6" label="Info" width="100%" height="100%" paddingBottom="4" paddingLeft="4" paddingRight="4" paddingTop="4">
						<mx:HBox verticalGap="0" horizontalGap="0">
							<mx:Label text="Experiment"  width="100" />
							<mx:TextInput editable="false" text="{requestCategoryName}" width="400"  backgroundColor="#FFFFFF"/>
						</mx:HBox>
						<mx:HBox verticalGap="0" horizontalGap="0">
							<mx:Label width="100" />
							<mx:TextInput editable="false" backgroundColor="#FFFFFF" text="{experimentCategoryName}" width="400" />
						</mx:HBox>
						<mx:HBox verticalGap="0" width="100%" horizontalGap="0">
							<mx:Label text="Lab group"  width="100" />
							<mx:TextInput editable="false" backgroundColor="#FFFFFF" text="{this.selectedExperiment.@labName}" width="400"/>
						</mx:HBox>
						<mx:HBox verticalGap="0" horizontalGap="0">
							<mx:Label text="{this.selectedExperiment.@isExternal == 'Y' ? 'Registered by' : 'Submitted by'}" width="100" />
							<mx:TextInput editable="false" backgroundColor="#FFFFFF" text="{this.selectedExperiment.@ownerName}" width="400" />
						</mx:HBox>
						<mx:HBox verticalGap="0" horizontalGap="0">
							<mx:Label text="{this.selectedExperiment.@isExternal == 'Y' ? 'Registered on' : 'Submitted on'}"  width="100" />
							<mx:TextInput editable="false" backgroundColor="#FFFFFF" text="{this.selectedExperiment.@createDate}" width="400"/>
						</mx:HBox>
						<mx:HBox verticalGap="0" horizontalGap="0" id="hbox2">
							<mx:Label width="100" text="Completed" />
							<mx:TextInput editable="false" backgroundColor="#FFFFFF"  text="{this.selectedExperiment.@completedDate}" width="400" />
						</mx:HBox>
						<mx:HBox verticalGap="0" width="100%" horizontalGap="0" id="visibilityBox">
							<mx:Text  width="100" text="Visibility" />
							<mx:TextInput editable="false" backgroundColor="#FFFFFF" text="{visibilityName}" width="400" />
						</mx:HBox>
						<mx:HBox width="100%" id="libDesignAndInsertBox" visible="false" includeInLayout="{selectedExperiment.@captureLibDesignId != '' || selectedExperiment.@avgInsertSizeFrom != ''}">					
							<mx:HBox verticalGap="0" width="100%" horizontalGap="0">
								<mx:Text id="designAndInsertLabel" width="100" />
								<mx:TextInput editable="false" backgroundColor="#FFFFFF" id="designAndInsertText" width="400" />
							</mx:HBox>
						</mx:HBox>

						<mx:VBox id="headerBox" width="100%">
							<mx:HBox width="100%" id="protocolsBox"   visible="{this.selectedExperiment.protocols.Protocol.length() > 0}" horizontalGap="0" horizontalAlign="left" verticalAlign="top">
								<mx:Label text="Materials &amp; Methods"  id="label1"/>
								<mx:Tile horizontalGap="0" width="100%" direction="horizontal" id="tile1" paddingLeft="0" paddingRight="0" paddingTop="0" paddingBottom="0" verticalGap="0" fontSize="9">
									<mx:Repeater id="protocolRepeater" dataProvider="{this.selectedExperiment.protocols.Protocol}"> 
										<mx:LinkButton id="labelProtocol" label="{protocolRepeater.currentItem.@label}" styleName="formLinkProtocolButton" 
													   paddingLeft="1" paddingRight="1"
													   click="{showProtocol(event.currentTarget.getRepeaterItem().@idProtocol, event.currentTarget.getRepeaterItem().@protocolClassName)}" paddingTop="0" paddingBottom="0"/>
									</mx:Repeater>
								</mx:Tile>
								
							</mx:HBox>
						</mx:VBox>            
					</mx:VBox>
				
					<mx:VBox id="notesTab" label="Description" paddingLeft="4" paddingRight="4" paddingTop="4" paddingBottom="4" verticalGap="0">
						<mx:HBox>
							<mx:Label text="Experiment Name"/>
							<mx:TextInput text="{this.selectedExperiment.@name}" editable="false" backgroundColor="0xffffff"/>
							<mx:Spacer width="5"/>
							</mx:HBox>
						<mx:Spacer height="4"/>
						<mx:Label text="Description"/>
						<mx:RichTextEditor  borderStyle="none"  headerHeight="0"  
											id="overallDescript" width="100%" 
											htmlText="{this.selectedExperiment.@description}" 
											showControlBar="false" 
											paddingLeft="0" paddingRight="0" paddingTop="0" 
											roundedBottomCorners="false" paddingBottom="0" 
											borderThicknessRight="0" borderThicknessLeft="0" 
											borderThicknessBottom="0" borderThickness="0" 
											borderThicknessTop="0" height="100%" minHeight="50"/>
						<mx:Spacer height="4" />
						<mx:HBox width="100%" height="100%" >
		  					<mx:VBox verticalGap="0" width="100%" height="100%">
	  							<mx:Label text="Notes for Core Facility" />
								<util:TextAreaWorkaround id="noteToSeq" backgroundColor="0xffffff" editable="false" text="{this.selectedExperiment.@corePrepInstructions}" width ="100%" height="100%"  />
							</mx:VBox>
							<mx:VBox verticalGap="0" width="100%" height="100%"  id='noteToBioBox'
									 visible="true"  
									 includeInLayout="true">
								<mx:Label text="Notes for Bioinformatics Group"  />
								<util:TextAreaWorkaround id="noteToBio" backgroundColor="0xffffff" editable="false" text="{this.selectedExperiment.@analysisInstructions}" width ="100%" height="100%" />
							</mx:VBox>
						</mx:HBox>
					</mx:VBox>
				<mx:VBox verticalGap="0" width="100%" height="100%" id="samplesTab" label="Samples">
					<mx:HBox width="100%" horizontalGap="2" paddingTop="4" id="hbox1">
							
					</mx:HBox>
					<mx:AdvancedDataGrid width="100%" id="samplesGridConfirm"  
						editable="false" 
						backgroundAlpha="0" borderStyle="solid"
						sortableColumns="false"
						variableRowHeight="true"
						sortExpertMode="true"
						defaultLeafIcon="{null}" 	
						iconFunction="getSampleTreeIcon"					 
						displayItemsExpanded="true"
						horizontalScrollPolicy="auto" height="100%">
						<mx:columns>
			                <mx:AdvancedDataGridColumn id="multiplexGroupNumberColumn" headerText="Multiplex #" dataField="@multiplexGroupNumberDisplay" editable="false" visible="true"
								width="60">
								<mx:headerRenderer>
									<mx:Component>
										<mx:VBox horizontalScrollPolicy="off" verticalGap="0">
											<mx:Label text="Index Tag"/>
											<mx:Label text="Group"/>
										</mx:VBox> 
									</mx:Component> 
								</mx:headerRenderer> 
						    </mx:AdvancedDataGridColumn>
							<mx:AdvancedDataGridColumn id="plateNameCol" headerText="Plate" dataField="@plateName" editable="false" visible="true" width="60" labelFunction="plateNameLabelFunction" />
							<mx:AdvancedDataGridColumn headerText="ID" width="60" dataField="@number"/>
							<mx:AdvancedDataGridColumn  headerText="Source Plate" width="150" dataField="@cherrySourcePlate" editable="false" id="cherrySourcePlateCol"/>
							<mx:AdvancedDataGridColumn  headerText="Source Well"  width="75" dataField="@cherrySourceWell" editable="false" id="cherrySourceWellCol"/>
							<mx:AdvancedDataGridColumn  headerText="Dest. Well" width="75" dataField="@cherryDestinationWell" editable="false" id="cherryDestinationWellCol"/>
							<mx:AdvancedDataGridColumn id="wellNameCol" visible="false" editable="false" headerText="Well"  width="40" resizable="false" dataField="@wellName"/>
							<mx:AdvancedDataGridColumn id="isControlCol" visible="false" editable="false" headerText="Ctrl?"  width="40" resizable="false" dataField="@isControl"
													    labelFunction="isControlLabelFunction"/>
							<mx:AdvancedDataGridColumn headerText="Sample Name" width="100" dataField="@name"/>
							<mx:AdvancedDataGridColumn id="concentrationCol" headerText="Conc." width="65" visible="true"  dataField="@concentration"/>
			                <mx:AdvancedDataGridColumn id="concentrationUnitCol" visible="{true}"  headerText="Unit"  width="60" 
	              				itemRenderer="{DropdownLabel.getFactory(parentApplication.dictionaryManager.xml.Dictionary.(@className=='hci.gnomex.model.ConcentrationUnit').DictionaryEntry, '@display', '@value', '@codeConcentrationUnit')}"/>
							
							<mx:AdvancedDataGridColumn id="descriptionCol" headerText="Description" wordWrap="true" width="100" dataField="@description"/>
							
							<mx:AdvancedDataGridColumn id="ccNumberCol" visible="{this.selectedExperiment.@hasCCNumber == 'Y' ? true : false}" headerText="CC Number" width="100" dataField="@ccNumber"/>
			                <mx:AdvancedDataGridColumn id="barcodeCol" headerText="Index Tag"  width="75" visible="{true}"  
	              				itemRenderer="{DropdownLabel.getFactory(parentApplication.dictionaryManager.xml.Dictionary.(@className=='hci.gnomex.model.OligoBarcode').DictionaryEntry, '@display', '@value', '@idOligoBarcode')}">
			                   <mx:headerRenderer>
			                   	  <mx:Component>
			                   	    <mx:VBox verticalGap="0" horizontalScrollPolicy="off">
			                   	    	<mx:Label text="Index"/>
			                   	    	<mx:Label text="Tag"/>
			                   	    </mx:VBox>
			                   	  </mx:Component>
			                   </mx:headerRenderer>
			                </mx:AdvancedDataGridColumn>
			                <mx:AdvancedDataGridColumn id="customBarcodeCol" headerText="Index Tag" width="65" visible="true"  dataField="@barcodeSequence">
			                   <mx:headerRenderer>
			                   	  <mx:Component>
			                   	    <mx:VBox verticalGap="0" horizontalScrollPolicy="off">
			                   	    	<mx:Label text="Custom"/>
			                   	    	<mx:Label text="Index Tag"/>
			                   	    </mx:VBox>
			                   	  </mx:Component>
			                   </mx:headerRenderer> 
			                </mx:AdvancedDataGridColumn>
			                <mx:AdvancedDataGridColumn id="sampleTypeCol" headerText="Sample Type"  width="100" visible="{true}"  
	              				itemRenderer="{DropdownLabel.getFactory(parentApplication.dictionaryManager.xml.Dictionary.(@className=='hci.gnomex.model.SampleType').DictionaryEntry, '@display', '@value', '@idSampleType')}"/>
				            <mx:AdvancedDataGridColumn id="organismCol" headerText="Organism" visible="{true}"  width="80" 
	              				itemRenderer="{DropdownLabel.getFactory(parentApplication.dictionaryManager.xml.Dictionary.(@className=='hci.gnomex.model.OrganismLite').DictionaryEntry, '@display', '@value', '@idOrganism')}"/>
							<mx:AdvancedDataGridColumn id="otherOrganismCol" headerText="Organism (other)" width="100" dataField="@otherOrganism"/>
				            <mx:AdvancedDataGridColumn id="preppedByLabCol" headerText="Core to prep lib?"   visible="{true}" width="104"  dataField="@seqPrepByCore"/>
							<mx:AdvancedDataGridColumn id="otherSamplePrepMethodCol" headerText="Nucl. acid extraction meth." width="100" dataField="@otherSamplePrepMethod"/>
			                <mx:AdvancedDataGridColumn id="chipTypeCol" visible="{true}" headerText="Chip Type"  width="120" 
	              				itemRenderer="{DropdownLabel.getFactory(parentApplication.dictionaryManager.xml.Dictionary.(@className=='hci.gnomex.model.BioanalyzerChipType').DictionaryEntry, '@display', '@value', '@codeBioanalyzerChipType')}"/>
							
	
							<mx:AdvancedDataGridColumn id="qcConcCol" visible="false" headerText="QC Conc. ng/uL" width="80" dataField="@qualCalcConcentration"/>
							<mx:AdvancedDataGridColumn id="qc260Col" visible="false" headerText="QC 260/230" width="80" dataField="@qual260nmTo230nmRatio"/>
							<mx:AdvancedDataGridColumn id="qcRINCol" visible="false" headerText="QC RIN" width="70" dataField="@qualRINNumber"/>
			                <mx:AdvancedDataGridColumn  visible="{currentState == 'SolexaState'}" headerText="QC Bioanalyzer method"  width="120" 
	              				itemRenderer="{DropdownLabel.getFactory(parentApplication.dictionaryManager.xml.Dictionary.(@className=='hci.gnomex.model.BioanalyzerChipType').DictionaryEntry, '@display', '@value', '@codeBioanalyzerChipType')}"/>
				 			<mx:AdvancedDataGridColumn visible="{currentState == 'SolexaState'}" headerText="QC Frag Size (from)" width="90" dataField="@qualFragmentSizeFrom"/>
							<mx:AdvancedDataGridColumn visible="{currentState == 'SolexaState'}" headerText="QC Frag Size (to)" width="90" dataField="@qualFragmentSizeTo"/>
							<mx:AdvancedDataGridColumn id='qcStatusCol' visible="true" headerText="QC Status" width="90" dataField="@qualStatus"/>
	
			                <mx:AdvancedDataGridColumn  visible="{currentState == 'SolexaState'}" headerText="Seq Lib Protocol"  width="120" 
	              				itemRenderer="{DropdownLabel.getFactory(parentApplication.dictionaryManager.xml.Dictionary.(@className=='hci.gnomex.model.SeqLibProtocol').DictionaryEntry, '@display', '@value', '@idSeqLibProtocol')}"/>
			                <mx:AdvancedDataGridColumn  visible="{currentState == 'SolexaState'}" headerText="Seq Lib QC Bioanalyzer method"  width="120" 
	              				itemRenderer="{DropdownLabel.getFactory(parentApplication.dictionaryManager.xml.Dictionary.(@className=='hci.gnomex.model.BioanalyzerChipType').DictionaryEntry, '@display', '@value', '@seqPrepQualCodeBioanalyzerChipType')}"/>
							<mx:AdvancedDataGridColumn visible="{currentState == 'SolexaState'}" headerText="Seq Lib Conc. ng/uL" width="90" dataField="@seqPrepLibConcentration"/>
							<mx:AdvancedDataGridColumn visible="{currentState == 'SolexaState'}" headerText="Seq Lib Prep Status" width="90" dataField="@seqPrepStatus"/>
	
							
	
						</mx:columns>
					</mx:AdvancedDataGrid>
				</mx:VBox>
				
    			<mx:Canvas label="Billing" id="billingTab" width="100%" height="100%">
    			 <mx:VBox width="100%" height="100%" verticalGap="4"  paddingBottom="0" paddingTop="0" paddingRight="0" paddingLeft="0" id="billingContainer" >
					<mx:AdvancedDataGrid height="100%" width="100%" id="billingADConfirmGrid"  
					displayItemsExpanded="true"  
        			editable="false" 
        			sortExpertMode="true" horizontalScrollPolicy="auto"
        			sortableColumns="false"
					backgroundAlpha="0" borderStyle="solid" showHeaders="true" 
					fontSize="9" iconFunction="parentApplication.getTreeIcon">
						<mx:dataProvider>   
      						<mx:HierarchicalData source="{billingItems}"/> 
    					</mx:dataProvider> 
        				<mx:columns> 
	        				<mx:AdvancedDataGridColumn headerText="Group" dataField="@labName" editable="false" width="70" wordWrap="false"/>
	        				<mx:AdvancedDataGridColumn headerText="Acct" dataField="@accountName" editable="false" width="100" wordWrap="false" />
	        				<mx:AdvancedDataGridColumn headerText="Period" dataField="@idBillingPeriod" editable="false" width="70"  wordWrap="false"
							  itemRenderer="{views.renderers.DropdownLabelBillingItem.create(parentApplication.dictionaryManager.xml.Dictionary.(@className=='hci.gnomex.model.BillingPeriod').DictionaryEntry,'@display', '@value', '@idBillingPeriod')}"/>
	        				<mx:AdvancedDataGridColumn  headerText="Price Category" wordWrap="true" dataField="@category" editable="false" width="200">
				              <mx:itemRenderer>
				                  <mx:Component>
				                  <mx:Text text="{data.@category}" styleName="{data.@other == 'Y' ?'other':'normal'}" />
				                  </mx:Component>
				              </mx:itemRenderer>
	        				</mx:AdvancedDataGridColumn>
	        				<mx:AdvancedDataGridColumn headerText="Description" wordWrap="true" dataField="@description" editable="false" width="200">
				              <mx:itemRenderer>
				                  <mx:Component>
				                  <mx:Text text="{data.@description}" styleName="{data.@other == 'Y' ?'other':'normal'}" />
				                  </mx:Component>
				              </mx:itemRenderer>
	        				</mx:AdvancedDataGridColumn>
	        				<mx:AdvancedDataGridColumn headerText="Notes"  dataField="@notes" editable="false" width="100" wordWrap="true">
	        				  <mx:itemRenderer>
				                  <mx:Component>
				                  <mx:Text text="{data.@notes}" styleName="{data.@other == 'Y' ?'other':'normal'}" />
				                  </mx:Component>
				              </mx:itemRenderer>
							</mx:AdvancedDataGridColumn>
	        				<mx:AdvancedDataGridColumn headerText="Qty" dataField="@qty" editable="false" textAlign="right" width="50" >
	        				  <mx:itemRenderer>
				                  <mx:Component>
				                  <mx:Text  textAlign="right" text="{data.@qty}" styleName="{data.@other == 'Y' ?'other':'normal'}" />
				                  </mx:Component>
				              </mx:itemRenderer>
							</mx:AdvancedDataGridColumn>
	        				<mx:AdvancedDataGridColumn headerText="Unit price" dataField="@unitPrice"  textAlign="right" editable="false" width="65" > 
	        				  <mx:itemRenderer>
				                  <mx:Component>
				                  <mx:Text  textAlign="right" text="{data.@unitPrice}" styleName="{data.@other == 'Y' ?'other':'normal'}" />
				                  </mx:Component>
				              </mx:itemRenderer>
							</mx:AdvancedDataGridColumn>
	        				<mx:AdvancedDataGridColumn headerText="%" dataField="@percentageDisplay" editable="false" textAlign="right" width="50" wordWrap="false"
	        				  rendererIsEditor="false"
							  itemRenderer="views.renderers.LabelPercentage" />                             
	        				<mx:AdvancedDataGridColumn headerText="Total price" dataField="@invoicePriceDisplay" textAlign="right" width="105" editable="false" >
	        				  <mx:itemRenderer>
				                  <mx:Component>
				                  <mx:Text text="{data.@invoicePrice}"  textAlign="right" styleName="{data.@other == 'Y' ?'other':'normal'}" />
				                  </mx:Component>
				              </mx:itemRenderer>
							</mx:AdvancedDataGridColumn>
	        				<mx:AdvancedDataGridColumn headerText="Status" dataField="@codeBillingStatus" editable="false" width="70" wordWrap="false"
							  itemRenderer="{views.renderers.DropdownLabelBillingItem.create(parentApplication.dictionaryManager.xml.Dictionary.(@className=='hci.gnomex.model.BillingStatus').DictionaryEntry,'@display', '@value', '@codeBillingStatus')}"/>                 
	        			</mx:columns>
	        		</mx:AdvancedDataGrid>
				</mx:VBox>
    			</mx:Canvas>
				
				<experiment:ExperimentDownloadView id="filesView" uploadButtonsVisible="{this.selectedExperiment.@canUploadData == 'Y'}" >
				</experiment:ExperimentDownloadView>
						   
			</mx:TabNavigator>
			
		
	<mx:ControlBar width="100%" >
		<mx:HBox  verticalAlign="middle" 
				  visible="{theTab.selectedChild==filesView}" 
				  includeInLayout="{theTab.selectedChild==filesView}" 
				  width="100%" horizontalAlign="left" 
				  id="downloadExpandedFilesButtonView"  >
			<mx:HBox  verticalAlign="middle" 
					  width="100%" horizontalAlign="left" 
					  id="hideButtonsBox">
				<mx:Button id="downloadExpandedFilesButton" 
						   click="filesView.downloadExpandedFiles()" 
						   icon="@Embed('../../assets/download.png')" 
						   toolTip="Download selected files"
						   label="Download"/>
				<mx:Button id="fdt_downloadButton" visible="{parentApplication.isFDTSupported ? true : false}" 
						   includeInLayout="{parentApplication.isFDTSupported ? true : false}" 
						   label="FDT Download"  click="{this.downloadFilesUsingFDT()}" 
						   icon="@Embed(source='../../assets/download_large.png')"/>
				<mx:Button id="http_downloadButton" visible="{parentApplication.isFDTSupported ? false : true}" 
						   includeInLayout="{parentApplication.isFDTSupported ? false : true}" 
						   label="HTTP Download" click="{this.showAlternateDownloadPage()}" 
						   icon="@Embed(source='../../assets/download_large.png')"/>
				<mx:Button id="alignSelectedFilesButton" 
						   click="this.alignSelectedFiles()" 
						   icon="@Embed('../../assets/align.png')" 
						   toolTip="Run automated alignment on selected files" 
						   visible="{parentApplication.isSequenceAlignmentSupported &amp;&amp; theTab.selectedChild==filesView  &amp;&amp; parentApplication.isAdminState}"
						   label="Run Alignment"/>
			</mx:HBox>
		</mx:HBox>		
	</mx:ControlBar>
	

<mx:states>
	<mx:State name="MicroarrayState">		 
		<mx:AddChild relativeTo="{this.samplesTab}" position="after" >
			<mx:VBox width="100%" height="100%" verticalGap="0" id="hybsConfirmContainer" label="Hybs">
				<mx:HBox width="100%" horizontalGap="2" paddingTop="4">
					<mx:HBox width="100%"  horizontalAlign="right" paddingRight="4">
						<mx:CheckBox id="showCy3LabelingFieldsCheckBox" label="Show Cy3 Labeling columns" click="showCy3LabelCols(showCy3LabelingFieldsCheckBox.selected)"/>
						<mx:CheckBox id="showCy5LabelingFieldsCheckBox" label="Cy5 Labeling" click="showCy5LabelCols(showCy5LabelingFieldsCheckBox.selected)"/>
						<mx:CheckBox id="showHybFieldsCheckBox" label="Hyb"/>
						<mx:CheckBox id="showExtFieldsCheckBox" label="Scan/FE"/>
					</mx:HBox>
				</mx:HBox>
				<mx:DataGrid width="100%" height="100%" id="hybsGridConfirm"  horizontalScrollPolicy="auto" editable="false" dataProvider="{this.selectedExperiment.hybridizations.Hybridization}"  backgroundAlpha="0" borderStyle="solid">
					<mx:columns>
						<mx:DataGridColumn headerText="ID" width="60" dataField="@number"/>
					    <mx:DataGridColumn editable="false" headerText="Cy3 Sample (green)"  width="122" labelFunction="getChannel1SampleName"/>
					    <mx:DataGridColumn editable="false" headerText="ID"  width="60" labelFunction="getChannel1SampleNumber"/>
					    <mx:DataGridColumn id="channel2SampleConfirmColumn" editable="false" headerText="Cy5 Sample (red)"  width="122" labelFunction="getChannel2SampleName"/>
					    <mx:DataGridColumn editable="false" headerText="ID"  width="60" labelFunction="getChannel2SampleNumber"/>
						
						<mx:DataGridColumn id="labelCol1"  visible="false"  headerText="Channel1 Labeling protocol" width="80" dataField="@idLabelingProtocolChannel1"
						                         itemRenderer="{DropdownLabel.getFactory(parentApplication.dictionaryManager.xml.Dictionary.(@className=='hci.gnomex.model.LabelingProtocol').DictionaryEntry, '@display', '@value', '@idLabelingProtocolChannel1')}">                 											
							<mx:headerRenderer > 
							<mx:Component>
								<mx:VBox verticalGap="0"   horizontalAlign="center" verticalAlign="middle">
								    <mx:Label text="Cy3 Label"/>
								    <mx:Label text="Protocol"/>
								</mx:VBox>
							</mx:Component>
							</mx:headerRenderer>
						</mx:DataGridColumn>
						<mx:DataGridColumn id="labelCol2"  visible="false" headerText="Channel1 Labeling yield" width="80" dataField="@labelingYieldChannel1">
							<mx:headerRenderer>
							<mx:Component>
								<mx:VBox verticalGap="0" horizontalAlign="center" verticalAlign="middle">
								    <mx:Label text="Cy3 Label"/>
								    <mx:Label text="Conc."/>
								</mx:VBox>
							</mx:Component>
							</mx:headerRenderer>
						</mx:DataGridColumn>
						<mx:DataGridColumn id="labelCol3"  visible="false" headerText="Channel1 Labeling Reaction size" width="80" dataField="@codeLabelingReactionSizeChannel1">
							<mx:headerRenderer>
							<mx:Component>
								<mx:VBox verticalGap="0" horizontalAlign="center" verticalAlign="middle">
								    <mx:Label text="Cy3 Label"/>
								    <mx:Label text="Reaction size"/>
								</mx:VBox>
							</mx:Component>
							</mx:headerRenderer>
						</mx:DataGridColumn>
						<mx:DataGridColumn id="labelCol4"  visible="false" headerText="Channel1 Labeling # Reactions" width="80" dataField="@numberOfReactionsChannel1">
							<mx:headerRenderer>
							<mx:Component>
								<mx:VBox verticalGap="0" horizontalAlign="center" verticalAlign="middle">
								    <mx:Label text="Cy3 Label"/>
								    <mx:Label text="# reactions"/>
								</mx:VBox>
							</mx:Component>
							</mx:headerRenderer>
						</mx:DataGridColumn>
						<mx:DataGridColumn  id="labelCol5"   visible="false" headerText="Channel1 Labeling Status" width="80" dataField="@labelingStatusChannel1">
							<mx:headerRenderer>
							<mx:Component>
								<mx:VBox verticalGap="0" horizontalAlign="center" verticalAlign="middle">
								    <mx:Label text="Cy3 Label"/>
								    <mx:Label text="Status"/>
								</mx:VBox>
							</mx:Component>
							</mx:headerRenderer>
						</mx:DataGridColumn>
						<mx:DataGridColumn id="labelCol6"   visible="false" headerText="Channel2 Labeling protocol"  width="80" dataField="@idLabelingProtocolChannel2"
						                         itemRenderer="{DropdownLabel.getFactory(parentApplication.dictionaryManager.xml.Dictionary.(@className=='hci.gnomex.model.LabelingProtocol').DictionaryEntry, '@display', '@value','@idLabelingProtocolChannel2')}">                 											
							<mx:headerRenderer>
							<mx:Component>
								<mx:VBox verticalGap="0" horizontalAlign="center" verticalAlign="middle">
								    <mx:Label text="Cy5 Label"/>
								    <mx:Label text="Protocol"/>
								</mx:VBox>
							</mx:Component>
							</mx:headerRenderer>
						</mx:DataGridColumn>
						<mx:DataGridColumn id="labelCol7"   visible="false" headerText="Channel2 Labeling yield" width="80" dataField="@labelingYieldChannel2">
							<mx:headerRenderer>
							<mx:Component>
								<mx:VBox verticalGap="0" horizontalAlign="center" verticalAlign="middle">
								    <mx:Label text="Cy5 Label"/>
								    <mx:Label text="Conc."/>
								</mx:VBox>
							</mx:Component>
							</mx:headerRenderer>
						</mx:DataGridColumn>
						<mx:DataGridColumn id="labelCol8"  visible="false" headerText="Channel2 Labeling Reaction size" width="80" dataField="@codeLabelingReactionSizeChannel2">
							<mx:headerRenderer>
							<mx:Component>
								<mx:VBox verticalGap="0" horizontalAlign="center" verticalAlign="middle">
								    <mx:Label text="Cy5 Label"/>
								    <mx:Label text="Reaction size"/>
								</mx:VBox>
							</mx:Component>
							</mx:headerRenderer>
						</mx:DataGridColumn>
						<mx:DataGridColumn id="labelCol9"  visible="false"  headerText="Channel2 Labeling # Reactions" width="80" dataField="@numberOfReactionsChannel2">
							<mx:headerRenderer>
							<mx:Component>
								<mx:VBox verticalGap="0" horizontalAlign="center" verticalAlign="middle">
								    <mx:Label text="Cy5 Label"/>
								    <mx:Label text="# reactions"/>
								</mx:VBox>
							</mx:Component>
							</mx:headerRenderer>
						</mx:DataGridColumn>
						<mx:DataGridColumn id="labelCol10"   visible="false" headerText="Channel2 Labeling Status" width="80" dataField="@labelingStatusChannel2">
							<mx:headerRenderer>
							<mx:Component>
								<mx:VBox verticalGap="0" horizontalAlign="center" verticalAlign="middle">
								    <mx:Label text="Cy5 Label"/>
								    <mx:Label text="Status"/>
								</mx:VBox>
							</mx:Component>
							</mx:headerRenderer>
						</mx:DataGridColumn>
						
						
						
						<mx:DataGridColumn visible="{showHybFieldsCheckBox.selected}" headerText="Hyb Slide barcode" width="70" dataField="@slideBarcode"/>
						<mx:DataGridColumn visible="{showHybFieldsCheckBox.selected}" headerText="Coordinate" width="70" dataField="@arrayCoordinateName"/>
						<mx:DataGridColumn visible="{showHybFieldsCheckBox.selected}" headerText="Hyb Protocol" width="70" dataField="@idHybProtocol"
						                          itemRenderer="{DropdownLabel.getFactory(parentApplication.dictionaryManager.xml.Dictionary.(@className=='hci.gnomex.model.HybProtocol').DictionaryEntry, '@display', '@value', '@idHybProtocol')}"/>                 											
						<mx:DataGridColumn visible="{showHybFieldsCheckBox.selected}" headerText="Hyb Status" width="90" dataField="@hybStatus"/>
						
						
						<mx:DataGridColumn visible="{showExtFieldsCheckBox.selected}" headerText="Scan Protocol" width="70" dataField="@idScanProtocol"
						                         itemRenderer="{DropdownLabel.getFactory(parentApplication.dictionaryManager.xml.Dictionary.(@className=='hci.gnomex.model.ScanProtocol').DictionaryEntry, '@display', '@value', '@idScanProtocol')}"/>                 											
						<mx:DataGridColumn visible="{showExtFieldsCheckBox.selected}" headerText="F/E Protocol" width="70" dataField="@idFeatureExtractionProtocol"
						                          itemRenderer="{DropdownLabel.getFactory(parentApplication.dictionaryManager.xml.Dictionary.(@className=='hci.gnomex.model.FeatureExtractionProtocol').DictionaryEntry, '@display', '@value', '@idFeatureExtractionProtocol')}"/>                 											
						<mx:DataGridColumn visible="{showExtFieldsCheckBox.selected}" headerText="Ext Status" width="90" dataField="@extractionStatus"/>
					     
					     
					     <mx:DataGridColumn headerText="Slide" visible="{showCy3LabelingFieldsCheckBox.selected || showCy5LabelingFieldsCheckBox.selected || showHybFieldsCheckBox.selected || showExtFieldsCheckBox.selected ? false : true}"  width="320" dataField="@slideDesignName" />
					     <mx:DataGridColumn headerText="Slide Source"  visible="{showCy3LabelingFieldsCheckBox.selected || showCy5LabelingFieldsCheckBox.selected || showHybFieldsCheckBox.selected || showExtFieldsCheckBox.selected ? false : true}"   width="82"   
					                        itemRenderer="{DropdownLabel.getFactory(parentApplication.dictionaryManager.xml.Dictionary.(@className=='hci.gnomex.model.SlideSource').DictionaryEntry, '@display', '@value', '@codeSlideSource')}"/>                 											
						<mx:DataGridColumn headerText="Notes" width="100"  visible="{showCy3LabelingFieldsCheckBox.selected || showCy5LabelingFieldsCheckBox.selected || showExtFieldsCheckBox.selected ? false : true}"   dataField="@notes"/>
					</mx:columns>
				</mx:DataGrid>
			</mx:VBox>
		</mx:AddChild>
	</mx:State>
	<mx:State name="QCState">		
		<mx:SetProperty target="{noteToBioBox}" name="visible" value="false"/>
		<mx:SetProperty target="{noteToBioBox}" name="includeInLayout" value="false"/>
	</mx:State>
	<mx:State name="SolexaState">
		<mx:AddChild relativeTo="{this.samplesTab}" position="after">
				<mx:VBox  id="lanesConfirmContainer" label="Sample Sequence Lanes"  verticalGap="0" width="100%" height="100%">
						<mx:AdvancedDataGrid width="100%" 
							height="100%" id="lanesConfirmGrid"
							displayItemsExpanded="true"
							sortExpertMode="true"
							sortableColumns="false"  
							editable="false"
							iconFunction="getLaneTreeIcon"
							rollOverColor="#C0C0C0" selectionColor="#FFFFB9" 
							horizontalScrollPolicy="auto">
							<mx:dataProvider>   
      							<mx:HierarchicalData source="{multiplexLanes}"/> 
    						</mx:dataProvider> 							
						<mx:columns>
							<mx:AdvancedDataGridColumn headerText="ID" width="90" dataField="@number"/>
						    <mx:AdvancedDataGridColumn  headerText="Sample Name"  width="100" dataField="@sampleName" editable="false"/>
						    <mx:AdvancedDataGridColumn  headerText="Sample ID"  width="68" dataField="@sampleNumber" editable="false"/>
			                <mx:AdvancedDataGridColumn id="laneBarcodeCol" headerText="Barcode"  width="75" visible="{true}"  
	              				itemRenderer="{DropdownLabel.getFactory(parentApplication.dictionaryManager.xml.Dictionary.(@className=='hci.gnomex.model.OligoBarcode').DictionaryEntry, '@display', '@value', '@sampleIdOligoBarcode')}">
			                   <mx:headerRenderer>
			                   	  <mx:Component>
			                   	    <mx:VBox verticalGap="0" horizontalScrollPolicy="off">
			                   	    	<mx:Label text="Illumina"/>
			                   	    	<mx:Label text="Barcode"/>
			                   	    </mx:VBox>
			                   	  </mx:Component>
			                   </mx:headerRenderer>
			                </mx:AdvancedDataGridColumn>
			                <mx:AdvancedDataGridColumn id="laneCustomBarcodeCol" headerText="Barcode" width="65" visible="true"  dataField="@sampleBarcodeSequence">
			                   <mx:headerRenderer>
			                   	  <mx:Component>
			                   	    <mx:VBox verticalGap="0" horizontalScrollPolicy="off">
			                   	    	<mx:Label text="Custom"/>
			                   	    	<mx:Label text="Barcode"/>
			                   	    </mx:VBox>
			                   	  </mx:Component>
			                   </mx:headerRenderer>
			                </mx:AdvancedDataGridColumn>
				            <mx:AdvancedDataGridColumn  width="150" id="seqRunTypeCol" headerText="Flow Cell Type"  editable="false" dataField="@idSeqRunType" 						             						             
                                    itemRenderer="{DropdownLabel.getFactory(parentApplication.dictionaryManager.xml.Dictionary.(@className=='hci.gnomex.model.SeqRunType').DictionaryEntry, '@display', '@value', '@idSeqRunType')}"/>                 											
				            <mx:AdvancedDataGridColumn width="65" id="numberOfSequencingCyclesCol" headerText="# Cycles"   editable="false" dataField="@idNumberSequencingCycles" 						             						             
                                    itemRenderer="{DropdownLabel.getFactory(parentApplication.dictionaryManager.xml.Dictionary.(@className=='hci.gnomex.model.NumberSequencingCycles').DictionaryEntry, '@display', '@value', '@idNumberSequencingCycles')}"/>                 											
							<mx:AdvancedDataGridColumn  headerText="Status in Workflow" width="120" dataField="@workflowStatus"/>
				            <mx:AdvancedDataGridColumn  width="65" id="flowCellNumberCol" headerText="Flow Cell #"  editable="false" dataField="@flowCellNumber"/> 	 					             						             
				            <mx:AdvancedDataGridColumn  width="55" id="flowCellLaneNumber" headerText="Channel"  editable="false" dataField="@flowCellChannelNumber"/> 						             						             
				            <mx:AdvancedDataGridColumn  width="90" headerText="Channel sample conc. pM"  editable="false" dataField="@flowCellChannelSampleConcentrationPmDisplay"> 						             						             
							   <mx:headerRenderer > 
							    <mx:Component>
							    	<mx:VBox verticalGap="0"   horizontalAlign="center"  horizontalScrollPolicy="off" verticalAlign="middle">
								        <mx:Label text="Channel Sample"/>
								        <mx:Label text="conc. pM"/>
					    			</mx:VBox>
							    </mx:Component>
							   </mx:headerRenderer>
						    </mx:AdvancedDataGridColumn>
				            <mx:AdvancedDataGridColumn  width="90" headerText="# Cycles (actual)"  editable="false" dataField="@numberSequencingCyclesActual"> 						             						             
							   <mx:headerRenderer > 
							    <mx:Component>
							    	<mx:VBox verticalGap="0"   horizontalAlign="center"  horizontalScrollPolicy="off" verticalAlign="middle">
								        <mx:Label text="# Seq Cycles"/>
								        <mx:Label text="(actual)"/>
					    			</mx:VBox>
							    </mx:Component>
							   </mx:headerRenderer>
						    </mx:AdvancedDataGridColumn>
							<mx:AdvancedDataGridColumn  headerText="Last Cycle Status" width="90" dataField="@lastCycleStatus"> 
							   <mx:headerRenderer > 
							    <mx:Component>
							    	<mx:VBox verticalGap="0"  horizontalScrollPolicy="off"  horizontalAlign="center" verticalAlign="middle">
								        <mx:Label text="Last Cycle"/>
								        <mx:Label text="Status"/>
					    			</mx:VBox>
							    </mx:Component>
							   </mx:headerRenderer>
						    </mx:AdvancedDataGridColumn>
				            <mx:AdvancedDataGridColumn width="150" id="genomeBuildAlignTo" headerText="Genome Build (align to)"  editable="false" dataField="@idGenomeBuildAlignTo" 						             						             
                                    itemRenderer="{DropdownLabel.getFactory(parentApplication.dictionaryManager.xml.Dictionary.(@className=='hci.gnomex.model.GenomeBuildLite').DictionaryEntry, '@display', '@value', '@idGenomeBuildAlignTo')}"/>                 											
							<mx:AdvancedDataGridColumn width="150" headerText="Analysis Instructions"   dataField="@analysisInstructions"/>
						</mx:columns> 
					</mx:AdvancedDataGrid>
					
				</mx:VBox>					        			
		
		</mx:AddChild>
		<mx:SetProperty target="{tile1}" name="tileHeight"/>
		<mx:SetProperty target="{tile1}" name="width"/>
		<mx:SetProperty target="{tile1}" name="tileWidth" value="220"/>
	</mx:State>
	<mx:State name="ExternalMicroarrayState" basedOn="MicroarrayState">
		<mx:RemoveChild target="{tile1}"/>
		<mx:RemoveChild target="{label1}"/>
		<mx:RemoveChild target="{headerBox}"/>
		<mx:RemoveChild target="{hbox2}"/>
	</mx:State>
	<mx:State name="ExternalSeqState">
		<mx:RemoveChild target="{hbox2}"/>
	</mx:State>
	<mx:State name="BaseSeqState">
		<mx:AddChild relativeTo="{this.visibilityBox}" position="after">
			<mx:HBox verticalGap="0" width="100%" horizontalGap="0" id="requestStatusBox">
				<mx:Text  width="100" text="Status" />
				<mx:TextInput editable="false" backgroundColor="#FFFFFF" text="{this.selectedExperiment.@requestStatus}" width="400" />
			</mx:HBox>
		</mx:AddChild>
		<mx:SetProperty target="{parentDocument.requestFormButton}" name="visible" value="false"/>
		<mx:SetProperty target="{parentDocument.submitExperimentButton}" name="includeInLayout" value="true"/>
		<mx:SetProperty target="{parentDocument.submitExperimentButton}" name="visible" value="true"/>
		<mx:SetProperty target="{noteToBioBox}" name="visible" value="false"/>
		<mx:SetProperty target="{noteToBioBox}" name="includeInLayout" value="false"/>
	</mx:State>
	<mx:State name="BaseSeqChromoState" basedOn="BaseSeqState">
		<mx:AddChild relativeTo="{theTab}" position="lastChild">
			<data:ChromatBrowseView label="Chromatogram"
									width="100%"
									height="100%"
									verticalGap="6"
									id="chromoTab"
									currentState="userState" />
		</mx:AddChild>
		<mx:RemoveChild target="{filesView}"/>
	</mx:State>
	<mx:State name="CapSeqState" basedOn="BaseSeqChromoState">
		<mx:AddChild relativeTo="{this.requestStatusBox}" position="before">
			<mx:HBox verticalGap="0" width="100%" horizontalGap="0">
				<mx:Text  width="100" text="Container" />
				<mx:TextInput editable="false" backgroundColor="#FFFFFF" text="{this.selectedExperiment.@containerType}" width="400" />
			</mx:HBox>
		</mx:AddChild>
		<mx:AddChild relativeTo="{this.requestStatusBox}" position="before">
			<mx:HBox verticalGap="0" width="100%" horizontalGap="0">
				<mx:Text  width="100" text="Drop Off Loc." />
				<mx:TextInput id="sampleDropOffLocationText" editable="false" backgroundColor="#FFFFFF" 
							  text="{parentApplication.dictionaryManager.xml.Dictionary.(@className == 'hci.gnomex.model.SampleDropOffLocation').DictionaryEntry.(@value == this.selectedExperiment.@idSampleDropOffLocation).@display}" 
							  width="400" />
			</mx:HBox>
		</mx:AddChild>
	</mx:State>
	<mx:State name="MitSeqState" basedOn="BaseSeqChromoState">
		<mx:AddChild relativeTo="{this.requestStatusBox}" position="before">
			<mx:HBox verticalGap="0" width="100%" horizontalGap="0">
				<mx:Text  width="100" text="Primers" />
				<mx:TextInput editable="false" backgroundColor="#FFFFFF" text="{this.selectedExperiment.@primerList}" width="400" />
			</mx:HBox>
		</mx:AddChild>
	</mx:State>
	<mx:State name="FragAnalState" basedOn="BaseSeqState">
		<mx:AddChild relativeTo="{this.requestStatusBox}" position="before">
			<mx:HBox verticalGap="0" width="100%" horizontalGap="0">
				<mx:Text  width="100" text="Assays" />
				<mx:TextInput editable="false" backgroundColor="#FFFFFF" text="{this.selectedExperiment.@assayList}" width="400" />
			</mx:HBox>
		</mx:AddChild>
	</mx:State>
	<mx:State name="CherryPickState" basedOn="BaseSeqState">
	</mx:State>
	<mx:State name="ExternalQCState">
		<mx:RemoveChild target="{hbox2}"/>
	</mx:State>
</mx:states>
	
</mx:VBox>
