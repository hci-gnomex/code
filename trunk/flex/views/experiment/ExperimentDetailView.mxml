<?xml version="1.0" encoding="utf-8"?>
<mx:TitleWindow  xmlns:mx="http://www.adobe.com/2006/mxml" 
	width="100%" height="100%" 
	xmlns:views="views.*"   
	 headerHeight="20"  
	close="{PopUpManager.removePopUp(this);}">
<mx:Script>
	<![CDATA[
		import mx.managers.PopUpManager;
		import mx.events.CloseEvent;
		import mx.controls.Alert;
		import views.experiment.ExperimentEditView;
		import hci.flex.renderers.LabelDictionary; 
		
		
		
	
		[Bindable]
		private var requestCategoryName:String;
		[Bindable]
		private var experimentCategoryName:String;
		[Bindable]
		private var billingAccountName:String;
		
		[Bindable]
		private var selectedExperiment:Object;
		
		public function checkSecurity():void {
			if (parentApplication.isGuestMode()) {
				this.showCy3LabelingFieldsCheckBox.visible = false;
				this.showCy5LabelingFieldsCheckBox.visible = false;
				this.showExtFieldsCheckBox.visible = false;
				this.showHybFieldsCheckBox.visible = false;
				this.showQCFieldsCheckBox.visible = false;
				this.requestFormButton.visible = false;
			}
		}
	
		public function setupForm(selectedExperiment:Object):void {
			this.selectedExperiment = selectedExperiment;
			
			this.currentState = '';						
			this.theViews.selectedIndex = 0;
			if (this.selectedExperiment.@codeRequestCategory == "QC") {
				currentState = 'QCState';
			} else if (this.selectedExperiment.@codeRequestCategory == 'SOLEXA') {
				currentState = 'SolexaState';
			} else {
				currentState = 'MicroarrayState';

				
				showCy3LabelingFieldsCheckBox.selected = false;
				showCy5LabelingFieldsCheckBox.selected = false;
				showHybFieldsCheckBox.selected = false;
				showExtFieldsCheckBox.selected = false;

			}
			
			if (this.selectedExperiment.analysisExperimentItems.hasOwnProperty("AnalysisExperimentItem")) {
				this.analysisButton.enabled = true;
				this.hasAnalysis.visible = true;
			} else {
				this.analysisButton.enabled = false;
				this.hasAnalysis.visible = false;
			}


			showQCFieldsCheckBox.selected = false;


			getRequestCategoryName();
			getExperimentCategoryName();
			getBillingAccountName();
			callLater(showHideColumns);
			this.addNonStandardSampleColumns();
			
		}
		
		private function showCy3LabelCols(isVisible:Boolean):void {
			labelCol1.visible = isVisible;
			labelCol2.visible = isVisible;
			labelCol3.visible = isVisible;
			labelCol4.visible = isVisible;
			labelCol5.visible = isVisible;
		}
			
		private function showCy5LabelCols(isVisible:Boolean):void {
			labelCol6.visible = isVisible;
			labelCol7.visible = isVisible;
			labelCol8.visible = isVisible;
			labelCol9.visible = isVisible;
			labelCol10.visible = isVisible;
		}

	    private function getChannel1SampleName(item:Object, col:int):String {
			var de:XMLList = item.labeledSampleChannel1.LabeledSample.sample.Sample;
	    	if (de.length() == 1) {
		    	return de[0].@name;
	    	} else {
	    		return "";
	    	}
		}
		private function getChannel2SampleName(item:Object, col:int):String {
			var de:XMLList = item.labeledSampleChannel2.LabeledSample.sample.Sample;
	    	if (de.length() == 1) {
		    	return de[0].@name;
	    	} else {
	    		return "";
	    	}
		}
		private function getChannel1SampleNumber(item:Object, col:int):String {
			var de:XMLList = item.labeledSampleChannel1.LabeledSample.sample.Sample;
	    	if (de.length() == 1) {
		    	return de[0].@number;
	    	} else {
	    		return "";
	    	}
		}
		private function getChannel2SampleNumber(item:Object, col:int):String {
			var de:XMLList = item.labeledSampleChannel2.LabeledSample.sample.Sample;
	    	if (de.length() == 1) {
		    	return de[0].@number;
	    	} else {
	    		return "";
	    	}
		}

   	 	private function getSamplesGridRowNumber(item:Object,col:int):String
	    {
    	   var x:int = samplesGridConfirm.dataProvider.getItemIndex(item) + 1;
	       return String(x);
	    } 
   	 	private function getHybsGridRowNumber(item:Object,col:int):String
	    {
    	   var x:int = hybsGridConfirm.dataProvider.getItemIndex(item) + 1;
	       return String(x);
	    } 

		private function getRequestCategoryName():void {
			var requestCategory:Object = parentApplication.dictionaryManager.getEntry('hci.gnomex.model.RequestCategory', this.selectedExperiment.@codeRequestCategory);
			requestCategoryName = requestCategory.@display.toString();
		}
		private function getExperimentCategoryName():void {
			var experimentCategory:Object = parentApplication.dictionaryManager.getEntry('hci.gnomex.model.MicroarrayCategory', this.selectedExperiment.@codeMicroarrayCategory);
			experimentCategoryName = experimentCategory.@display.toString();
		}
		private function getBillingAccountName():void {
			var billingAccount:Object = null;
			for each(var lab:Object in parentApplication.promptedSubmitRequestLabList) {
				for each(var ba:Object in lab.billingAccounts.BillingAccount) {
					if (ba.@idBillingAccount == this.selectedExperiment.@idBillingAccount) {
						billingAccount = ba;
						break;
					}
						
				}
			}
			if (billingAccount != null) {
				billingAccountName = billingAccount.@accountName;
			}
		}
		
		public function showDownloads():void {
			parentDocument.showExperimentDownloads();
		}

	  	public function promptToDeleteExperiment():void {
			Alert.show("Delete experiment " + this.selectedExperiment.@number + "?", 
						null, 
						(Alert.YES | Alert.NO), this, 
						onPromptToDeleteExperiment);
			
	  	}
		
	  	private function onPromptToDeleteExperiment(event:CloseEvent):void {
            if (event.detail==Alert.YES) {
            	deleteExperiment();
            }
      	}
		private function deleteExperiment():void {
			parentDocument.deleteExperiment();
		}
		
		public function showPrintableRequestForm():void {
			var url:URLRequest = new URLRequest('ShowRequestForm.gx?idRequest=' + this.selectedExperiment.@idRequest);
			navigateToURL(url, '_blank');			
		}
		
		private function showEditExperimentWindow():void {
			 // add this get request code b/c the edit window was freezing the second time 
			 // the edit window was pressed.  by putting this extra call in, it seems to clear
			 // out some weird state.
			 //var parms:Object = new Object();
			 //parms.idRequest = this.selectedExperiment.@idRequest;
			 //parentDocument.getRequest.send(parms);
 
 			/*
			 var editWindow:ExperimentEditView = ExperimentEditView(PopUpManager.createPopUp(this.parentApplication.topArea, ExperimentEditView, true));
			 editWindow.width= 1000;
			 editWindow.height= 500;
			 editWindow.showCloseButton = true;
			 editWindow.title = "Edit Experiment " + this.selectedExperiment.@number;
			 PopUpManager.centerPopUp(editWindow);		
             editWindow.setupEditForm(this.selectedExperiment);
           	 editWindow.initializeData();
           	 callLater(editWindow.setupDataListeners); 
           	 */
           	 
           	 parentDocument.theViews.selectedChild = parentDocument.editView;
           	 parentDocument.editView.removeDataListeners();
           	 parentDocument.editView.setupEditForm(this.selectedExperiment);
           	 parentDocument.editView.initializeData();
           	 callLater(parentDocument.editView.setupDataListeners);
		}
		
		public function refreshSavedExperiment(idRequest:Object):void {
			 parentDocument.selectedIdRequest = idRequest;
			 var parms:Object = new Object();
			 parms.idRequest = parentDocument.selectedIdRequest;
			 parentDocument.getRequest.send(parms);
			
		}

		public function getLanesGridRowNumber(item:Object,col:int):String
        {
           var x:int = this.lanesConfirmGrid.dataProvider.getItemIndex(item) + 1;
           return String(x);     		
        }
		public function getLaneSampleName(item:Object,col:int):String
        {
        	var sampleName:String = "";
    		for each(var sample:Object in this.samplesGridConfirm.dataProvider) {
    			if (sample.@idSample == item.@idSample) {
    				sampleName = sample.@name;
    				break;
    			}
    		}
        	return sampleName;
        }
        

        
       
		public function getLaneSampleNumber(item:Object,col:int):String
        {
        	var sampleNumber:String = "";
    		for each(var sample:Object in this.samplesGridConfirm.dataProvider) {
    			if (sample.@idSample == item.@idSample) {
    				sampleNumber = sample.@number;
    				break;
    			}
    		}
        	return sampleNumber;
        }
        
        private function showHideColumns():void {
       	if (this.showQCFieldsCheckBox.selected) {
				concentrationCol.visible = false; 
				sampleTypeCol.visible = false;
				organismCol.visible = false;
				sampleSourceCol.visible = false;
				preppedByLabCol.visible = false;
				samplePrepCol.visible = false;
				chipTypeCol.visible = false;
				concentrationUnitCol.visible = false;

				AGE0.visible = false;
				CELLLINE0.visible = false;   
				CELLTYPE0.visible = false;   
				CLININFO0.visible = false;   
				COMPOUND0.visible = false;   
				DISSTATE0.visible = false;   
				DOSE0.visible = false;   
				GENMOD0.visible = false;   
				GENOTYPE0.visible = false;   
				GROWTHCOND0.visible = false;   
				INDIV0.visible = false;   
				ORGPART0.visible = false;   
				SEX0.visible = false;   
				TEMP0.visible = false;   
				TIME0.visible = false;   
				otherDataColumnConfirm.visible = false;   
				treatmentCol.visible = false;   
				descriptionCol.visible = false;   
        		
        	} else {
				AGE0.visible = this.selectedExperiment.@AGE == 'Y' ? true : false;        		
				CELLLINE0.visible = this.selectedExperiment.@CELLLINE == 'Y' ? true : false;   
				CELLTYPE0.visible = this.selectedExperiment.@CELLTYPE == 'Y' ? true : false;   
				CLININFO0.visible = this.selectedExperiment.@CLININFO == 'Y' ? true : false;   
				COMPOUND0.visible = this.selectedExperiment.@COMPOUND == 'Y' ? true : false;   
				DISSTATE0.visible = this.selectedExperiment.@DISSTATE == 'Y' ? true : false;   
				DOSE0.visible = this.selectedExperiment.@DOSE == 'Y' ? true : false;   
				GENMOD0.visible = this.selectedExperiment.@GENMOD == 'Y' ? true : false;   
				GENOTYPE0.visible = this.selectedExperiment.@GENOTYPE == 'Y' ? true : false;   
				GROWTHCOND0.visible = this.selectedExperiment.@GROWTHCOND == 'Y' ? true : false;   
				INDIV0.visible = this.selectedExperiment.@INDIV == 'Y' ? true : false;   
				ORGPART0.visible = this.selectedExperiment.@ORGPART == 'Y' ? true : false;   
				SEX0.visible = this.selectedExperiment.@SEX == 'Y' ? true : false;   
				TEMP0.visible = this.selectedExperiment.@TEMP == 'Y' ? true : false;   
				TIME0.visible = this.selectedExperiment.@TIME == 'Y' ? true : false;   
				otherDataColumnConfirm.visible = this.selectedExperiment.@OTHER == 'Y' ? true : false;   
				treatmentCol.visible = this.selectedExperiment.@treatment == 'Y' ? true : false;   
				descriptionCol.visible = true;   

	        	if (currentState == 'SolexaState') {
					concentrationCol.visible = true; 
					sampleTypeCol.visible = true;
					organismCol.visible = true;
					sampleSourceCol.visible = true;
					preppedByLabCol.visible = true;
					samplePrepCol.visible = true;
					chipTypeCol.visible = false;
					concentrationUnitCol.visible = false;
	        		
	        	} else if (currentState == 'QCState') {
					concentrationCol.visible = false; 
					sampleTypeCol.visible = false;
					organismCol.visible = false;
					sampleSourceCol.visible = false;
					preppedByLabCol.visible = false;
					samplePrepCol.visible = true;
					chipTypeCol.visible = true;
					concentrationUnitCol.visible = true;
	        		
	        	} else {
					concentrationCol.visible = true; 
					sampleTypeCol.visible = true;
					organismCol.visible = true;
					sampleSourceCol.visible = true;
					preppedByLabCol.visible = false;
					samplePrepCol.visible = true;
					chipTypeCol.visible = false;
					concentrationUnitCol.visible = false;        		
        		}
        	} 
        }
        
        public function showRelatedAnalysis():void {
        	parentApplication.showAnalysisForExperiment(this.selectedExperiment);
        }
        
        public function addNonStandardSampleColumns():void {
       		var annotation:Object;
       		var col:DataGridColumn;
       		var exists:Boolean = false;
       		for each(annotation in this.selectedExperiment.SampleCharacteristicEntries.SampleCharacteristicEntry) {
				exists = false;
       			for each(col in samplesGridConfirm.columns) {
					if (col.dataField == ("@" + annotation.@codeSampleCharacteristic)) {
						exists = true;
						break;
					}    				
       			}
       			if (!exists) {
       				
       				var newCol:DataGridColumn = new DataGridColumn();
       				newCol.dataField  = "@" + annotation.@codeSampleCharacteristic;
       				newCol.headerText = annotation.@sampleCharacteristic;
       				newCol.visible    = annotation.@isSelected == "true" ? true : false;
       				
       				var columns:Array = samplesGridConfirm.columns;
       				// Pop the description; we want it to be the last column
       				var descCol:DataGridColumn = DataGridColumn(columns.pop());
       				columns.push(newCol);
       				columns.push(descCol);
       				samplesGridConfirm.columns = columns;
       			} else {
       				col.visible    = annotation.@isSelected == "true" ? true : false;       				
       			}
       		}
        	
        }
        public function lookupSlideDesignName(item:Object, col:DataGridColumn):String {
        	var sd:Object = parentApplication.getSlideProductList.lastResult..SlideDesign.(@idSlideDesign == item.@idSlideDesign);
        	if (sd != null) {
        		return sd.@name;
        	} else {
        		return "";
        	}
        }
        

	]]>
</mx:Script>

<mx:VBox width="100%" height="100%"  styleName="form" >
	
		
	<mx:ViewStack id="theViews"  width="100%" height="100%" >

		<mx:VBox width="100%" height="100%" verticalGap="0">
		    <mx:VBox height="100%"  width="100%" verticalGap="0">
		        <mx:HBox width="100%" paddingTop="4" paddingBottom="4" horizontalGap="6" paddingLeft="6" paddingRight="6">
		        	<mx:VBox verticalGap="0">
		        		<mx:HBox horizontalGap="0">
		                    <mx:Label text="#"  width="90" fontWeight="bold">
		                    </mx:Label>
		                    <mx:Text  id="requestNumber" text="{this.selectedExperiment.@number}"  width="130" />
		                </mx:HBox>
		                <mx:HBox verticalGap="0" horizontalGap="0">
		                  <mx:Label text="Submit Date"  width="90" fontWeight="bold"/>
		                  <mx:Text text="{this.selectedExperiment.@createDate}" width="120"/>
		                </mx:HBox>
			        	 <mx:HBox verticalGap="0" horizontalGap="0">
			        	   <mx:Label text="Submitted by"  width="90" fontWeight="bold"/>
			        	   <mx:Text text="{this.selectedExperiment.@ownerName}" width="130" />
			        	 </mx:HBox>
						<mx:LinkButton icon="@Embed(source='../../assets/map.png')" label="Linked to analysis" labelPlacement="right"
 		        		   enabled="true" disabledIcon="@Embed(source='../../assets/map_disable.png')" id="hasAnalysis" visible="false" paddingBottom="0" paddingTop="0" paddingLeft="0" paddingRight="0">
		        	    </mx:LinkButton>			            
		        	</mx:VBox>
		        	<mx:VBox verticalGap="0">
			        	
			        	 <mx:HBox verticalGap="0" horizontalGap="0">
			        	       <mx:Label text="Request Type"  width="105" fontWeight="bold"/>
			        	       <mx:Text text="{requestCategoryName}" width="120" />
			        	   </mx:HBox>
			            <mx:HBox verticalGap="0" horizontalGap="0">
			                <mx:Label text="Experiment Type"  width="105" fontWeight="bold"/>
			                <mx:Text  text="{experimentCategoryName}" width="120" />
			            </mx:HBox>
		                <mx:HBox verticalGap="0" horizontalGap="0">
		                  <mx:Label width="105" text="Completed on" fontWeight="bold"/>
		                  <mx:Text  text="{this.selectedExperiment.@completedDate}" width="120" />
		                </mx:HBox>
		        	</mx:VBox>
		        	<mx:VBox width="100%" verticalGap="0">
			        	
			            <mx:HBox verticalGap="0" width="100%" horizontalGap="0">
			                   <mx:Label text="Group"  width="55" fontWeight="bold"/>
			                   <mx:Text text="{this.selectedExperiment.@labName}" width="100%"/>
			               </mx:HBox>
			            <mx:HBox verticalGap="0" width="100%" horizontalGap="0">
			                <mx:Label text="Account"  width="55" fontWeight="bold"/>
			                <mx:Text text="{billingAccountName}" width="100%" />
			            </mx:HBox>
			            <mx:HBox verticalGap="0" width="100%" horizontalGap="0">
			                <mx:Label text="Project"  width="55" fontWeight="bold"/>
			                <mx:Text  text="{this.selectedExperiment.@projectName}" width="100%"/>
			            </mx:HBox>
		        	</mx:VBox>
		        	
		        </mx:HBox>
		        
	
				<mx:VBox   width="100%" height="100%" verticalGap="5" paddingBottom="5" paddingLeft="5" paddingRight="5" paddingTop="0" id="confirmContainer">
			    <mx:HRule width="100%"/>
					<mx:VBox verticalGap="0" width="100%" height="100%" id="vbox1">
						<mx:HBox width="100%" horizontalGap="2" paddingTop="4">
							<mx:Label text="{'Samples (' + samplesGridConfirm.dataProvider.length + ')'}" fontWeight="bold"/>
							<mx:HBox width="100%" horizontalAlign="right" paddingRight="4">
								<mx:CheckBox id="showQCFieldsCheckBox" label="Show QC columns" visible="true" click="showHideColumns()"/>
								<mx:CheckBox id="showSeqPrepFieldsCheckBox" label="Solexa Lib Prep" visible="true" click="showHideColumns()"/>
							</mx:HBox>
								
						</mx:HBox>
						<mx:DataGrid width="100%" id="samplesGridConfirm"  editable="false" dataProvider="{this.selectedExperiment.samples.Sample}" backgroundAlpha="0" borderStyle="solid" selectionColor="#FFFFB9" rollOverColor="#C0C0C0" horizontalScrollPolicy="auto" height="100%">
							<mx:columns>
								<mx:DataGridColumn headerText="ID" width="60" dataField="@number"/>
								<mx:DataGridColumn headerText="Sample Name" width="100" dataField="@name"/>
								<mx:DataGridColumn id="concentrationCol" headerText="Conc." width="65" visible="true"  dataField="@concentration"/>
				                <mx:DataGridColumn id="concentrationUnitCol" visible="{true}"  headerText="Unit"  width="60" 
	                  				itemRenderer="{LabelDictionary.create(parentApplication.dictionaryManager, 'hci.gnomex.model.ConcentrationUnit','@codeConcentrationUnit')}"/>
					            <mx:DataGridColumn id="sampleTypeCol" headerText="Sample Type"  width="100" visible="{true}"  
	                  				itemRenderer="{LabelDictionary.create(parentApplication.dictionaryManager, 'hci.gnomex.model.SampleType', '@idSampleType')}"/>
					            <mx:DataGridColumn id="organismCol" headerText="Organism" visible="{true}"  width="80" 
	                  				itemRenderer="{LabelDictionary.create(parentApplication.dictionaryManager, 'hci.gnomex.model.Organism', '@idOrganism')}"/>
					            <mx:DataGridColumn id="sampleSourceCol" headerText="Sample Source" visible="{true}"  width="50" 
	                  				itemRenderer="{LabelDictionary.create(parentApplication.dictionaryManager, 'hci.gnomex.model.SampleSource', '@idSampleSource')}"/>
					            <mx:DataGridColumn id="preppedByLabCol" headerText="Core to prep lib?"   visible="{true}" width="104"  dataField="@seqPrepByCore"/>
					            <mx:DataGridColumn id="samplePrepCol" headerText="Sample Prep Method"   visible="{true}" width="200" 
	                  				itemRenderer="{LabelDictionary.create(parentApplication.dictionaryManager, 'hci.gnomex.model.SamplePrepMethod', '@idSamplePrepMethod')}"/>
				                <mx:DataGridColumn id="chipTypeCol" visible="{true}" headerText="Chip Type"  width="120" 
	                  				itemRenderer="{LabelDictionary.create(parentApplication.dictionaryManager, 'hci.gnomex.model.BioanalyzerChipType', '@codeBioanalyzerChipType')}"/>
								

								<mx:DataGridColumn visible="{showQCFieldsCheckBox.selected}" headerText="QC Conc. ng/uL" width="80" dataField="@qualCalcConcentration"/>
								<mx:DataGridColumn visible="{showQCFieldsCheckBox.selected}" headerText="QC 260/230" width="80" dataField="@qual260nmTo230nmRatio"/>
								<mx:DataGridColumn visible="{showQCFieldsCheckBox.selected}" headerText="QC RIN" width="70" dataField="@qualRINNumber"/>
				                <mx:DataGridColumn  visible="{showQCFieldsCheckBox.selected}" headerText="QC Bioanalyzer method"  width="120" 
	                  				itemRenderer="{LabelDictionary.create(parentApplication.dictionaryManager, 'hci.gnomex.model.BioanalyzerChipType', '@codeBioanalyzerChipType')}"/>
					 			<mx:DataGridColumn visible="{showQCFieldsCheckBox.selected}" headerText="QC Frag Size (from)" width="90" dataField="@qualFragmentSizeFrom"/>
								<mx:DataGridColumn visible="{showQCFieldsCheckBox.selected}" headerText="QC Frag Size (to)" width="90" dataField="@qualFragmentSizeTo"/>
								<mx:DataGridColumn visible="{showQCFieldsCheckBox.selected}" headerText="QC Status" width="90" dataField="@qualStatus"/>

				                <mx:DataGridColumn  visible="{showSeqPrepFieldsCheckBox.selected}" headerText="Lib QC Bioanalyzer method"  width="120" 
	                  				itemRenderer="{LabelDictionary.create(parentApplication.dictionaryManager, 'hci.gnomex.model.BioanalyzerChipType', '@seqPrepQualCodeBioanalyzerChipType')}"/>
								<mx:DataGridColumn visible="{showSeqPrepFieldsCheckBox.selected}" headerText="Lib Conc. ng/uL" width="90" dataField="@seqPrepLibConcentration"/>
								<mx:DataGridColumn visible="{showSeqPrepFieldsCheckBox.selected}" headerText="Gel size (from)" width="90" dataField="@seqPrepGelFragmentSizeFrom"/>
								<mx:DataGridColumn visible="{showSeqPrepFieldsCheckBox.selected}" headerText="Gel size (to)" width="90" dataField="@seqPrepGelFragmentSizeTo"/>
								<mx:DataGridColumn visible="{showSeqPrepFieldsCheckBox.selected}" headerText="Lib Prep Status" width="90" dataField="@seqPrepStatus"/>

								
								<mx:DataGridColumn id="AGE0" headerText="Age" visible="{this.selectedExperiment.@AGE == 'Y' ? true : false}" dataField="@AGE"  />
								<mx:DataGridColumn id="CELLLINE0" headerText="Cell line" dataField="@CELLLINE" visible="{this.selectedExperiment.@CELLLINE == 'Y' ? true : false}" />
								<mx:DataGridColumn id="CELLTYPE0" headerText="Cell Type" dataField="@CELLTYPE" visible="{!this.selectedExperiment.@CELLTYPE == 'Y' ? true : false}" />
								<mx:DataGridColumn id="CLININFO0" headerText="Clinical Info" dataField="@CLININFO" visible="{this.selectedExperiment.@CLININFO == 'Y' ? true : false}" />
								<mx:DataGridColumn id="COMPOUND0" headerText="Compound" dataField="@COMPOUND" visible="{this.selectedExperiment.@COMPOUND == 'Y' ? true : false}" />
								<mx:DataGridColumn id="DISSTATE0" headerText="Disease State" dataField="@DISSTATE" visible="{this.selectedExperiment.@DISSTATE == 'Y' ? true : false}" />
								<mx:DataGridColumn id="DOSE0" headerText="Dose" dataField="@DOSE" visible="{this.selectedExperiment.@DOSE == 'Y' ? true : false}" />
								<mx:DataGridColumn id="GENMOD0" headerText="Genetic Modification" dataField="@GENMOD" visible="{this.selectedExperiment.@GENMOD == 'Y' ? true : false}" />
								<mx:DataGridColumn id="GENOTYPE0" headerText="Genotype" dataField="@GENOTYPE" visible="{this.selectedExperiment.@GENOTYPE == 'Y' ? true : false}" />
								<mx:DataGridColumn id="GROWTHCOND0" headerText="Growth Conditions" dataField="@GROWTHCOND" visible="{this.selectedExperiment.@GROWTHCOND == 'Y' ? true : false}" />
								<mx:DataGridColumn id="INDIV0" headerText="Individual" dataField="@INDIV" visible="{this.selectedExperiment.@INDIV == 'Y' ? true : false}" />
								<mx:DataGridColumn id="ORGPART0" headerText="Organ / Tissue" dataField="@ORGPART" visible="{this.selectedExperiment.@ORGPART == 'Y' ? true : false}" />
								<mx:DataGridColumn id="SEX0" headerText="Sex" dataField="@SEX" visible="{this.selectedExperiment.@SEX == 'Y' ? true : false}" />
								<mx:DataGridColumn id="TEMP0" headerText="Temperature" dataField="@TEMP" visible="{!this.selectedExperiment.@TEMP == 'Y' ? true : false}" />
								<mx:DataGridColumn id="TIME0" headerText="Time Course" dataField="@TIME" visible="{this.selectedExperiment.@TIME == 'Y' ? true : false}" />
								<mx:DataGridColumn id="otherDataColumnConfirm" headerText="{this.selectedExperiment.@otherLabel.toString()}" dataField="@OTHER" visible="{this.selectedExperiment.@OTHER == 'Y' ? true : false}" />
								<mx:DataGridColumn id="treatmentCol" visible="{this.selectedExperiment.@treatment == 'Y' ? true : false}" headerText="Treatment" width="100" dataField="@treatment"/>

								<mx:DataGridColumn id="descriptionCol" headerText="Description" width="100" dataField="@description"/>
							</mx:columns>
						</mx:DataGrid>
		        <mx:Spacer height="4"/>
					</mx:VBox>
					<mx:HRule width="100%"/>
					
			    
					<mx:VBox width="100%" height="100%" verticalGap="0" id="hybsConfirmContainer">
						<mx:HBox width="100%" horizontalGap="2" paddingTop="4">
							<mx:Label text="{'Hybridizations (' + hybsGridConfirm.dataProvider.length + ')' }" fontWeight="bold"/>
							<mx:HBox width="100%"  horizontalAlign="right" paddingRight="4">
								<mx:CheckBox id="showCy3LabelingFieldsCheckBox" label="Show Cy3 Labeling columns" click="showCy3LabelCols(showCy3LabelingFieldsCheckBox.selected)"/>
								<mx:CheckBox id="showCy5LabelingFieldsCheckBox" label="Cy5 Labeling" click="showCy5LabelCols(showCy5LabelingFieldsCheckBox.selected)"/>
								<mx:CheckBox id="showHybFieldsCheckBox" label="Hyb"/>
								<mx:CheckBox id="showExtFieldsCheckBox" label="Scan/FE"/>
							</mx:HBox>
						</mx:HBox>
						<mx:DataGrid width="100%" height="100%" id="hybsGridConfirm"  horizontalScrollPolicy="auto" editable="false" dataProvider="{this.selectedExperiment.hybridizations.Hybridization}"  backgroundAlpha="0" borderStyle="solid" rollOverColor="#C0C0C0" selectionColor="#FFFFB9">
							<mx:columns>
								<mx:DataGridColumn headerText="ID" width="60" dataField="@number"/>
							    <mx:DataGridColumn editable="false" headerText="Cy3 Sample (green)"  width="122" labelFunction="getChannel1SampleName"/>
							    <mx:DataGridColumn editable="false" headerText="ID"  width="60" labelFunction="getChannel1SampleNumber"/>
							    <mx:DataGridColumn id="channel2SampleConfirmColumn" editable="false" headerText="Cy5 Sample (red)"  width="122" labelFunction="getChannel2SampleName"/>
							    <mx:DataGridColumn editable="false" headerText="ID"  width="60" labelFunction="getChannel2SampleNumber"/>

								<mx:DataGridColumn id="labelCol1"  visible="false"  headerText="Channel1 Labeling protocol" width="80" dataField="@idLabelingProtocolChannel1"
                                    itemRenderer="{LabelDictionary.create(parentApplication.dictionaryManager, 'hci.gnomex.model.LabelingProtocol', '@idLabelingProtocolChannel1')}">                 											
									<mx:headerRenderer > 
									<mx:Component>
										<mx:VBox verticalGap="0"   horizontalAlign="center" verticalAlign="middle">
										    <mx:Label text="Cy3 Label"/>
										    <mx:Label text="Protocol"/>
										</mx:VBox>
									</mx:Component>
									</mx:headerRenderer>
								</mx:DataGridColumn>
								<mx:DataGridColumn id="labelCol2"  visible="false" headerText="Channel1 Labeling yield" width="80" dataField="@labelingYieldChannel1">
									<mx:headerRenderer>
									<mx:Component>
										<mx:VBox verticalGap="0" horizontalAlign="center" verticalAlign="middle">
										    <mx:Label text="Cy3 Label"/>
										    <mx:Label text="Conc."/>
										</mx:VBox>
									</mx:Component>
									</mx:headerRenderer>
								</mx:DataGridColumn>
								<mx:DataGridColumn id="labelCol3"  visible="false" headerText="Channel1 Labeling Reaction size" width="80" dataField="@codeLabelingReactionSizeChannel1">
									<mx:headerRenderer>
									<mx:Component>
										<mx:VBox verticalGap="0" horizontalAlign="center" verticalAlign="middle">
										    <mx:Label text="Cy3 Label"/>
										    <mx:Label text="Reaction size"/>
										</mx:VBox>
									</mx:Component>
									</mx:headerRenderer>
								</mx:DataGridColumn>
								<mx:DataGridColumn id="labelCol4"  visible="false" headerText="Channel1 Labeling # Reactions" width="80" dataField="@numberOfReactionsChannel1">
									<mx:headerRenderer>
									<mx:Component>
										<mx:VBox verticalGap="0" horizontalAlign="center" verticalAlign="middle">
										    <mx:Label text="Cy3 Label"/>
										    <mx:Label text="# reactions"/>
										</mx:VBox>
									</mx:Component>
									</mx:headerRenderer>
								</mx:DataGridColumn>
								<mx:DataGridColumn  id="labelCol5"   visible="false" headerText="Channel1 Labeling Status" width="80" dataField="@labelingStatusChannel1">
									<mx:headerRenderer>
									<mx:Component>
										<mx:VBox verticalGap="0" horizontalAlign="center" verticalAlign="middle">
										    <mx:Label text="Cy3 Label"/>
										    <mx:Label text="Status"/>
										</mx:VBox>
									</mx:Component>
									</mx:headerRenderer>
								</mx:DataGridColumn>
								<mx:DataGridColumn id="labelCol6"   visible="false" headerText="Channel2 Labeling protocol"  width="80" dataField="@idLabelingProtocolChannel2"
                                    itemRenderer="{LabelDictionary.create(parentApplication.dictionaryManager, 'hci.gnomex.model.LabelingProtocol','@idLabelingProtocolChannel2')}">                 											
									<mx:headerRenderer>
									<mx:Component>
										<mx:VBox verticalGap="0" horizontalAlign="center" verticalAlign="middle">
										    <mx:Label text="Cy5 Label"/>
										    <mx:Label text="Protocol"/>
										</mx:VBox>
									</mx:Component>
									</mx:headerRenderer>
								</mx:DataGridColumn>
								<mx:DataGridColumn id="labelCol7"   visible="false" headerText="Channel2 Labeling yield" width="80" dataField="@labelingYieldChannel2">
									<mx:headerRenderer>
									<mx:Component>
										<mx:VBox verticalGap="0" horizontalAlign="center" verticalAlign="middle">
										    <mx:Label text="Cy5 Label"/>
										    <mx:Label text="Conc."/>
										</mx:VBox>
									</mx:Component>
									</mx:headerRenderer>
								</mx:DataGridColumn>
								<mx:DataGridColumn id="labelCol8"  visible="false" headerText="Channel2 Labeling Reaction size" width="80" dataField="@codeLabelingReactionSizeChannel2">
									<mx:headerRenderer>
									<mx:Component>
										<mx:VBox verticalGap="0" horizontalAlign="center" verticalAlign="middle">
										    <mx:Label text="Cy5 Label"/>
										    <mx:Label text="Reaction size"/>
										</mx:VBox>
									</mx:Component>
									</mx:headerRenderer>
								</mx:DataGridColumn>
								<mx:DataGridColumn id="labelCol9"  visible="false"  headerText="Channel2 Labeling # Reactions" width="80" dataField="@numberOfReactionsChannel2">
									<mx:headerRenderer>
									<mx:Component>
										<mx:VBox verticalGap="0" horizontalAlign="center" verticalAlign="middle">
										    <mx:Label text="Cy5 Label"/>
										    <mx:Label text="# reactions"/>
										</mx:VBox>
									</mx:Component>
									</mx:headerRenderer>
								</mx:DataGridColumn>
								<mx:DataGridColumn id="labelCol10"   visible="false" headerText="Channel2 Labeling Status" width="80" dataField="@labelingStatusChannel2">
									<mx:headerRenderer>
									<mx:Component>
										<mx:VBox verticalGap="0" horizontalAlign="center" verticalAlign="middle">
										    <mx:Label text="Cy5 Label"/>
										    <mx:Label text="Status"/>
										</mx:VBox>
									</mx:Component>
									</mx:headerRenderer>
								</mx:DataGridColumn>



								<mx:DataGridColumn visible="{showHybFieldsCheckBox.selected}" headerText="Hyb Slide barcode" width="70" dataField="@slideBarcode"/>
								<mx:DataGridColumn visible="{showHybFieldsCheckBox.selected}" headerText="Coordinate" width="70" dataField="@arrayCoordinateName"/>
								<mx:DataGridColumn visible="{showHybFieldsCheckBox.selected}" headerText="Hyb Protocol" width="70" dataField="@idHybProtocol"
                                     itemRenderer="{LabelDictionary.create(parentApplication.dictionaryManager, 'hci.gnomex.model.HybProtocol', '@idHybProtocol')}"/>                 											
								<mx:DataGridColumn visible="{showHybFieldsCheckBox.selected}" headerText="Hyb Status" width="90" dataField="@hybStatus"/>


								<mx:DataGridColumn visible="{showExtFieldsCheckBox.selected}" headerText="Scan Protocol" width="70" dataField="@idScanProtocol"
                                    itemRenderer="{LabelDictionary.create(parentApplication.dictionaryManager, 'hci.gnomex.model.ScanProtocol', '@idScanProtocol')}"/>                 											
								<mx:DataGridColumn visible="{showExtFieldsCheckBox.selected}" headerText="F/E Protocol" width="70" dataField="@idFeatureExtractionProtocol"
                                     itemRenderer="{LabelDictionary.create(parentApplication.dictionaryManager, 'hci.gnomex.model.FeatureExtractionProtocol', '@idFeatureExtractionProtocol')}"/>                 											
								<mx:DataGridColumn visible="{showExtFieldsCheckBox.selected}" headerText="Ext Status" width="90" dataField="@extractionStatus"/>


							     <mx:DataGridColumn headerText="Slide" visible="{showCy3LabelingFieldsCheckBox.selected || showCy5LabelingFieldsCheckBox.selected || showHybFieldsCheckBox.selected || showExtFieldsCheckBox.selected ? false : true}"  width="320" labelFunction="lookupSlideDesignName" />
							     <mx:DataGridColumn headerText="Slide Source"  visible="{showCy3LabelingFieldsCheckBox.selected || showCy5LabelingFieldsCheckBox.selected || showHybFieldsCheckBox.selected || showExtFieldsCheckBox.selected ? false : true}"   width="82"   
                                  itemRenderer="{LabelDictionary.create(parentApplication.dictionaryManager, 'hci.gnomex.model.SlideSource', '@codeSlideSource')}"/>                 											
								<mx:DataGridColumn headerText="Notes" width="100"  visible="{showCy3LabelingFieldsCheckBox.selected || showCy5LabelingFieldsCheckBox.selected || showExtFieldsCheckBox.selected ? false : true}"   dataField="@notes"/>
							</mx:columns>
						</mx:DataGrid>
					</mx:VBox>
				</mx:VBox>
		    </mx:VBox>
			
		</mx:VBox>
	    
	     



		
	</mx:ViewStack>
	
</mx:VBox>

<mx:ControlBar  width="100%" id="buttonBar">
    <mx:HBox width="100%" horizontalAlign="left">
	    <mx:LinkButton label="Downloads" click="showDownloads()" icon="@Embed(source='../../assets/icon_download.gif')" id="downloadExperimentButton" textDecoration="underline"/>
	    <mx:LinkButton label="Printable form" click="showPrintableRequestForm()" icon="@Embed(source='../../assets/page.png')" id="requestFormButton" textDecoration="underline"/>
	    <mx:LinkButton label="Analysis" icon="@Embed(source='../../assets/map.png')" textDecoration="underline" 
	    	enabled="false" disabledIcon="@Embed(source='../../assets/map_disable.png')" height="21" id="analysisButton" click="showRelatedAnalysis()">
	    </mx:LinkButton>
	    <mx:LinkButton label="Edit" click="showEditExperimentWindow()" icon="@Embed(source='../../assets/tag_blue_edit.png')" textDecoration="underline" id="editButton">
	        <mx:height>{this.selectedExperiment.@canUpdate == &quot;Y&quot; ? 22 : 0}</mx:height>
	        <mx:visible>{this.selectedExperiment.@canUpdate == &quot;Y&quot; ? true : false}</mx:visible>
	    </mx:LinkButton>				
	
    </mx:HBox>
    <mx:HBox width="100%" horizontalAlign="right">
	    <mx:LinkButton label="Delete" click="promptToDeleteExperiment()" icon="@Embed(source='../../assets/delete.png')" textDecoration="underline" id="deleteButton">
	        <mx:height>{this.selectedExperiment.@canDelete == &quot;Y&quot; ? 22 : 0}</mx:height>
	        <mx:visible>{this.selectedExperiment.@canDelete == &quot;Y&quot; ? true : false}</mx:visible>
	    </mx:LinkButton>
    	
    </mx:HBox>
</mx:ControlBar>

<mx:states>
	<mx:State name="MicroarrayState">		 
	</mx:State>
	<mx:State name="QCState">		
		<mx:RemoveChild target="{hybsConfirmContainer}"/>	 
	</mx:State>
	<mx:State name="SolexaState">
		<mx:RemoveChild target="{hybsConfirmContainer}"/>	
		<mx:AddChild relativeTo="{this.confirmContainer}">
				<mx:VBox  id="lanesConfirmContainer"  verticalGap="0" width="100%" height="100%">
						<mx:Label text="{'Sequencing Lanes (' + lanesConfirmGrid.dataProvider.length + ')'}"  fontWeight="bold"/>
						<mx:DataGrid width="100%" height="100%" id="lanesConfirmGrid"  editable="false" dataProvider="{this.selectedExperiment.sequenceLanes.SequenceLane}"  rollOverColor="#C0C0C0" selectionColor="#FFFFB9" horizontalScrollPolicy="auto">
						<mx:columns>
							<mx:DataGridColumn headerText="ID" width="60" dataField="@number"/>
						    <mx:DataGridColumn  headerText="Sample Name"  width="100" labelFunction="getLaneSampleName" editable="false"/>
						    <mx:DataGridColumn  headerText="Sample ID"  width="68" labelFunction="getLaneSampleNumber" editable="false"/>
				            <mx:DataGridColumn  width="150" id="seqRunTypeCol" headerText="Flow Cell Type"  editable="false" dataField="@idSeqRunType" 						             						             
                                    itemRenderer="{LabelDictionary.create(parentApplication.dictionaryManager, 'hci.gnomex.model.SeqRunType', '@idSeqRunType')}"/>                 											
				            <mx:DataGridColumn width="65" id="numberOfSequencingCyclesCol" headerText="# Cycles"   editable="false" dataField="@idNumberSequencingCycles" 						             						             
                                    itemRenderer="{LabelDictionary.create(parentApplication.dictionaryManager, 'hci.gnomex.model.NumberSequencingCycles', '@idNumberSequencingCycles')}"/>                 											
							<mx:DataGridColumn  headerText="Status in Workflow" width="120" dataField="@workflowStatus"/>
				            <mx:DataGridColumn  width="65" id="flowCellNumberCol" headerText="Flow Cell #"  editable="false" dataField="@flowCellNumber"/> 	 					             						             
				            <mx:DataGridColumn  width="55" id="flowCellLaneNumber" headerText="Channel"  editable="false" dataField="@flowCellChannelNumber"/> 						             						             
				            <mx:DataGridColumn  width="90" headerText="# Cycles (actual)"  editable="false" dataField="@numberSequencingCyclesActual"> 						             						             
							   <mx:headerRenderer > 
							    <mx:Component>
							    	<mx:VBox verticalGap="0"   horizontalAlign="center" verticalAlign="middle">
								        <mx:Label text="# Seq Cycles"/>
								        <mx:Label text="(actual)"/>
					    			</mx:VBox>
							    </mx:Component>
							   </mx:headerRenderer>
						    </mx:DataGridColumn>
				            <mx:DataGridColumn  width="90" headerText="Clusters per Tile"  editable="false" dataField="@clustersPerTile"> 						             						             
							   <mx:headerRenderer > 
							    <mx:Component>
							    	<mx:VBox verticalGap="0"   horizontalAlign="center" verticalAlign="middle">
								        <mx:Label text="Clusters per"/>
								        <mx:Label text="Tile"/>
					    			</mx:VBox>
							    </mx:Component>
							   </mx:headerRenderer>
						    </mx:DataGridColumn>
				            <mx:DataGridColumn  width="90"  headerText="File name"  editable="false" dataField="@fileName"/> 						             						             
							<mx:DataGridColumn  headerText="Last Cycle Status" width="90" dataField="@lastCycleStatus"> 
							   <mx:headerRenderer > 
							    <mx:Component>
							    	<mx:VBox verticalGap="0"   horizontalAlign="center" verticalAlign="middle">
								        <mx:Label text="Last Cycle"/>
								        <mx:Label text="Status"/>
					    			</mx:VBox>
							    </mx:Component>
							   </mx:headerRenderer>
						    </mx:DataGridColumn>
				            <mx:DataGridColumn width="150" id="genomeBuildAlignTo" headerText="Genome Build (align to)"  editable="false" dataField="@idGenomeBuildAlignTo" 						             						             
                                    itemRenderer="{LabelDictionary.create(parentApplication.dictionaryManager, 'hci.gnomex.model.GenomeBuild','@idGenomeBuildAlignTo')}"/>                 											
							<mx:DataGridColumn width="150" headerText="Analysis Instructions"   dataField="@analysisInstructions"/>
						</mx:columns> 
					</mx:DataGrid>
					
				</mx:VBox>					        			
		
		</mx:AddChild>
	</mx:State>
</mx:states>
	
</mx:TitleWindow>
