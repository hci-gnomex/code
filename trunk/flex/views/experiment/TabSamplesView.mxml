<?xml version="1.0" encoding="utf-8"?>
<mx:Canvas xmlns:mx="http://www.adobe.com/2006/mxml" 
	label="Samples" width="100%" height="100%"  enabled="false">
<mx:Script>
	<![CDATA[
		import mx.controls.Alert;
		import mx.events.CloseEvent;
		
		public function addSample():void {
			var emptyNode:XML = null;
			if (parentDocument.isSolexaState()) {
				if (parentDocument.sampleSetupView.currentState == 'SolexaSetupPreppedState') {
					emptyNode = new XML("<Sample " +
				    " idSample='" + "Sample" + parentDocument.samples.length + "'" +
				    " name='' description='' " +
				    " canChangeSampleName='Y'" +
				    " canChangeSampleType='Y'" +
				    " canChangeSampleConcentration='Y'" +
				    " canChangeSampleSource='Y'" +
				    " canChangeSamplePrepMethod='Y'" +
   					" canChangeNumberSequencingLanes='Y'" + 
   					" canChangeNumberSequencingCycles='Y'" +
					" concentration='" + parentDocument.sampleSetupView.sampleConcentration.text + "'" +
					" idNumberSequencingCycles='" + parentDocument.sampleSetupView.numberSequencingCyclesCombo.selectedItem.@value + "'" +				
					" idFlowCellType='" + parentDocument.sampleSetupView.flowCellTypeCombo.selectedItem.@value + "'" +				
					" numberSequencingLanes=''" +
					" codeConcentrationUnit='ng/ul'" + 
					" idSampleType='" + parentDocument.sampleSetupView.sampleTypeCombo.selectedItem.@value + "'" +
					" seqPrepByCore = 'N'" +
					" idSamplePrepMethod='" + parentDocument.sampleSetupView.samplePrepMethodCombo.selectedItem.@value + "'" +				
					" idGenomeBuildAlignTo='" + parentDocument.sampleSetupView.genomeBuildCombo.selectedItem.@value + "'" +				
					" analysisInstructions='" + parentDocument.sampleSetupView.analysisInstructions.text + "'" +				
					" fragmentSizeFrom='" + parentDocument.sampleSetupView.fragmentSizeFrom.text + "'" +				
					" fragmentSizeTo='" + parentDocument.sampleSetupView.fragmentSizeTo.text + "'" +				
					" idOrganism='"  + parentDocument.sampleSetupView.sampleOrganismCombo.selectedItem.@value + "'" +				
					" idSampleSource='"  + parentDocument.sampleSetupView.sampleSourceCombo.selectedItem.@value + "'" +				
					" treatment='"  + parentDocument.annotationView.treatmentTextInput.text + "'" +				
					"/>");
					
				} else {
					emptyNode = new XML("<Sample " +
				    " idSample='" + "Sample" + parentDocument.samples.length + "'" +
				    " name='' description='' " +
				    " canChangeSampleName='Y'" +
  				    " canChangeSampleType='Y'" +
				    " canChangeSampleConcentration='Y'" +
				    " canChangeSampleSource='Y'" +
				    " canChangeSamplePrepMethod='Y'" +
   					" canChangeNumberSequencingCycles='Y'" +
					" canChangeNumberSequencingLanes='Y'" + 
					" concentration='" + parentDocument.sampleSetupView.sampleConcentration.text + "'" +
					" idNumberSequencingCycles='" + parentDocument.sampleSetupView.numberSequencingCyclesCombo.selectedItem.@value + "'" +
					" idFlowCellType='" +	parentDocument.sampleSetupView.getDefaultIdFlowCellType() + "'" +			
					" numberSequencingLanes=''" +
					" codeConcentrationUnit='ng/ul'" + 
					" idSampleType='" + parentDocument.sampleSetupView.sampleTypeCombo.selectedItem.@value + "'" +
					" idGenomeBuildAlignTo='" + parentDocument.sampleSetupView.genomeBuildCombo.selectedItem.@value + "'" +				
					" analysisInstructions='" + parentDocument.sampleSetupView.analysisInstructions.text + "'" +				
					" idSamplePrepMethod='" + parentDocument.sampleSetupView.samplePrepMethodCombo.selectedItem.@value + "'" +				
					" seqPrepByCore = 'Y'" +
					" fragmentSizeFrom='" + parentDocument.sampleSetupView.fragmentSizeFrom.text + "'" +				
					" fragmentSizeTo='" + parentDocument.sampleSetupView.fragmentSizeTo.text + "'" +				
					" idOrganism='"  + parentDocument.sampleSetupView.sampleOrganismCombo.selectedItem.@value + "'" +				
					" idSampleSource='"  + parentDocument.sampleSetupView.sampleSourceCombo.selectedItem.@value + "'" +				
					" treatment='"  + parentDocument.annotationView.treatmentTextInput.text + "'" +				
					"/>");
					
				}
				
			}
			else if ((currentState.indexOf('QCSamples') >= 0)) {
				emptyNode = new XML("<Sample " +
			    " idSample='" + "Sample" + parentDocument.samples.length + "'" +
			    " name='' description='' " +
			    " canChangeSampleName='Y'" +
			    " canChangeSampleType='Y'" +
			    " canChangeSampleConcentration='Y'" +
			    " canChangeSampleSource='Y'" +
			    " canChangeSamplePrepMethod='Y'" +
  				" canChangeNumberSequencingCycles='Y'" +
				" canChangeNumberSequencingLanes='Y'" + 
				" concentration='" + parentDocument.sampleSetupView.sampleConcentration.text + "'" +
				" codeConcentrationUnit='ng/ul'" + 
				" codeBioanalyzerChipType='" + parentDocument.sampleSetupView.getSelectedCodeBioanalyzerChipType() + "'" +
				" idSampleType='" + parentDocument.sampleSetupView.sampleTypeCombo.selectedItem.@value + "'" +
				" idSamplePrepMethod='" + parentDocument.sampleSetupView.samplePrepMethodCombo.selectedItem.@value + "'" +				
				" treatment='" + parentDocument.annotationView.treatmentTextInput.text + "'" +				
				"/>");
			
			} else {
				emptyNode = new XML("<Sample " +
			    " idSample='" + "Sample" + parentDocument.samples.length + "'" +
			    " name='' description='' " +
			    " canChangeSampleName='Y'" +
			    " canChangeSampleType='Y'" +
			    " canChangeSampleConcentration='Y'" +
			    " canChangeSampleSource='Y'" +
			    " canChangeSamplePrepMethod='Y'" +
  				" canChangeNumberSequencingCycles='Y'" +
				" canChangeNumberSequencingLanes='Y'" + 
				" concentration='" + parentDocument.sampleSetupView.sampleConcentration.text + "'" +
				" codeConcentrationUnit='ng/ul'" + 
				" idSampleType='" + parentDocument.sampleSetupView.sampleTypeCombo.selectedItem.@value + "'" +
				" idSamplePrepMethod='" + parentDocument.sampleSetupView.samplePrepMethodCombo.selectedItem.@value + "'" +				
				" idOrganism='"  + parentDocument.sampleSetupView.sampleOrganismCombo.selectedItem.@value + "'" +				
				" idSampleSource='"  + parentDocument.sampleSetupView.sampleSourceCombo.selectedItem.@value + "'" +				
				" treatment='"  + parentDocument.annotationView.treatmentTextInput.text + "'" +				
				"/>");
			}
			
			parentDocument.samples.addItem(emptyNode);
	        	
		}
		
		private function deleteSample():void {
			parentDocument.dirty.setDirty();
			if (samplesGrid.selectedItems.length > 0) {
				for each(var sample:Object in samplesGrid.selectedItems) {					
					if (sample.@idSample.indexOf("Sample") < 0) {
						Alert.show("Existing sample " + sample.@number + " cannot be deleted from the experiment.");
						continue;
					}		
		
					for each(var hyb:Object in parentDocument.hybs) {
						if (hyb.@idSampleChannel1 == sample.@idSample) {
							hyb.@idSampleChannel1 = '0';
						}
						if (hyb.@idSampleChannel2 == sample.@idSample) {
							hyb.@idSampleChannel2 = '0';
						}
					}
					for each(var lane:Object in parentDocument.getLanes(sample, -1)) {
						parentDocument.lanes.removeItemAt(parentDocument.lanes.getItemIndex(lane));
					}
					parentDocument.samples.removeItemAt(parentDocument.samples.getItemIndex(sample));
					
				}
			}
			if (parentDocument.isMicroarrayState()) {
				parentDocument.hybsView.hybsGrid.invalidateList();
				parentDocument.hybsView.hybsGrid.invalidateDisplayList();
			}
		}
		
		private function copySample():void {
			parentDocument.dirty.setDirty();
			if (samplesGrid.selectedIndex != -1) {
				for each(var i:int in samplesGrid.selectedIndices) {					
					var sampleToCopy:Object = parentDocument.samples[i];
					
					var emptyNode:XML = new XML("<Sample " +
					" idSample='" + "Sample" + parentDocument.samples.length + "'" +
					" name='" + sampleToCopy.@name + "'" + 
					" canChangeSampleName='Y'" +
			    	" canChangeSampleType='Y'" +
			   	 	" canChangeSampleConcentration='Y'" +
			    	" canChangeSampleSource='Y'" +
			    	" canChangeSamplePrepMethod='Y'" +
					" canChangeNumberSequencingLanes='Y'" + 
					" description='" + sampleToCopy.@description + "'" + 
					" idSampleType='" + sampleToCopy.@idSampleType + "'" +
					" idSamplePrepMethod='" + sampleToCopy.@idSamplePrepMethod + "'" +				
					" fragmentSizeFrom='" + sampleToCopy.@fragmentSizeFrom + "'" +				
					" fragmentSizeTo='" + sampleToCopy.@fragmentSizeTo + "'" +				
					" idOrganism='" + sampleToCopy.@idOrganism + "'" +				
					" idSampleSource='" + sampleToCopy.@idSampleSource + "'" +				
					" concentration='" + sampleToCopy.@concentration + "'" +				
					" treatment='" + sampleToCopy.@treatment + "'" +		
					" seqPrepByCore='" + sampleToCopy.@seqPrepByCore + "'" +		
					" codeConcentrationUnit='" + sampleToCopy.@codeConcentrationUnit + "'" +				
					" codeBioanalyzerChipType='" + sampleToCopy.@codeBioanalyzerChipType + "'" +				
					" idGenomeBuildAlignTo='" + sampleToCopy.@idGenomeBuildAlignTo+ "'" +				
					" idNumberSequencingCycles='" + sampleToCopy.@idNumberSequencingCycles+ "'" +				
					" idFlowCellType='" + sampleToCopy.@idFlowCellType + "'" +				
					" numberSequencingLanes='" + sampleToCopy.@numberSequencingLanes + "'" +
					" AGE='" + sampleToCopy.@AGE + "'" +				
					" CELLLINE='" + sampleToCopy.@CELLLINE + "'" +				
					" CELLTYPE='" + sampleToCopy.@CELLTYPE + "'" +				
					" CLININFO='" + sampleToCopy.@CLININFO + "'" +				
					" COMPOUND='" + sampleToCopy.@COMPOUND + "'" +				
					" DISSTATE='" + sampleToCopy.@DISSTATE + "'" +				
					" DOSE='" + sampleToCopy.@DOSE + "'" +				
					" GENMOD='" + sampleToCopy.@GENMOD + "'" +				
					" GENOTYPE='" + sampleToCopy.@GENOTYPE + "'" +				
					" INDIV='" + sampleToCopy.@INDIV + "'" +				
					" GROWTHCOND='" + sampleToCopy.@GROWTHCOND + "'" +				
					" ORGPART='" + sampleToCopy.@ORGPART + "'" +				
					" OTHER='" + sampleToCopy.@OTHER + "'" +				
					" SEX='" + sampleToCopy.@SEX + "'" +				
					" TEMP='" + sampleToCopy.@TEMP + "'" +				
					" TIME='" + sampleToCopy.@TIME + "'" +				
					"/>");
			
					parentDocument.samples.addItem(emptyNode);
					
				}
			}
		}
       	public function initializeSamplesGrid():void {
        	if (parentDocument.requestToClone != null) {
        		return;
        	}
       		if (!parentDocument.sampleSetupView.checkSampleSetupCompleteness()) {
       			return;
       		}
        	
    		var numberOfSamplesToAdd:Number = new Number(parentDocument.sampleSetupView.numberOfSamples.text);
    		if(parentDocument.samples.length <= numberOfSamplesToAdd) {
    			numberOfSamplesToAdd = numberOfSamplesToAdd - parentDocument.samples.length;
    		} else {
    			numberOfSamplesToAdd = 0;
    		}
    		for(var x:int = 0; x < numberOfSamplesToAdd; x++) {
    			addSample();
    		}
        }
        
        
        
		
		
		public function promptToClearAllSamples():void {
			Alert.show("Remove all samples currently showing in list?",
						null, 
						(Alert.YES | Alert.NO), this, 
						onPromptToClearAllSamples);
			
		}
		
		private function onPromptToClearAllSamples(event:CloseEvent):void {
            if (event.detail==Alert.YES) {
            	parentDocument.samples.removeAll();
            	parentDocument.lanes.removeAll();
            	checkSamplesCompleteness();
            }
        }		
        
        public function checkSamplesCompleteness():void {
        	var completeCount:int = 0;
        	for each(var sample:Object in parentDocument.samples) {
        		if (currentState.indexOf('SolexaSamples') >= 0) {
        			if (sample.@name != null && sample.@name != '' &&
		        		sample.@idSampleType != null && sample.@idSampleType != '' &&
		        		sample.@idSamplePrepMethod != null && sample.@idSamplePrepMethod != '' &&
		        		sample.@concentration != null && sample.@concentration != '' &&
		        		sample.@fragmentSizeFrom != null && sample.@fragmentSizeFrom != '' &&
		        		sample.@fragmentSizeTo != null && sample.@fragmentSizeTo != '' &&
		        		sample.@idSampleSource != null && sample.@idSampleSource != '' &&
		        		sample.@idOrganism != null && sample.@idOrganism != '' &&
		        		sample.@idFlowCellType != null && sample.@idFlowCellType != '' &&
		        		sample.@idNumberSequencingReactions != null && sample.@idNumberSequencingReactions != '') {
		        				
		        		if (!parentDocument.isEditState()) {
	        				if (sample.@numberSequencingLanes != '') {
	        					completeCount++;
	        				}		
	        			} else {
	        				completeCount++;
	        			}
		        	}
		        } else if (currentState.indexOf('QCSamples') >= 0){
	        		if (sample.@name != null && sample.@name != '' &&
	        			sample.@idSampleType != null && sample.@idSampleType != '' &&
	        			sample.@idSamplePrepMethod != null && sample.@idSamplePrepMethod != '' &&
	        			sample.@concentration != null && sample.@concentration != '' &&
	        			sample.@codeConcentrationUnit != null && sample.@codeConcentrationUnit != '' &&
	        			sample.@codeBioanalyzerChipType != null && sample.@codeBioanalyzerChipType != '') {
	        			completeCount++;       				
	        		}
        		} else {
	        		if (sample.@name != null && sample.@name != '' &&
	        			sample.@idSampleType != null && sample.@idSampleType != '' &&
	        			sample.@idSamplePrepMethod != null && sample.@idSamplePrepMethod != '' &&
	        			sample.@concentration != null && sample.@concentration != '' &&
	        			sample.@idSampleSource != null && sample.@idSampleSource != '' &&
	        			sample.@idOrganism != null && sample.@idOrganism != '') {
	        			completeCount++;       				
	        		}
        			
        		}
        	}
        	
        	
        	var isComplete:Boolean = false;
        	if (parentDocument.samples.length > 0 && completeCount == parentDocument.samples.length) {
        		isComplete = true;
        	} else if (parentDocument.request != null && parentDocument.request.@idRequest != '0') {
        		isComplete = true;
        	}
        	
        	// If this is a Solexa request and the sample setup is complete,
        	// create the sequencing lanes based on the number of lanes 
        	// entered for each sample.
        	if (isComplete && currentState =='SolexaSamplesState') {
        		var isValidNumberSeqLanes:Boolean = true;
        		for each (var s:Object in parentDocument.samples) {
    				if (s.@numberSequencingLanes > 100) {
    					callLater(showMaxLaneError, [s.@numberSequencingLanes]);
    					isValidNumberSeqLanes = false;
    					break;
    				}
        		}
        		if (isValidNumberSeqLanes) {
	        		for each (var theSample:Object in parentDocument.samples) {
	        			var numberLanesForSample:int = parentDocument.getLaneCount(theSample);
	        			if (numberLanesForSample < theSample.@numberSequencingLanes) {
		        			var numberLanesToAdd:int = theSample.@numberSequencingLanes - numberLanesForSample;
		        			for (var x:Number = 0; x < numberLanesToAdd; x++) {
		        				addSequencingLaneForSample(theSample);
		        			}
	        			} else if (numberLanesForSample > theSample.@numberSequencingLanes) {
	        				var numberLanesToRemove:int = numberLanesForSample - theSample.@numberSequencingLanes;
							for each(var lane:Object in parentDocument.getLanes(theSample, numberLanesToRemove)) {
								parentDocument.lanes.removeItemAt(parentDocument.lanes.getItemIndex(lane));
							}
	        			}
	        				
	        		}
        		}
        	}

        	
        	
			if (parentDocument.theTab.contains(parentDocument.hybSetupView)) {
        		parentDocument.hybSetupView.enabled = isComplete;
    		} if (parentDocument.isSolexaEditState()) {
    			parentDocument.lanesView.enabled = isComplete;
    		} else {
    			if (parentDocument.theTab.contains(parentDocument.confirmView)) {
	    			parentDocument.confirmView.enabled = isComplete;
    			}
    		}        	
    		parentDocument.enableNextButtons();
    		

			callLater(postSamplesCompleteness, [isComplete]);
        	
        
        }
        
        private function showMaxLaneError(numberSeqLanes:String):void {
			Alert.show("Number of lanes to sequence " + numberSeqLanes + " is too large.");
        }
        
                
        private function postSamplesCompleteness(isComplete:Boolean):void {
	    		
	    	if (!isComplete) {
	        	if (parentDocument.theTab.contains(parentDocument.hybSetupView)) {
		        	parentDocument.hybSetupView.enabled = false;
	        	} 
	
	        	if (parentDocument.theTab.contains(parentDocument.hybsView)) {
		        	parentDocument.hybsView.enabled = false;
	        	} 
	        	
	        	if (parentDocument.isSolexaEditState()) {
	    			parentDocument.lanesView.enabled = false;
	        	}
	
	        	parentDocument.confirmView.enabled = false;
    		} else {
    			if (parentDocument.theTab.contains(parentDocument.hybSetupView)) {
	    			parentDocument.hybSetupView.checkHybSetupCompleteness();
	    			this.refreshHybsGrid();    				
    			} 
    			if (parentDocument.isSolexaState() && !parentDocument.isEditState()) {
    				this.refreshLanesGrid();
    			}
    		}
        	
        }
		
		private function addSequencingLaneForSample(sample:Object):void {
			var emptyNode:XML = new XML("<SequenceLane " +
			    " idSequenceLane='" + "SequenceLane" + parentDocument.lanes.length + "'" +
			    " notes='' " + 
				" idFlowCellType='" + sample.@idFlowCellType + "'" +
				" idNumberSequencingCycles='" + sample.@idNumberSequencingCycles + "'" +
				" idSample='" + sample.@idSample + "'" +
				" idGenomeBuildAlignTo='" + sample.@idGenomeBuildAlignTo + "'" +
				" analysisInstructions='" + sample.@analysisInstructions + "'" +
				"/>");
			
			parentDocument.lanes.addItem(emptyNode);
		}
		

		public function propagateSamplePrepMethod(idSamplePrepMethod:String):void {
			if (currentState.indexOf('SolexaSamples') >= 0) {
				for each (var sample:Object in parentDocument.samples) {
					sample.@idSamplePrepMethod = idSamplePrepMethod;
				}
			}
		}
		public function propagateOrganism(idOrganism:String):void {
			if (currentState.indexOf('SolexaSamples') >= 0) {
				for each (var sample:Object in parentDocument.samples) {
					sample.@idOrganism = idOrganism;
				}
			}
		}
		public function propagateFlowCellType(idFlowCellType:String):void {
			if (currentState.indexOf('SolexaSamples') >= 0) {
				for each (var sample:Object in parentDocument.samples) {
					sample.@idFlowCellType = idFlowCellType;
				}
			}
		}
		public function propagateNumberSequencingCycles(theSample:Object):void {
			if (currentState.indexOf('SolexaSamples') >= 0) {
				for each(var lane:Object in parentDocument.getLanes(theSample, -1)) {
					lane.@idNumberSequencingCycles = theSample.@idNumberSequencingCycles;
				}
			}
		}		
 		public function propagateSolexaLibraryType(idSolexaLibraryType:String):void {
			if (currentState.indexOf('SolexaSamples') >= 0) {
				for each (var sample:Object in parentDocument.samples) {
					sample.@idSolexaLibraryType = idSolexaLibraryType;
				}
			}
		}       
		public function propagateFragmentSizeFrom(fragmentSizeFrom:String):void {
			if (currentState.indexOf('SolexaSamples') >= 0) {
				for each (var sample:Object in parentDocument.samples) {
					sample.@fragmentSizeFrom = fragmentSizeFrom;
				}
			}
		}		
		public function propagateFragmentSizeTo(fragmentSizeTo:String):void {
			if (currentState.indexOf('SolexaSamples') >= 0) {
				for each (var sample:Object in parentDocument.samples) {
					sample.@fragmentSizeTo = fragmentSizeTo;
				}
			}
		}		
        public function showHideColumns():void {
        	sampleNumberCol.visible = parentDocument.isEditState();
        	sampleRowNumberCol.visible = !parentDocument.isEditState();
        	this.showQCFieldsCheckBox.visible = parentDocument.isEditState();
        	
        	if (showQCFieldsCheckBox.selected) {
        		numberSequencingLanesCol.visible = false;
				numberSequencingCyclesCol.visible = false;
				idFlowCellTypeCol.visible = false; 
				concentrationUnitColumn.visible = false;
				sampleSourceColumn.visible = false;
				sampleOrganismColumn.visible = false;
				chipTypeColumn.visible = false; 
				samplePrepMethodCol.visible = false;
				preppedByCoreCol.visible = false;
        	} else if (currentState.indexOf('SolexaSamples') >= 0 ) {
        		numberSequencingLanesCol.visible = !parentDocument.isEditState();
				numberSequencingCyclesCol.visible = !parentDocument.isEditState();
				preppedByCoreCol.visible = true;
				idFlowCellTypeCol.visible = !parentDocument.isEditState(); 
				concentrationUnitColumn.visible = false;
				sampleOrganismColumn.visible = true;
				sampleSourceColumn.visible = true;
				chipTypeColumn.visible = false; 
				samplePrepMethodCol.visible = true;
				fragmentSizeFromCol.visible = true;
				fragmentSizeToCol.visible = true;

			} else if (currentState.indexOf('QCSamples') >= 0) {
        		numberSequencingLanesCol.visible = false;
				numberSequencingCyclesCol.visible = false;
				preppedByCoreCol.visible = false;
				idFlowCellTypeCol.visible = false; 
				concentrationUnitColumn.visible = true;
				sampleSourceColumn.visible = false;
				sampleOrganismColumn.visible = false;
				samplePrepMethodCol.visible = true;
				chipTypeColumn.visible = true; 
				fragmentSizeFromCol.visible = false;
				fragmentSizeToCol.visible = false;
			} else {
        		numberSequencingLanesCol.visible = false;
				numberSequencingCyclesCol.visible = false;
				preppedByCoreCol.visible = false;
				idFlowCellTypeCol.visible = false; 
				concentrationUnitColumn.visible = false;
				sampleSourceColumn.visible = true;
				sampleOrganismColumn.visible = true;
				samplePrepMethodCol.visible = true;
				chipTypeColumn.visible = false; 
				fragmentSizeFromCol.visible = false;
				fragmentSizeToCol.visible = false;
			}
			
			if (!parentDocument.isEditState()) {
				parentDocument.confirmView.showHideColumns();				
			}
  						
        }
		private function refreshHybsGrid():void {
 		    parentDocument.hybsView.hybsGrid.invalidateList();
	        parentDocument.hybsView.hybsGrid.invalidateDisplayList();
	        if (!parentDocument.isEditState()) {
		        parentDocument.confirmView.hybsGridConfirm.invalidateList();
		        parentDocument.confirmView.hybsGridConfirm.invalidateDisplayList();
	        }
		}
		private function refreshLanesGrid():void {
 		    parentDocument.lanesConfirmGrid.invalidateList();
 		    parentDocument.lanesConfirmGrid.invalidateDisplayList();
		}
		
		public function onEdit():void {
			parentDocument.dirty.setDirty();
		}
        
	]]>
</mx:Script>	
	<mx:VBox width="100%" height="100%">
			<mx:HBox id="headerContainer" width="100%">
				<mx:Label id="samplesTitle" text="Samples  (fields in pink are required.)"/>
				<mx:HBox width="100%" horizontalAlign="right">
					<mx:CheckBox id="showQCFieldsCheckBox" label="Show QC columns"  visible="false" click="showHideColumns()">
					</mx:CheckBox>							
				</mx:HBox>
			</mx:HBox>
			<mx:HBox id="buttonsContainer">
				<mx:Button click="addSample();checkSamplesCompleteness()" icon="@Embed(source='../../assets/add.png')" id="addSampleButton" toolTip="Add sample" width="24"/>
				<mx:Button click="copySample();checkSamplesCompleteness()" icon="@Embed('../../assets/table_multiple.png')" id="copySampleButton" toolTip="Copy sample(s)" width="24"/>
				<mx:Button click="deleteSample();checkSamplesCompleteness();parentDocument.hybsView.checkHybsCompleteness()" icon="@Embed(source='../../assets/delete.png')" id="deleteSampleButton" toolTip="Delete sample(s)" width="24"/>
				<mx:Button click="promptToClearAllSamples();deleteSample();" icon="@Embed('../../assets/folder_delete.png')" id="clearSamplesButton" toolTip="Clear all samples" width="24"/>
			</mx:HBox>
					
			<mx:DataGrid width="100%" height="100%" id="samplesGrid"  editable="true" dataProvider="{parentDocument.samples}" 
				allowMultipleSelection="true" itemFocusOut="checkSamplesCompleteness()" 
				selectionColor="#FFFFB9" rollOverColor="#C0C0C0"
				horizontalScrollPolicy="auto">
				<mx:columns>
  			        <mx:DataGridColumn id="sampleRowNumberCol" visible="true" editable="false" headerText=""  width="25" resizable="false" labelFunction="parentDocument.getSamplesGridRowNumber"/>
					<mx:DataGridColumn id="sampleNumberCol" headerText="ID" width="60" visible="true"  dataField="@number"  editable="false"/>
					<mx:DataGridColumn headerText="Name" width="100" editorDataField="text" dataField="@name"  editable="true" itemRenderer="views.renderers.LabelSampleName"  itemEditor="views.renderers.TextInputSampleName" rendererIsEditor="false">
					</mx:DataGridColumn>
	 				<mx:DataGridColumn headerText="Conc." visible="{!showQCFieldsCheckBox.selected}"  width="60" dataField="@concentration" editorDataField="text"  itemRenderer="views.renderers.LabelConcentration"  itemEditor="views.renderers.TextInputConcentration" rendererIsEditor="false"/>
	                <mx:DataGridColumn id="concentrationUnitColumn" visible="{!showQCFieldsCheckBox.selected}" width="74" headerText="Unit" dataField="@codeConcentrationUnit" 
	                   editorDataField="value" sortable="false" editable="true" rendererIsEditor="false" itemRenderer="views.renderers.LabelConcentrationUnit" itemEditor="views.renderers.ComboBoxConcentrationUnit" labelFunction="parentApplication.lookupConcentrationUnit" />
					<mx:DataGridColumn id="fragmentSizeFromCol" headerText="Size From" width="54" editorDataField="text" dataField="@fragmentSizeFrom" itemRenderer="views.renderers.LabelFragmentSizeFrom"  itemEditor="views.renderers.TextInputFragmentSizeFrom" rendererIsEditor="false">
					</mx:DataGridColumn>
					<mx:DataGridColumn id="fragmentSizeToCol" headerText="Size To" width="54" editorDataField="text" dataField="@fragmentSizeTo" itemRenderer="views.renderers.LabelFragmentSizeTo"  itemEditor="views.renderers.TextInputFragmentSizeTo" rendererIsEditor="false">
					</mx:DataGridColumn>
	 				<mx:DataGridColumn headerText="Flow Cell Type" id="idFlowCellTypeCol" visible="{currentState == 'SolexaSamplesState'}"  editable="false" width="150" labelFunction="parentApplication.lookupFlowCellType" dataField="@idFlowCellType"/>
	 				<mx:DataGridColumn headerText="# Seq Cycles" id="numberSequencingCyclesCol" visible="{currentState == 'SolexaSamplesState'}"  width="84" dataField="@idNumberSequencingCycles" labelFunction="parentApplication.lookupNumberSequencingCycles"
	 					 rendererIsEditor="false" editorDataField="value" itemRenderer="views.renderers.LabelNumberSequencingCycles" itemEditor="views.renderers.ComboBoxNumberSequencingCyclesSample"/>
					<mx:DataGridColumn id="numberSequencingLanesCol" headerText="# Lanes to Sequence" width="128" editorDataField="text" dataField="@numberSequencingLanes" itemRenderer="views.renderers.LabelNumberSequencingLanes"  itemEditor="views.renderers.TextInputNumberSequencingLanes" rendererIsEditor="false">
					</mx:DataGridColumn>
					<mx:DataGridColumn id="preppedByCoreCol" headerText="Core to prep lib?"   visible="{true}" width="104"  dataField="@seqPrepByCore" editable="false"/>
                    <mx:DataGridColumn id="samplePrepMethodCol" headerText="Sample Prep Method" visible="{!showQCFieldsCheckBox.selected}"  width="180" dataField="@idSamplePrepMethod" 
	                   editorDataField="value" sortable="false" editable="true" rendererIsEditor="false" itemRenderer="views.renderers.LabelSamplePrepMethod" labelFunction="parentApplication.lookupSamplePrepMethod" itemEditor="views.renderers.ComboBoxSamplePrepMethod" />
	                 <mx:DataGridColumn headerText="Sample Type" visible="{!showQCFieldsCheckBox.selected}" width="120"   dataField="@idSampleType" 
	                   editorDataField="value" sortable="false" editable="true" rendererIsEditor="false" itemRenderer="views.renderers.LabelSampleType" itemEditor="views.renderers.ComboBoxSampleType" labelFunction="parentApplication.lookupSampleTypeName" />
	                <mx:DataGridColumn id="sampleOrganismColumn" visible="{!showQCFieldsCheckBox.selected}" width="110" headerText="Organism"  dataField="@idOrganism" 
	                    editorDataField="value" sortable="false" editable="true" rendererIsEditor="false" itemRenderer="views.renderers.LabelOrganism" itemEditor="views.renderers.ComboBoxOrganism" labelFunction="parentApplication.lookupOrganism" />
	                <mx:DataGridColumn headerText="Sample Source" visible="{!showQCFieldsCheckBox.selected}" width="95" dataField="@idSampleSource" 
	                   editorDataField="value" id="sampleSourceColumn" sortable="false" editable="true" rendererIsEditor="false" itemRenderer="views.renderers.LabelSampleSource" itemEditor="views.renderers.ComboBoxSampleSource" labelFunction="parentApplication.lookupSampleSource" />
	                <mx:DataGridColumn id="chipTypeColumn" visible="{showQCFieldsCheckBox.selected || parentDocument.request.@codeRequestCategory != 'QC' ? false : true}" headerText="Chip Type" width="150" dataField="@codeBioanalyzerChipType" 
	                   editorDataField="value" sortable="false" editable="true" rendererIsEditor="false" itemRenderer="mx.controls.Label" labelFunction="parentApplication.lookupChipType" itemEditor="views.renderers.ComboBoxChipType" />

					<mx:DataGridColumn visible="{showQCFieldsCheckBox.selected}" editable="{parentApplication.hasPermission('canWriteAnyObject')}" headerText="QC Conc." width="70" dataField="@qualCalcConcentration"/>
					<mx:DataGridColumn visible="{showQCFieldsCheckBox.selected}" editable="{parentApplication.hasPermission('canWriteAnyObject')}" headerText="QC 260/230" width="80" dataField="@qual260nmTo230nmRatio"/>
					<mx:DataGridColumn visible="{showQCFieldsCheckBox.selected}" editable="{parentApplication.hasPermission('canWriteAnyObject')}" headerText="QC 260/280" width="80" dataField="@qual260nmTo280nmRatio"/>
					<mx:DataGridColumn visible="{showQCFieldsCheckBox.selected}" editable="{parentApplication.hasPermission('canWriteAnyObject')}" headerText="QC 28s/18s" width="80" dataField="@qual28sTo18sRibosomalRatio"/>
					<mx:DataGridColumn visible="{showQCFieldsCheckBox.selected}" editable="{parentApplication.hasPermission('canWriteAnyObject')}" headerText="QC RIN" width="70" dataField="@qualRINNumber"/>
					<mx:DataGridColumn visible="{showQCFieldsCheckBox.selected}" headerText="QC Status" width="90" dataField="@qualStatus"
	                   editorDataField="value" sortable="false" editable="true" rendererIsEditor="false" itemEditor="views.renderers.ComboBoxQCStatus" itemRenderer="mx.controls.Label" />
	                   				                   
					<mx:DataGridColumn id="AGE" headerText="Age" dataField="@AGE" editable="true" visible="{parentDocument.request.@AGE == 'Y'}"/>
					<mx:DataGridColumn id="CELLLINE" headerText="Cell line" dataField="@CELLLINE" editable="true" visible="{parentDocument.request.@CELLLINE == 'Y'}"/>
					<mx:DataGridColumn id="CELLTYPE" headerText="Cell Type" dataField="@CELLTYPE" editable="true" visible="{parentDocument.request.@CELLTYPE == 'Y'}"/>
					<mx:DataGridColumn id="CLININFO" headerText="Clinical Info" dataField="@CLININFO" editable="true" visible="{parentDocument.request.@CLININFO == 'Y'}"/>
					<mx:DataGridColumn id="COMPOUND" headerText="Compound" dataField="@COMPOUND" editable="true" visible="{parentDocument.request.@COMPOUND == 'Y'}"/>
					<mx:DataGridColumn id="DISSTATE" headerText="Disease State" dataField="@DISSTATE" editable="true" visible="{parentDocument.request.@DISSTATE == 'Y'}"/>
					<mx:DataGridColumn id="DOSE" headerText="Dose" dataField="@DOSE" editable="true" visible="{parentDocument.request.@DOSE == 'Y'}"/>
					<mx:DataGridColumn id="GENMOD" headerText="Genetic Modification" dataField="@GENMOD" editable="true" visible="{parentDocument.request.@GENMOD == 'Y'}"/>
					<mx:DataGridColumn id="GENOTYPE" headerText="Genotype" dataField="@GENOTYPE" editable="true" visible="{parentDocument.request.@GENOTYPE == 'Y'}"/>
					<mx:DataGridColumn id="GROWTHCOND" headerText="Growth Conditions" dataField="@GROWTHCOND" editable="true" visible="{parentDocument.request.@GROWTHCOND == 'Y'}"/>
					<mx:DataGridColumn id="INDIV" headerText="Individual" dataField="@INDIV" editable="true" visible="{parentDocument.request.@INDIV == 'Y'}"/>
					<mx:DataGridColumn id="ORGPART" headerText="Organ / Tissue" dataField="@ORGPART" editable="true" visible="{parentDocument.request.@ORGPART == 'Y'}"/>
					<mx:DataGridColumn id="SEX" headerText="Sex" dataField="@SEX" editable="true" visible="{parentDocument.request.@SEX == 'Y'}"/>
					<mx:DataGridColumn id="TEMP" headerText="Temperature" dataField="@TEMP" editable="true" visible="{parentDocument.request.@TEMP == 'Y'}"/>
					<mx:DataGridColumn id="TIME" headerText="Time Course" dataField="@TIME" editable="true" visible="{parentDocument.request.@TIME == 'Y'}"/>
					<mx:DataGridColumn id="otherDataColumn" headerText="Other" dataField="@OTHER" editable="true" visible="{parentDocument.request.@OTHER == 'Y'}"/>
					<mx:DataGridColumn id="treatmentColumn" headerText="Treatment" visible="{parentDocument.request.@treatment == 'Y' ? true : false}" width="100" dataField="@treatment"/>
					<mx:DataGridColumn headerText="Description" width="100" dataField="@description"/>
				</mx:columns>
			</mx:DataGrid>

			
		
	</mx:VBox>
	
	<mx:states>
		<mx:State name="SamplesEditState" >
			<mx:RemoveChild target="{buttonsContainer}"/>
		</mx:State>

		<mx:State name="SamplesAdminState">
		</mx:State>


		<mx:State name="SolexaSamplesState" >
		</mx:State>
		<mx:State name="SolexaSamplesEditState" basedOn="SamplesEditState" >
		</mx:State>
		<mx:State name="SolexaSamplesAdminState" basedOn="SamplesAdminState" >
			<mx:RemoveChild target="{addSampleButton}"/>
			<mx:RemoveChild target="{clearSamplesButton}"/>
		</mx:State>

		<mx:State name="QCSamplesState" >
		</mx:State>
		<mx:State name="QCSamplesEditState" basedOn="SamplesEditState" >
		</mx:State>
		<mx:State name="QCSamplesAdminState" basedOn="SamplesAdminState" >
			<mx:RemoveChild target="{clearSamplesButton}"/>
			<mx:RemoveChild target="{addSampleButton}"/>
		</mx:State>

		<mx:State name="MicroarraySamplesState" >
		</mx:State>
		<mx:State name="MicroarraySamplesEditState" basedOn="SamplesEditState" >
		</mx:State>
		<mx:State name="MicroarraySamplesAdminState" basedOn="SamplesAdminState" >
			<mx:RemoveChild target="{addSampleButton}"/>
			<mx:RemoveChild target="{clearSamplesButton}"/>
		</mx:State>


		
	</mx:states>
	
</mx:Canvas>
