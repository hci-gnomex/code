<?xml version="1.0" encoding="utf-8"?>
<mx:Panel xmlns:mx="http://www.adobe.com/2006/mxml"     
	xmlns:SubmitRequestView="SubmitRequestView.*" 
    xmlns:views="views.*"
	label="Submit Request" width="100%" height="100%" 
	>
    <mx:states>
        <mx:State name="SolexaBaseState">
            <mx:RemoveChild target="{hybSetupView}"/>
            <mx:RemoveChild target="{hybsView}"/>
            <mx:RemoveChild target="{bioanalyzerContainer}"/>
            <mx:RemoveChild target="{hybsConfirmContainer}"/>
            <mx:AddChild relativeTo="{samplesConfirmContainer}" position="after">
				<mx:VBox  id="lanesConfirmContainer"  verticalGap="0" width="100%" height="100%">
						<mx:Label text="{lanes.length + ' Sequencing Lanes'}"/>
						<mx:DataGrid width="100%" height="100%" id="lanesConfirmGrid"  editable="false" dataProvider="{lanes}"  rollOverColor="#C0C0C0" selectionColor="#FFFFB9" horizontalScrollPolicy="auto">
						<mx:columns>
						    <mx:DataGridColumn editable="false" headerText=""   resizable="false" width="25" labelFunction="getLanesGridRowNumber"/>
						    <mx:DataGridColumn  headerText="Sample"  width="222" labelFunction="getLaneSampleName" editable="false"/>
				             <mx:DataGridColumn  width="200" id="flowCellTypeCol" headerText="Flow Cell Type"  labelFunction="parentApplication.lookupFlowCellType" editable="false" dataField="@idFlowCellType"/> 						             						             
				             <mx:DataGridColumn width="65" id="numberOfSequencingCyclesCol" headerText="# Cycles"   labelFunction="parentApplication.lookupNumberSequencingCycles" editable="false" dataField="@idNumberSequencingCycles"/> 						             						             
							<mx:DataGridColumn width="150" headerText="Notes"   dataField="@notes"/>
						</mx:columns>
					</mx:DataGrid>
					
				</mx:VBox>					        			
            
            </mx:AddChild>
            <mx:AddChild relativeTo="{samplesView}" position="after">
            	<mx:Canvas label="Sequencing Lanes" id="lanesView" enabled="false">
            		<mx:VBox id="lanesSetupContainer" width="100%" height="100%" verticalGap="6">
            			<mx:HBox id="laneFlowCellContainer">
							<mx:Image source="assets/bullet_orange.png"/>
            				<mx:Label width="230" text="Select the type of flow cell to be used:"/>
            				<mx:ComboBox id="flowCellTypeCombo" labelField="@display" change="initializeLanesGrid();propagateFlowCellType()">
            					<mx:dataProvider>{parentApplication.manageDictionaries.lastResult.Dictionary.(@className == 'hci.gnomex.model.FlowCellType').DictionaryEntry}</mx:dataProvider>
            				</mx:ComboBox>
            				<mx:Spacer width="10"/>
            				<mx:HBox>
            					<mx:Label width="300" text="Select the minimum number of sequencing cycles:"/>
            					<mx:ComboBox id="numberSequencingCyclesCombo" labelField="@display" change="initializeLanesGrid();propagateNumberSequencingCycles()">
            						<mx:dataProvider>{parentApplication.manageDictionaries.lastResult.Dictionary.(@className == 'hci.gnomex.model.NumberSequencingCycles').DictionaryEntry}</mx:dataProvider>
            					</mx:ComboBox>
            				</mx:HBox>
            			</mx:HBox>
            			<mx:HDividedBox width="100%" height="100%" paddingTop="10">
					        <mx:Panel  title="Samples" height="100%" verticalGap="4">
					        	<views:DataGrid
					        		dragProxyImage="views.DataGridSampleDragProxy" 
					        		 height="100%" width="100%" 
					        		 dataProvider="{samples}" labelField="@name" 
					        		 dragEnabled="true" id="sampleLaneDragGrid" selectionColor="#FFFFB9" rollOverColor="#C0C0C0" showHeaders="false">
									<views:columns>
										<mx:DataGridColumn headerText = "Samples" width="80" dataField="@name"/>
<!--							            <mx:DataGridColumn width="20"  labelFunction="getChannelCountLabelFunction" headerText="">
							                <mx:itemRenderer>
							                    <mx:Component >
							                        <mx:HBox  horizontalGap="0" >
							                          <mx:Image source="{data.@laneCount > 0 ? '../assets/tick.png' : ''}">
							                    	 </mx:Image> 
							                        </mx:HBox>
							                    </mx:Component>
							                </mx:itemRenderer>
							            </mx:DataGridColumn> 
 -->									</views:columns>												        				        		
					         	</views:DataGrid>
					        </mx:Panel>            	

							<mx:Panel  id="lanesContainer" width="100%" height="100%">
							   <mx:title><![CDATA[Sequencing Lanes    (Drag sample onto sequencing lane sample cell)]]></mx:title>
									<mx:HBox width="100%" verticalAlign="middle" paddingLeft="4" paddingTop="4">
										<mx:HBox>
											<mx:Button label="Add" click="addLane();checkLanesCompleteness()" icon="@Embed('../assets/table_row_insert.png')" id="addLaneButton"/>
											<mx:Button label="Copy" click="addLane();checkLanesCompleteness()" icon="@Embed('../assets/table_multiple.png')" id="copyLaneButton"/>
											<mx:Button label="Delete" click="deleteLane();checkLanesCompleteness()" icon="@Embed('../assets/table_row_delete.png')" id="deleteLaneButton"/>
											<mx:Button label="Clear all" click="promptToClearAllLanes()" icon="@Embed('../assets/folder_delete.png')" id="clearLaneButton"/>
										</mx:HBox>
										
									</mx:HBox>
								<mx:DataGrid width="100%" height="100%" id="lanesGrid"  editable="true" dataProvider="{lanes}" allowMultipleSelection="true" dropEnabled="true" dragDrop="onDragDropLane(event)" itemFocusOut="checkLanesCompleteness()" rollOverColor="#C0C0C0" selectionColor="#FFFFB9" horizontalScrollPolicy="auto">
									<mx:columns>
									    <mx:DataGridColumn editable="false" headerText=""   resizable="false" width="25" labelFunction="getLanesGridRowNumber"/>
									    <mx:DataGridColumn  headerText="Sample"  width="222" 
									    	labelFunction="getLaneSampleName" 
	                                        editorDataField="text" sortable="false" editable="true" rendererIsEditor="false" itemEditor="views.renderers.TextInputLaneSample" itemRenderer="views.renderers.LabelLaneSample" />								    	
							             <mx:DataGridColumn  width="200" headerText="Flow Cell Type"  labelFunction="parentApplication.lookupFlowCellType" editable="false" dataField="@idFlowCellType"/> 						             						             
							             <mx:DataGridColumn width="65"  headerText="# Cycles"   labelFunction="parentApplication.lookupNumberSequencingCycles" editable="false" dataField="@idNumberSequencingCycles"/> 						             						             
										<mx:DataGridColumn width="150" headerText="Notes"   dataField="@notes"/>
									</mx:columns>
								</mx:DataGrid>
								
							</mx:Panel>					        			
            			</mx:HDividedBox>
            		</mx:VBox>
            	</mx:Canvas>
            </mx:AddChild>
         </mx:State>
        <mx:State name="SolexaSetupState" basedOn="SolexaBaseState">
            <mx:AddChild relativeTo="{concentrationContainer}">
                <mx:HBox width="100%">
    	            <mx:Label text="Enter approximate volume:"/>
	                <mx:TextInput id="volume" />
					<mx:Label text="ng" />
                </mx:HBox>
            </mx:AddChild>
            <mx:AddChild relativeTo="{concentrationContainer}" position="after">
				<mx:HBox id="isPreppedContainer" width="100%" horizontalGap="0">
					<mx:Image source="assets/bullet_orange.png"/>
					<mx:Label text="Are the samples already prepped?" width="340" />
					<mx:RadioButton id="samplesAlreadyPreppedCheckbox" change="{samplesAlreadyPreppedCheckbox.selected ? currentState = 'SolexaSetupPreppedState' : 'SolexaSetupState'}" label="Yes, samples have already been prepped" />							
					<mx:RadioButton id="samplesToBePreppedCheckbox" change="{samplesToBePreppedCheckbox.selected ? currentState = 'SolexaSetupState' : 'SolexaSetupPreppedState'}"  label="No, please prep the samples" selected="true"/>							
				</mx:HBox>            	
            </mx:AddChild>
            <mx:RemoveChild target="{label1}"/>
            <mx:AddChild relativeTo="{sampleSetupContainer}" >
                <mx:HBox width="100%" horizontalGap="0" id="alignContainer">
                	<mx:Image source="assets/bullet_orange.png"/>
                	<mx:Label text="Should the sequence be aligned to a genome build?" width="340"/>
                	<mx:VBox width="100%" id="alignMoreContainer">
                		<mx:HBox>
                			<mx:CheckBox id="alignCheckBox" label="Yes, align to build"/>
                			<mx:ComboBox labelField="@display" width="300" id="genomeBuildCombo" change="initializeSamplesGrid();organismCombo.selectedItem = sampleOrganismCombo.selectedItem;propagateSampleOrganism();checkSampleSetupCompleteness()" visible="{alignCheckBox.selected}">							
        		        		<mx:dataProvider>{parentApplication.manageDictionaries.lastResult.Dictionary.(@className == 'hci.gnomex.model.GenomeBuild').DictionaryEntry}</mx:dataProvider>
		                	</mx:ComboBox>                			
                		</mx:HBox>
                		<mx:HBox width="100%">
		                	<mx:Label text="Alignment instructions:" visible="{alignCheckBox.selected}"/>
        		        	<mx:TextInput id="alignNotes" width="100%" visible="{alignCheckBox.selected}"/>                			
                		</mx:HBox>                		
                	</mx:VBox>
                </mx:HBox>
            </mx:AddChild>
            <mx:SetProperty target="{label2}" name="text" value="Select a sample preparation method:"/>
            <mx:AddChild relativeTo="{laneFlowCellContainer}"  position="after">
        	         <mx:HBox id="numberOfLanesContainer">
						<mx:Image source="assets/bullet_orange.png"/>
          				<mx:Label width="230" text="How many sequencing lanes will be run?"/>
        				<mx:TextInput id="numberOfLanes" width="40" change="initializeLanesGrid()"/>
        			</mx:HBox>
            </mx:AddChild>
            <mx:AddChild relativeTo="{numberOfLanesContainer}"  position="after">
        			<mx:HBox id="testRunContainer">
						<mx:Image source="assets/bullet_orange.png"/>
        				<mx:Label width="230" text="Should a test run be performed?"/>
        				<mx:RadioButton id="performTestRunRadio" label="Yes, perform test run" click="initializeLanesGrid()"/>
        				<mx:RadioButton id="dontPerformTestRunRadio" label="No, run all lanes for all samples at once" click="initializeLanesGrid()"/>
        			</mx:HBox>

            </mx:AddChild>
        </mx:State>
        <mx:State name="SolexaSetupPreppedState" basedOn="SolexaSetupState">
            <mx:AddChild relativeTo="{isPreppedContainer}" position="after">
				<mx:HBox width="100%" horizontalGap="0" verticalAlign="middle" id="sampleAlreadyPreppedContainer">
					<mx:Image source="assets/bullet_orange.png"/>
					<mx:Label text="Describe how the samples were prepped:" width="340"/>
					<mx:TextInput id="samplePrepMethodText"/>			
					<mx:Spacer width="40"/>				
					<mx:RadioButton id="isFragLib" label="Fragment"/>
					<mx:RadioButton id="isPairedEndLib" label="Paired Ends"/>
					<mx:Spacer width="40"/>				
					<mx:CheckBox id="isSizeSelected" label="Size Selected?"/>
					<mx:TextInput id="sizeSelectedFrom" width="30"/>	
					<mx:Label text="-" textAlign="center"/>
					<mx:TextInput id="sizeSelectedTo" width="30"/>
				</mx:HBox>            	
            </mx:AddChild>
            <mx:RemoveChild target="{samplePrepContainer}">            	
            </mx:RemoveChild>
        </mx:State>
    </mx:states>
    
   <mx:HTTPService  
    id="getNewProject" 
    url="http://localhost/gnomex/GetProject.gx"
    destination="getProject"
    resultFormat="e4x"
    showBusyCursor="true"
    result="onGetNewProject(event)"
    method="POST"
    useProxy="false">
    <mx:request>
   		<idProject>0</idProject>    	
    </mx:request>
  </mx:HTTPService>

  <mx:HTTPService  
    id="getLab" 
    url="http://localhost/gnomex/GetLab.gx"
    destination="getLab"
    resultFormat="e4x"
    showBusyCursor="true"
    result="onGetLab(event)"
    method="POST"
    useProxy="false">
    <mx:request>
    	<idLab>{labCombo.selectedItem.@idLab}</idLab>
    </mx:request>
  </mx:HTTPService>
  
  <mx:HTTPService  
    id="getProject" 
    url="http://localhost/gnomex/GetProject.gx"
    destination="getProject"
    resultFormat="e4x"
    showBusyCursor="true"
    result="onGetProject(event)"
    method="POST"
    useProxy="false">
  </mx:HTTPService>
  
    <mx:HTTPService  
    id="getProjectForEdit" 
    url="http://localhost/gnomex/GetProject.gx"
    destination="getProjectForEdit"
    resultFormat="e4x"
    showBusyCursor="true"
    result="onGetProjectForEdit(event)"
    method="POST"
    useProxy="false">
  </mx:HTTPService>
  
  <mx:HTTPService  
    id="getProjectRequestList" 
    url="http://localhost/gnomex/GetProjectRequestList.gx"
    destination="getProjectRequestList"
    resultFormat="e4x"
    showBusyCursor="true"
    result="onGetProjectRequestList(event)"
    method="POST"
    useProxy="false">
    <mx:request>
            <idLab>{labCombo.selectedItem.@idLab}</idLab> 
            <showSamples>N</showSamples>
            <showCategory>N</showCategory>
            <showMyLabsAlways>N</showMyLabsAlways>
            <listKind>ProjectRequestCloneList</listKind>
    </mx:request>
   </mx:HTTPService>
   
   <mx:HTTPService  
    id="getNewRequest" 
    url="http://localhost/gnomex/GetRequest.gx"
    destination="getRequest"
    resultFormat="e4x"
    showBusyCursor="true"
    result="onGetNewRequest(event)"
    method="POST"
    useProxy="false">
    <mx:request>
   		<idRequest>0</idRequest>    	
    </mx:request>
  </mx:HTTPService>

   <mx:HTTPService  
    id="getRequestToClone" 
    url="http://localhost/gnomex/GetRequest.gx"
    destination="getRequest"
    resultFormat="e4x"
    showBusyCursor="true"
    result="onGetRequestToClone(event)"
    method="POST"
    useProxy="false">
    <mx:request>
   		<idRequest>{requestToClone.@idRequest}</idRequest>    	
    </mx:request>
  </mx:HTTPService>
  
  <mx:HTTPService  
    id="saveNewRequest" 
    url="http://localhost/gnomex/SaveRequest.gx"
    destination="saveNewRequest"
    resultFormat="e4x"
    showBusyCursor="true"
    result="onSaveNewRequest(event)"
    method="POST"
    useProxy="false">
  </mx:HTTPService>

  <mx:HTTPService  
    id="saveExistingRequest" 
    url="http://localhost/gnomex/SaveRequest.gx"
    destination="saveExistingRequest"
    resultFormat="e4x"
    showBusyCursor="true"
    result="onSaveExistingRequest(event)"
    method="POST"
    useProxy="false">
  </mx:HTTPService>
  
	<mx:Script>
		<![CDATA[
		import mx.controls.Alert;
		import mx.core.UIComponent;
		import mx.core.Container;
		
		import mx.rpc.events.ResultEvent;
		import mx.managers.PopUpManager;
		import mx.events.CloseEvent;
        import mx.managers.DragManager;
        import mx.core.DragSource;
        import mx.events.DragEvent;
        
        private var editMode:Boolean = false;
        
        [Bindable]
        private var lab:Object = null;
        
        [Bindable]
        private var appUsers:XMLListCollection;
        private var appUserSort:Sort;
        
        private var idAppUser:Object = '';

		[Bindable]
		private var errorMessage:String = "";
		[Bindable]
		private var warningMessage:String = "";
		        
        
        
        [Bindable]
        private var submittedIdRequest:String;
        [Bindable]
        private var submittedRequestNumber:String;

		[Bindable]
		private var requestCategoryName:String;
		
		[Bindable]
		public var request:Object;
		
		private var projectDetailWindow:views.ProjectDetailWindow;
		private var selectedIdProject:Object;
		
		private var requestCloneWindow:views.RequestCloneWindow;
		
		[Bindable]
		public var requestToClone:Object;
		
		[Bindable]
		public var slideDesigns:XMLListCollection = new XMLListCollection();
		[Bindable]
		private var selectedIdSlideProduct:Object;
		
		
		public function initializeData():void {
			if (!this.isSolexaState()) {
				if (theTab.contains(sampleSetupView)) {
					sampleTypeCombo.dataProvider = parentApplication.manageDictionaries.lastResult.Dictionary.(@className == 'hci.gnomex.model.SampleType').DictionaryEntry;
					sampleSourceCombo.dataProvider = parentApplication.manageDictionaries.lastResult.Dictionary.(@className == 'hci.gnomex.model.SampleSource').DictionaryEntry;
					sampleOrganismCombo.dataProvider = parentApplication.manageDictionaries.lastResult.Dictionary.(@className == 'hci.gnomex.model.Organism').DictionaryEntry;					
				}
				if (theTab.contains(hybSetupView)) {
					organismCombo.dataProvider = parentApplication.manageDictionaries.lastResult.Dictionary.(@className == 'hci.gnomex.model.Organism').DictionaryEntry;
					microarrayCategoryCombo.dataProvider = parentApplication.manageDictionaries.lastResult.Dictionary.(@className == 'hci.gnomex.model.MicroarrayCategory').DictionaryEntry;
				}
				
			}
			
			initFilters();
		}
		
		private function initFilters():void {
	        parentApplication.filteredProjectListForSubmitRequests.filterFunction = this.filterProject;
	        parentApplication.filteredProjectListForSubmitRequests.refresh();
			
			parentApplication.filteredSlideProductListForSubmitRequests.filterFunction = filterSlideProduct;
			parentApplication.filteredSlideProductListForSubmitRequests.refresh();
		}
		
		private function isSolexaState():Boolean {
			if (currentState == 'SolexaBaseState' ||
			    currentState == 'SolexaSetupState' ||
			    currentState == 'SolexaSetupPreppedState') {
				return true;    	
			} else {
				return false;
			}
		}
		
		public function checkSecurity():void {
			if (parentApplication.hasPermission("canWriteAnyObject")) {
				appUserContainer.visible = true;
				idAppUser = '';
			} else {
				appUserContainer.visible = false;
				idAppUser = parentApplication.createSecurityAdvisor.lastResult.@idAppUser;
			}
		}
		
		public function isRequestPending():Boolean {
			if (this.setupView == null || request == null) {
				return false;
			} else if (request.@idRequest == '0'  && submittedIdRequest == null) {
				if (nextButton.enabled) {
					return true;
				} else {
					return false;
				}
			} else {
				return false;
			}
		}
		
		private function promptToCancelRequest():void {
			if (isRequestPending()) {
				Alert.show( "The request has not been saved.  Are you sure you want to quit?",
						"Warning",
						(Alert.YES | Alert.NO), this, 
						onPromptToCancelRequest,						
						parentApplication.iconWarning);
			}
			
		}
		
		private function onPromptToCancelRequest(event:CloseEvent):void {
            if (event.detail==Alert.YES) {
            	cancelRequest();
            }
        }
        
        private function promptToCancelPriorRequest():void {
			if (isRequestPending()) {
				Alert.show( "The request you have entered has not been saved.  Do you want to start over?",
						"Warning",
						(Alert.YES | Alert.NO), this, 
						onPromptToCancelPriorRequest,						
						parentApplication.iconWarning);
			}
			
		}
		
		private function onPromptToCancelPriorRequest(event:CloseEvent):void {
            if (event.detail==Alert.YES) {
            	initializeForm();
            }
        }

        
        
        public function cancelRequest():void {
        	getNewRequest.send();
			initializeForm();
        	parentApplication.theViews.selectedIndex = -1;
        	parentApplication.theViews.visible = false;
        }
        
        public function setupForm():void {
        	// Have to separate out tab selection from
        	// getting new request; otherwise current state
        	// of Solexa messes up window state.
        	setupForm1();
        	callLater(setupForm2);
        }
		
		
		private function setupForm1():void {
			currentState = '';
			if (!theTab.contains(setupView)) {
				theTab.addChildAt(setupView, 0);
			}
			setupView.enabled = true;
			theTab.selectedIndex = 0;

			if (!theTab.contains(confirmView)) {
				theTab.addChildAt(confirmView, 6);
			}
			confirmView.enabled = true;
			theTab.selectedChild = confirmView;
		}
		private function setupForm2():void {
			getNewRequest.send();
			buttonStack.selectedIndex = 0;
			initializeForm();			
		}
		
		
		public function initializeForm():void {	
			editMode = false;

			theTab.creationPolicy = 'all';
			showWorkflowLabel.visible = false;
			showQCFieldsCheckBox.visible = false;
			showCy3LabelingFieldsCheckBox.visible = false;
			showCy5LabelingFieldsCheckBox.visible = false;
			showHybFieldsCheckBox.visible = false;
			showExtFieldsCheckBox.visible = false;
			if (setupView == null) {
				return;
			}
			if (!theTab.contains(setupView)) {
				theTab.addChildAt(setupView, 0);
			}
			if (!theTab.contains(sampleSetupView)) {
				theTab.addChildAt(sampleSetupView, 1);
			}
			if (!theTab.contains(hybSetupView)) {
				theTab.addChildAt(hybSetupView, 4);
			}
			if (!theTab.contains(confirmView)) {
				theTab.addChildAt(confirmView, 6);
			}
			hybSetupView.label = "Hyb setup";
			numberOfHybsContainer.visible = true;
			slideSourceContainer.visible = true;

			
			setupView.enabled = true;
			theTab.selectedChild = setupView;
			
			requestToClone = null;
			submittedIdRequest = null;
			submittedRequestNumber = null;

			labCombo.selectedIndex = -1;
			billingAccountCombo.selectedIndex = -1;
			projectCombo.selectedIndex = -1;
			this.requestTypeGroup.selectedValue = '';
			this.requestRadioAffy.selected = false;
			this.requestRadioAgilent.selected = false;
			this.requestRadioNimbleGen.selected = false;
			this.requestRadioQC.selected = false;
			this.requestRadioSolexa.selected = false;
			submitNewRequestRadio.selected = true;
			
			
			if (theTab.contains(sampleSetupView)) {
				numberOfSamples.text = '';
				sampleTypeCombo.selectedIndex = -1;
				samplePrepMethodCombo.selectedIndex = -1;
				sampleSourceCombo.selectedIndex = -1;
				this.sampleOrganismCombo.selectedIndex = -1;
				this.sampleConcentration.text = '';
				sampleSetupView.enabled = false;
				if (theTab.contains(annotationView)) {
					annotationView.enabled = false;								
				}
			}
					
			if (theTab.contains(hybSetupView)) {
				organismCombo.selectedIndex = -1;
				microarrayCategoryCombo.selectedIndex = -1;
				slideProductCombo.selectedIndex = -1;
				numberOfHybs.text = '';
				isCatalogRadio.selected = true;
				coreSlideSourceCheckbox.selected = false;
			 	this.clientSlideSourceCheckbox.selected = false;
				this.stripSlideSourceCheckbox.selected = false;
				
			}	
			
			
			if (theTab.contains(samplesView)) {
				samplesView.enabled = false;			
			}
			if (theTab.contains(hybSetupView)) {
				hybSetupView.enabled = false;
			}
			if (theTab.contains(hybsView)) {
				hybsView.enabled = false;
			}
			if (theTab.contains(confirmView)) {
				confirmView.enabled = false;
				if (confirmButtonStack != null) {
					confirmButtonStack.selectedIndex = 0;
				}
			}
			
			
			addSampleButton.visible = true;
			copySampleButton.visible = true;
			deleteSampleButton.visible = true;
			clearSamplesButton.visible = true;
			addHybButton.visible = true;
			copyHybButton.visible = true;
			deleteHybButton.visible = true;
			clearHybsButton.visible = true;

			this.organismCombo.enabled = true;
			this.microarrayCategoryCombo.enabled = true;
			this.slideProductCombo.enabled = true;
			this.isCatalogRadio.enabled = true;
			this.isCustomRadio.enabled = true;
			
		}
		
		
		private function nextTab():void {
			theTab.selectedIndex++;
		}
		
		private function previousTab():void {
			if (theTab.selectedIndex > 0) {
				theTab.selectedIndex--;				
			}
		}
		
		private function enableNextButtons():void {
			if (theTab.selectedIndex < theTab.getChildren().length - 1) {
				confirmButtonStack.selectedIndex = 0;
				var nextChild:UIComponent = UIComponent(theTab.getChildAt(theTab.selectedIndex + 1));
				if (nextChild.enabled) {
					nextButton.enabled = true;
				} else {
					nextButton.enabled = false;
				}
					
			} else {
				nextButton.enabled = false;
				confirmButtonStack.selectedIndex = 1;
			}
			if (theTab.selectedIndex > 0) {
				var prevChild:UIComponent = UIComponent(theTab.getChildAt(theTab.selectedIndex - 1));
				if (prevChild != null && prevChild.enabled) {
					backButton.enabled = true;
				} else {
					backButton.enabled = false;
				}
			} else {
				backButton.enabled = false;
			}
		}

        private function sortAppUsers(obj1:Object, obj2:Object, fields:Array=null):int {
			if (obj1 == null && obj2 == null) {
				return 0;
			} else if (obj1 == null) {
				return 1;
			} else if (obj2 == null) {
				return -1;
			} else {
				var display1:String = obj1.@displayName;
				var display2:String = obj2.@displayName;
				
				if (display1 < display2) {
					return -1;
				} else if (display1 > display2) {
					return 1;
				} else {
					return 0;
				}
				
			}
		}			
		
		
		private function setRequestCategoryName():void {
			var requestCategory:Object = parentApplication.manageDictionaries.lastResult.Dictionary.(@className == 'hci.gnomex.model.RequestCategory').DictionaryEntry.(@value == requestTypeGroup.selectedValue);
			requestCategoryName = requestCategory.@display.toString();

			if (requestTypeGroup.selectedValue == 'SOLEXA') {
				this.currentState = 'SolexaSetupState';				
			} else {
				this.currentState = '';
				if (this.requestTypeGroup.selectedValue == "QC") {
					if (!sampleSetupContainer.contains(bioanalyzerContainer)) {
						sampleSetupContainer.addChildAt(bioanalyzerContainer, 6);
					}
					if (sampleSetupContainer.contains(sampleOrganismContainer)) {
						sampleSetupContainer.removeChild(sampleOrganismContainer);
					}
					if (sampleSetupContainer.contains(sampleSourceContainer)) {
						sampleSetupContainer.removeChild(sampleSourceContainer);
					}
					hybsConfirmContainer.visible = false;
					hybsConfirmContainer.height = 0;
					if (this.theTab.contains(annotationView)) {
						this.theTab.removeChild(annotationView);				
					}
					if (this.theTab.contains(hybSetupView)) {
						this.theTab.removeChild(hybSetupView);				
					}
					if (this.theTab.contains(hybsView)) {
						this.theTab.removeChild(hybsView);				
					}
					this.sampleOrganismColumn.visible = false;
					this.sampleOrganismConfirmColumn.visible = false;
					this.sampleSourceColumn.visible  = false;
					this.sampleSourceConfirmColumn.visible  = false;
					this.concentrationUnitColumn.visible = true;
					this.concentrationUnitConfirmColumn.visible = true;
					this.chipTypeColumn.visible = true;
					this.chipTypeConfirmColumn.visible = true;
				} else {
					if (theTab.contains(sampleSetupView)) {
						if (sampleSetupContainer.contains(bioanalyzerContainer)) {
							sampleSetupContainer.removeChild(bioanalyzerContainer);
						}
						if (!sampleSetupContainer.contains(sampleOrganismContainer)) {
							sampleSetupContainer.addChildAt(sampleOrganismContainer, 2);
						}
						if (!sampleSetupContainer.contains(sampleSourceContainer)) {
							sampleSetupContainer.addChildAt(sampleSourceContainer, 3);
						}
					}
					hybsConfirmContainer.visible = true;
					hybsConfirmContainer.percentHeight = 100;
					if (!this.theTab.contains(annotationView)) {
						this.theTab.addChildAt(annotationView, 3);				
					}
					if (!this.theTab.contains(hybSetupView)) {
						this.theTab.addChildAt(hybSetupView, 4);				
					}
					if (!this.theTab.contains(hybsView)) {
						this.theTab.addChildAt(hybsView, 5);				
					}
					this.sampleOrganismColumn.visible = true;
					this.sampleOrganismConfirmColumn.visible = true;
					this.sampleSourceColumn.visible  = true;
					this.sampleSourceConfirmColumn.visible  = true;
					this.concentrationUnitColumn.visible = false;
					this.concentrationUnitConfirmColumn.visible = false;
					this.chipTypeColumn.visible = false;
					this.chipTypeConfirmColumn.visible = false;
	
					// Hide/Show the channel 2 sample column
					if (requestCategory.@numberOfChannels == "2") {
						this.channel2SampleColumn.visible = true;
						this.channel2SampleConfirmColumn.visible = true;
					} else {
						this.channel2SampleColumn.visible = false;
						this.channel2SampleConfirmColumn.visible = false;
					}
	
				}
			}
			
			
			
		}
		
		private function getSamplesGridRowNumber(item:Object,col:int):String
        {
        	if (samples!= null) {
	           var x:int = samples.getItemIndex(item) + 1;
	           return String(x);     		
        	} else {
        		return "";
        	}
        }
		private function getHybsGridRowNumber(item:Object,col:int):String
        {
        	if (hybs!= null) {
	           var x:int = hybs.getItemIndex(item) + 1;
	           return String(x);     		
        	} else {
        		return "";
        	}
        }
		private function getLanesGridRowNumber(item:Object,col:int):String
        {
        	if (lanes!= null) {
	           var x:int = lanes.getItemIndex(item) + 1;
	           return String(x);     		
        	} else {
        		return "";
        	}
        }
		private function getSampleChannel1Name(item:Object,col:int):String
        {
        	var sampleName:String = "";
        	if (hybsGrid!= null) {
        		for each(var sample:Object in samples) {
        			if (sample.@idSample == item.@idSampleChannel1) {
        				sampleName = sample.@name;
        				break;
        			}
        		}
        	} 
        	return sampleName;
        }
		private function getSampleChannel2Name(item:Object,col:int):String
        {
        	var sampleName:String = "";
        	if (hybsGrid!= null) {
        		for each(var sample:Object in samples) {
        			if (sample.@idSample == item.@idSampleChannel2) {
        				sampleName = sample.@name;
        				break;
        			}
        		}
        	} 
        	return sampleName;
        }
		private function getLaneSampleName(item:Object,col:int):String
        {
        	var sampleName:String = "";
        	if (lanesGrid!= null) {
        		for each(var sample:Object in samples) {
        			if (sample.@idSample == item.@idSample) {
        				sampleName = sample.@name;
        				break;
        			}
        		}
        	} 
        	return sampleName;
        }
		private function getChannelCountLabelFunction(item:Object,col:int):String
        {
        	var channel1Count:int = 0;
        	var channel2Count:int = 0;
        	if (hybs!= null) {
        		for each(var hyb:Object in hybs) {
        			if (hyb.@idSampleChannel1 == item.@idSample) {
        				channel1Count++;
        			}
        			if (hyb.@idSampleChannel2 == item.@idSample) {
        				channel2Count++;
        			}
        		}
        	} 
			item.@channel1Count = channel1Count;
			item.@channel2Count = channel2Count;
			return "";
        }
        


		public function filterProject(item:Object):Boolean {
			var keep:Boolean = false;
			if (item.@idProject == '') {
				keep = true;
			} else if (labCombo.selectedItem != null) {
				if (item.@idLab == labCombo.selectedItem.@idLab) {
					keep = true;
				}
			}
			return keep;
		}
		
		public function addSamplePrepMethodFilter():void {
			parentApplication.samplePrepMethodList.filterFunction = filterSamplePrepMethod;
			parentApplication.samplePrepMethodList.refresh();
		}
		
		private function filterSamplePrepMethod(item:Object):Boolean {
        	if (item.@value == "") {
        		return true;
        	}
        	
        	if (item.@isActive == 'N') {
        		return false;
        	}
        	var doesMatch:Boolean = true;
        	if (sampleTypeCombo.selectedItem != null && 
        	    sampleTypeCombo.selectedItem.@value != null  &&
        	    sampleTypeCombo.selectedItem.@value != "") {
        	   	doesMatch = false;
        	   	var applicableSamplePrepMethods:XMLList = parentApplication.manageDictionaries.lastResult.Dictionary.(@className == 'hci.gnomex.model.SamplePrepMethodSampleType').DictionaryEntry.(@value != '' && @idSampleType == sampleTypeCombo.selectedItem.@value);
        	   	for each (var xref:Object in applicableSamplePrepMethods) {
        	   		if (xref.@idSamplePrepMethod == item.@value) {
        	   		    doesMatch = true;
        	   		    break;
        	   		}
        	   	}
        	}
        	return doesMatch;
        }  
        
       
        private function filterSlideProduct(item:Object):Boolean {
        	if (item.@idSlideProduct == null || item.@idSlideProduct == "") {
        		return true;
        	}
        	
        	if (item.@isActive == 'N') {
        		return false;	
        	}
        	
			var doesMatchRequestCategoryVendor:Boolean = true;
        	if (this.requestTypeGroup.selectedValue != null && 
        	    this.requestTypeGroup.selectedValue != "") {
				var requestCategory:Object = parentApplication.manageDictionaries.lastResult.Dictionary.(@className == 'hci.gnomex.model.RequestCategory').DictionaryEntry.(@value == requestTypeGroup.selectedValue);
        		doesMatchRequestCategoryVendor = false;
        		if (item.@idVendor == requestCategory.@idVendor) {
        			doesMatchRequestCategoryVendor = true;
        		}
        	} else if(request != null && request.@idRequest != '0') {
        		doesMatchRequestCategoryVendor = false;
				var rCategory:Object = parentApplication.manageDictionaries.lastResult.Dictionary.(@className == 'hci.gnomex.model.RequestCategory').DictionaryEntry.(@value == request.@codeRequestCategory);
        		if (item.@idVendor == rCategory.@idVendor) {
        			doesMatchRequestCategoryVendor = true;        			
        		}
        	}       	
        	
        	var doesMatchOrganism:Boolean = true;
        	if (organismCombo.selectedItem != null && 
        	    organismCombo.selectedItem.@value != null  &&
        	    organismCombo.selectedItem.@value != "") {
        		if (item.@idOrganism == organismCombo.selectedItem.@idOrganism) {
        			doesMatchOrganism = true;
        		} else {
        			doesMatchOrganism = false;
        		}
        	}
        	var doesMatchExperimentCategory:Boolean = true;
        	if (microarrayCategoryCombo.selectedItem != null && 
        	    microarrayCategoryCombo.selectedItem.@value != null &&
        	    microarrayCategoryCombo.selectedItem.@value != "") {
        		doesMatchExperimentCategory = false;
        		var categoriesForSlideProduct:XMLList  = item.microarrayCategories.MicroarrayCategory;
        		for(var x:Number = 0; x < categoriesForSlideProduct.length(); x++) {
        			if (categoriesForSlideProduct[x].@codeMicroarrayCategory == microarrayCategoryCombo.selectedItem.@value) {
        				doesMatchExperimentCategory = true;
        				break;
        			}
        		}
        	}
        	var doesMatchGroup:Boolean = true;
        	if (labCombo.selectedItem != null && labCombo.selectedItem.@idLab != "" && isCustomRadio.selected) {
        		if (item.@isCustom == "Y" && item.@idLab == labCombo.selectedItem.@idLab) {
        			doesMatchGroup = true;
        		} else {
        			doesMatchGroup = false;
        		}
        	} else if (labCombo.selectedItem != null && labCombo.selectedItem.@idLab != "" && isCatalogRadio.selected) {
        		if (item.@isCustom != "Y") {
        			doesMatchGroup = true;
        		} else {
        			doesMatchGroup = false;
        		}
        	}
        	
        	return doesMatchRequestCategoryVendor && doesMatchOrganism && doesMatchExperimentCategory && doesMatchGroup;
        }  
		


		private function showNewProjectWindow():void {
			getNewProject.send();		
		}
		
		private function showEditProjectWindow():void {
			selectedIdProject = projectCombo.selectedItem.@idProject;
			var params:Object = new Object();
			params.idProject = projectCombo.selectedItem.@idProject;
			getProjectForEdit.send(params);			
		}
	
		private function onGetNewProject(event:ResultEvent):void {
			if (getNewProject.lastResult.name() == "OpenProjectList") {
				 parentApplication.navExperimentView.selectedProject = getNewProject.lastResult.Project.(@idProject == 0);
				 parentApplication.navExperimentView.selectedProject.@idAppUser = idAppUser;
				 parentApplication.navExperimentView.selectedProject.@idLab = labCombo.selectedItem.@idLab;

				 this.projectDetailWindow = views.ProjectDetailWindow(PopUpManager.createPopUp(this, views.ProjectDetailWindow, true));
				 this.projectDetailWindow.projectDetailView.fromSubmitRequestWindow = true;
				 this.projectDetailWindow.projectDetailView.experimentDesignEntries.refresh();
				 this.projectDetailWindow.projectDetailView.experimentFactorEntries.refresh();
				 
				 this.projectDetailWindow.labCombo.selectedItem = labCombo.selectedItem;
				 this.projectDetailWindow.labCombo.enabled = false;
				 
				 PopUpManager.centerPopUp(this.projectDetailWindow);		
				
			} else {
				mx.controls.Alert.show(getNewProject.lastResult..ACTMESSAGE.@TEXT, "Get new project failed");
			}
		}
		
		public function onProjectAdded(idProject:Object):void {
			selectedIdProject = idProject;
			var params:Object = new Object();
			params.idProject = idProject;
			getProject.send(params);
		}
		
		private function getMembersOfLab():void {
			if (parentApplication.hasPermission("canWriteAnyObject") && 
			    labCombo.selectedItem.@idLab != '') {
			    idAppUser = null;
				getLab.send();						    
			}
		}
		private function onGetLab(event:ResultEvent):void {			
			lab = getLab.lastResult..Lab.(@idLab == labCombo.selectedItem.@idLab);
			var emptyNode:XML = <AppUser idAppUser='' displayName=''/>;
			appUsers = new XMLListCollection(lab.members.AppUser);
			appUsers.addItemAt(emptyNode, 0);
			
			appUserSort = new Sort();
	        appUserSort.compareFunction = this.sortAppUsers;
	        appUsers.sort = appUserSort;
	        appUsers.refresh();
	        
	        appUserCombo.selectedIndex = 0;

		}
		
		private function onGetProject(event:ResultEvent):void {
			var newProject:Object = getProject.lastResult..Project.(@idProject == selectedIdProject);
			parentApplication.filteredProjectListForSubmitRequests.addItem(newProject);
			this.projectCombo.selectedItem = newProject;
		}
		
		private function onGetProjectRequestList(event:ResultEvent):void {
			
			this.requestCloneWindow = views.RequestCloneWindow(PopUpManager.createPopUp(this, views.RequestCloneWindow, true));
			PopUpManager.centerPopUp(requestCloneWindow);
			requestCloneWindow.expandAllNodes();
		}
		
		private function onPickStartingPoint():void {
			if (cloneRequestRadio.selected) {
				getProjectRequestList.send();
			}
		}
		
		public function cloneRequest(requestToClone:Object):void {
			this.requestToClone = requestToClone;
			getRequestToClone.send();
		}
		
		private function onGetRequestToClone(event:ResultEvent):void {
			
			var clonedRequest:Object = getRequestToClone.lastResult..Request.(@idRequest == requestToClone.@idRequest);
			if (requestTypeGroup.selectedValue == "QC" || requestTypeGroup.selectedValue == "SOLEXA") {
				clonedRequest.replace("hybridizations", <hybridizations></hybridizations>); 	
			} 
			
			request = clonedRequest;
			request.@idRequest = "0";
			request.@number = "";
			request.@idLab = labCombo.selectedItem.@idLab;
			request.@idAppUser = idAppUser;
			request.@idProject = projectCombo.selectedItem.@idProject;

			var requestCategory:Object = parentApplication.manageDictionaries.lastResult.Dictionary.(@className == 'hci.gnomex.model.RequestCategory').DictionaryEntry.(@value == requestTypeGroup.selectedValue);
			
			// Clear out workflow fields from sample and hyb
			for each(var sample:Object in samples) {
				sample.@qualDate = '';
				sample.@qualCompleted = 'N';
				sample.@qualFailed = 'N';
				sample.@qualBypassed="N"; 
				sample.@qual260nmTo230nmRatio=""; 
				sample.@qual260nmTo280nmRatio=""; 
				sample.@qual28sTo18sRibosomalRatio=""; 
				sample.@qualAverageFragmentLength=""; 
				sample.@qualRINNumber=""; 
				sample.@qualCalcConcentration="";
				sample.@qualStatus = "";
				sample.@treatment = "";
			}
			for each(var hyb:Object in hybs) {
				 // If this is a 1 channel kind if request, clear out channel2 of the cloned request
				 if (requestCategory.@numberOfChannels != "2") {
					hyb.@idSampleChannel2 = "0";
				 }
				 hyb.@idArrayCoordinate="" 
				 hyb.@idScanProtocol="";
				 hyb.@extractionDate="";
				 hyb.@extractionFailed=""; 
				 hyb.@extractionBypassed="";
				 hyb.@hybFailed="";
				 hyb.@hybBypassed="";
				 hyb.@idSlide = "";
				 hyb.@idFeatureExtractionProtocol="";
				 hyb.@hybDate; 
				 hyb.@idLabeledSampleChannel1="";
				 hyb.@idLabeledSampleChannel2=""
				 hyb.@slideNumber="";
				 hyb.@slide="";
				 hyb.@hasResults=""; 
				 hyb.@slideBarcode="";
				 hyb.@hybCompleted="N"; 
				 hyb.@extractionCompleted="N";
				 hyb.@arrayCoordinate="";
				 hyb.@idLabelingProtocolChannel1=""; 
				 hyb.@idLabelingProtocolChannel2="";
				 hyb.@labelingYieldChannel1="";
				 hyb.@codeLabelingReactionSizeChannel1="STD"; 
				 hyb.@labelingYieldChannel2=""; 
				 hyb.@numberOfReactionsChannel2="" 
				 hyb.@codeLabelingReactionSizeChannel2="STD"; 
				 hyb.@labelingFailedChannel1="N"; 
				 hyb.@labelingFailedChannel2="N"; 
				 hyb.@labelingCompleteChannel1="N"; 
				 hyb.@labelingCompleteChannel2="N"; 
				 hyb.@labelingStatusChannel1=""; 
				 hyb.@labelingStatusChannel2=""; 
				 hyb.@arrayCoordinateName=""; 
				 hyb.@hybStatus=""; 
				 hyb.@extractionStatus="";
			}
			

			// Clear out sample annotations for QC request cloned from another request
			if (requestTypeGroup.selectedValue == "QC") {
				for each(var annotation:Object in sampleCharacteristicEntries) {
					annotation.@isSelected = "false";
				}
				this.clearOutUncheckedSampleAnnotations();
			}
			
			// Make sure we render the annotation tab because
			// otherwise we won't activate the renderer code that
			// hides/shows the sample annotation columns in the samples
			// grid
			if (theTab.contains(annotationView)) {
				theTab.selectedChild = this.annotationView;
			}
						
			callLater(initializeControls);
			callLater(assignSlideNumbers);
			
			
			callLater(checkSampleSetupCompleteness);
			callLater(checkSamplesCompleteness);
			callLater(checkHybSetupCompleteness);
			callLater(checkHybsCompleteness);
			
			
		}

		public function setupEditForm(theRequest:Object):void {
			currentState = '';
			editMode = true;

			request = theRequest;

			var requestCategory:Object = parentApplication.manageDictionaries.lastResult.Dictionary.(@className == 'hci.gnomex.model.RequestCategory').DictionaryEntry.(@value == request.@codeRequestCategory);
			requestCategoryName = requestCategory.@display.toString();

			buttonStack.selectedIndex = 1;
			theTab.creationPolicy = 'all';	
			
			var prevSelectedTab:Container = theTab.selectedChild;			
			
			if (theTab.contains(setupView)) {
				theTab.removeChild(setupView);
			}
			if (theTab.contains(sampleSetupView)) {
				theTab.removeChild(sampleSetupView);
			}
			if (theTab.contains(hybSetupView)) {
				hybSetupView.label = "Slide";
				numberOfHybsContainer.visible = false;
				slideSourceContainer.visible = false;
			}
			if (request.@codeRequestCategory == 'QC') {
				if (theTab.contains(hybSetupView)) {
					theTab.removeChild(hybSetupView);
				}
				if (theTab.contains(hybsView)) {
					theTab.removeChild(hybsView);
				}
			} else if (request.@codeRequestCategory == 'SOLEXA') {
				currentState = 'SolexaBaseState';
			
			} else {
				if (!theTab.contains(hybSetupView)) {
					theTab.addChildAt(hybSetupView, 2);
				}
				if (!theTab.contains(hybsView)) {
					theTab.addChildAt(hybsView, 3);
				}
				if (theTab.contains(hybsView)) {
					hybsView.enabled = true;
				}
			}
			if (theTab.contains(confirmView)) {
				theTab.removeChild(confirmView);
			}
			annotationView.enabled = true;			
			samplesView.enabled = true;			

			// Make sure we render the annotation tab because
			// otherwise we won't activate the renderer code that
			// hides/shows the sample annotation columns in the samples
			// grid
			if (theTab.contains(annotationView)) {
				theTab.selectedChild = this.annotationView;
			} 
			
			
			if (parentApplication.hasPermission("canWriteAnyObject")) {
				addSampleButton.visible = true;
				copySampleButton.visible = true;
				deleteSampleButton.visible = true;
				clearSamplesButton.visible = true;
				addHybButton.visible = true;
				copyHybButton.visible = true;
				deleteHybButton.visible = true;
				clearHybsButton.visible = true;
			} else {
				addSampleButton.visible = false;
				copySampleButton.visible = false;
				deleteSampleButton.visible = false;
				clearSamplesButton.visible = false;
				addHybButton.visible = false;
				copyHybButton.visible = false;
				deleteHybButton.visible = false;
				clearHybsButton.visible = false;
			}

			var canChangeSlide:Boolean = false;			
			if (parentApplication.hasPermission("canWriteAnyObject")) {
				canChangeSlide = true;		
			} else {
				for each(var hyb:Object in hybs) {
					if (hyb.@canChangeSlideDesign == "Y") {
						canChangeSlide = true;
						break;
					}
				}
			}
			this.organismCombo.enabled = canChangeSlide;
			this.microarrayCategoryCombo.enabled = canChangeSlide;
			this.slideProductCombo.enabled = canChangeSlide;
			this.isCatalogRadio.enabled = canChangeSlide;
			this.isCustomRadio.enabled = canChangeSlide;
			
						if (this.isSolexaState()) {
				
			} else {
				showWorkflowLabel.visible = true;
				showQCFieldsCheckBox.visible = true;
				showCy3LabelingFieldsCheckBox.visible = true;
				showCy5LabelingFieldsCheckBox.visible = true;
				showHybFieldsCheckBox.visible = true;
				showExtFieldsCheckBox.visible = true;
					
			}

			
			callLater(initializeControls);
			callLater(assignSlideNumbers);			
			callLater(checkSamplesCompleteness);
			callLater(checkHybSetupCompleteness);
			callLater(checkHybsCompleteness);
			
		}
		
		private function onGetProjectForEdit(event:ResultEvent):void {
			if (getProjectForEdit.lastResult.name() == "OpenProjectList") {
				 parentApplication.navExperimentView.selectedProject = getProjectForEdit.lastResult.Project.(@idProject == projectCombo.selectedItem.@idProject);

				 this.projectDetailWindow = views.ProjectDetailWindow(PopUpManager.createPopUp(this, views.ProjectDetailWindow, true));
				 this.projectDetailWindow.title = "Edit Project";
				 this.projectDetailWindow.projectDetailView.fromSubmitRequestWindow = true;
				 this.projectDetailWindow.projectDetailView.experimentDesignEntries.refresh();
				 this.projectDetailWindow.projectDetailView.experimentFactorEntries.refresh();
				 
				 this.projectDetailWindow.labCombo.selectedItem = labCombo.selectedItem;
				 this.projectDetailWindow.labCombo.enabled = false;
				 
				 PopUpManager.centerPopUp(this.projectDetailWindow);		
				
			} else {
				mx.controls.Alert.show(getNewProject.lastResult..ACTMESSAGE.@TEXT, "Get project for edit failed");
			}
			
		}
		
		private function onGetNewRequest(event:ResultEvent):void {
			request = getNewRequest.lastResult..Request.(@idRequest = '0');
			request.@idAppUser = idAppUser;

		}

		private function initializeControls():void {
			
			if (theTab.contains(sampleSetupView)) {
				numberOfSamples.text = new String(request.samples.Sample.length());
				sampleConcentration.text = "100";
				sampleTypeCombo.selectedItem = parentApplication.manageDictionaries.lastResult.Dictionary.(@className == 'hci.gnomex.model.SampleType').DictionaryEntry.(@value == request.@idSampleTypeDefault);
				samplePrepMethodCombo.selectedItem = parentApplication.manageDictionaries.lastResult.Dictionary.(@className == 'hci.gnomex.model.SamplePrepMethod').DictionaryEntry.(@value == request.@idSamplePrepMethodDefault);
				
			}

			
			if (request != null && request.@idRequest != '0' && request.@codeRequestCategory == "QC") {
				
			} else if (requestTypeGroup.selectedValue == "QC") {
				
			}else {
				sampleOrganismCombo.selectedItem = parentApplication.manageDictionaries.lastResult.Dictionary.(@className == 'hci.gnomex.model.Organism').DictionaryEntry.(@value == request.@idOrganismSampleDefault);
				sampleSourceCombo.selectedItem = parentApplication.manageDictionaries.lastResult.Dictionary.(@className == 'hci.gnomex.model.SampleSource').DictionaryEntry.(@value == request.@idSampleSourceDefault);

				selectedIdSlideProduct = request.@idSlideProduct;
				numberOfHybs.text = new String(request.hybridizations.Hybridization.length());
				var theSlideProduct:Object = parentApplication.getSlideProductList.lastResult.SlideProduct.(@idSlideProduct == request.@idSlideProduct);
				microarrayCategoryCombo.selectedItem = parentApplication.manageDictionaries.lastResult.Dictionary.(@className == 'hci.gnomex.model.MicroarrayCategory').DictionaryEntry.(@value == request.@codeMicroarrayCategory);
				organismCombo.selectedItem = parentApplication.manageDictionaries.lastResult.Dictionary.(@className == 'hci.gnomex.model.Organism').DictionaryEntry.(@value == theSlideProduct.@idOrganism);
				checkForSampleTypeCompatibility();
				initializeSlideProductCombo();
				initializeSlideDesigns();
				this.coreSlideSourceCheckbox.selected = true;
				
			}			
			
			if (theTab.contains(setupView)) {
				theTab.selectedChild = this.setupView;			
			} else {
				theTab.selectedChild = this.samplesView;
			}
			
			
			
		}
		
		private function initializeSlideProductCombo():void {
				parentApplication.filteredSlideProductListForSubmitRequests.refresh();

				slideProductCombo.selectedIndex = -1;
				for each(var slideProduct:Object in slideProductCombo.dataProvider) {
					if (slideProduct.@idSlideProduct == request.@idSlideProduct) {
						slideProductCombo.selectedItem = slideProduct;
						break;
					}
				}
				checkForSlideProductWarning();
		}
		
		private function initializeSlideDesigns():void {
			var slideDesign:Object = this.getDefaultSlideDesign();
			if (slideDesign != null) {
				for each (var hyb:Object in hybs) {
					hyb.@idSlideDesign = slideDesign.@idSlideDesign;
				}
			}
		}
		
		private function clearHybSlideDesigns():void {
			if (slideProductCombo.selectedItem == null ||
			    slideProductCombo.selectedItem.@idSlideProduct == '' ||
			    request.@idSlideProduct == '' ||
				request.@idSlideProduct != slideProductCombo.selectedItem.@idSlideProduct) {
			
				for each (var hyb:Object in hybs) {
					hyb.@idSlideDesign = '';
				}
				checkHybsCompleteness();
			}
			
		}
		
		
		
		public function sortSampleCharacteristics(obj1:Object, obj2:Object, fields:Array=null):int {
			if (obj1 == null && obj2 == null) {
				return 0;
			} else if (obj1 == null) {
				return 1;
			} else if (obj2 == null) {
				return -1;
			} else {
				var sc1:String = obj1.@sampleCharacteristic;
				var sc2:String = obj2.@sampleCharacteristic;
				
				if (sc1 == 'Other') {
					return 1;
				} else if (sc2 == 'Other') {
					return  -1;
				} else {
					if (sc1 < sc2) {
						return -1;
					} else if (sc1 > sc2) {
						return 1;
					} else {
						return 0;
					}
				}			
				
			}
		}	
		
		public function clearOutUncheckedSampleAnnotations():void {
			for each(var annotation:Object in sampleCharacteristicEntries) {
				var isSelected:String;
				var value:String;
				if (annotation.@isSelected == "false") {
					isSelected = "N";
					value = '';
				} else {
					isSelected = "Y";
					value = null;
				}
					
				for each(var sample:XML in samples) {
					switch (annotation.@codeSampleCharacteristic.toString()) { 
						case 'AGE' :
							sample.@AGE = (value == null ? sample.@AGE : value);
							request.@AGE = isSelected;
							break;
						case 'CELLLINE' :
							sample.@CELLLINE = (value == null ? sample.@CELLLINE : value);
							request.@CELLLINE = isSelected;
							break;
						case 'CELLTYPE' :
							sample.@CELLTYPE = (value == null ? sample.@CELLTYPE : value);
							request.@CELLTYPE = isSelected;
							break;
						case 'CLININFO' :
							sample.@CLININFO = (value == null ? sample.@CLININFO : value);
							request.@CLININFO = isSelected;
							break;
						case 'COMPOUND' :
							sample.@COMPOUND = (value == null ? sample.@COMPOUND : value);
							request.@COMPOUND = isSelected;
							break;
						case 'DOSE' :
							sample.@DOSE = (value == null ? sample.@DOSE : value);
							request.@DOSE = isSelected;
							break;
						case 'DISSTATE' :
							sample.@DISSTATE = (value == null ? sample.@DISSTATE : value);
							request.@DISSTATE = isSelected;
							break;
						case 'GENMOD' :
							sample.@GENMOD = (value == null ? sample.@GENMOD : value);
							request.@GENMOD = isSelected;
							break;
						case 'GROWTHCOND' :
							sample.@GROWTHCOND = (value == null ? sample.@GROWTHCOND : value);
							request.@GROWTHCOND = isSelected;
							break;
						case 'GENOTYPE' :
							sample.@GENOTYPE = (value == null ? sample.@GENOTYPE : value);
							request.@GENOTYPE = isSelected;
							break;
						case 'INDIV' :
							sample.@INDIV = (value == null ? sample.@INDIV : value);
							request.@INDIV = isSelected;
							break;
						case 'ORGPART' :
							sample.@ORGPART = (value == null ? sample.@ORGPART : value);
							request.@ORGPART = isSelected;
							break;
						case 'OTHER' :
							sample.@OTHER = (value == null ? sample.@OTHER : value);
							request.@OTHER = isSelected;
							break;
						case 'SEX' :
							sample.@SEX = (value == null ? sample.@SEX : value);
							request.@SEX = isSelected;
							break;
						case 'TEMP' :
							sample.@TEMP = (value == null ? sample.@TEMP : value);
							request.@TEMP = isSelected;
							break;
						case 'TIME' :
							sample.@TIME = (value == null ? sample.@TIME : value);
							request.@TIME = isSelected;
							break;
						default :
							break;    							 
					}
				}
			}
		}
		
		
		public function showSampleAnnotationColumn(codeSampleCharacteristic:String, show:Boolean):void {
			if (samplesGrid == null) {
				return;
			}
			for (var x:Number = 0; x < samplesGrid.columnCount; x++) {
				var dc:DataGridColumn = samplesGrid.columns[x];
				if ( dc.dataField == "@" + codeSampleCharacteristic) {
					dc.visible = show;
					break;					
				}
			}
			for (var x1:Number = 0; x1 < this.samplesGridConfirm.columnCount; x1++) {
				var dc1:DataGridColumn = samplesGridConfirm.columns[x1];
				if ( dc1.dataField == "@" + codeSampleCharacteristic) {
					dc1.visible = show;
					break;
				}
			}
		}
		
		
		
		private function addSample():void {
			var emptyNode:XML = null;
			if (requestTypeGroup.selectedValue == "QC") {
				emptyNode = new XML("<Sample " +
			    " idSample='" + "Sample" + samples.length + "'" +
			    " name='' description='' " +
				" concentration='" + sampleConcentration.text + "'" +
				" codeConcentrationUnit='ng/ul'" + 
				" codeBioanalyzerChipType='" + getSelectedCodeBioanalyzerChipType() + "'" +
				" idSampleType='" + sampleTypeCombo.selectedItem.@value + "'" +
				" idSamplePrepMethod='" + samplePrepMethodCombo.selectedItem.@value + "'" +				
				" treatment='" + treatmentTextInput.text + "'" +				
				"/>");
			
			} else {
				emptyNode = new XML("<Sample " +
			    " idSample='" + "Sample" + samples.length + "'" +
			    " name='' description='' " +
				" concentration='" + sampleConcentration.text + "'" +
				" codeConcentrationUnit='ng/ul'" + 
				" idSampleType='" + sampleTypeCombo.selectedItem.@value + "'" +
				" idSamplePrepMethod='" + samplePrepMethodCombo.selectedItem.@value + "'" +				
				" idOrganism='"  + sampleOrganismCombo.selectedItem.@value + "'" +				
				" idSampleSource='"  + sampleSourceCombo.selectedItem.@value + "'" +				
				" treatment='"  + treatmentTextInput.text + "'" +				
				"/>");
			}
			
			samples.addItem(emptyNode);
	        	
		}
		
		private function getSelectedCodeBioanalyzerChipType():String {
			var selectedCode:String = '';
			for each(var item:Object in this.bioanalyzerChipTypeGrid.dataProvider) {
				if (item.@isSelected != null && item.@isSelected == "true") {
					selectedCode = item.@value;
					break;
				}
			} 
			return selectedCode;
		}
		
		private function deleteSample():void {
			if (samplesGrid.selectedItems.length > 0) {
				for each(var sample:Object in samplesGrid.selectedItems) {					
					for each(var hyb:Object in hybs) {
						if (hyb.@idSampleChannel1 == sample.@idSample) {
							hyb.@idSampleChannel1 = '0';
						}
						if (hyb.@idSampleChannel2 == sample.@idSample) {
							hyb.@idSampleChannel2 = '0';
						}
					}

					samples.removeItemAt(samples.getItemIndex(sample));
					
				}
			}
			if (requestTypeGroup.selectedValue == "QC") {
				
			} else {
				hybsGrid.invalidateList();
				hybsGrid.invalidateDisplayList();
				
			}
		}
		
		private function copySample():void {
			if (samplesGrid.selectedIndex != -1) {
				for each(var i:int in samplesGrid.selectedIndices) {					
					var sampleToCopy:Object = samples[i];
					
					var emptyNode:XML = new XML("<Sample " +
					" idSample='" + "Sample" + samples.length + "'" +
					" name='" +  sampleToCopy.@name + "'" + 
					" description='" + sampleToCopy.@description + "'" + 
					" idSampleType='" + sampleToCopy.@idSampleType + "'" +
					" idSamplePrepMethod='" + sampleToCopy.@idSamplePrepMethod + "'" +				
					" idOrganism='" + sampleToCopy.@idOrganism + "'" +				
					" idSampleSource='" + sampleToCopy.@idSampleSource + "'" +				
					" concentration='" + sampleToCopy.@concentration + "'" +				
					" treatment='" + sampleToCopy.@treatment + "'" +				
					" codeConcentrationUnit='" + sampleToCopy.@codeConcentrationUnit + "'" +				
					" codeBioanalyzerChipType='" + sampleToCopy.@codeBioanalyzerChipType + "'" +				
					" AGE='" + sampleToCopy.@AGE + "'" +				
					" CELLLINE='" + sampleToCopy.@CELLLINE + "'" +				
					" CELLTYPE='" + sampleToCopy.@CELLTYPE + "'" +				
					" CLININFO='" + sampleToCopy.@CLININFO + "'" +				
					" COMPOUND='" + sampleToCopy.@COMPOUND + "'" +				
					" DISSTATE='" + sampleToCopy.@DISSTATE + "'" +				
					" DOSE='" + sampleToCopy.@DOSE + "'" +				
					" GENMOD='" + sampleToCopy.@GENMOD + "'" +				
					" GENOTYPE='" + sampleToCopy.@GENOTYPE + "'" +				
					" INDIV='" + sampleToCopy.@INDIV + "'" +				
					" GROWTHCOND='" + sampleToCopy.@GROWTHCOND + "'" +				
					" ORGPART='" + sampleToCopy.@ORGPART + "'" +				
					" OTHER='" + sampleToCopy.@OTHER + "'" +				
					" SEX='" + sampleToCopy.@SEX + "'" +				
					" TEMP='" + sampleToCopy.@TEMP + "'" +				
					" TIME='" + sampleToCopy.@TIME + "'" +				
					"/>");
			
					samples.addItem(emptyNode);
					
				}
			}
		}
		
		public function promptToClearAllSamples():void {
			Alert.show("Remove all samples currently showing in list?",
						null, 
						(Alert.YES | Alert.NO), this, 
						onPromptToClearAllSamples);
			
		}
		
		private function onPromptToClearAllSamples(event:CloseEvent):void {
            if (event.detail==Alert.YES) {
            	samples.removeAll();
            	checkSamplesCompleteness();
            }
        }
       	private function propagateSampleType():void {
			for each (var sample:Object in samples) {
				sample.@idSampleType = this.sampleTypeCombo.selectedItem.@value;
			}
			callLater(checkSamplesCompleteness);
		}
       	private function propagateSamplePrepMethod():void {
			for each (var sample:Object in samples) {
				sample.@idSamplePrepMethod = this.samplePrepMethodCombo.selectedItem.@value;
			}
			callLater(checkSamplesCompleteness);
		}
       	private function propagateSampleSource():void {
			for each (var sample:Object in samples) {
				sample.@idSampleSource = this.sampleSourceCombo.selectedItem.@value;
			}
			callLater(checkSamplesCompleteness);
		}
       	private function propagateSampleConcentration():void {
			for each (var sample:Object in samples) {
				sample.@concentration = this.sampleConcentration.text;
			}
			callLater(checkSamplesCompleteness);
		}
       	private function propagateSampleOrganism():void {
			for each (var sample:Object in samples) {
				sample.@idOrganism = this.sampleOrganismCombo.selectedItem.@value;
			}
			callLater(checkSamplesCompleteness);
		}
       	public function propagateChipType():void {
       		var codeChipType:String = this.getSelectedCodeBioanalyzerChipType();
			for each (var sample:Object in samples) {
				sample.@codeBioanalyzerChipType = codeChipType;
			}
			callLater(checkSamplesCompleteness);
		}
       	private function propagateTreatment():void {
			for each (var sample:Object in samples) {
				sample.@treatment = this.treatmentTextInput.text;
			}
			if (this.treatmentTextInput.text != '') {
				treatmentColumn.visible = true;
				treatmentConfirmColumn.visible = true;
				request.@treatment = 'Y';
			} else {
				treatmentColumn.visible = false;
				treatmentConfirmColumn.visible = false;
				request.@treatment = 'N';
				
			}
		}

        
       	public function initializeSamplesGrid():void {
        	if (requestToClone != null) {
        		return;
        	}
       		if (!this.checkSampleSetupCompleteness()) {
       			return;
       		}
        	
    		var numberOfSamplesToAdd:Number = new Number(numberOfSamples.text);
    		if(samples.length <= numberOfSamplesToAdd) {
    			numberOfSamplesToAdd = numberOfSamplesToAdd - samples.length;
    		} else {
    			numberOfSamplesToAdd = 0;
    		}
    		for(var x:int = 0; x < numberOfSamplesToAdd; x++) {
    			addSample();
    		}
        }
        
        private function checkSetupCompleteness():void {
        	var isComplete:Boolean = false;
        	if (request != null && request.@idRequest != '0') {
        		isComplete = true;
        	} else if (this.idAppUser != null && this.idAppUser != '' &&
        	    this.requestTypeGroup.selectedValue != null &&
        	    this.labCombo.selectedItem != null && this.labCombo.selectedItem.@idLab != '' &&
        	    this.billingAccountCombo.selectedItem != null && 
        	    this.projectCombo.selectedItem != null && this.projectCombo.selectedItem.@idProject != '') {
        	    isComplete = true;
        	    	
        	} 
    		this.sampleSetupView.enabled = isComplete;
    		enableNextButtons();
    		if (theTab.contains(annotationView)) {
        		this.annotationView.enabled = isComplete;        			
    		}
    		cloneRequestRadio.enabled = isComplete;
    		
    		callLater(postSetupCompleteness, [isComplete]);
    		
    		
        }
        
        private function postSetupCompleteness(isComplete:Boolean):void {
    		if (!isComplete) {
	    		this.samplesView.enabled = false;
	        	if (theTab.contains(hybSetupView)) {
		        	this.hybSetupView.enabled = false;
	        	} 
	        	if (theTab.contains(hybsView)) {
		        	this.hybsView.enabled = false;
	        	} 
	        	this.confirmView.enabled = false;
    		} else {
    			this.checkSampleSetupCompleteness();
    			this.checkSamplesCompleteness();
    			this.checkHybSetupCompleteness();
    			this.checkHybsCompleteness();
    		}
        	
        }
        
      	public function checkSampleSetupCompleteness():Boolean {
        	var isComplete:Boolean = false;
        	if (request != null && request.@idRequest != '0') {
        		isComplete = true;
        	}else if (this.requestTypeGroup.selectedValue == "QC") {
	        	if (this.numberOfSamples.text != null && this.numberOfSamples.text != '' &&
	        	    this.sampleConcentration.text != null && this.sampleConcentration.text != '' &&
	        	    this.sampleTypeCombo.selectedItem != null && this.sampleTypeCombo.selectedItem.@value != '' &&
	        	    this.samplePrepMethodCombo.selectedItem != null && this.samplePrepMethodCombo.selectedItem.@value != '' ) {
	        	    	
	        		for each(var chipType:Object in this.bioanalyzerChipTypeGrid.dataProvider) {
	        			if (chipType.@isSelected == "true") {
	        				isComplete = true;
	        				break;
	        			}
	        		}
	        	}
        	} else {
	        	if (this.numberOfSamples.text != null && this.numberOfSamples.text != '' &&
	        	    this.sampleConcentration.text != null && this.sampleConcentration.text != '' &&
	        	    this.sampleTypeCombo.selectedItem != null && this.sampleTypeCombo.selectedItem.@value != '' &&
	        	    this.sampleSourceCombo.selectedItem != null && this.sampleSourceCombo.selectedItem.@value != '' &&
	        	    this.sampleOrganismCombo.selectedItem != null && this.sampleOrganismCombo.selectedItem.@value != '' &&
	        	    this.samplePrepMethodCombo.selectedItem != null && this.samplePrepMethodCombo.selectedItem.@value != '' ) {
					isComplete = true;	        	    	
	        	}
        	}

    		this.samplesView.enabled = isComplete;
    		enableNextButtons();
			if (theTab.contains(annotationView)) {
				this.annotationView.enabled = isComplete;        			
	    	}

        	callLater(postSampleSetupCompleteness, [isComplete]);
        	
    		return isComplete;
    	    	
        }
        
        private function postSampleSetupCompleteness(isComplete:Boolean):void {
	    		
	    	if (!isComplete) {
	        	if (theTab.contains(hybSetupView)) {
		        	this.hybSetupView.enabled = false;
	        	} 
	
	        	if (theTab.contains(hybsView)) {
		        	this.hybsView.enabled = false;
	        	} 
	
	        	this.confirmView.enabled = false;
    		} else {
    			this.checkSamplesCompleteness();
    		}
        	
        }
        
        public function checkSamplesCompleteness():void {
        	var completeCount:int = 0;
        	for each(var sample:Object in samples) {
        		if (requestTypeGroup.selectedValue == "QC") {
	        		if (sample.@name != null && sample.@name != '' &&
	        			sample.@idSampleType != null && sample.@idSampleType != '' &&
	        			sample.@idSamplePrepMethod != null && sample.@idSamplePrepMethod != '' &&
	        			sample.@concentration != null && sample.@concentration != '' &&
	        			sample.@codeConcentrationUnit != null && sample.@codeConcentrationUnit != '' &&
	        			sample.@codeBioanalyzerChipType != null && sample.@codeBioanalyzerChipType != '') {
	        			completeCount++;       				
	        		}
        		} else {
	        		if (sample.@name != null && sample.@name != '' &&
	        			sample.@idSampleType != null && sample.@idSampleType != '' &&
	        			sample.@idSamplePrepMethod != null && sample.@idSamplePrepMethod != '' &&
	        			sample.@concentration != null && sample.@concentration != '' &&
	        			sample.@idSampleSource != null && sample.@idSampleSource != '' &&
	        			sample.@idOrganism != null && sample.@idOrganism != '') {
	        			completeCount++;       				
	        		}
        			
        		}
        	}
        	
        	var isComplete:Boolean = false;
        	if (samples.length > 0 && completeCount == samples.length) {
        		isComplete = true;
        	} else if (request != null && request.@idRequest != '0') {
        		isComplete = true;
        	}
    		enableNextButtons();
    		if (theTab.contains(hybSetupView)) {
        		this.hybSetupView.enabled = isComplete;
    		} if (this.isSolexaState()) {
    			this.lanesView.enabled = isComplete;
    		} else {
    			if (theTab.contains(confirmView)) {
	    			this.confirmView.enabled = isComplete;
    			}
    		}

			callLater(postSamplesCompleteness, [isComplete]);
        	
        
        }
        
                
        private function postSamplesCompleteness(isComplete:Boolean):void {
	    		
	    	if (!isComplete) {
	        	if (theTab.contains(hybSetupView)) {
		        	this.hybSetupView.enabled = false;
	        	} 
	
	        	if (theTab.contains(hybsView)) {
		        	this.hybsView.enabled = false;
	        	} 
	        	
	        	if (this.isSolexaState()) {
	    			this.lanesView.enabled = false;
	        	}
	
	        	this.confirmView.enabled = false;
    		} else {
    			if (theTab.contains(hybSetupView)) {
	    			this.checkHybSetupCompleteness();    				
    			} 
    		}
        	
        }
        
        private function postHybSetupCompleteness(isComplete:Boolean):void { 

        	if (!isComplete) {
	        	if (theTab.contains(hybSetupView)) {
		        	this.hybSetupView.enabled = false;
	        	} 

	        	if (theTab.contains(hybsView)) {
		        	this.hybsView.enabled = false;
	        	} 

	        	this.confirmView.enabled = false;
    		} else {
    			this.checkHybSetupCompleteness();
    			this.checkHybsCompleteness();
    		}        	
        }
        
        public function checkHybsCompleteness():void {
        	if (request != null && request.codeRequestCategory == "QC") {
        		return;
        	}else if (requestTypeGroup.selectedValue == "QC") {
        		return;
        	}
        	
        	var completeCount:int = 0;
        	for each(var hyb:Object in hybs) {
        		if (hyb.@idSampleChannel1 != null && hyb.@idSampleChannel1 != '0'  &&
        			hyb.@idSlideDesign != null && hyb.@idSlideDesign != '' &&
        			hyb.@codeSlideSource != null && hyb.@codeSlideSource != '') {
        			completeCount++;       				
        		}
        	}
        	if (hybs.length > 0 && completeCount == hybs.length) {
        		if (theTab.contains(confirmView)){
	        		this.confirmView.enabled = true;
        		}
        		
        	} else if (request.@idRequest != '0') {
        		if (theTab.contains(confirmView)) {
 		       		this.confirmView.enabled = true;        			
        		}
        	} else {
        		if (theTab.contains(confirmView)) {
	        		this.confirmView.enabled = false;        			
        		}
        	}
        	enableNextButtons();
        
        }


		private function getDefaultSlideDesign():Object {
			var slideDesign:Object = null;
			
			if (slideProductCombo.selectedItem != null) {
				selectedIdSlideProduct = slideProductCombo.selectedItem.@idSlideProduct;
				slideDesigns = new XMLListCollection(parentApplication.manageDictionaries.lastResult.Dictionary.(@className == 'hci.gnomex.model.SlideDesign').DictionaryEntry.(@value == '' || @idSlideProduct == selectedIdSlideProduct));
				
				// If there is only one slide design (besides the blank entry) for the slide product,
				// set all of the hybs to it.
				if (slideDesigns.length == 2) {
					slideDesign = slideDesigns[1];
				}
			}
			
			return slideDesign;

		}

		private function addHyb():void {
			var defaultSlideDesign:Object = getDefaultSlideDesign();
			var idSlideDesign:String = '';
			if (defaultSlideDesign != null) {
				idSlideDesign = defaultSlideDesign.@idSlideDesign;
			}
			
			
			var emptyNode:XML = new XML("<Hybridization " +
			    " idHybridization='" + "Hyb" + hybs.length + "'" +
			    " notes='' " + 
				" idSlideDesign='" + idSlideDesign + "'" +
				" codeSlideSource='" + getCheckedCodeSlideSource() + "'" +
				" idSampleChannel1='0'" +
				" idSampleChannel2='0'" +
				"/>");
			
			hybs.addItem(emptyNode);
	        assignSlideNumbers();	
		}
		
		private function propagateHybChannel1Samples():void {
			var requestCategory:Object = parentApplication.manageDictionaries.lastResult.Dictionary.(@className == 'hci.gnomex.model.RequestCategory').DictionaryEntry.(@value == requestTypeGroup.selectedValue);
			if (requestCategory.@numberOfChannels == "1") {
				var count:int = 0;
				for each(var sample:Object in samples) {
					if (hybs.length == count) {
						break;
					}
					var hyb:Object = hybs.getItemAt(count);
					hyb.@idSampleChannel1 = sample.@idSample;
					count++;
				}
			}
			
		}
		
		private function assignSlideNumbers():void {
			if (slideProductCombo.selectedItem == null || slideProductCombo.selectedItem.@idSlideProduct == '') {
				return;
			}
			if (slideProductCombo.selectedItem.@arraysPerSlide == '' ||
				slideProductCombo.selectedItem.@arraysPerSlide == '1') {
				slideNumberColumn.visible = false;		
			} else {
				slideNumberColumn.visible = true;
			}
			var slideNumber:int = 0;
			var count:int = 0;
			var firstTime:Boolean = true;
			var useAltColor:Boolean = true;
			for each(var hyb:Object in hybs) {
				if (slideProductCombo.selectedItem.@arraysPerSlide == '' ||
				    slideProductCombo.selectedItem.@arraysPerSlide == '1') {
					slideNumber++;    
					hyb.@showSlideIcon = 'Y';	
					hyb.@altColor = false;
				} else {
					if (firstTime || count == slideProductCombo.selectedItem.@arraysPerSlide) {
						count = 0;
						slideNumber ++;
						hyb.@showSlideIcon = 'Y';
						useAltColor = !useAltColor;
						hyb.@altColor = useAltColor;
					} else {
						hyb.@showSlideIcon = 'N';							
						hyb.@altColor = useAltColor;
					}
				}
				hyb.@slideNumber = slideNumber;
				count++;
				firstTime = false;
			}
		}
		
		private function getCheckedCodeSlideSource():String {
			if (this.coreSlideSourceCheckbox.selected == true) {
				return "CORE";
			} else if (this.clientSlideSourceCheckbox.selected == true ) {
				return "CLIENT";
			} else if (this.stripSlideSourceCheckbox.selected== true) {
				return "REUSE";
			} else {
				return '';
			}
		}
		private function toggleCheckedCodeSlideSource(checkBoxNumber:int):void {
			if (checkBoxNumber == 1) {
				this.clientSlideSourceCheckbox.selected = false;
				this.stripSlideSourceCheckbox.selected  = false;
			} else if (checkBoxNumber == 2) {
				this.coreSlideSourceCheckbox.selected = false;
				this.stripSlideSourceCheckbox.selected  = false;
			} else if (checkBoxNumber == 3) {
				this.coreSlideSourceCheckbox.selected  = false;
				this.clientSlideSourceCheckbox.selected = false;
			} 
		}
		
		private function propagateCheckCodeSlideSource():void {
			for each (var hyb:Object in hybs) {
				hyb.@codeSlideSource = this.getCheckedCodeSlideSource();
			}
			callLater(checkHybsCompleteness);
		}
		
		public function propagateSlideSourceToHybsSameSlide(theHyb:Object):void {
			for each (var hyb:Object in hybs) {
				if (theHyb.@slideNumber == hyb.@slideNumber) {
					hyb.@codeSlideSource = theHyb.@codeSlideSource;
				}
			}
			
		}
		private function propagateSlideDesign():void {
			for each (var hyb:Object in hybs) {
				hyb.@idSideDesign = this.slideProductCombo.selectedItem.@idSlideDesign;
			}
			callLater(checkHybsCompleteness);
		}
		
		private function checkHybSetupCompleteness():void {
			if ((request!= null && request.@codeRequestCategory == "QC") || requestTypeGroup.selectedValue == "QC" ) {
				return;
			}
			if ((request!= null && request.@codeRequestCategory == "SOLEXA") || requestTypeGroup.selectedValue == "SOLEXA" ) {
				return;
			}
			
        	if (this.numberOfHybs.text != null && this.numberOfHybs.text != '' &&
        	    this.slideProductCombo.selectedItem != null && this.slideProductCombo.selectedItem.@idSlideProduct != '' &&
        	    this.getCheckedCodeSlideSource() != '' && isSampleTypeCompatibile() ) {
        	    	
        		this.hybsView.enabled = true;
        	    	
        	} else if (request.@idRequest != '0') {
        		this.hybsView.enabled = true;
        	} else {
        		this.hybsView.enabled = false;
        	}
        	enableNextButtons();
        }
        
        private function checkForSlideProductWarning():void {
        	if (this.slideProductCombo.dataProvider.length == 1) {
        		slideProductStack.selectedIndex = 1;
        	} else {
        		slideProductStack.selectedIndex = 0;
        	}
        }
        
        private function isSampleTypeCompatibile():Boolean {
        	var compatible:Boolean = true;
        	var sampleTypeX:Object = null;
        	if (this.isSolexaState()) {
        		return compatible;		
        	}
        	
        	if (editMode) {
        		if (request.@codeMicroarrayCategory!= '' &&
	        	    request.@idSampleTypeDefault != '') {
    	    	    compatible = false;
					for each(sampleTypeX in parentApplication.manageDictionaries.lastResult.Dictionary.(@className == 'hci.gnomex.model.SampleTypeMicroarrayCategory').DictionaryEntry) {
						if (sampleTypeX.@codeMicroarrayCategory == request.@codeMicroarrayCategory &&
					    	sampleTypeX.@idSampleType == request.@idSampleTypeDefault) {
							compatible = true;
							break;
					}
				}        		    	
        	}

        	} else {
	        	if (this.microarrayCategoryCombo.selectedItem != null &&
	        	    this.microarrayCategoryCombo.selectedItem.@value != '' &&
	        	    this.sampleTypeCombo.selectedItem != null &&
	        	    this.sampleTypeCombo.selectedItem.@value != '') {
	        	    compatible = false;
					for each(sampleTypeX in parentApplication.manageDictionaries.lastResult.Dictionary.(@className == 'hci.gnomex.model.SampleTypeMicroarrayCategory').DictionaryEntry) {
						if (sampleTypeX.@codeMicroarrayCategory == microarrayCategoryCombo.selectedItem.@value &&
						    sampleTypeX.@idSampleType == sampleTypeCombo.selectedItem.@value) {
							compatible = true;
							break;
						}
					}        		    	
	        	}
        		
        	}
        	return compatible;
        }
        
        private function checkForSampleTypeCompatibility():void {
        	if (!this.isSampleTypeCompatibile()) {
        		if (editMode) {
					var sampleType:Object = parentApplication.manageDictionaries.lastResult.Dictionary.(@className == 'hci.gnomex.model.SampleType').DictionaryEntry.(@value == request.@idSampleTypeDefault);
					var sampleTypeName:String = sampleType.@display.toString();
        			
	        		Alert.show('Sample type ' + sampleTypeName + 
	        		' cannot be used for ' + microarrayCategoryCombo.selectedItem.@display + 
	        		' experiments.  Please change the microarray category.');
        			
        		} else {
	        		Alert.show('Sample type ' + sampleTypeCombo.selectedItem.@display + 
	        		' cannot be used for ' + microarrayCategoryCombo.selectedItem.@display + 
	        		' experiments.  Please change the sample type or microarray category.');
        			
        		}

        		slideProductCombo.selectedIndex = 0;
        	}
        }

		
		private function deleteHyb():void {
			if (hybsGrid.selectedItems.length > 0) {
				for each(var hyb:Object in hybsGrid.selectedItems) {					
					hybs.removeItemAt(hybs.getItemIndex(hyb));
				}
			}
	        assignSlideNumbers();	
		}
		
		private function copyHyb():void {
			if (hybsGrid.selectedIndex != -1) {
				for each(var i:int in hybsGrid.selectedIndices) {					
					var hybToCopy:Object = hybs[i];
					
					var emptyNode:XML = new XML("<Hybridization " +
    			    " idHybridization='" + "Hyb" + hybs.length + "'" +
					" notes='" + hybToCopy.@notes + "'" + 
					" idSampleChannel1='" + hybToCopy.@idSampleChannel1 + "'" +
					" idSampleChannel2='" + hybToCopy.@idSampleChannel2 + "'" +	
					" codeSlideSource='" + hybToCopy.@codeSlideSource + "'" +			
					" idSlideDesign='" + hybToCopy.@idSlideDesign + "'" +			
					"/>");
			
					hybs.addItem(emptyNode);
					
				}
			}
	        assignSlideNumbers();	
		}
		
		public function promptToClearAllHybs():void {
			Alert.show("Remove all hybs currently showing in list?",
						null, 
						(Alert.YES | Alert.NO), this, 
						onPromptToClearAllHybs);
			
		}
		
		private function onPromptToClearAllHybs(event:CloseEvent):void {
            if (event.detail==Alert.YES) {
            	hybs.removeAll();
            	checkHybsCompleteness();
            }
        }
        private function initializeHybsGrid():void {
        	if (requestToClone != null) {
        		return;
        	}
        	
        	if (numberOfHybs.text == null || numberOfHybs.text == "0" || numberOfHybs.text == '') {
        		return;
        	}
        	if (slideProductCombo.selectedItem == null || slideProductCombo.selectedItem.@value == '') {
        		return;
        	}
        	if (this.getCheckedCodeSlideSource() == '') {
        		return;
        	}
        	
        	
    		var numberOfHybsToAdd:Number = new Number(numberOfHybs.text);
    		if(hybs.length <= numberOfHybsToAdd) {
    			numberOfHybsToAdd = numberOfHybsToAdd - hybs.length;
    		} else {
    			numberOfHybsToAdd = 0;
    		}
    		for(var x:int = 0; x < numberOfHybsToAdd; x++) {
    			addHyb();
    		}
    		
    		this.propagateHybChannel1Samples();
        }

	  	private function onDragDrop(event:DragEvent) : void
		{
		   var isChannel1Drop:Boolean = false;
		   var isChannel2Drop:Boolean = false;
			
	       var ds:DragSource = event.dragSource;
	       var colXStart:int = 0;
	       var colXEnd:int = 0;
	       for each(var col:DataGridColumn in hybsGrid.columns) {
	       		colXEnd += col.width;
	       		
	       		if (event.localX >= colXStart && event.localX <= colXEnd) {
	       			if (col.headerText == "Cy3 Sample (green)") {
	       				isChannel1Drop = true;
	       				break;
	       			} else if (col.headerText == "Cy5 Sample (red)") {
	       				isChannel2Drop = true;
	       				break;
	       			}
	       		}
	       		colXStart = colXEnd;
	       }
	      

		   // The user didn't drag over cy3 or cy5 sample column, so disregard 
		   // operation.	       
	       if (!isChannel1Drop && !isChannel2Drop) {
		       	event.preventDefault();
		       	event.target.hideDropFeedback(event);
		       	DragManager.showFeedback(DragManager.NONE);
		       	checkHybsCompleteness();
		       	return;
	       }
	       
	       // retrieve the data associated with the "items" format. This will be the data that
	       // the dragInitiator has copied into the DragSource.
	       var items:Array = ds.dataForFormat("items") as Array;
	
	       // determine where in the grid the drop occurs and select that node by the index; followed by 
	       // retrieving the node itself. 
	       var r:int = hybsGrid.calculateDropIndex(event);
	       hybsGrid.selectedIndex = r;
	       var node:XML = hybsGrid.selectedItem as XML;
	       var p:*;
	
	
	       if (node.name()  == "Hybridization") {
	       		p = node;
	       } else {
	       		//ignore drop operations not on existing hyb row
	       }
	       
	        
	       // Disallow operation if samples cannot be changed on hyb
	       if (hybsGrid.selectedItem.@canChangeSampleDesignations == "Y" ||
	           parentApplication.hasPermission("canWriteAnyObject")) {
	           	
	       } else {
	       	  	Alert.show("Cy3 and Cy5 samples cannot be changed.");
		       	event.preventDefault();
		       	event.target.hideDropFeedback(event);
		       	DragManager.showFeedback(DragManager.NONE);
				return;	       	  	
	       }
	
	       // taking all of the items in the DragSouce, update the appropriate
	       // sample id on the hyb node.
	       if (p != null) {
		       for(var i:Number=0; i < items.length; i++) {
		       	if (items[i].name() == "Sample") {
		       		if (isChannel1Drop) {
			       		hybsGrid.selectedItem.@idSampleChannel1 = items[i].@idSample;	       			
		       		} else if (isChannel2Drop) {
			       		hybsGrid.selectedItem.@idSampleChannel2 = items[i].@idSample;	       			
		       			
		       		}
		       	} 
		       }
	       	
	       }	
	       
	       this.sampleDragGrid.invalidateDisplayList();
	       this.sampleDragGrid.invalidateList();
	       
	       // Don't allow flex to do any default moves to the data.  
	       // We handle it in the code above.
	       event.preventDefault();
	       
	       checkHybsCompleteness();
		}
		
		private function addLane():void {
			var emptyNode:XML = new XML("<SequenceLane " +
			    " idSequenceLane='" + "SequenceLane" + lanes.length + "'" +
			    " notes='' " + 
				" idFlowCellType='" + flowCellTypeCombo.selectedItem.@value + "'" +
				" idNumberSequencingCycles='" + numberSequencingCyclesCombo.selectedItem.@value + "'" +
				" idSample='0'" +
				"/>");
			
			lanes.addItem(emptyNode);
		}

		private function copyLane():void {
			if (lanesGrid.selectedIndex != -1) {
				for each(var i:int in lanesGrid.selectedIndices) {					
					var laneToCopy:Object = lanes[i];
					
					var emptyNode:XML = new XML("<SequenceLane " +
    			    " idSequenceLane='" + "SequenceLane" + lanes.length + "'" +
					" notes='" + laneToCopy.@notes + "'" + 
					" idSample='" + laneToCopy.@idSample + "'" +
					" idFlowCellType='" + laneToCopy.@idFlowCellType + "'" +			
					" idNumberSequencingCycles='" + laneToCopy.@idNumberSequencingCycles + "'" +			
					"/>");
			
					lanes.addItem(emptyNode);
					
				}
			}
		}
		private function deleteLane():void {
			if (lanesGrid.selectedItems.length > 0) {
				for each(var lane:Object in lanesGrid.selectedItems) {		
					var index:int = lanes.getItemIndex(lane);			
					lanes.removeItemAt(index);
				}
			}
		}
		public function promptToClearAllLanes():void {
			Alert.show("Remove all sequence lanes currently showing in list?",
						null, 
						(Alert.YES | Alert.NO), this, 
						onPromptToClearAllLanes);
			
		}
        private function initializeLanesGrid():void {
        	if (requestToClone != null) {
        		return;
        	}
        	
        	if (numberOfLanes.text == null || numberOfLanes.text == "0" || numberOfLanes.text == '') {
        		return;
        	}
        	if (flowCellTypeCombo.selectedItem == null || flowCellTypeCombo.selectedItem.@value == '') {
        		return;
        	}
        	if (numberSequencingCyclesCombo.selectedItem == null || numberSequencingCyclesCombo.selectedItem.@value == '') {
        		return;
        	}
        	if (!this.performTestRunRadio.selected && !this.dontPerformTestRunRadio.selected) {
        		return;
        	}
        	
        	
    		var numberOfLanesToAdd:Number = new Number(numberOfLanes.text);
    		if(lanes.length <= numberOfLanesToAdd) {
    			numberOfLanesToAdd = numberOfLanesToAdd - lanes.length;
    		} else {
    			numberOfLanesToAdd = 0;
    		}
    		for(var x:int = 0; x < numberOfLanesToAdd; x++) {
    			addLane();
    		}
    		
        }
		private function propagateFlowCellType():void {
			for each (var lane:Object in lanes) {
				lane.@idFlowCellType = this.flowCellTypeCombo.selectedItem.@value;
			}
			callLater(checkLanesCompleteness);
		}
		private function propagateNumberSequencingCycles():void {
			for each (var lane:Object in lanes) {
				lane.@idNumberSequencingCycles = this.numberSequencingCyclesCombo.selectedItem.@value;
			}
			callLater(checkLanesCompleteness);
		}

		private function onPromptToClearAllLanes(event:CloseEvent):void {
            if (event.detail==Alert.YES) {
            	lanes.removeAll();
            	checkLanesCompleteness();
            }
        }
        public function checkLanesCompleteness():void {
        	var completeCount:int = 0;
        	for each(var lane:Object in lanes) {
        		if (lane.@idSample != null && lane.@idSample!= '0'  &&
        			lane.@idFlowCellType != null && lane.@idFlowCellType != '' &&
        			lane.@idNumberSequencingCycles != null && lane.@idNumberSequencingCycles != '') {
        			completeCount++;       				
        		}
        	}
        	if (lanes.length > 0 && completeCount == lanes.length) {
        		if (theTab.contains(confirmView)){
	        		this.confirmView.enabled = true;
        		}
        		
        	} else if (request.@idRequest != '0') {
        		if (theTab.contains(confirmView)) {
 		       		this.confirmView.enabled = true;        			
        		}
        	} else {
        		if (theTab.contains(confirmView)) {
	        		this.confirmView.enabled = false;        			
        		}
        	}
        	enableNextButtons();
        
        }

	  	private function onDragDropLane(event:DragEvent) : void
		{
	       // retrieve the data associated with the "items" format. This will be the data that
	       // the dragInitiator has copied into the DragSource.
	       var items:Array = event.dragSource.dataForFormat("items") as Array;
	
	       // determine where in the grid the drop occurs and select that node by the index; followed by 
	       // retrieving the node itself. 
	       var r:int = lanesGrid.calculateDropIndex(event);
	       lanesGrid.selectedIndex = r;
	       var node:XML = lanesGrid.selectedItem as XML;
	       var p:*;
	
	
	       if (node.name()  == "SequenceLane") {
	       		p = node;
	       } else {
	       		//ignore drop operations not on existing hyb row
	       }
	       
	        
	       // Disallow operation if samples cannot be changed on hyb
	       if (lanesGrid.selectedItem.@canChangeSampleDesignations == "Y" ||
	           parentApplication.hasPermission("canWriteAnyObject")) {
	           	
	       } else {
	       	  	Alert.show("Lane samples cannot be changed.");
		       	event.preventDefault();
		       	event.target.hideDropFeedback(event);
		       	DragManager.showFeedback(DragManager.NONE);
				return;	       	  	
	       }
	
	       // taking all of the items in the DragSouce, update the appropriate
	       // sample id on the hyb node.
	       if (p != null) {
		       for(var i:Number=0; i < items.length; i++) {
		       	if (items[i].name() == "Sample") {
			    	lanesGrid.selectedItem.@idSample = items[i].@idSample;	       			
		       	} 
		       }
	       	
	       }	
	       
	       this.sampleLaneDragGrid.invalidateDisplayList();
	       this.sampleLaneDragGrid.invalidateList();
	       
	       // Don't allow flex to do any default moves to the data.  
	       // We handle it in the code above.
	       event.preventDefault();
	       
	       checkLanesCompleteness();
		}

		private function validateRequest():void {
			errorMessage = '';
			warningMessage = '';
			
			// All samples must be used on at least one hyb
			var allSamplesUsed:Boolean = true;
			var unusedSampleList:String = '';
			var unusedSampleCount:int = 0;
			var target:String = "";
			if (requestTypeGroup.selectedValue != "QC") {
				for each(var sample:Object in samples) {
					var useCount:int = 0;
					if (requestTypeGroup.selectedValue == "SOLEXA") {
						useCount = getLaneCount(sample);
						target = "sequence lane";
					} else {
						useCount = getChannelCount(sample);
						target = "hybridization";
					}
					
					if (useCount == 0) {
						allSamplesUsed = false;
						if (unusedSampleList != '') {
							unusedSampleList += ', ';							
						}
						unusedSampleList += sample.@name;
						unusedSampleCount++;
						
					}
				}
				if (unusedSampleCount > 0) {
					if (unusedSampleCount == 1) {
						errorMessage = 'The sample ' + unusedSampleList + 
						' is not used on any ' + target + 's.\n' +
						'The request cannot be submitted until the unused sample is removed from the list or assigned to a ' + target + '.';
						
					} else {
						errorMessage = 'The samples  (' + unusedSampleList + 
						')  are not used on any ' + target + 's.\n' +
						'The request cannot be submitted until the unused samples are removed from the list or assigned to ' + target + 's.';
						
					}
				}
			}	
			
			// Warn if some of the arrays (on a multi-array slide) are not used.	
			
			if (!this.isSolexaState()) {
				if (slideProductCombo.selectedItem.@arraysPerSlide != '' && slideProductCombo.selectedItem.@arraysPerSlide != 1) {
					if (hybs.length % slideProductCombo.selectedItem.@arraysPerSlide != 0) {
						warningMessage = "There are unused arrays on the multi-array slide  '" + slideProductCombo.selectedItem.@name +
						 "'. ";
					}
				}
				
			}
		}
		
		private function getChannelCount(sample:Object):int {
			var count:int = 0;
        	if (hybs!= null) {
        		for each(var hyb:Object in hybs) {
        			if (hyb.@idSampleChannel1 == sample.@idSample ||
        			    hyb.@idSampleChannel2 == sample.@idSample) {
        				count++;
        			}
        		}
        	} 								
        	return count;
		}
		private function getLaneCount(sample:Object):int {
			var count:int = 0;
        	if (lanes!= null) {
        		for each(var sequenceLane:Object in lanes) {
        			if (sequenceLane.@idSample == sample.@idSample) {
        				count++;
        			}
        		}
        	} 								
        	return count;
		}
		
		private function validateAndSubmitRequest():void {
			
			// Only submit request if it is valid
			validateRequest();
			if (errorMessage != '') {
				Alert.show(errorMessage, "Error", Alert.OK, null, null, parentApplication.iconError);
				return;
			}
			if (warningMessage != '') {
				promptToSubmitRequest();
				return;
			}
			submitRequest();
		}
		
		private function validateAndSaveRequest():void {
			
			// Only save request if it is valid
			validateRequest();
			if (errorMessage != '') {
				Alert.show(errorMessage, "Error", Alert.OK, null, null, parentApplication.iconError);
				return;
			}
			if (warningMessage != '') {
				promptToSaveRequest();
				return;
			}
			saveRequest();
		}
		
		
		
		private function submitRequest():void {
			
			request.@codeRequestCategory = this.requestTypeGroup.selectedValue;
			request.@idLab = labCombo.selectedItem.@idLab;
			request.@idAppUser = idAppUser;
			request.@idBillingAccount = this.billingAccountCombo.selectedItem.@idBillingAccount;
			request.@idProject = projectCombo.selectedItem.@idProject;
			
			request.@idSampleTypeDefault = sampleTypeCombo.selectedItem.@value;
			request.@idSampleSourceDefault = sampleSourceCombo.selectedItem.@value;
			request.@idSamplePrepMethodDefault = samplePrepMethodCombo.selectedItem.@value;
			request.@idOrganismSampleDefault = this.sampleOrganismCombo.selectedItem.@value;

			if (!this.isSolexaState()) {
				request.@idSlideProduct = slideProductCombo.selectedItem.@idSlideProduct;
				request.@codeMicroarrayCategory = this.microarrayCategoryCombo.selectedItem.@codeMicroarrayCategory;				
			}
			
			var requestCategory:Object = parentApplication.manageDictionaries.lastResult.Dictionary.(@className == 'hci.gnomex.model.RequestCategory').DictionaryEntry.(@value == request.@codeRequestCategory);
			
			request.replace("samples", <samples></samples>); 
			for each(var sample:Object in samples) {
				request.samples.appendChild(sample);
			}
			request.replace("hybridizations", <hybridizations></hybridizations>); 
			if (request.@codeRequestCategory != "QC" && request.@codeRequestCategory != "SOLEXA") {
				for each(var hyb:Object in hybs) {
					if (requestCategory.@numberOfChannels != "2") {
						hyb.@idSampleChannel2 = "0";
					}
					request.hybridizations.appendChild(hyb);
				 }
			} else {
				request.@codeMicroarrayCategory = '';
				request.@idSlideProduct = '';
			}
			request.replace("sequenceLanes", <sequenceLanes></sequenceLanes>); 
			if (request.@codeRequestCategory == "SOLEXA") {
				for each(var lane:Object in lanes) {
					request.sequenceLanes.appendChild(lane);
				}
			
			}			

			var params:Object = new Object();
			params.requestXMLString = request.toXMLString();
			params.idProject = projectCombo.selectedItem.@idProject;
			saveNewRequest.send(params);			
			
		}

		
		private function saveRequest():void {
			
			if (!this.isSolexaState()) {
				request.@idSlideProduct = slideProductCombo.selectedItem.@idSlideProduct;
				request.@codeMicroarrayCategory = this.microarrayCategoryCombo.selectedItem.@codeMicroarrayCategory;
			} 			
			
			request.replace("samples", <samples></samples>); 
			for each(var sample:Object in samples) {
				request.samples.appendChild(sample);
			}
			request.replace("hybridizations", <hybridizations></hybridizations>); 
			if (request.@codeRequestCategory != "QC") {
				for each(var hyb:Object in hybs) {
					request.hybridizations.appendChild(hyb);
				 }
			}
			request.replace("sequenceLanes", <sequenceLanes></sequenceLanes>); 
			if (request.@codeRequestCategory == "SOLEXA") {
				for each(var lane:Object in lanes) {
					request.sequenceLanes.appendChild(lane);
				}
			}

			var params:Object = new Object();
			params.requestXMLString = request.toXMLString();
			params.idProject = request.@idProject;
			saveExistingRequest.send(params);			
			
		}
		
		public function promptToSubmitRequest():void {
			Alert.show( warningMessage + "\n\nDo you want to submit the request anyway?", 
						"Warning", 
						(Alert.YES | Alert.NO), this, 
						onPromptSubmitRequest,
						parentApplication.iconWarning);
			
		}
		
		private function onPromptSubmitRequest(event:CloseEvent):void {
            if (event.detail==Alert.YES) {
            	warningMessage = '';
            	submitRequest();
            }
        }
		
		public function promptToSaveRequest():void {
			Alert.show( warningMessage + "\n\nDo you want to save the request anyway?", 
						"Warning", 
						(Alert.YES | Alert.NO), this, 
						onPromptSaveRequest,
						parentApplication.iconWarning);
			
		}
		
		private function onPromptSaveRequest(event:CloseEvent):void {
            if (event.detail==Alert.YES) {
            	warningMessage = '';
            	saveRequest();
            }
        }
		
		private function onSaveNewRequest(event:ResultEvent):void {
			if (saveNewRequest.lastResult.name() == "SUCCESS") {
				submittedIdRequest = saveNewRequest.lastResult.@idRequest;
				submittedRequestNumber = saveNewRequest.lastResult.@requestNumber;

				confirmButtonStack.selectedIndex = 2;
				var message:String = 'Request #  ' + submittedRequestNumber + ' has been submitted. Please print off the request form and deliver it along with your samples to the Microarray Core Facility.';
				Alert.show(message); 
 				nextButton.enabled = false;
				backButton.enabled = false;
				
				setupView.enabled = false;
				sampleSetupView.enabled = false;
				if (theTab.contains(annotationView)) {
					annotationView.enabled = false;
				}
				samplesView.enabled = false;

				if (this.isSolexaState()) {
					lanesView.enabled = false;
				} else {
					if (theTab.contains(hybSetupView)) {
						hybSetupView.enabled = false;
					}
					if (theTab.contains(hybsView)) {
						hybsView.enabled = false;
					}					
				} 
				
			} else {
				Alert.show(saveNewRequest.lastResult..ACTMESSAGE.@TEXT);
			}
		}
		
		private function onSaveExistingRequest(event:ResultEvent):void {
			if (saveExistingRequest.lastResult.name() == "SUCCESS") {
				
			} else {
				Alert.show(saveExistingRequest.lastResult..ACTMESSAGE.@TEXT);
			}
		}

		private function showPrintableRequestForm():void {
			var url:URLRequest = new URLRequest('http://localhost/gnomex/ShowRequestForm.gx?idRequest=' + submittedIdRequest);
			navigateToURL(url, '_blank');			
		}
		
		public function toggleOtherChipTypeSelections(codeSelected:String):void {
			
			for each(var item:Object in this.bioanalyzerChipTypeGrid.dataProvider) {
				if (item.@value != codeSelected) {
					item.@isSelected = "false";
				}
			}
		}

		private function showCy3LabelCols(isVisible:Boolean):void {
			labelCol1.visible = isVisible;
			labelCol2.visible = isVisible;
			labelCol3.visible = isVisible;
			labelCol4.visible = isVisible;
			labelCol5.visible = isVisible;
		}
			
		private function showCy5LabelCols(isVisible:Boolean):void {
			labelCol6.visible = isVisible;
			labelCol7.visible = isVisible;
			labelCol8.visible = isVisible;
			labelCol9.visible = isVisible;
			labelCol10.visible = isVisible;
		}

		]]>
		
		
	</mx:Script>
	
  	<mx:XMLListCollection id="sampleCharacteristicEntries" source="{request.SampleCharacteristicEntries.SampleCharacteristicEntry}" 
	  	 sort="{sampleCharacteristicSorter}"/>
	<mx:Sort id="sampleCharacteristicSorter" compareFunction="sortSampleCharacteristics" unique="true"/>


	<mx:XMLListCollection id="samples" source="{request.samples.Sample}"/>

	<mx:XMLListCollection id="hybs" source="{request.hybridizations.Hybridization}"/>


	<mx:XMLListCollection id="lanes" source="{request.sequenceLanes.SequenceLane}"/>
  
 	<mx:VBox  width="100%" height="100%" paddingBottom="6" paddingLeft="6" paddingRight="6" paddingTop="6" verticalGap="0">
 	    	
		<mx:TabNavigator  click="theTab.creationPolicy='all'"  id="theTab" width="100%" height="100%" paddingLeft="8" paddingRight="4" paddingBottom="4"  paddingTop="6" change="enableNextButtons()">
			<mx:Canvas  id="setupView" label="Request setup" width="100%" height="100%">
				<mx:VBox width="100%" height="100%" verticalGap="20" paddingTop="10">
					<mx:VBox width="100%" verticalGap="1">
					    <mx:HBox width="100%" horizontalGap="0">
					    <mx:Image source="assets/bullet_orange.png" autoLoad="true"/>
					    <mx:Label text="Select a request type:" width="240"/>
							<mx:HBox width="100%" horizontalGap="8">
								<mx:VBox verticalGap="2" paddingRight="2" paddingBottom="2">
								    <mx:RadioButtonGroup id="requestTypeGroup" />
								    <mx:HBox>
										<mx:RadioButton groupName="requestTypeGroup" label="Agilent Oligo Microarray Platform" value="AGIL" click="setRequestCategoryName()" change="checkSetupCompleteness()" id="requestRadioAgilent"/>							
								    </mx:HBox>
								    <mx:HBox>
										<mx:RadioButton groupName="requestTypeGroup" label="Affymetrix Microarray Platform" value="AFFY" click="setRequestCategoryName()" change="checkSetupCompleteness()" id="requestRadioAffy"/>							
									</mx:HBox>
								    <mx:HBox>
										<mx:RadioButton groupName="requestTypeGroup" label="NimbleGen Microarray Platform" value="NIMBLE" click="setRequestCategoryName()" change="checkSetupCompleteness()" id="requestRadioNimbleGen"/>							
									</mx:HBox>
								</mx:VBox>
								<mx:VBox verticalGap="2" paddingLeft="2" paddingRight="2" paddingBottom="2" height="100%">									
								    <mx:RadioButton groupName="requestTypeGroup" label="Sample Quality" value="QC" click="setRequestCategoryName()" change="checkSetupCompleteness()" id="requestRadioQC"/>														
								</mx:VBox>
								<mx:VBox verticalGap="2" paddingLeft="2" paddingRight="2" paddingBottom="2" height="100%">
									<mx:RadioButton groupName="requestTypeGroup" label="Solexa Sequencing" value="SOLEXA" click="setRequestCategoryName()" change="checkSetupCompleteness()" id="requestRadioSolexa"/>																							
								</mx:VBox>
							</mx:HBox>
					    </mx:HBox>
					</mx:VBox>
					<mx:HBox width="100%" horizontalGap="0">
						<mx:Image source="assets/bullet_orange.png" autoLoad="true"/>
						<mx:Label text="Select the lab submitting this request:" width="240"/>
						<mx:ComboBox dataProvider="{parentApplication.promptedSubmitRequestLabList}" 
							selectedIndex="-1" labelField="@name" 
							width="300"
							 change="parentApplication.filteredProjectListForSubmitRequests.refresh();projectCombo.selectedIndex = -1;checkSetupCompleteness();getMembersOfLab();" id="labCombo">
						</mx:ComboBox>
						<mx:HBox id="appUserContainer" visible="true" paddingLeft="12" horizontalGap="0" width="100%">						    
							<mx:Label text="User submitting request:"/>
							<mx:ComboBox dataProvider="{appUsers}" 
								selectedIndex="-1" labelField="@displayName" 
							    id="appUserCombo" width="200">
								<mx:change>{idAppUser = appUserCombo.selectedItem.@idAppUser;checkSetupCompleteness()}</mx:change>
							</mx:ComboBox>
						</mx:HBox>
					</mx:HBox>
					<mx:VBox width="100%" verticalGap="0">
						<mx:HBox width="100%" horizontalGap="0">
							<mx:Image source="assets/bullet_orange.png"/>
							<mx:Label text="Select the account to be billed:" width="240"/>
							<mx:ComboBox labelField="@accountName" width="300" id="billingAccountCombo" change="checkSetupCompleteness()">
								<mx:dataProvider>{labCombo.selectedItem.billingAccounts.BillingAccount}</mx:dataProvider>
							</mx:ComboBox>
						</mx:HBox>
						<mx:HBox width="100%">
						    <mx:Spacer width="240"/>
						    <mx:Text width="100%">
						        <mx:htmlText><![CDATA[ If billing account is inactive, please download the work authorization form below.<br> Forward the completed form to the Microarray Core Facility (HCI room 3350; Fax 585-0900)]]></mx:htmlText>
							</mx:Text>
							
						</mx:HBox>
						<mx:HBox width="100%">
						    <mx:Spacer width="240"/>
							<mx:LinkButton label="Work authorization form (pdf)" useHandCursor="true" textDecoration="underline" color="#0000ff">
								<mx:click>navigateToURL(new URLRequest('https://hci-as1.hci.utah.edu/gnomex/microarray_work_authorization_form_0906.pdf'), '_blank');</mx:click>
							</mx:LinkButton>
							<mx:LinkButton label="Work authorization form (Microsoft work doc)" textDecoration="underline" useHandCursor="true" color="#0000ff">
								<mx:click>navigateToURL(new URLRequest('https://hci-as1.hci.utah.edu/gnomex/microarray_work_authorization_form_0906.doc'), '_blank');</mx:click>
							</mx:LinkButton>
						</mx:HBox>
						
					</mx:VBox>
					<mx:HBox width="100%" horizontalGap="0">
						<mx:Image source="assets/bullet_orange.png"/>
						<mx:Text width="240" height="50">
							<mx:htmlText>Select a project or create a new project which describes the overall experimental purpose and design:</mx:htmlText>
						</mx:Text>
						<mx:VBox verticalGap="2">
							<mx:ComboBox dataProvider="{parentApplication.filteredProjectListForSubmitRequests}" labelField="@name" width="370" id="projectCombo" change="{checkSetupCompleteness()}">
							</mx:ComboBox>
							<mx:HBox width="100%" horizontalAlign="right">
								<mx:Button id="editProjectButton" label="Edit project..." icon="@Embed('../assets/folder.png')" click="showEditProjectWindow()"/>
								<mx:Button id="newProjectButton" label="New project..." icon="@Embed('../assets/folder_add.png')" click="showNewProjectWindow()"/>
							</mx:HBox>					
						</mx:VBox>
					</mx:HBox>
					<mx:VBox width="100%" verticalGap="1">
					    <mx:HBox horizontalGap="0">
					    <mx:Image source="assets/bullet_orange.png"/>
					    <mx:Label text="Pick a starting point:" width="240"/>
					    	<mx:VBox verticalGap="2" width="100%">
								<mx:RadioButton groupName="requestTemplateGroup" label="Submit a new request from scratch" selected="true" id="submitNewRequestRadio"/>							
								<mx:HBox width="100%">
									<mx:RadioButton groupName="requestTemplateGroup" label="Use a previous request as a template" click="onPickStartingPoint()" id="cloneRequestRadio"/>						
									<mx:Label text="{requestToClone.@label}" color="#0000ff" width="100%"/>
									
								</mx:HBox>
					    		
					    	</mx:VBox>
					    </mx:HBox>
					</mx:VBox>
					
				</mx:VBox>
			</mx:Canvas>
			<mx:Canvas id="sampleSetupView" label="Sample setup" width="100%" height="100%" enabled="false">
				<mx:VBox width="100%" height="100%" verticalGap="2">
					<mx:VBox width="100%" height="100%"  paddingTop="12"  verticalGap="20" id="sampleSetupContainer">
						<mx:HBox width="100%" horizontalGap="0">
							<mx:Image source="assets/bullet_orange.png"/>
							<mx:Label text="How many samples will you be submitting?" width="340" />
							<mx:TextInput width="40" id="numberOfSamples" change="initializeSamplesGrid();checkSampleSetupCompleteness()" backgroundColor="#ffffff"/>							
						</mx:HBox>
						<mx:HBox width="100%" horizontalGap="0">
							<mx:Image source="assets/bullet_orange.png"/>
							<mx:Label text="Select the sample type that best describes your samples:" width="340"/>
							<mx:ComboBox labelField="@display" width="300" id="sampleTypeCombo" change="initializeSamplesGrid();parentApplication.samplePrepMethodList.refresh();propagateSampleType();checkSampleSetupCompleteness();checkForSampleTypeCompatibility()">							
								<mx:dataProvider></mx:dataProvider>
							</mx:ComboBox>
						</mx:HBox>
						<mx:HBox width="100%" horizontalGap="0" id="sampleOrganismContainer">
							<mx:Image source="assets/bullet_orange.png"/>
							<mx:Label text="Select the organism of your samples:" width="340"/>
							<mx:ComboBox labelField="@display" width="300" id="sampleOrganismCombo" change="initializeSamplesGrid();organismCombo.selectedItem = sampleOrganismCombo.selectedItem;propagateSampleOrganism();checkSampleSetupCompleteness()">							
								<mx:dataProvider></mx:dataProvider>
							</mx:ComboBox>
						</mx:HBox>
						<mx:HBox width="100%" horizontalGap="0" id="sampleSourceContainer">
							<mx:Image source="assets/bullet_orange.png"/>
							<mx:Label text="Select the source of your samples:" width="340"/>
							<mx:ComboBox labelField="@display" width="300" id="sampleSourceCombo" change="initializeSamplesGrid();propagateSampleSource();checkSampleSetupCompleteness()">							
								<mx:dataProvider></mx:dataProvider>
							</mx:ComboBox>
						</mx:HBox>
						<mx:HBox width="100%" horizontalGap="0" id="concentrationContainer">
							<mx:Image source="assets/bullet_orange.png"/>
							<mx:Label text="Enter the approximate sample concentration:" width="340"/>
							<mx:TextInput width="40" id="sampleConcentration" change="initializeSamplesGrid();propagateSampleConcentration();checkSampleSetupCompleteness()"/>							
							<mx:Label text="ng/µL" id="concentrationLabel"/>
							<mx:Spacer width="40"/>
						</mx:HBox>
						<mx:HBox width="100%" horizontalGap="0" id="samplePrepContainer">
							<mx:Image source="assets/bullet_orange.png"/>
							<mx:Label text="Select the nucleic acid purification/extraction method:" width="340" id="label2"/>
							<mx:ComboBox labelField="@display" width="300" id="samplePrepMethodCombo" change="initializeSamplesGrid();propagateSamplePrepMethod();checkSampleSetupCompleteness()" >							
								<mx:dataProvider>{parentApplication.samplePrepMethodList}</mx:dataProvider>
							</mx:ComboBox>
						</mx:HBox>
						<mx:VBox id="bioanalyzerContainer" visible="true" width="100%" height="100%">
							<mx:HBox width="100%" horizontalGap="0">
								<mx:Image source="assets/bullet_orange.png"/>
								<mx:Label text="Select a Bioanalyzer Chip Type:" width="340"/>
							</mx:HBox>
							<mx:HBox width="100%">
								<mx:Spacer width="8"/>								
								<mx:DataGrid width="100%" height="90" visible="true" id="bioanalyzerChipTypeGrid"  backgroundAlpha="0"  >
									<mx:dataProvider>{parentApplication.manageDictionaries.lastResult.Dictionary.(@className == 'hci.gnomex.model.BioanalyzerChipType').DictionaryEntry.(@value != '')}</mx:dataProvider>
									<mx:columns>
									    <mx:DataGridColumn id = "isSelectedChipType" headerText=" " 
									        	width="20" 
									        	editable="true"                        	
									        	dataField="@isSelected" 
									        	editorDataField="selected"
									        	itemRenderer="views.CheckBoxIsSelectedChipType" />
										<mx:DataGridColumn headerText="Chip Type" dataField="@bioanalyzerChipType"/>
										<mx:DataGridColumn headerText="Concentration Range" dataField="@concentrationRange"/>
										<mx:DataGridColumn headerText="Max Sample Buffer Strength" dataField="@maxSampleBufferStrength"/>
										<mx:DataGridColumn headerText="Cost per Sample" dataField="@costPerSample"/>
										<mx:DataGridColumn headerText="Sample Wells per Chip" dataField="@sampleWellsPerChip"/>
										
									</mx:columns>
								</mx:DataGrid>
							</mx:HBox>
							<mx:HBox width="100%" horizontalAlign="center" paddingTop="10">
								<mx:HBox borderStyle="inset" backgroundColor="#ffffff" width="90%" verticalAlign="middle" horizontalAlign="center" paddingLeft="10" paddingRight="10" paddingBottom="10" paddingTop="10">
									<mx:Text width="100%" text="Terms:  Bioanalyzer chips will be run when sufficient samples have been collected to load all wells of a chip.  Expedited service can be obtained if the researcher is willing to accept charges for any remaining empty wells on a chip.  Call the Microarray Core Facility (581-6346) for details." color="#0000ff">									
									</mx:Text>
								</mx:HBox>
							</mx:HBox>
							
						</mx:VBox>
						
					</mx:VBox>
					
				</mx:VBox>
				
			</mx:Canvas>
			<mx:Canvas label="Annotations" width="100%" height="100%" enabled="false" id="annotationView">
				<mx:VBox width="100%" height="100%">
					<mx:HBox width="100%" height="100%" horizontalGap="24">
						<mx:VBox height="100%">
						    <mx:HBox>
							    <mx:Image source="assets/bullet_orange.png"/>
							    <mx:Text  htmlText="Specify all sample characteristics you wish to &lt;BR&gt; annotate in subsequent columns:"/>
						    	
						    </mx:HBox>
							<mx:DataGrid id="sampleAnnotationGrid" height="100%" 
								dataProvider="{sampleCharacteristicEntries}" 
								selectionColor="#FFFFFF" fontSize="9"
							showHeaders="true" headerHeight="20" variableRowHeight="true" width="280">
							    <mx:columns>
							        <mx:DataGridColumn headerText=" " 
							        	width="17" 
							        	editable="true"                        	
							        	dataField="@isSelected" 
							        	editorDataField="selected"
							        	itemRenderer="views.CheckBoxIsSelectedSampleCharacteristic" >
							        </mx:DataGridColumn>
							        <mx:DataGridColumn  
							        	headerText="Sample characteristics"
							        	editable="false" editorDataField="selected" 
							        	dataField="@sampleCharacteristic">
							            <mx:itemRenderer>
							                <mx:Component >
							                     <mx:HBox>
							                       <mx:Label text="{data.@sampleCharacteristic}">			                           	
							                       </mx:Label>
							                       <mx:TextInput id="scOtherLabel" fontSize="9"
							                       	text="{data.@otherLabel}"
							                       	change="{data.@otherLabel = scOtherLabel.text;parentDocument.request.@otherLabel = scOtherLabel.text;parentDocument.otherDataColumn.headerText = scOtherLabel.text;parentDocument.otherDataColumnConfirm.headerText = scOtherLabel.text}" 
							                       	width="{data.@sampleCharacteristic == 'Other' ? 130 : 0}"  
							                       	height="{data.@sampleCharacteristic == 'Other' ? 20 : 0}"  
							                       	visible="{data.@sampleCharacteristic == 'Other' ? true : false}" 
							                       	editable="{data.@sampleCharacteristic == 'Other' ? true : false}">			                           
							                       </mx:TextInput>
							                     	
							                     </mx:HBox>
							                </mx:Component>
							            </mx:itemRenderer>
							        </mx:DataGridColumn>
							    </mx:columns>
							</mx:DataGrid>
							
						</mx:VBox>
						<mx:VBox width="100%" height="100%">
							<mx:HBox>
								<mx:Image source="assets/bullet_orange.png"/>
								<mx:Text  htmlText="Describe in general terms how the samples differ:" width="100%" height="28"/>
								
							</mx:HBox>
							<mx:TextArea width="100%" height="100" id="treatmentTextInput" focusOut="propagateTreatment()">
							</mx:TextArea>
							
						</mx:VBox>
						
						
					</mx:HBox>
				
				</mx:VBox>
			</mx:Canvas>
			<mx:Canvas label="Samples"  id="samplesView" width="100%" height="100%"  enabled="false">
				<mx:VBox width="100%" height="100%">
						<mx:HBox width="100%">
							<mx:Label text="Samples  (fields in pink are required.)"/>
						</mx:HBox>
						<mx:HBox width="100%" verticalAlign="middle">
							<mx:HBox>
								<mx:Button label="Add" click="addSample();checkSamplesCompleteness()" icon="@Embed('../assets/table_row_insert.png')" id="addSampleButton"/>
								<mx:Button label="Copy" click="copySample();checkSamplesCompleteness()" icon="@Embed('../assets/table_multiple.png')" id="copySampleButton"/>
								<mx:Button label="Delete" click="deleteSample();checkSamplesCompleteness();checkHybsCompleteness()" icon="@Embed('../assets/table_row_delete.png')" id="deleteSampleButton"/>
							</mx:HBox>
							<mx:Button label="Clear all" click="promptToClearAllSamples();deleteSample();" icon="@Embed('../assets/folder_delete.png')" id="clearSamplesButton"/>
							<mx:HBox width="100%" horizontalAlign="left" paddingLeft="20">
								<mx:CheckBox id="showQCFieldsCheckBox" label="Show QC columns">
								</mx:CheckBox>							
							</mx:HBox>
							<mx:HBox horizontalAlign="right" width="100%">
							</mx:HBox>
								
						</mx:HBox>
						<mx:DataGrid width="100%" height="100%" id="samplesGrid"  editable="true" dataProvider="{samples}" allowMultipleSelection="true" itemFocusOut="checkSamplesCompleteness()" selectionColor="#FFFFB9" rollOverColor="#C0C0C0" horizontalScrollPolicy="auto">
							<mx:columns>
	  					        <mx:DataGridColumn editable="false" headerText=""  width="25" resizable="false" labelFunction="getSamplesGridRowNumber"/>
								<mx:DataGridColumn headerText="Sample Name" width="100" editorDataField="text" dataField="@name" itemRenderer="views.LabelSampleName"  itemEditor="views.renderers.TextInputSampleName" rendererIsEditor="false">
								</mx:DataGridColumn>
				 				<mx:DataGridColumn headerText="Conc." visible="{!showQCFieldsCheckBox.selected}"  width="60" dataField="@concentration" editorDataField="text"  itemRenderer="views.LabelConcentration"  itemEditor="views.renderers.TextInputConcentration" rendererIsEditor="false"/>
				                <mx:DataGridColumn id="concentrationUnitColumn" visible="{!showQCFieldsCheckBox.selected}" width="74" headerText="Unit" dataField="@codeConcentrationUnit" 
				                   editorDataField="value" sortable="false" editable="true" rendererIsEditor="false" itemRenderer="views.renderers.LabelConcentrationUnit" itemEditor="views.renderers.ComboBoxConcentrationUnit" labelFunction="parentApplication.lookupConcentrationUnit" />
				                 <mx:DataGridColumn headerText="Sample Type" visible="{!showQCFieldsCheckBox.selected}" width="120"   dataField="@idSampleType" 
				                   editorDataField="value" sortable="false" editable="true" rendererIsEditor="false" itemRenderer="views.renderers.LabelSampleType" itemEditor="views.renderers.ComboBoxSampleType" labelFunction="parentApplication.lookupSampleTypeName" />
				                <mx:DataGridColumn id="sampleOrganismColumn" visible="{!showQCFieldsCheckBox.selected}" width="110" headerText="Organism"  dataField="@idOrganism" 
				                    editorDataField="value" sortable="false" editable="true" rendererIsEditor="false" itemRenderer="views.renderers.LabelOrganism" itemEditor="views.renderers.ComboBoxOrganism" labelFunction="parentApplication.lookupOrganism" />
				                <mx:DataGridColumn headerText="Sample Source" visible="{!showQCFieldsCheckBox.selected}" width="95" dataField="@idSampleSource" 
				                   editorDataField="value" id="sampleSourceColumn" sortable="false" editable="true" rendererIsEditor="false" itemRenderer="views.renderers.LabelSampleSource" itemEditor="views.renderers.ComboBoxSampleSource" labelFunction="parentApplication.lookupSampleSource" />
				                <mx:DataGridColumn headerText="Sample Prep Method" visible="{!showQCFieldsCheckBox.selected}"  width="180" dataField="@idSamplePrepMethod" 
				                   editorDataField="value" sortable="false" editable="true" rendererIsEditor="false" itemRenderer="views.renderers.LabelSamplePrepMethod" labelFunction="parentApplication.lookupSamplePrepMethod" itemEditor="views.renderers.ComboBoxSamplePrepMethod" />
				                <mx:DataGridColumn id="chipTypeColumn" visible="{showQCFieldsCheckBox.selected || request.@codeRequestCategory != 'QC' ? false : true}" headerText="Chip Type" width="70" dataField="@codeBioanalyzerChipType" 
				                   editorDataField="value" sortable="false" editable="true" rendererIsEditor="false" itemRenderer="mx.controls.Label" labelFunction="parentApplication.lookupChipType" itemEditor="views.renderers.ComboBoxChipType" />

								<mx:DataGridColumn visible="{showQCFieldsCheckBox.selected}" editable="{parentApplication.hasPermission('canWriteAnyObject')}" headerText="QC Conc." width="70" dataField="@qualCalcConcentration"/>
								<mx:DataGridColumn visible="{showQCFieldsCheckBox.selected}" editable="{parentApplication.hasPermission('canWriteAnyObject')}" headerText="QC 260/230" width="80" dataField="@qual260nmTo230nmRatio"/>
								<mx:DataGridColumn visible="{showQCFieldsCheckBox.selected}" editable="{parentApplication.hasPermission('canWriteAnyObject')}" headerText="QC 260/280" width="80" dataField="@qual260nmTo280nmRatio"/>
								<mx:DataGridColumn visible="{showQCFieldsCheckBox.selected}" editable="{parentApplication.hasPermission('canWriteAnyObject')}" headerText="QC 28s/18s" width="80" dataField="@qual28sTo18sRibosomalRatio"/>
								<mx:DataGridColumn visible="{showQCFieldsCheckBox.selected}" editable="{parentApplication.hasPermission('canWriteAnyObject')}" headerText="QC RIN" width="70" dataField="@qualRINNumber"/>
								<mx:DataGridColumn visible="{showQCFieldsCheckBox.selected}" headerText="QC Status" width="90" dataField="@qualStatus"
				                   editorDataField="value" sortable="false" editable="true" rendererIsEditor="false" itemEditor="views.renderers.ComboBoxQCStatus" itemRenderer="mx.controls.Label" />
				                   				                   
								<mx:DataGridColumn id="AGE" headerText="Age" dataField="@AGE" editable="true" visible="false"/>
								<mx:DataGridColumn id="CELLLINE" headerText="Cell line" dataField="@CELLLINE" editable="true" visible="false"/>
								<mx:DataGridColumn id="CELLTYPE" headerText="Cell Type" dataField="@CELLTYPE" editable="true" visible="false"/>
								<mx:DataGridColumn id="CLININFO" headerText="Clinical Info" dataField="@CLININFO" editable="true" visible="false"/>
								<mx:DataGridColumn id="COMPOUND" headerText="Compound" dataField="@COMPOUND" editable="true" visible="false"/>
								<mx:DataGridColumn id="DISSTATE" headerText="Disease State" dataField="@DISSTATE" editable="true" visible="false"/>
								<mx:DataGridColumn id="DOSE" headerText="Dose" dataField="@DOSE" editable="true" visible="false"/>
								<mx:DataGridColumn id="GENMOD" headerText="Genetic Modification" dataField="@GENMOD" editable="true" visible="false"/>
								<mx:DataGridColumn id="GENOTYPE" headerText="Genotype" dataField="@GENOTYPE" editable="true" visible="false"/>
								<mx:DataGridColumn id="GROWTHCOND" headerText="Growth Conditions" dataField="@GROWTHCOND" editable="true" visible="false"/>
								<mx:DataGridColumn id="INDIV" headerText="Individual" dataField="@INDIV" editable="true" visible="false"/>
								<mx:DataGridColumn id="ORGPART" headerText="Organ / Tissue" dataField="@ORGPART" editable="true" visible="false"/>
								<mx:DataGridColumn id="SEX" headerText="Sex" dataField="@SEX" editable="true" visible="false"/>
								<mx:DataGridColumn id="TEMP" headerText="Temperature" dataField="@TEMP" editable="true" visible="false"/>
								<mx:DataGridColumn id="TIME" headerText="Time Course" dataField="@TIME" editable="true" visible="false"/>
								<mx:DataGridColumn id="otherDataColumn" headerText="Other" dataField="@OTHER" editable="true" visible="false"/>
								<mx:DataGridColumn id="treatmentColumn" headerText="Treatment" visible="false" width="100" dataField="@treatment"/>
								<mx:DataGridColumn headerText="Description" width="100" dataField="@description"/>
							</mx:columns>
						</mx:DataGrid>

						
					
				</mx:VBox>
			</mx:Canvas>
			<mx:Canvas label="Hyb setup" width="100%" height="100%" enabled="false" id="hybSetupView">
				<mx:VBox width="100%" height="100%" verticalGap="20" paddingTop="10">
					<mx:HBox width="100%" horizontalGap="0">
						<mx:Image source="assets/bullet_orange.png"/>
						<mx:Label text="Select an organism:" width="300" />
						<mx:ComboBox labelField="@display" width="300" id="organismCombo">							
							<mx:change>parentApplication.filteredSlideProductListForSubmitRequests.refresh();slideProductCombo.selectedIndex = -1;clearHybSlideDesigns();checkHybSetupCompleteness();checkForSlideProductWarning()</mx:change>
							<mx:dataProvider></mx:dataProvider>
						</mx:ComboBox>
					</mx:HBox>
					<mx:HBox width="100%" horizontalGap="0">
						<mx:Image source="assets/bullet_orange.png"/>
						<mx:Label text="Select an experiment category:" width="300" />
						<mx:ComboBox labelField="@display" width="300" id="microarrayCategoryCombo">							
							<mx:change>parentApplication.filteredSlideProductListForSubmitRequests.refresh();slideProductCombo.selectedIndex = -1;clearHybSlideDesigns();checkHybSetupCompleteness();checkForSlideProductWarning();callLater(checkForSampleTypeCompatibility)</mx:change>
							<mx:dataProvider></mx:dataProvider>
						</mx:ComboBox>
					</mx:HBox>
					<mx:HBox width="100%" horizontalGap="0">
						<mx:Image source="assets/bullet_orange.png"/>
						<mx:Label text="Select on of the following:" width="300" />
						<mx:RadioButtonGroup id="customVsCatalogRadioGroup"/>
						<mx:RadioButton label="Catalog microarray" groupName="customVsCatalogRadioGroup" id="isCatalogRadio" selected="true" click="parentApplication.filteredSlideProductListForSubmitRequests.refresh();slideProductCombo.selectedIndex = -1;clearHybSlideDesigns();checkHybSetupCompleteness();checkForSlideProductWarning();callLater(checkForSampleTypeCompatibility)">
							<mx:change>parentApplication.filteredSlideProductListForSubmitRequests.refresh();slideProductCombo.selectedIndex = -1;checkHybSetupCompleteness()</mx:change>
						</mx:RadioButton>
						<mx:RadioButton label="Custom microarray" groupName="customVsCatalogRadioGroup" id="isCustomRadio" click="parentApplication.filteredSlideProductListForSubmitRequests.refresh();slideProductCombo.selectedIndex = -1;clearHybSlideDesigns();checkHybSetupCompleteness();checkForSlideProductWarning();callLater(checkForSampleTypeCompatibility)">
							<mx:change>parentApplication.filteredSlideProductListForSubmitRequests.refresh();slideProductCombo.selectedIndex = -1;checkHybSetupCompleteness()</mx:change>
						</mx:RadioButton>
					</mx:HBox>
					<mx:HBox width="100%" horizontalGap="0">
						<mx:Image source="assets/bullet_orange.png"/>
						<mx:Text width="300">
							<mx:htmlText><![CDATA[Select the microarray slide or slide set to be used <BR> for these hybridizations:]]></mx:htmlText>
						</mx:Text>
						<mx:ViewStack id="slideProductStack" width="100%" height="100%">
						    <mx:HBox>
								<mx:ComboBox labelField="@display" width="420" id="slideProductCombo"  change="{initializeHybsGrid();clearHybSlideDesigns();initializeSlideDesigns();propagateSlideDesign();assignSlideNumbers();checkHybSetupCompleteness()}" >							
									<mx:dataProvider>{parentApplication.filteredSlideProductListForSubmitRequests}</mx:dataProvider>
								</mx:ComboBox>
						    </mx:HBox>
						    <mx:HBox width="100%" backgroundColor="#ffffff" borderStyle="inset" verticalAlign="middle">
								<mx:Text width="100%" text="{'No ' + (isCatalogRadio.selected ? 'catalog ': 'custom ') + this.requestCategoryName + ' ' + organismCombo.selectedItem.@display + ' ' + microarrayCategoryCombo.selectedItem.@display + ' slides are listed.  Please contact Brian Dalley about slide stock.'}" color="#0000ff">								
								</mx:Text>						    	
						    </mx:HBox>
							
							
						</mx:ViewStack>
					</mx:HBox>
					<mx:HBox width="100%" horizontalGap="0" id="numberOfHybsContainer">
						<mx:Image source="assets/bullet_orange.png"/>
						<mx:Text width="300" >
							<mx:htmlText><![CDATA[How many hybridizations will be performed on this <BR>experiment request?]]></mx:htmlText>
						</mx:Text>
						<mx:TextInput width="40" id="numberOfHybs" change="initializeHybsGrid();clearHybSlideDesigns();initializeSlideDesigns();checkHybSetupCompleteness()">
							
						</mx:TextInput>
					</mx:HBox>
					<mx:HBox width="100%" horizontalGap="0" id="slideSourceContainer">
						<mx:Image source="assets/bullet_orange.png"/>
						<mx:Label text="Where will the microarrays come from?" width="300" />
						<mx:VBox verticalGap="1">
							<mx:CheckBox label="New microarray purchased from core facility"  id="coreSlideSourceCheckbox"   click="this.toggleCheckedCodeSlideSource(1);;initializeHybsGrid();clearHybSlideDesigns();initializeSlideDesigns();propagateCheckCodeSlideSource();checkHybSetupCompleteness();"/>
							<mx:CheckBox label="New microarray purchased by lab"  id="clientSlideSourceCheckbox"  click="this.toggleCheckedCodeSlideSource(2);initializeHybsGrid();clearHybSlideDesigns();initializeSlideDesigns();propagateCheckCodeSlideSource();checkHybSetupCompleteness();"/>
							<mx:CheckBox label="Strip and reuse existing microarray" id="stripSlideSourceCheckbox"  click="this.toggleCheckedCodeSlideSource(3);initializeHybsGrid();clearHybSlideDesigns();initializeSlideDesigns();propagateCheckCodeSlideSource();checkHybSetupCompleteness();"/>
						</mx:VBox>
					</mx:HBox>
					
				</mx:VBox>
			</mx:Canvas>
			<mx:Canvas label="Hybs" width="100%" height="100%" enabled="false" id="hybsView">
			    <mx:VBox width="100%" height="100%" verticalGap="0">
				    <mx:HDividedBox height="100%" width="100%">
				        <mx:Panel  title="Samples" height="100%" verticalGap="4">
				        	<views:DataGrid
				        		dragProxyImage="views.DataGridSampleDragProxy" 
				        		 height="100%" width="100%" 
				        		 dataProvider="{samples}" labelField="@name" 
				        		 dragEnabled="true" id="sampleDragGrid" selectionColor="#FFFFB9" rollOverColor="#C0C0C0" showHeaders="false">
								<views:columns>
									<mx:DataGridColumn headerText = "Samples" width="80" dataField="@name"/>
						            <mx:DataGridColumn width="20"  labelFunction="getChannelCountLabelFunction" headerText="">
						                <mx:itemRenderer>
						                    <mx:Component >
						                        <mx:HBox  horizontalGap="0" >
						                          <mx:Image source="{data.@channel1Count > 0 ? '../assets/bullet_green.png' : ''}">
						                    	 </mx:Image> 
						                          <mx:Image source="{data.@channel2Count > 0 ? '../assets/bullet_red.png' : ''}">
						                    	 </mx:Image> 
						                        </mx:HBox>
						                    </mx:Component>
						                </mx:itemRenderer>
						            </mx:DataGridColumn> 
								</views:columns>
											        				        		
				         	</views:DataGrid>
				        </mx:Panel>
						<mx:Panel  id="hybsContainer" width="100%" height="100%">
						   <mx:title><![CDATA[Hybridizations    (Drag sample onto Cy3 or Cy5 Sample cell)]]></mx:title>
								<mx:HBox width="100%" verticalAlign="middle" paddingLeft="4" paddingTop="4">
									<mx:HBox>
										<mx:Button label="Add" click="addHyb();checkHybsCompleteness()" icon="@Embed('../assets/table_row_insert.png')" id="addHybButton"/>
										<mx:Button label="Copy" click="copyHyb();checkHybsCompleteness()" icon="@Embed('../assets/table_multiple.png')" id="copyHybButton"/>
										<mx:Button label="Delete" click="deleteHyb();checkHybsCompleteness()" icon="@Embed('../assets/table_row_delete.png')" id="deleteHybButton"/>
										<mx:Button label="Clear all" click="promptToClearAllHybs()" icon="@Embed('../assets/folder_delete.png')" id="clearHybsButton"/>
									</mx:HBox>
									
									<mx:HBox horizontalAlign="right" width="100%">
										<mx:HBox width="100%" horizontalGap="0"  horizontalAlign="left" label="Show Cy5 Labeling data" paddingBottom="2" verticalAlign="middle" paddingLeft="8" paddingTop="2">
											<mx:Label text="Show other columns:" id="showWorkflowLabel"/>
											<mx:CheckBox id="showCy3LabelingFieldsCheckBox" label="Cy3 Labeling" click="showCy3LabelCols(showCy3LabelingFieldsCheckBox.selected)" paddingLeft="0" paddingBottom="0" paddingRight="0"/>
											<mx:CheckBox id="showCy5LabelingFieldsCheckBox" label="Cy5 Labeling" click="showCy5LabelCols(showCy5LabelingFieldsCheckBox.selected)" paddingLeft="0" paddingRight="0"/>
											<mx:CheckBox id="showHybFieldsCheckBox" label="Hyb" paddingLeft="0" paddingRight="0"/>
											<mx:CheckBox id="showExtFieldsCheckBox" label="Scan/FE data" paddingLeft="0" paddingRight="0"/>
										</mx:HBox>
									</mx:HBox>
										
								</mx:HBox>
							<views:DataGridAlternatingGroup width="100%" height="100%" id="hybsGrid"  editable="true" dataProvider="{hybs}" allowMultipleSelection="true" dropEnabled="true" dragDrop="onDragDrop(event)" itemFocusOut="checkHybsCompleteness()" rollOverColor="#C0C0C0" selectionColor="#FFFFB9" horizontalScrollPolicy="auto">
								<views:columns>
								    <mx:DataGridColumn editable="false" headerText=""   resizable="false" width="25" labelFunction="getHybsGridRowNumber"/>
						            <mx:DataGridColumn width="50" id="slideNumberColumn" headerText="Slide">
						                <mx:itemRenderer>
						                    <mx:Component >
						                        <mx:HBox  horizontalGap="0" >
						                          <mx:Image id="experimentImage"  source="{data.@showSlideIcon == 'Y' ? '../assets/color_swatch.png' : ''}">
						                    	 </mx:Image> 
						                          <mx:Label  text="{data.@showSlideIcon == 'Y' ? data.@slideNumber : ''}">
						                    	 </mx:Label>  
						                        </mx:HBox>
						                    </mx:Component>
						                </mx:itemRenderer>
						            </mx:DataGridColumn> 
								    <mx:DataGridColumn headerText="Cy3 Sample (green)"  width="122" 
								    	labelFunction="getSampleChannel1Name" 
                                        editorDataField="text" sortable="false" editable="true" rendererIsEditor="false" itemEditor="views.renderers.TextInputSampleChannel1" itemRenderer="views.renderers.LabelSampleChannel1" />								    	
								    <mx:DataGridColumn id="channel2SampleColumn" headerText="Cy5 Sample (red)"  width="122" 
								    	labelFunction="getSampleChannel2Name" 
                                        editorDataField="text" sortable="false" editable="true" rendererIsEditor="false" itemEditor="views.renderers.TextInputSampleChannel2" itemRenderer="mx.controls.Label" />								    	
                                        
                                        
								<mx:DataGridColumn id="labelCol1"  visible="false"  headerText="Channel1 Labeling protocol"  labelFunction="parentApplication.lookupLabelingProtocolChannel1" width="80" dataField="@idLabelingProtocolChannel1">
									<mx:headerRenderer >
									<mx:Component>
										<mx:VBox verticalGap="0"   horizontalAlign="center" verticalAlign="middle">
										    <mx:Label text="Cy3 Label"/>
										    <mx:Label text="Protocol"/>
										</mx:VBox>
									</mx:Component>
									</mx:headerRenderer>
								</mx:DataGridColumn>
								<mx:DataGridColumn id="labelCol2"  visible="false" headerText="Channel1 Labeling yield" width="80" dataField="@labelingYieldChannel1">
									<mx:headerRenderer>
									<mx:Component>
										<mx:VBox verticalGap="0" horizontalAlign="center" verticalAlign="middle">
										    <mx:Label text="Cy3 Label"/>
										    <mx:Label text="Yield"/>
										</mx:VBox>
									</mx:Component>
									</mx:headerRenderer>
								</mx:DataGridColumn>
								<mx:DataGridColumn id="labelCol3"  visible="false" headerText="Channel1 Labeling Reaction size" width="80" dataField="@codeLabelingReactionSizeChannel1">
									<mx:headerRenderer>
									<mx:Component>
										<mx:VBox verticalGap="0" horizontalAlign="center" verticalAlign="middle">
										    <mx:Label text="Cy3 Label"/>
										    <mx:Label text="Reaction size"/>
										</mx:VBox>
									</mx:Component>
									</mx:headerRenderer>
								</mx:DataGridColumn>
								<mx:DataGridColumn id="labelCol4"  visible="false" headerText="Channel1 Labeling # Reactions" width="80" dataField="@numberOfReactionsChannel1">
									<mx:headerRenderer>
									<mx:Component>
										<mx:VBox verticalGap="0" horizontalAlign="center" verticalAlign="middle">
										    <mx:Label text="Cy3 Label"/>
										    <mx:Label text="# reactions"/>
										</mx:VBox>
									</mx:Component>
									</mx:headerRenderer>
								</mx:DataGridColumn>
								<mx:DataGridColumn  id="labelCol5"   visible="false" headerText="Channel1 Labeling Status" width="80" dataField="@labelingStatusChannel1">
									<mx:headerRenderer>
									<mx:Component>
										<mx:VBox verticalGap="0" horizontalAlign="center" verticalAlign="middle">
										    <mx:Label text="Cy3 Label"/>
										    <mx:Label text="Status"/>
										</mx:VBox>
									</mx:Component>
									</mx:headerRenderer>
								</mx:DataGridColumn>
								<mx:DataGridColumn id="labelCol6"   visible="false" headerText="Channel2 Labeling protocol"  labelFunction="parentApplication.lookupLabelingProtocolChannel2" width="80" dataField="@idLabelingProtocolChannel2">
									<mx:headerRenderer>
									<mx:Component>
										<mx:VBox verticalGap="0" horizontalAlign="center" verticalAlign="middle">
										    <mx:Label text="Cy5 Label"/>
										    <mx:Label text="Protocol"/>
										</mx:VBox>
									</mx:Component>
									</mx:headerRenderer>
								</mx:DataGridColumn>
								<mx:DataGridColumn id="labelCol7"   visible="false" headerText="Channel2 Labeling yield" width="80" dataField="@labelingYieldChannel2">
									<mx:headerRenderer>
									<mx:Component>
										<mx:VBox verticalGap="0" horizontalAlign="center" verticalAlign="middle">
										    <mx:Label text="Cy5 Label"/>
										    <mx:Label text="Yield"/>
										</mx:VBox>
									</mx:Component>
									</mx:headerRenderer>
								</mx:DataGridColumn>
								<mx:DataGridColumn id="labelCol8"  visible="false" headerText="Channel2 Labeling Reaction size" width="80" dataField="@codeLabelingReactionSizeChannel2">
									<mx:headerRenderer>
									<mx:Component>
										<mx:VBox verticalGap="0" horizontalAlign="center" verticalAlign="middle">
										    <mx:Label text="Cy5 Label"/>
										    <mx:Label text="Reaction size"/>
										</mx:VBox>
									</mx:Component>
									</mx:headerRenderer>
								</mx:DataGridColumn>
								<mx:DataGridColumn id="labelCol9"  visible="false"  headerText="Channel2 Labeling # Reactions" width="80" dataField="@numberOfReactionsChannel2">
									<mx:headerRenderer>
									<mx:Component>
										<mx:VBox verticalGap="0" horizontalAlign="center" verticalAlign="middle">
										    <mx:Label text="Cy5 Label"/>
										    <mx:Label text="# reactions"/>
										</mx:VBox>
									</mx:Component>
									</mx:headerRenderer>
								</mx:DataGridColumn>
								<mx:DataGridColumn id="labelCol10"   visible="false" headerText="Channel2 Labeling Status" width="80" dataField="@labelingStatusChannel2">
									<mx:headerRenderer>
									<mx:Component>
										<mx:VBox verticalGap="0" horizontalAlign="center" verticalAlign="middle">
										    <mx:Label text="Cy5 Label"/>
										    <mx:Label text="Status"/>
										</mx:VBox>
									</mx:Component>
									</mx:headerRenderer>
								</mx:DataGridColumn>



								<mx:DataGridColumn visible="{showHybFieldsCheckBox.selected}" headerText="Hyb Slide barcode" width="70" dataField="@slideBarcode"/>
								<mx:DataGridColumn visible="{showHybFieldsCheckBox.selected}" headerText="Coordinate" width="70" dataField="@arrayCoordinateName"/>
								<mx:DataGridColumn visible="{showHybFieldsCheckBox.selected}" headerText="Hyb Protocol" width="70" labelFunction="parentApplication.lookupHybProtocol"  dataField="@idHybProtocol"/>
								<mx:DataGridColumn visible="{showHybFieldsCheckBox.selected}" headerText="Hyb Status" width="90" dataField="@hybStatus"/>


								<mx:DataGridColumn visible="{showExtFieldsCheckBox.selected}" headerText="Scan Protocol" width="70" labelFunction="parentApplication.lookupScanProtocol" dataField="@idScanProtocol"/>
								<mx:DataGridColumn visible="{showExtFieldsCheckBox.selected}" headerText="F/E Protocol" width="70" labelFunction="parentApplication.lookupFeatureExtractionProtocol" dataField="@idFeatureExtractionProtocol"/>
								<mx:DataGridColumn visible="{showExtFieldsCheckBox.selected}" headerText="Ext Status" width="90" dataField="@extractionStatus"/>


                                        
                                        
                                        
                                        
                                        
						             <mx:DataGridColumn id="slideDesignColumn" visible="{showCy3LabelingFieldsCheckBox.selected || showCy5LabelingFieldsCheckBox.selected || showHybFieldsCheckBox.selected || showExtFieldsCheckBox.selected ? false : true}"  headerText="Slide"  width="250" dataField="@idSlideDesign" 						             						             
						                editorDataField="value" sortable="false" labelFunction="parentApplication.lookupSlideDesignName" editable="true" rendererIsEditor="false" itemRenderer="views.renderers.LabelSlideDesign" itemEditor="views.renderers.ComboBoxSlideDesign" />
						             <mx:DataGridColumn visible="{showCy3LabelingFieldsCheckBox.selected || showCy5LabelingFieldsCheckBox.selected || showHybFieldsCheckBox.selected || showExtFieldsCheckBox.selected ? false : true}"  headerText="Slide Source"  width="78" dataField="@codeSlideSource" 
						                editorDataField="value" sortable="false" editable="true" labelFunction="parentApplication.lookupSlideSource" rendererIsEditor="false" itemRenderer="views.renderers.LabelSlideSource" itemEditor="views.renderers.ComboBoxSlideSource" />
									<mx:DataGridColumn headerText="Notes" visible="{showCy3LabelingFieldsCheckBox.selected || showCy5LabelingFieldsCheckBox.selected || showHybFieldsCheckBox.selected || showExtFieldsCheckBox.selected ? false : true}"  width="100" dataField="@notes"/>
								</views:columns>
							</views:DataGridAlternatingGroup>
							
						</mx:Panel>
				    	
				    </mx:HDividedBox>

			    </mx:VBox>
			</mx:Canvas>
			<mx:Canvas label="Confirm" width="100%" height="100%" enabled="false" id="confirmView">
			<mx:VBox id="confirmHeaderContainer"  width="100%" height="100%" backgroundAlpha="0.0" verticalGap="0">




			<mx:VBox   width="100%" height="100%" backgroundAlpha="0.0" verticalGap="5" paddingBottom="5" paddingLeft="5" paddingRight="5" paddingTop="0" id="confirmContainer">
				<mx:HBox width="100%" horizontalGap="20">
					<mx:VBox height="100%" verticalGap="0">
						<mx:Label text="Request Kind" textDecoration="underline" height="16"/>
						<mx:Text text="{requestCategoryName}" id="requestKindLabel"/>
					</mx:VBox>
					<mx:VBox height="100%" verticalGap="0">
						<mx:Label text="Lab" textDecoration="underline" height="16"/>
						<mx:Text text="{labCombo.selectedItem.@name}"/>
					</mx:VBox>
					<mx:VBox height="100%" verticalGap="0">
						<mx:Label text="Project" textDecoration="underline" height="16"/>
						<mx:Text text="{projectCombo.selectedItem.@name}"/>
					</mx:VBox>
					<mx:VBox height="100%" verticalGap="0">
						<mx:Label text="Billing Account" textDecoration="underline" height="16"/>
						<mx:Text text="{billingAccountCombo.selectedItem.@accountName}"/>
					</mx:VBox>
				</mx:HBox>
					<mx:VBox verticalGap="0" width="100%" height="100%" id="samplesConfirmContainer">
						<mx:Label text="{samples.length + ' Samples'}" id="label1"/>
						<mx:DataGrid width="100%" id="samplesGridConfirm"  editable="false" dataProvider="{samples}" backgroundAlpha="0" borderStyle="solid" selectionColor="#FFFFB9" rollOverColor="#C0C0C0" horizontalScrollPolicy="auto" height="100%">
							<mx:columns>
							    <mx:DataGridColumn editable="false" headerText=""  width="25" resizable="false" labelFunction="getSamplesGridRowNumber"/>
								<mx:DataGridColumn headerText="Sample Name" width="100" dataField="@name"/>
								<mx:DataGridColumn headerText="Conc." width="65" dataField="@concentration"/>
				                <mx:DataGridColumn id="concentrationUnitConfirmColumn" headerText="Unit"  width="60" labelFunction="parentApplication.lookupConcentrationUnit" />
					            <mx:DataGridColumn headerText="Sample Type"  width="130" labelFunction="parentApplication.lookupSampleTypeName"/>
					            <mx:DataGridColumn headerText="Organism" id="sampleOrganismConfirmColumn" width="100" labelFunction="parentApplication.lookupOrganism"/>
					            <mx:DataGridColumn headerText="Sample Source" id="sampleSourceConfirmColumn" width="90" labelFunction="parentApplication.lookupSampleSource"/>
					            <mx:DataGridColumn headerText="Sample Prep Method"  width="160" labelFunction="parentApplication.lookupSamplePrepMethod"/>
				                <mx:DataGridColumn id="chipTypeConfirmColumn" headerText="Chip Type"  width="80" labelFunction="parentApplication.lookupChipType" />
								<mx:DataGridColumn id="AGE0" headerText="Age" dataField="@AGE" editable="true" visible="false"/>
								<mx:DataGridColumn id="CELLLINE0" headerText="Cell line" dataField="@CELLLINE" editable="true" visible="false"/>
								<mx:DataGridColumn id="CELLTYPE0" headerText="Cell Type" dataField="@CELLTYPE" editable="true" visible="false"/>
								<mx:DataGridColumn id="CLININFO0" headerText="Clinical Info" dataField="@CLININFO" editable="true" visible="false"/>
								<mx:DataGridColumn id="COMPOUND0" headerText="Compound" dataField="@COMPOUND" editable="true" visible="false"/>
								<mx:DataGridColumn id="DISSTATE0" headerText="Disease State" dataField="@DISSTATE" editable="true" visible="false"/>
								<mx:DataGridColumn id="DOSE0" headerText="Dose" dataField="@DOSE" editable="true" visible="false"/>
								<mx:DataGridColumn id="GENMOD0" headerText="Genetic Modification" dataField="@GENMOD" editable="true" visible="false"/>
								<mx:DataGridColumn id="GENOTYPE0" headerText="Genotype" dataField="@GENOTYPE" editable="true" visible="false"/>
								<mx:DataGridColumn id="GROWTHCOND0" headerText="Growth Conditions" dataField="@GROWTHCOND" editable="true" visible="false"/>
								<mx:DataGridColumn id="INDIV0" headerText="Individual" dataField="@INDIV" editable="true" visible="false"/>
								<mx:DataGridColumn id="ORGPART0" headerText="Organ / Tissue" dataField="@ORGPART" editable="true" visible="false"/>
								<mx:DataGridColumn id="SEX0" headerText="Sex" dataField="@SEX" editable="true" visible="false"/>
								<mx:DataGridColumn id="TEMP0" headerText="Temperature" dataField="@TEMP" editable="true" visible="false"/>
								<mx:DataGridColumn id="TIME0" headerText="Time Course" dataField="@TIME" editable="true" visible="false"/>
								<mx:DataGridColumn id="otherDataColumnConfirm" headerText="Other" dataField="@OTHER" editable="true" visible="false"/>
								<mx:DataGridColumn id="treatmentConfirmColumn" headerText="Treatment" visible="false" width="100" dataField="@treatment"/>
								<mx:DataGridColumn headerText="Description" width="100" dataField="@description"/>
							</mx:columns>
						</mx:DataGrid>
						
				</mx:VBox>
					<mx:VBox width="100%" height="100%" verticalGap="0" id="hybsConfirmContainer">
						<mx:Label text="{hybs.length + ' Hybridizations'}"/>
						<mx:DataGrid width="100%" height="100%" id="hybsGridConfirm" editable="false" dataProvider="{hybs}"  backgroundAlpha="0" borderStyle="solid" rollOverColor="#C0C0C0" selectionColor="#FFFFB9">
							<mx:columns>
							    <mx:DataGridColumn editable="false" headerText=""   resizable="false" width="70" labelFunction="getHybsGridRowNumber"/>
							    <mx:DataGridColumn editable="false" headerText="Cy3 Sample (green)"  width="122" labelFunction="getSampleChannel1Name"/>
							    <mx:DataGridColumn id="channel2SampleConfirmColumn" editable="false" headerText="Cy5 Sample (red)"  width="122" labelFunction="getSampleChannel2Name"/>
							     <mx:DataGridColumn headerText="Slide"  width="320" labelFunction="parentApplication.lookupSlideDesignName" />
							     <mx:DataGridColumn headerText="Slide Source"  width="82"  labelFunction="parentApplication.lookupSlideSource" />
								<mx:DataGridColumn headerText="Notes" width="100" dataField="@notes"/>
							</mx:columns>
						</mx:DataGrid>
						
					</mx:VBox>
				</mx:VBox>
				
			</mx:VBox>
			</mx:Canvas>
		</mx:TabNavigator>
	</mx:VBox>
	
 	   <mx:ControlBar>
 		<mx:ViewStack id="buttonStack" width="100%">
	 	    <mx:HBox width="100%" >
				<mx:Button label="&lt; Back" enabled="false" visible="true" id="backButton" click="previousTab()"/>
				<mx:Button id="nextButton"  label="Next &gt;" enabled="false" click="nextTab()"/>
				<mx:ViewStack id="confirmButtonStack" width="100%" height="28">
							<mx:HBox width="100%"  verticalAlign="top" horizontalAlign="left">
								<mx:Button visible="false" />
							</mx:HBox>
							<mx:HBox width="100%"  verticalAlign="top" horizontalAlign="left">
								<mx:Button label="Submit" id="submitButton" enabled="true" icon="@Embed('../assets/tick.png')" click="validateAndSubmitRequest()"  visible="true"/>
							</mx:HBox>
							<mx:HBox width="100%" horizontalAlign="left" verticalAlign="top" borderStyle="none"  paddingTop="0" paddingRight="2" paddingLeft="2">
								<mx:Button label="Request form" click="showPrintableRequestForm()" icon="@Embed('../assets/page.png')"/>
								<mx:HBox width="100%" >
									<mx:Text width="100%" color="#0000ff" condenseWhite="true" letterSpacing=".1" paddingBottom="0" paddingLeft="0" paddingRight="0" paddingTop="0" leading="0" height="28">
									</mx:Text>
									
								</mx:HBox>
							</mx:HBox>
					    	
				</mx:ViewStack>
				<mx:HBox horizontalAlign="right">
					<mx:Button label="Cancel" id="cancelButton0" click="promptToCancelRequest()"/>
				</mx:HBox>
	 	    </mx:HBox>
	 	    <mx:HBox width="100%">
 				<mx:Button id="saveButton" label="Save" 
	            	icon="@Embed('../assets/action_save.gif')" click="validateAndSaveRequest()">
	            </mx:Button>
				<mx:Button label="Close" enabled="true" visible="true" click="PopUpManager.removePopUp(this)"/>								

	 	    </mx:HBox>
 			
 		</mx:ViewStack>
 	   	
 	   </mx:ControlBar>
	
    
</mx:Panel>
