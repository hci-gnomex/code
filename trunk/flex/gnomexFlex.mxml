<?xml version="1.0" encoding="utf-8"?>
<mx:Application xmlns:mx="http://www.adobe.com/2006/mxml" width="100%" height="100%" xmlns="*" 
	xmlns:views="views.*"  
	paddingLeft="5" paddingRight="5" paddingTop="5" paddingBottom="5" 
	backgroundGradientColors="[#8db4d3, #ffffff]" 
	initialize="init()" 
	>
	

	     
        <mx:Style source="css/gnomex_flex.css" />
        
            <mx:Script>
            
        <![CDATA[
        	import mx.collections.XMLListCollection;
            import mx.controls.Alert;
            import mx.rpc.events.ResultEvent;        
            import mx.managers.CursorManager;

            public	var fileDownloadUtil:views.FileDownloadUtil;

            
            private function search():void {
            	theViews.selectedIndex=7;
 				navSearchView.searchViews.selectedIndex=1;
            	var params:Object = new Object();
            	params.text = searchText.text;
            	
            
            	CursorManager.setBusyCursor();
            	navSearchView.searchView.searchGNomEx.send(params);
            	CursorManager.removeBusyCursor();
            	
            	
            }

            
            private function init():void {
            	XML.ignoreWhitespace = true;
				XML.prettyPrinting = false;

            	createSecurityAdvisor.send();
            } 
            public  function formatDate(date:Date):String {
			    return date.getFullYear().toString() + 
                    '-' + (date.getMonth()+1).toString() + '-' + date.getDate();
            }
            
                   
            public function getUserName(item:Object, col:int):String 
            { 
	        	var userName:String = "";
	        	var appUserList:XMLList = getAppUserList.lastResult.AppUser;     			
	        	for(var i:Number = 0; i < appUserList.length(); i++) {
	            	if(appUserList[i].@idAppUser == item.@idAppUser) {
	                	userName = getAppUserList.lastResult.AppUser[i].@displayName;
	                    break;
	             	}
	             }
	             return userName;
       	
            }
            public function getLabName(item:Object, col:int):String 
            { 
	        	var labName:String = "";
	        	var labList:XMLList = getLabList.lastResult.Lab;     			
	        	for(var i:Number = 0; i < labList.length(); i++) {
	            	if(labList[i].@idLab == item.@idLab) {
	                	labName = labList[i].@name;
	                    break;
	             	}
	             }
	             return labName;
       	
            }
            
            private function onCreateSecurityAdvisor(event:ResultEvent):void {
            	manageDictionaries.send();
            	getAppUserList.send();
            	getExperimentDesignList.send();
            	getExperimentFactorList.send();
            	getLabList.send();
            	getSlideProductList.send();
            	getProjectList.send();
            }
            private function onManageDictionaries(event:ResultEvent):void {
            }
            
            private function onGetAppUserList(event:ResultEvent):void {
            }
            
            private function onGetExperimentDesignList(event:ResultEvent):void {
	        }		
	        
			private function onGetExperimentFactorList(event:ResultEvent):void {
	        }
	        
	        private function onGetLabList(event:ResultEvent):void {
	        }		
            
            private function onGetSlideProductList(event:ResultEvent):void {
	        }		
            private function onGetProjectList(event:ResultEvent):void {
	        }
            
            
        ]]>
    </mx:Script>
    
    	
	<mx:HTTPService 
    id="createSecurityAdvisor" 
    url="http://localhost/gnomex/CreateSecurityAdvisor.gx"
    resultFormat="e4x"
    result="onCreateSecurityAdvisor(event)"
    destination="createSecurityAdvisor"
    showBusyCursor="true"
    useProxy="false">
    <mx:request>
    </mx:request>
    </mx:HTTPService > 
    
    
    <mx:HTTPService 
    id="getAppUserList" 
    url="http://localhost/gnomex/GetAppUserList.gx"
    resultFormat="e4x"
    result="onGetAppUserList(event)"
    destination="getAppUserList"
    showBusyCursor="false"
    useProxy="false">
    <mx:request>
    </mx:request>
    </mx:HTTPService >
    
        
    <mx:HTTPService 
    id="manageDictionaries" 
    url="http://localhost/gnomex/ManageDictionaries.gx"
    resultFormat="e4x"
        result="onManageDictionaries(event)"
    destination="manageDictionaries"
    showBusyCursor="true"
    useProxy="false">
    <mx:request>
       <action>load</action>
    </mx:request>
    </mx:HTTPService >
    
    <mx:HTTPService 
    id="getExperimentDesignList" 
    url="http://localhost/gnomex/GetExperimentDesignList.gx"
    resultFormat="e4x"
    showBusyCursor="false"
    destination="getExperimentDesignList"
    result="onGetExperimentDesignList(event)"
    useProxy="false">
    <mx:request>
    </mx:request>
    </mx:HTTPService >
    
    <mx:HTTPService 
    id="getExperimentFactorList" 
    url="http://localhost/gnomex/GetExperimentFactorList.gx"
    resultFormat="e4x"
    showBusyCursor="false"
    result="onGetExperimentFactorList(event)"
    destination="getExperimentFactorList"
    useProxy="false">
    <mx:request>
    </mx:request>
    </mx:HTTPService >
         
         
    <mx:HTTPService 
    id="getLabList" 
    url="http://localhost/gnomex/GetLabList.gx"
    showBusyCursor="true"
    resultFormat="e4x"
    result="onGetLabList(event)"
    destination="getLabList"
    useProxy="false">
    <mx:request>
           <listKind>UnboundedLabList</listKind>
    </mx:request>
    </mx:HTTPService >
    
    <mx:HTTPService 
    id="getSlideProductList" 
    url="http://localhost/gnomex/GetSlideProductList.gx"
    showBusyCursor="false"
    resultFormat="e4x"
    result="onGetSlideProductList(event)"
    destination="getSlideProductList"
    useProxy="false">
    <mx:request>
    </mx:request>
    </mx:HTTPService >
    
    <mx:HTTPService 
    id="getProjectList" 
    url="http://localhost/gnomex/GetProjectList.gx"
    resultFormat="e4x"
    result="onGetProjectList(event)"
    destination="getProjectList"
    showBusyCursor="false"
    useProxy="false">
    <mx:request>
    </mx:request>
    </mx:HTTPService >
    
    <mx:XMLListCollection id="dictionaryEntries" source="{manageDictionaries.lastResult.Dictionary.(@className == 'hci.gnomex.model.LabelingReactionSize').DictionaryEntry}"/>
    <mx:XMLListCollection id="experimentDesignList" source="{getExperimentDesignList.lastResult.ExperimentDesign}"/>
    <mx:XMLListCollection id="experimentFactorList" source="{getExperimentFactorList.lastResult.ExperimentFactor}"/>

	    <mx:VBox id="topArea" width="100%" height="100%" verticalGap="0">
	      <mx:HBox width="100%"  horizontalAlign="right" verticalAlign="top" horizontalGap="0" paddingBottom="0">
	        <mx:HBox width="100%" height="100%" horizontalAlign="left" horizontalGap="0">
	          <mx:Label text="GNomEx" id="appLabel" fontFamily="Arial" fontSize="18" color="#ffffff"/>
	          <mx:HBox width="100%" height="100%" horizontalAlign="right" paddingLeft="10" paddingRight="12" horizontalGap="26">
	            <mx:HBox horizontalAlign="left" width="100%" paddingLeft="40">
	            </mx:HBox>
	            
	            <mx:HBox height="100%" horizontalGap="2">
	              <mx:Label text="Request #" color="#ffffff"/>
	              <mx:TextInput id="requestNumber" backgroundAlpha="0.89" borderStyle="inset" width="56"/>
	              <mx:Button label="Lookup" id="lookupButton"  
	              	fontFamily="Arial" fillColors="[#6aa0c8, #bad8bb]" 
	              	alpha="1.0" fillAlphas="[.71, .71]" color="#400040"/>
	            </mx:HBox>
	            <mx:HBox height="100%" horizontalAlign="right" horizontalGap="2">
	              <mx:TextInput id="searchText" backgroundAlpha="0.89" borderStyle="inset" width="118"/>
	              <mx:Button label="Search" id="searchButton" click="theViews.selectedIndex=7;callLater(search)" fontFamily="Arial" fillColors="[#6aa0c8, #bad8bb]" fillAlphas="[0.71, 1.0]"/>
	            </mx:HBox>
	          </mx:HBox>
	        </mx:HBox>
	        <mx:HBox horizontalAlign="right" verticalAlign="top" horizontalGap="3">
	    	    <mx:LinkButton label="Help" color="#ffffff"/>
	    	    <mx:LinkButton label="About" color="#ffffff"/>
	        </mx:HBox>
	      </mx:HBox>
	    
	    

        
        
	      <mx:VBox id="mainArea" width="100%" height="100%" paddingTop="1" paddingLeft="0" paddingRight="0" horizontalCenter="0"  verticalGap="12">
<!--        <mx:ApplicationControlBar id="navBar" width="100%"  horizontalAlign="center" fontGridFitType="pixel" fillAlphas="[1.0, 1.0]" fillColors="[#d7ffd7, #5083ad]">
 -->            
            <mx:ToggleButtonBar
                dataProvider="{theViews}" width="100%" 
                paddingBottom="0" paddingLeft="0" paddingRight="0" paddingTop="0" alpha="1.0" buttonHeight="25"/>
                
<!--        </mx:ApplicationControlBar> -->

        <mx:ViewStack id="theViews" width="100%" height="100%"  creationPolicy="auto">

	        <mx:Canvas label="Submit Request"/>
	        
	        <views:NavExperimentView width="100%" height="100%">
	        </views:NavExperimentView>
	        
	        <mx:Canvas label="Analysis"/>


	        <mx:Canvas label="Methods and Materials"/>
	        

	        <views:NavWorkflowView width="100%" height="100%">
	        </views:NavWorkflowView>

	        
	        <views:NavUsersView width="100%" height="100%" backgroundAlpha="1.0">	
	        </views:NavUsersView>

	        <mx:Canvas label="Dictionaries"/>
	        
           <views:NavSearchView id="navSearchView" width="100%" height="100%" backgroundAlpha="1.0">	
	        </views:NavSearchView>



      </mx:ViewStack> 
     </mx:VBox>
     

	 </mx:VBox>
	    <mx:HBox width="100%" visible="true">
	    	    <mx:ProgressBar id="downloadProgress" label="" mode="manual"  labelPlacement="left" visible="false"/>
	    	    <mx:Button id="cancelDownloadButton" label="Cancel" click="fileDownloadUtil.cancelDownload();" enabled="true"  fillColors="[#6aa0c8, #bad8bb]" fontFamily="Arial" color="#000000" visible="false"/>
	    </mx:HBox>
	
	
</mx:Application>
